<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>code working in iphone but not on android??? Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>code working in iphone but not on android???</h1>
		</header>
		<section>
			<p>Hi,</p>
<p>The following piece of code works fine with iphone but not on android.Dont know why???</p>
<pre><code class="hljs">data[i] = {<span class="hljs-string">'id'</span><span class="hljs-symbol">:deals</span>[i].primary_category.id, <span class="hljs-string">'view'</span><span class="hljs-symbol">:view_deal</span>};
</code></pre><p>Thanks</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="December 7th 2011, 2:39:35 am">December 7th 2011</span>
				by <span class='authorname'>mathew orleans</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-224987">
				
						<section>
							<p>Hi Mathew </p>
<p>Try this below code.</p>
<pre><code class="hljs">data.push({<span class="hljs-string">'id'</span><span class="hljs-symbol">:deals</span>[i].primary_category.id, <span class="hljs-string">'view'</span><span class="hljs-symbol">:view_deal</span>});
</code></pre><p>regards</p>
<p>Nikunj</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 7th 2011, 3:22:35 am">December 7th 2011</span>
								by <span class='authorname'>Nikunj Sakhrelia</span><br>
								<a class="icon-bg icon-link" href="question/129157/code-working-in-iphone-but-not-on-android#answer-224987" rel="permalink">permalink</a>
							</div>

							<h5>7 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>no didnt worked ..still crashing.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 7th 2011, 4:07:34 am">December 7th 2011</span>
											by <span class='authorname'>mathew orleans</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi mathew</p>
<p>if you can able to share more code on this which might help me to test the code so try to share some more code for this.</p>
<p>Regards</p>
<p>Nikunj</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 7th 2011, 4:09:30 am">December 7th 2011</span>
											by <span class='authorname'>Nikunj Sakhrelia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>If you run this on iphone, it will work fine..But on android it will crash. So i have written one comment for you where the code is crashing on android. </p>
<pre><code class="hljs"><span class="hljs-comment">//</span>
<span class="hljs-comment">// ui/home.js</span>
<span class="hljs-keyword">var</span> win = Titanium.UI.currentWindow;
win.backgroundImage = <span class="hljs-string">'../images/sky_bgr.png'</span>;


<span class="hljs-keyword">if</span>(Titanium.Platform.name == <span class="hljs-string">'android'</span>){
    <span class="hljs-comment">//alert('android');</span>
}
<span class="hljs-keyword">else</span>{
    win.hideNavBar(); 
}

Titanium.Geolocation.purpose = <span class="hljs-string">"Get user location"</span>;
Titanium.Geolocation.accuracy = Titanium.Geolocation.ACCURACY_BEST;
Titanium.Geolocation.distanceFilter = <span class="hljs-number">500</span>;
<span class="hljs-keyword">var</span> lat = <span class="hljs-number">10</span>;
<span class="hljs-keyword">var</span> lon = <span class="hljs-number">10</span>;

Titanium.Geolocation.getCurrentPosition(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">if</span>(e.error) {
        Titanium.API.info(<span class="hljs-string">'location error: '</span> + e.error);
        <span class="hljs-keyword">return</span>;
    }

    Titanium.API.info(<span class="hljs-string">'location: '</span> + e.coords);
    lat = e.coords.latitude;
    lon = e.coords.longitude;
});

<span class="hljs-comment">//var data_id = [];</span>

<span class="hljs-comment">/////////</span>
<span class="hljs-comment">// Label</span>
<span class="hljs-keyword">var</span> lbl_whatever = Titanium.UI.createLabel({
    text:<span class="hljs-string">'No gimmicks. Just great deals'</span>,
    font:{size:<span class="hljs-number">9</span>, fontWeight:<span class="hljs-string">'bold'</span>},
    color:<span class="hljs-string">'#013662'</span>,
    width:<span class="hljs-string">'auto'</span>,
    height:<span class="hljs-string">'15px'</span>,
    top:<span class="hljs-string">'3px'</span>,
    left:<span class="hljs-string">'10px'</span>
});

<span class="hljs-keyword">var</span> lbl_your_bag = Titanium.UI.createLabel({
    text:<span class="hljs-string">'your bag'</span>,
    font:{size:<span class="hljs-number">8</span>,fontWeight:<span class="hljs-string">'bold'</span>},
    color:<span class="hljs-string">'#013662'</span>,
    width:<span class="hljs-string">'auto'</span>,
    height:<span class="hljs-string">'15px'</span>,
    top:<span class="hljs-string">'10px'</span>,
    right:<span class="hljs-string">'12px'</span>
});

win.add(lbl_whatever);
win.add(lbl_your_bag);

<span class="hljs-comment">//////////</span>
<span class="hljs-comment">// Images</span>
<span class="hljs-keyword">var</span> img_you_got_it = Titanium.UI.createImageView({
    image:<span class="hljs-string">'../images/you_got_it_82x47.png'</span>,
    width:<span class="hljs-string">'82px'</span>,
    height:<span class="hljs-string">'47px'</span>,
    top:<span class="hljs-string">'16px'</span>,
    left:<span class="hljs-string">'160px'</span>
});

<span class="hljs-comment">//</span>
<span class="hljs-keyword">var</span> img_green_bag = Titanium.UI.createImageView({
    image:<span class="hljs-string">'../images/green_bag.png'</span>,
    width:<span class="hljs-string">'44px'</span>,
    height:<span class="hljs-string">'37px'</span>,
    top:<span class="hljs-string">'28px'</span>,
    right:<span class="hljs-string">'20px'</span>
});

win.add(img_you_got_it);
win.add(img_green_bag);

<span class="hljs-comment">/////////////</span>
<span class="hljs-comment">// Combo box</span>

<span class="hljs-comment">// Combo box button</span>
<span class="hljs-keyword">var</span> drop_button =  Titanium.UI.createButton({
    image:<span class="hljs-string">'../images/combo_arrow.png'</span>,
    width:<span class="hljs-string">'23px'</span>,
    height:<span class="hljs-string">'27px'</span>,
    right:<span class="hljs-string">'0px'</span>
});

<span class="hljs-comment">// Combo box</span>
<span class="hljs-keyword">var</span> combo_sort = Titanium.UI.createTextField({
    hintText:<span class="hljs-string">"Sort by"</span>,
    font:{size:<span class="hljs-number">11</span>},
    height:<span class="hljs-string">'27px'</span>,
    width:<span class="hljs-string">'130px'</span>,
    top:<span class="hljs-string">'30px'</span>,
    left:<span class="hljs-string">'10px'</span>,
    borderStyle:Titanium.UI.INPUT_BORDERSTYLE_ROUNDED,
    enabled:<span class="hljs-literal">false</span>
});

combo_sort.add(drop_button);


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createDealsUI</span>(<span class="hljs-params">deals</span>) </span>{

    <span class="hljs-keyword">if</span>(!!win.scrollView &amp;&amp; win.scrollView) { win.remove(win.scrollView); }

    <span class="hljs-keyword">var</span> rect_x = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> buttons = [];
    <span class="hljs-keyword">var</span> data = [];




    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; deals.length; i++) {
        <span class="hljs-keyword">if</span>(i &gt; <span class="hljs-number">0</span>) { rect_x += <span class="hljs-number">135</span>; }

       <span class="hljs-keyword">var</span> dealId = (deals[i].pk) ? deals[i].pk : <span class="hljs-string">''</span>;
       <span class="hljs-keyword">var</span> merchant = (deals[i].merchant) ? deals[i].merchant : {};
       <span class="hljs-keyword">var</span> subtitle = (deals[i].subtitle) ? deals[i].subtitle : <span class="hljs-string">""</span>;
       <span class="hljs-keyword">var</span> description = (deals[i].description) ? deals[i].description : <span class="hljs-string">""</span>;
       <span class="hljs-keyword">var</span> title = (deals[i].title) ? deals[i].title : <span class="hljs-string">""</span>;
       <span class="hljs-keyword">var</span> price = (deals[i].price) ? deals[i].price : <span class="hljs-string">""</span>;
       <span class="hljs-keyword">var</span> discount = (deals[i].discount) ? deals[i].discount : <span class="hljs-string">""</span>;
       <span class="hljs-keyword">var</span> featured = (deals[i]) ? deals[i].featured : <span class="hljs-literal">false</span>;
       <span class="hljs-keyword">var</span> image_url = (deals[i].image) ? Ti.App.Properties.getString(<span class="hljs-string">'hostname'</span>) + <span class="hljs-string">'/static/'</span> + deals[i].image : <span class="hljs-string">""</span>;
        <span class="hljs-comment">// Addresess</span>

       <span class="hljs-keyword">var</span> address = (deals[i].locations &amp;&amp; deals[i].locations[<span class="hljs-number">0</span>]) ? deals[i].locations[<span class="hljs-number">0</span>].address : <span class="hljs-string">""</span>;
       <span class="hljs-keyword">var</span> city = (deals[i].locations &amp;&amp; deals[i].locations[<span class="hljs-number">0</span>]) ? deals[i].locations[<span class="hljs-number">0</span>].city : <span class="hljs-string">""</span>;
       <span class="hljs-keyword">var</span> zip = (deals[i].locations &amp;&amp; deals[i].locations[<span class="hljs-number">0</span>]) ? deals[i].locations[<span class="hljs-number">0</span>].zip : <span class="hljs-string">""</span>;
       <span class="hljs-keyword">var</span> country = (deals[i].locations &amp;&amp; deals[i].locations[<span class="hljs-number">0</span>]) ? deals[i].locations[<span class="hljs-number">0</span>].country : <span class="hljs-string">""</span>;
       <span class="hljs-keyword">var</span> longitude = (deals[i].locations &amp;&amp; deals[i].locations[<span class="hljs-number">0</span>]) ? deals[i].locations[<span class="hljs-number">0</span>].logitude : <span class="hljs-number">0</span>;
       <span class="hljs-keyword">var</span> latitude = (deals[i].locations &amp;&amp; deals[i].locations[<span class="hljs-number">0</span>]) ? deals[i].locations[<span class="hljs-number">0</span>].latitude : <span class="hljs-number">0</span>;
       <span class="hljs-keyword">var</span> state = (deals[i].locations &amp;&amp; deals[i].locations[<span class="hljs-number">0</span>]) ? deals[i].locations[<span class="hljs-number">0</span>].state : <span class="hljs-string">""</span>;
       <span class="hljs-keyword">var</span> distance = (deals[i].locations &amp;&amp; deals[i].locations[<span class="hljs-number">0</span>]) ? deals[i].locations[<span class="hljs-number">0</span>].distance : <span class="hljs-string">''</span>;
        <span class="hljs-comment">//Titanium.API.info(distance);</span>



       <span class="hljs-keyword">if</span>(distance &gt; <span class="hljs-number">0</span>) {
            <span class="hljs-keyword">var</span> calc = (distance / <span class="hljs-number">1.6</span>);
            distance = calc.toFixed(<span class="hljs-number">2</span>) + <span class="hljs-string">' Miles'</span>;
        }
        <span class="hljs-keyword">else</span> {
            distance = <span class="hljs-string">''</span>;
        }

        <span class="hljs-comment">// UI</span>
        <span class="hljs-comment">// </span>
        <span class="hljs-keyword">var</span> view_deal = Ti.UI.createView({
            height:<span class="hljs-string">'130px'</span>,
            width:<span class="hljs-string">'300px'</span>,
            top:rect_x + <span class="hljs-string">'px'</span>,
            left:<span class="hljs-string">'5px'</span>,
            backgroundColor:<span class="hljs-string">'#fff'</span>,
            borderRadius:<span class="hljs-number">5</span>
        });

        <span class="hljs-comment">//</span>
        <span class="hljs-keyword">var</span> lbl_title = Titanium.UI.createLabel({
            text:title,
            font:{size:<span class="hljs-number">18</span>, fontWeight:<span class="hljs-string">'bold'</span>},
            color:<span class="hljs-string">'#000'</span>,
            width:<span class="hljs-string">'auto'</span>,
            height:<span class="hljs-string">'25px'</span>,
            top:<span class="hljs-string">'5px'</span>,
            left:<span class="hljs-string">'5px'</span>
        });
        view_deal.add(lbl_title);

        <span class="hljs-comment">//</span>
        <span class="hljs-keyword">var</span> lbl_address = Titanium.UI.createLabel({
            text:zip + <span class="hljs-string">' '</span> + address,
            font:{size:<span class="hljs-number">9</span>},
            color:<span class="hljs-string">'blue'</span>,
            width:<span class="hljs-string">'240px'</span>,
            height:<span class="hljs-string">'11px'</span>,
            top:<span class="hljs-string">'30px'</span>,
            left:<span class="hljs-string">'5px'</span>
        });
        view_deal.add(lbl_address);

        <span class="hljs-comment">//</span>
        <span class="hljs-keyword">var</span> lbl_desc = Titanium.UI.createLabel({
            text:description,
            font:{size:<span class="hljs-number">14</span>, fontWeight:<span class="hljs-string">'bold'</span>},
            color:<span class="hljs-string">'#000'</span>,
            width:<span class="hljs-string">'200px'</span>,
            height:<span class="hljs-string">'60px'</span>,
            top:<span class="hljs-string">'45px'</span>,
            left:<span class="hljs-string">'5px'</span>
        });
        view_deal.add(lbl_desc);

        <span class="hljs-comment">//</span>
        <span class="hljs-keyword">var</span> lbl_discount = Titanium.UI.createLabel({
            text:<span class="hljs-string">"Discount: "</span> + discount,
            font:{size:<span class="hljs-number">7</span>},
            color:<span class="hljs-string">'blue'</span>,
            width:<span class="hljs-string">'200px'</span>,
            height:<span class="hljs-string">'60px'</span>,
            top:<span class="hljs-string">'85px'</span>,
            left:<span class="hljs-string">'5px'</span>
        });
        view_deal.add(lbl_discount);

        <span class="hljs-comment">//</span>
        <span class="hljs-keyword">var</span> lbl_dist = Titanium.UI.createLabel({
            text:distance,
            font:{size:<span class="hljs-number">9</span>, fontWeight:<span class="hljs-string">'bold'</span>},
            color:<span class="hljs-string">'#000'</span>,
            width:<span class="hljs-string">'auto'</span>,
            height:<span class="hljs-string">'13px'</span>,
            top:<span class="hljs-string">'10px'</span>,
            right:<span class="hljs-string">'5px'</span>
        });
        view_deal.add(lbl_dist);

        <span class="hljs-comment">//</span>
        <span class="hljs-keyword">var</span> lbl_map = Titanium.UI.createLabel({
            text:<span class="hljs-string">'Map It'</span>,
            font:{size:<span class="hljs-number">9</span>, fontWeight:<span class="hljs-string">'bold'</span>},
            color:<span class="hljs-string">'blue'</span>,
            width:<span class="hljs-string">'auto'</span>,
            height:<span class="hljs-string">'13px'</span>,
            top:<span class="hljs-string">'30px'</span>,
            right:<span class="hljs-string">'5px'</span>
        });
        view_deal.add(lbl_map);

        <span class="hljs-comment">//</span>
        <span class="hljs-keyword">var</span> img_deal = Titanium.UI.createImageView({
            image:image_url,
            top:<span class="hljs-string">'45px'</span>,
            right:<span class="hljs-string">'5px'</span>,
            width:<span class="hljs-string">'48px'</span>,
            height:<span class="hljs-string">'48px'</span>
        });
        view_deal.add(img_deal);

        <span class="hljs-comment">//</span>
        buttons[i] = Titanium.UI.createButton({
            image:<span class="hljs-string">'../images/go_btn.png'</span>,
            width:<span class="hljs-string">'71px'</span>,
            height:<span class="hljs-string">'30px'</span>,
            bottom:<span class="hljs-string">'5px'</span>,
            right:<span class="hljs-string">'5px'</span>,
            bid:dealId
        });
        view_deal.add(buttons[i]);

        <span class="hljs-comment">// Actions</span>
        lbl_map.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-comment">//<span class="hljs-doctag">TODO:</span>fix this</span>
            win.tabGroup.setActiveTab(<span class="hljs-number">1</span>);
            win.deal_id = dealId;
        });

        <span class="hljs-comment">// Go button</span>
        buttons[i].addEventListener(<span class="hljs-string">'click'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
            <span class="hljs-keyword">var</span> w = Titanium.UI.createWindow({
                url:<span class="hljs-string">'deal_select.js'</span>,
                title:<span class="hljs-string">'Deal Select'</span>,
                top:<span class="hljs-string">'0px'</span>,
                left:<span class="hljs-string">'0px'</span>
            });

            w.open();

            <span class="hljs-keyword">var</span> did = e.source.bid;
            w.deal_id = did;


        });

        <span class="hljs-keyword">if</span>(Titanium.Platform.name == <span class="hljs-string">'android'</span>){
    <span class="hljs-comment">//alert('android');</span>
    <span class="hljs-comment">//data.push({'id':deals[i].primary_category.id, 'view':view_deal});</span>
    }
    <span class="hljs-keyword">else</span>{
      data[i] = {<span class="hljs-string">'id'</span>:deals[i].primary_category.id, <span class="hljs-string">'view'</span>:view_deal};
    }




    }

    <span class="hljs-comment">//</span>
    <span class="hljs-keyword">if</span>(data.length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">if</span>(rect_x == <span class="hljs-number">0</span>) { rect_x = <span class="hljs-string">'130px'</span>; }

        win.scrollView = Titanium.UI.createScrollView({
            contentWidth:<span class="hljs-string">'auto'</span>,
            contentHeight:<span class="hljs-string">'auto'</span>,
            top:<span class="hljs-string">'65px'</span>,
            showVerticalScrollIndicator:<span class="hljs-literal">true</span>,
            type:<span class="hljs-string">'vertical'</span>
        });

        <span class="hljs-keyword">var</span> view = Ti.UI.createView({
            backgroundColor:<span class="hljs-string">'none'</span>,
            borderRadius:<span class="hljs-string">'0px'</span>,
            width:<span class="hljs-string">'310px'</span>,
            height:rect_x + <span class="hljs-string">'px'</span>,
            top:<span class="hljs-string">'0px'</span>,
            left:<span class="hljs-string">'5px'</span>
        }); 

        win.scrollView.add(view);

        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; data.length; j++) {
            view.add(data[j].view);
        }

        win.add(win.scrollView);
    }
}

<span class="hljs-comment">// Sort </span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sortDeals</span>(<span class="hljs-params">sortBy</span>) </span>{
    <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();
    xhr.timeout = <span class="hljs-number">1000000</span>;

    <span class="hljs-keyword">var</span> urlStr = Ti.App.Properties.getString(<span class="hljs-string">'apiUrl'</span>) + <span class="hljs-string">'/deals/'</span>;
    Titanium.API.info(<span class="hljs-string">'urlStr: '</span> + urlStr);

    xhr.open(<span class="hljs-string">'GET'</span>, urlStr);
    xhr.setRequestHeader(<span class="hljs-string">'Authorization'</span>, Ti.App.Properties.getString(<span class="hljs-string">'userAuth'</span>));

    xhr.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        Titanium.API.info(<span class="hljs-string">'deals error'</span>);
        Titanium.API.info(e);
    };

    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">var</span> data = <span class="hljs-built_in">eval</span>(<span class="hljs-string">'('</span>+xhr.responseText+<span class="hljs-string">')'</span>);
            <span class="hljs-keyword">if</span>(data.length &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">var</span> sorted = [];
                <span class="hljs-keyword">var</span> s = <span class="hljs-number">0</span>;
                <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; data.length; i++) {
                    <span class="hljs-keyword">if</span>(data[i].primary_category.id == sortBy) {
                        sorted[s] = data[i];
                        s += <span class="hljs-number">1</span>;
                    }
                }

                Titanium.API.info(<span class="hljs-string">'Sorted: '</span> + sorted.length);
                createDealsUI(sorted);
            }
            <span class="hljs-keyword">else</span> {
                alert(<span class="hljs-string">'No deals'</span>);
            }
        }
        <span class="hljs-keyword">catch</span>(E){
            Titanium.API.info(<span class="hljs-string">'getAllDeals'</span>);
            Titanium.API.info(E);
        }
    };
    <span class="hljs-comment">// Get the data</span>
    xhr.send();
}

<span class="hljs-comment">// Picker</span>
<span class="hljs-keyword">var</span> picker_view = Titanium.UI.createView({
    width:<span class="hljs-number">290</span>,
    height:<span class="hljs-number">231</span>,
    bottom:<span class="hljs-number">0</span>
});

<span class="hljs-keyword">var</span> picker = Titanium.UI.createPicker({
    top:<span class="hljs-number">43</span>
});

picker.selectionIndicator=<span class="hljs-literal">true</span>;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getPickerData</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> picker_data = [];
    <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();
    xhr.timeout = <span class="hljs-number">1000000</span>;

    <span class="hljs-keyword">var</span> urlStr = Ti.App.Properties.getString(<span class="hljs-string">'apiUrl'</span>) + <span class="hljs-string">'/categories/'</span>;
    xhr.open(<span class="hljs-string">'GET'</span>, urlStr);
    xhr.setRequestHeader(<span class="hljs-string">'Authorization'</span>, Ti.App.Properties.getString(<span class="hljs-string">'userAuth'</span>));

    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">var</span> categories = <span class="hljs-built_in">eval</span>(<span class="hljs-string">'('</span>+xhr.responseText+<span class="hljs-string">')'</span>);
            <span class="hljs-comment">//alert(categories);</span>
            <span class="hljs-comment">// UI</span>
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; categories.length; i++) {
                <span class="hljs-keyword">var</span> name = (categories[i].name) ? categories[i].name : <span class="hljs-string">''</span>;
                <span class="hljs-keyword">var</span> cid = (categories[i].id) ? categories[i].id : <span class="hljs-string">''</span>;

                picker_data[i] = Titanium.UI.createPickerRow({title:name, id:cid});
            }

            picker.add(picker_data);
            picker_view.add(picker);
            win.add(combo_sort);
        }
        <span class="hljs-keyword">catch</span>(E) {
            alert(<span class="hljs-string">'getPickerData'</span>);
            alert(E);
        }
    };

    xhr.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        Titanium.API.info(<span class="hljs-string">'picker error'</span>);
        Titanium.API.info(e);
    };

    xhr.send();
}
getPickerData();

<span class="hljs-keyword">var</span> slide_in = Titanium.UI.createAnimation({bottom:<span class="hljs-number">0</span>});
<span class="hljs-keyword">var</span> slide_out = Titanium.UI.createAnimation({bottom:-<span class="hljs-number">251</span>});

combo_sort.addEventListener(<span class="hljs-string">'focus'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    picker_view.animate(slide_out);
});

drop_button.addEventListener(<span class="hljs-string">'click'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    win.add(picker_view);
    picker_view.animate(slide_in);
    combo_sort.blur();
});

picker.addEventListener(<span class="hljs-string">'change'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    combo_sort.value = picker.getSelectedRow(<span class="hljs-number">0</span>).title;

    sortDeals(picker.getSelectedRow(<span class="hljs-number">0</span>).id);

    picker_view.animate(slide_out);

    <span class="hljs-keyword">if</span>(!!picker_view) {
        win.remove(picker_view);
    }
});

<span class="hljs-comment">/////////////</span>
<span class="hljs-comment">// Deal views</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAllDeals</span>(<span class="hljs-params">args</span>) </span>{
    <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();
    xhr.timeout = <span class="hljs-number">1000000</span>;

    <span class="hljs-keyword">var</span> urlStr = Ti.App.Properties.getString(<span class="hljs-string">'apiUrl'</span>) + <span class="hljs-string">'/deals/'</span>;
    Titanium.API.info(<span class="hljs-string">'urlStr: '</span> + urlStr);

    <span class="hljs-keyword">if</span>(args.filter == <span class="hljs-string">'nearby'</span>) {
        Titanium.API.info(<span class="hljs-string">'Near By -&gt; '</span> + args.filter + <span class="hljs-string">'/'</span> + lat + <span class="hljs-string">'/'</span> + lon + <span class="hljs-string">'/'</span>);
        urlStr += args.filter + <span class="hljs-string">'/'</span> + lat + <span class="hljs-string">'/'</span> + lon + <span class="hljs-string">'/'</span>;


    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(args.filter == <span class="hljs-string">'featured'</span>) {
        Titanium.API.info(<span class="hljs-string">'Featured -&gt; '</span> + args.filter + <span class="hljs-string">'/'</span> + lat + <span class="hljs-string">'/'</span> + lon + <span class="hljs-string">'/'</span>);
        urlStr += args.filter + <span class="hljs-string">'/'</span> + lat + <span class="hljs-string">'/'</span> + lon + <span class="hljs-string">'/'</span>;
        Titanium.API.info(<span class="hljs-string">'urlStr in if: '</span> + urlStr);
    }


    xhr.open(<span class="hljs-string">'GET'</span>, urlStr);
    xhr.setRequestHeader(<span class="hljs-string">'Authorization'</span>, Ti.App.Properties.getString(<span class="hljs-string">'userAuth'</span>));

    xhr.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        Titanium.API.info(<span class="hljs-string">'deals error'</span>);
        Titanium.API.info(e);
    };

    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">var</span> data = <span class="hljs-built_in">eval</span>(<span class="hljs-string">'('</span>+xhr.responseText+<span class="hljs-string">')'</span>);
            <span class="hljs-keyword">if</span>(data.length &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-comment">//Titanium.API.info(data);</span>
              createDealsUI(data);
            }
            <span class="hljs-keyword">else</span> {
                alert(<span class="hljs-string">'No deals'</span>);
            }
        }
        <span class="hljs-keyword">catch</span>(E){
            Titanium.API.info(<span class="hljs-string">'getAllDeals'</span>);
            Titanium.API.info(E);
        }
    };
    <span class="hljs-comment">// Get the data</span>
    xhr.send();
}
<span class="hljs-comment">//change for android</span>
<span class="hljs-keyword">if</span>(Titanium.Platform.name == <span class="hljs-string">'android'</span>){
    <span class="hljs-comment">//alert('android');</span>
    getAllDeals({});
}
<span class="hljs-keyword">else</span>{
getAllDeals({});
}
<span class="hljs-comment">//////////////</span>
<span class="hljs-comment">// Tabbed bar</span>


<span class="hljs-keyword">if</span>(Titanium.Platform.name == <span class="hljs-string">'android'</span>){
    <span class="hljs-comment">//alert('android');</span>
}
<span class="hljs-keyword">else</span>{
    <span class="hljs-keyword">var</span> tabbedBar = Titanium.UI.createTabbedBar({
    labels:[<span class="hljs-string">'My Deals'</span>, <span class="hljs-string">'Nearby'</span>, <span class="hljs-string">'Featured'</span>],
    bottom:<span class="hljs-string">'0px'</span>,
    style:Titanium.UI.iPhone.SystemButtonStyle.BAR,
    height:<span class="hljs-string">'30px'</span>,
    width:<span class="hljs-string">'300px'</span>,
    index:<span class="hljs-number">0</span>
});

<span class="hljs-keyword">var</span> flexSpace = Titanium.UI.createButton({
    systemButton:Titanium.UI.iPhone.SystemButton.FLEXIBLE_SPACE
});

tabbedBar.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    combo_sort.value = <span class="hljs-string">''</span>;
    combo_sort.hintText = <span class="hljs-string">'Sort by'</span>;

    <span class="hljs-keyword">if</span>(e.index == <span class="hljs-number">0</span>) {
        getAllDeals({});
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(e.index == <span class="hljs-number">1</span>) {
        getAllDeals({<span class="hljs-string">'filter'</span>:<span class="hljs-string">'nearby'</span>});
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(e.index == <span class="hljs-number">2</span>) {
        getAllDeals({<span class="hljs-string">'filter'</span>:<span class="hljs-string">'featured'</span>});
    }
});

<span class="hljs-comment">///////////////////////</span>
<span class="hljs-comment">// Add views to window</span>
win.setToolbar([flexSpace, tabbedBar, flexSpace]);

}
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="December 7th 2011, 4:21:45 am">December 7th 2011</span>
											by <span class='authorname'>mathew orleans</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>hey matthew</p>
<p>try to make two block of code as it will not allow a large code so do that and also see preview first.</p>
<p>Regards</p>
<p>Nikunj</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 7th 2011, 4:23:51 am">December 7th 2011</span>
											by <span class='authorname'>Nikunj Sakhrelia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I think the code didnt cameâ¦.just sent you a mail. plz have a look.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 7th 2011, 4:24:53 am">December 7th 2011</span>
											by <span class='authorname'>mathew orleans</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>ok Mathew</p>
<p>I will test it and reply back on it my email is nikunj at mnpinfotech dot com</p>
<p>Regards</p>
<p>Nikunj</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 7th 2011, 4:27:50 am">December 7th 2011</span>
											by <span class='authorname'>Nikunj Sakhrelia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Sent. Have a look please.</p>
<p>Thanks</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 7th 2011, 4:32:18 am">December 7th 2011</span>
											by <span class='authorname'>mathew orleans</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-225075">
				
						<section>
							<p>Why not something like</p>
<pre><code class="hljs"><span class="hljs-typedef"><span class="hljs-keyword">data</span>[i].id=deals[i].primary_category.id;</span>
<span class="hljs-typedef"><span class="hljs-keyword">data</span>[i].view=view_deal;</span>
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 8th 2011, 12:34:18 pm">December 8th 2011</span>
								by <span class='authorname'>Josh Lewis</span><br>
								<a class="icon-bg icon-link" href="question/129157/code-working-in-iphone-but-not-on-android#answer-225075" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
