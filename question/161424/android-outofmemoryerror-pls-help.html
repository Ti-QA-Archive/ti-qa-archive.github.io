<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Android OutOfMemoryError Pls Help Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Android OutOfMemoryError Pls Help</h1>
		</header>
		<section>
			<pre><code class="hljs"><span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err: java.lang.OutOfMemoryError
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at java.io.ByteArrayOutputStream.toByteArray<span class="hljs-list">(<span class="hljs-keyword">ByteArrayOutputStream.java:122</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at org.appcelerator.kroll.util.KrollStreamHelper.toByteArray<span class="hljs-list">(<span class="hljs-keyword">KrollStreamHelper.java:81</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at org.appcelerator.titanium.TiBlob.getBytes<span class="hljs-list">(<span class="hljs-keyword">TiBlob.java:266</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at ti.modules.titanium.network.TiHTTPClient.addTitaniumFileAsPostData<span class="hljs-list">(<span class="hljs-keyword">TiHTTPClient.java:963</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at ti.modules.titanium.network.TiHTTPClient.send<span class="hljs-list">(<span class="hljs-keyword">TiHTTPClient.java:1137</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at ti.modules.titanium.network.HTTPClientProxy.send<span class="hljs-list">(<span class="hljs-keyword">HTTPClientProxy.java:118</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at org.appcelerator.kroll.runtime.v8.V8Object.nativeFireEvent<span class="hljs-list">(<span class="hljs-keyword">Native</span> Method)</span>
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at org.appcelerator.kroll.runtime.v8.V8Object.fireEvent<span class="hljs-list">(<span class="hljs-keyword">V8Object.java:64</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at org.appcelerator.kroll.KrollProxy.doFireEvent<span class="hljs-list">(<span class="hljs-keyword">KrollProxy.java:884</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at org.appcelerator.kroll.KrollProxy.handleMessage<span class="hljs-list">(<span class="hljs-keyword">KrollProxy.java:1107</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at org.appcelerator.titanium.proxy.TiViewProxy.handleMessage<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:329</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at ti.modules.titanium.ui.TableViewProxy.handleMessage<span class="hljs-list">(<span class="hljs-keyword">TableViewProxy.java:939</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at android.os.Handler.dispatchMessage<span class="hljs-list">(<span class="hljs-keyword">Handler.java:95</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at android.os.Looper.loop<span class="hljs-list">(<span class="hljs-keyword">Looper.java:137</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   W/System.err:     at org.appcelerator.kroll.KrollRuntime$KrollRuntimeThread.run<span class="hljs-list">(<span class="hljs-keyword">KrollRuntime.java:112</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiExceptionHandler: <span class="hljs-list">(<span class="hljs-keyword">main</span>)</span> <span class="hljs-list">[<span class="hljs-keyword">3796</span>,<span class="hljs-number">133407</span>] ----- Titanium Javascript Runtime Error -----
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiExceptionHandler: <span class="hljs-list">(<span class="hljs-keyword">main</span>)</span> <span class="hljs-list">[<span class="hljs-keyword">2</span>,<span class="hljs-number">133409</span>] - In ti:/httpclient.js:28,<span class="hljs-number">9</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiExceptionHandler: <span class="hljs-list">(<span class="hljs-keyword">main</span>)</span> <span class="hljs-list">[<span class="hljs-keyword">0</span>,<span class="hljs-number">133409</span>] - Message: Uncaught Error: Java Exception occurred
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiExceptionHandler: <span class="hljs-list">(<span class="hljs-keyword">main</span>)</span> <span class="hljs-list">[<span class="hljs-keyword">0</span>,<span class="hljs-number">133409</span>] - Source:         _send.call<span class="hljs-list">(<span class="hljs-keyword">this</span>, options)</span><span class="hljs-comment">;</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  V8Exception: Exception occurred at ti:/httpclient.js:28: Uncaught Error: Java Exception occurred</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
</code></pre><p>Hi All</p>
<p>I am getting the error above when trying to upload anything over 10mb via a http request, is there anyway around this or am i stuck??</p>
<p>My http is as follows</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> toUpload = fileToUpload.read();

        <span class="hljs-keyword">var</span> sendXhr = Titanium.Network.createHTTPClient();
        sendXhr.setTimeout(<span class="hljs-number">600000</span>);
        sendXhr.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">callback</span>) {
                <span class="hljs-keyword">callback</span>(<span class="hljs-literal">false</span>);
            }
        };

        sendXhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status === <span class="hljs-number">200</span>) {
                <span class="hljs-keyword">var</span> response = <span class="hljs-keyword">this</span>.responseData;
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">callback</span>) {
                    <span class="hljs-keyword">callback</span>(response);
                }
            } <span class="hljs-keyword">else</span> {
                Ti.API.info(<span class="hljs-string">'this.status ='</span> + <span class="hljs-keyword">this</span>.status);
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">callback</span>) {
                    <span class="hljs-keyword">callback</span>(<span class="hljs-literal">false</span>);
                }
            } <span class="hljs-comment">// ENDif return status ok</span>
        };

        sendXhr.onsendstream = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
            progressBar.value = e.progress;
        };

        sendXhr.enableKeepAlive = <span class="hljs-literal">true</span>;

        sendXhr.open(<span class="hljs-string">"POST"</span>, <span class="hljs-string">'https://example.com/upload.php'</span>);

        <span class="hljs-keyword">var</span> params = {
            data : toUpload
        };
        sendXhr.send(params);
</code></pre><p>Any help please thanks</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="January 11th 2014, 8:30:16 am">January 11th 2014</span>
				by <span class='authorname'>Samuel East</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>httpclient</span></li>
					
						<li><span class='tagname'>memory</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>You dont mention if this is on a device or the simulator. ?</p>
</div>
							<div class="author">
								&mdash; commented <span title="January 11th 2014, 11:09:49 am">January 11th 2014</span>
								by <span class='authorname'>Nick Milner</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Apologies this is on the device i am using a Samsung S3 Galaxy to test thanks</p>
</div>
							<div class="author">
								&mdash; commented <span title="January 11th 2014, 11:11:47 am">January 11th 2014</span>
								by <span class='authorname'>Samuel East</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-273801">
				
						<section>
							<p>You could try requesting a larger heap but that requires Android 3.0  (API 11) or greater</p>
<pre><code class="hljs">Requesting a large heap <span class="hljs-keyword">from</span> Dalvik

To request a large heap size <span class="hljs-function_start"><span class="hljs-keyword">on</span></span> Android <span class="hljs-number">3.</span>x <span class="hljs-keyword">and</span> later, <span class="hljs-keyword">set</span> <span class="hljs-keyword">the</span> android:largeHeap <span class="hljs-keyword">property</span> <span class="hljs-keyword">of</span> <span class="hljs-keyword">the</span> &lt;<span class="hljs-type">application</span>&gt; attribute <span class="hljs-keyword">to</span> <span class="hljs-constant">true</span>. Requires &lt;tool-api-level&gt; <span class="hljs-keyword">of</span> <span class="hljs-number">11</span> <span class="hljs-keyword">or</span> higher. Note <span class="hljs-keyword">that</span> you are <span class="hljs-keyword">not</span> guaranteed a fixed increase <span class="hljs-keyword">in</span> available memory, because <span class="hljs-keyword">some</span> devices are constrained <span class="hljs-keyword">by</span> their total available memory.
</code></pre><pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">android</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">manifest</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">application</span> <span class="hljs-attribute">android:largeHeap</span>=<span class="hljs-value">"true"</span>/&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">manifest</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">android</span>&gt;</span>
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 11th 2014, 11:31:18 am">January 11th 2014</span>
								by <span class='authorname'>Nick Milner</span><br>
								<a class="icon-bg icon-link" href="../../question/161424/android-outofmemoryerror-pls-help.html#answer-273801" rel="permalink">permalink</a>
							</div>

							<h5>9 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Nick</p>
<p>I have taken out the &lt;tool-api-level&gt; as the output said it is depreciated, but my tiapp.xml is set as follows i have added the largeheap ill test now thanks.</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">android</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">manifest</span> <span class="hljs-attribute">android:installLocation</span>=<span class="hljs-value">"preferExternal"</span>
            <span class="hljs-attribute">android:versionCode</span>=<span class="hljs-value">"11"</span> <span class="hljs-attribute">android:versionName</span>=<span class="hljs-value">"2.0"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.READ_PHONE_STATE"</span>/&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">supports-screens</span> <span class="hljs-attribute">android:anyDensity</span>=<span class="hljs-value">"false"</span>
                <span class="hljs-attribute">android:largeScreens</span>=<span class="hljs-value">"true"</span> <span class="hljs-attribute">android:normalScreens</span>=<span class="hljs-value">"true"</span> <span class="hljs-attribute">android:smallScreens</span>=<span class="hljs-value">"false"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">uses-sdk</span> <span class="hljs-attribute">android:minSdkVersion</span>=<span class="hljs-value">"10"</span> <span class="hljs-attribute">android:targetSdkVersion</span>=<span class="hljs-value">"14"</span>/&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">application</span> <span class="hljs-attribute">android:largeHeap</span>=<span class="hljs-value">"true"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">manifest</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">activities</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">activity</span> <span class="hljs-attribute">url</span>=<span class="hljs-value">"app.js"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">intent-filter</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">action</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.intent.action.VIEW"</span>/&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">category</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.intent.category.DEFAULT"</span>/&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">category</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.intent.category.BROWSABLE"</span>/&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">intent-filter</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">activity</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">activities</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">android</span>&gt;</span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="January 11th 2014, 11:35:00 am">January 11th 2014</span>
											by <span class='authorname'>Samuel East</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>You might need to adjust</p>
<pre><code class="hljs">&lt;uses-sdk <span class="hljs-string">android:</span>minSdkVersion=<span class="hljs-string">"10"</span> <span class="hljs-string">android:</span>targetSdkVersion=<span class="hljs-string">"14"</span>/&gt;
</code></pre><p>to</p>
<pre><code class="hljs">&lt;uses-sdk <span class="hljs-string">android:</span>minSdkVersion=<span class="hljs-string">"11"</span> <span class="hljs-string">android:</span>targetSdkVersion=<span class="hljs-string">"14"</span>/&gt;
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="January 11th 2014, 11:58:27 am">January 11th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Any luck ?</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 12th 2014, 3:59:58 pm">January 12th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Nick</p>
<p>It has definitely helped a little bit its uploading up to 30mb files now which is a improvement but anything above that the issue still remains. thanks</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 12th 2014, 5:52:42 pm">January 12th 2014</span>
											by <span class='authorname'>Samuel East</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>You have to remember that the heap size for your app is limited by the OS. 30MB on top of all your other code in memory is going to certainly use all that up. You need to split up your data into smaller chunks if you expect to be able to upload any large amount of data</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 13th 2014, 7:36:05 am">January 13th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Nick thanks for the info. Do you know any tutorials that explain splitting a 100mb video into smaller chunks for upload it is something i have never had to do before?</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 13th 2014, 7:57:43 am">January 13th 2014</span>
											by <span class='authorname'>Samuel East</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Someone else is doing something similar <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;157104&#x2F;read-end-of-file-stream-without-buffering-the-entire-file">here</a></p>
</p>
										<div class="author">
											&mdash; commented <span title="January 13th 2014, 8:11:15 am">January 13th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><pre><code class="hljs"><span class="hljs-keyword">var</span> chunk_size = 1024 * 1024; <span class="hljs-comment">// 1Kb * 1024 = 1MB</span>
<span class="hljs-keyword">var</span> chunk_no = 10; <span class="hljs-comment">// Which chunk we want</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">file</span> = Ti.Filesystem.getFile( '<span class="hljs-keyword">file</span>.mp4' );
<span class="hljs-keyword">var</span> stream = <span class="hljs-keyword">file</span>.<span class="hljs-keyword">open</span>( Ti.Filesystem.MODE_READ );

<span class="hljs-comment">// Scrub through the stream till we're up to the part we need</span>
<span class="hljs-keyword">for</span> (i = 0; i &lt; chunk_no; i++) {
    <span class="hljs-keyword">var</span> buffer = Ti.createBuffer({length: chunk_size});
    <span class="hljs-comment">// This reads chunk_size bytes from where it left of in the last loop, puts it at the start of the buffer</span>
    <span class="hljs-keyword">var</span> bytes_read = stream.<span class="hljs-keyword">read</span>( buffer, 0, chunk_size );

    <span class="hljs-comment">// Ti.API.info('bytes_read: '+bytes_read);</span>

    <span class="hljs-comment">// If it's not the chunk we want, release the buffer memory</span>
    <span class="hljs-keyword">if</span> (i &lt; chunk_no) {
        buffer.release();
        buffer = null;
    }
}
<span class="hljs-comment">// This now contains the chunk we want</span>
<span class="hljs-keyword">var</span> blob = buffer.toBlob();
</code></pre><p>Hi thanks for all your help so what would you actually do with the above code do you integrate it with the Titanium.Network.createHTTPClient()  and send the blob.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 13th 2014, 9:10:26 am">January 13th 2014</span>
											by <span class='authorname'>Samuel East</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Yes, and send your chunk number along with the blob so you can re-construct it at the other end</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 13th 2014, 9:14:51 am">January 13th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
