<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Reload data dynamically or with Javascript Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Reload data dynamically or with Javascript</h1>
		</header>
		<section>
			<p>How do you do this. HELP Please!<br>Ok<br>I have successfully made an application but need to dynamically reload the data. Or just reload the date every 2 minutes or so.  I am using the XHR to retrieve a JSON service. Successfully parsing it and everything. Using the example from the Kitchen Sink. Small example below.</p>
<p>var xhr = Titanium.Network.createHTTPClient();</p>
<p>xhr.onload = function()<br>{<br>&#x2F;&#x2F;Code is here<br>}</p>
<p>&#x2F;&#x2F; open the client<br>xhr.open(&#39;GET&#39;,&#39;http:&#x2F;&#x2F;NiceURLforService.com&#x2F;service&#39;);</p>
<p>&#x2F;&#x2F; send the data<br>xhr.send();</p>
<p>How would I go about reloading or recalling the xhr function every 2 minutes in Appcelerator. I am assuming it is done with Javascript but have not been able to make it work successfully. I put my data refresh code below the xhr.send();<br>The code is below.</p>
<p>var refresh = parseInt(&#39;120000&#39;);<br>function viewcountdwn() {<br>var viewDate = new Date();<br>var viewTime = viewDate.getTime();<br>xhr.setTimeout(&quot;viewcountdwn()&quot;, refresh);<br>}<br>xhr.setTimeout(&quot;viewcountdwn()&quot;, refresh);</p>
<p>Help is much appreciated. I didn&#39;t know if there was a built in Appcelerator function for this or not.</p>
<p>Thanks</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="June 22nd 2010, 5:38:50 pm">June 22nd 2010</span>
				by <span class='authorname'>Carlos Mosqueda</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>data</span></li>
					
						<li><span class='tagname'>refresh</span></li>
					
						<li><span class='tagname'>xhr</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>7</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>7 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-74671">
				
						<section>
							<p>try only xhr.setTimeout(120000);</p>
<p> and in xhr.onload put your code like:<br>var viewDate = new Date(); var viewTime = viewDate.getTime(); </p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 22nd 2010, 6:00:51 pm">June 22nd 2010</span>
								by <span class='authorname'>Guillaume LAFOUTRY</span><br>
								<a class="icon-bg icon-link" href="../../question/37261/reload-data-dynamically-or-with-javascript.html#answer-74671" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-74681">
				
						<section>
							<p>Nope. I set the timer for 2 minutes or 120000 milliseconds and did what you suggested.  Did not work.<br>I did<br>function viewcountdwn() {<br>xhr.setTimeout(120000);<br>}</p>
<p>and in side the xhr.onload I put the<br>var viewDate = new Date(); var viewTime = viewDate.getTime();</p>
<p>Nothing is happening in the Android emulator anyways.<br>Any other suggestions anyone?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 22nd 2010, 6:21:15 pm">June 22nd 2010</span>
								by <span class='authorname'>Carlos Mosqueda</span><br>
								<a class="icon-bg icon-link" href="../../question/37261/reload-data-dynamically-or-with-javascript.html#answer-74681" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-74711">
				
						<section>
							<p>You&#39;re partially correct - <code>setInterval</code> is similar to <code>setTimeout</code>, but will be executed on a regular interval.  Some permutation of the following should probably work:</p>
<pre><code class="hljs">setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  doMyAjaxCall(); <span class="hljs-comment">//execute the function which fetches data</span>
},<span class="hljs-number">120000</span>); <span class="hljs-comment">//execute every 120000 milliseconds</span>
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 22nd 2010, 6:46:18 pm">June 22nd 2010</span>
								by <span class='authorname'>Kevin Whinnery</span><br>
								<a class="icon-bg icon-link" href="../../question/37261/reload-data-dynamically-or-with-javascript.html#answer-74711" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-74741">
				
						<section>
							<p>So Kevin,<br>If i understand what you saying and from my example above I would put</p>
<pre><code class="hljs">setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  xhr.onload; <span class="hljs-comment">//execute the function which fetches data</span>
  },<span class="hljs-number">120000</span>); <span class="hljs-comment">//execute every 120000 milliseconds`</span>

<span class="hljs-keyword">var</span> xhr = Titanium.Network.createHTTPClient();
xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">//Code is here }</span>
<span class="hljs-comment">// open the client </span>
xhr.open(<span class="hljs-string">'GET'</span>,<span class="hljs-string">'http://NiceURLforService.com/service'</span>);
<span class="hljs-comment">// send the data </span>
xhr.send();
</code></pre><p>Set the xhr.onload in the setInterval function. Right?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 22nd 2010, 7:18:40 pm">June 22nd 2010</span>
								by <span class='authorname'>Carlos Mosqueda</span><br>
								<a class="icon-bg icon-link" href="../../question/37261/reload-data-dynamically-or-with-javascript.html#answer-74741" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-74761">
				
						<section>
							<p>So I wrapped my<br>xhr.onload = function() { &#x2F;&#x2F;Code is here }</p>
<p>inside of a function and called the function.<br>more or less</p>
<pre><code class="hljs">setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
  dataLoad(); <span class="hljs-comment">//execute the function which fetches data</span>
  },<span class="hljs-number">10000</span>); <span class="hljs-comment">//execute every 120000 milliseconds</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dataLoad</span><span class="hljs-params">()</span></span>{
xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{ <span class="hljs-comment">//Code is here }</span>
};
</code></pre><p>It worked,kinda. The interval worked BUT it kept sending the dataLoad and visually it just listened and listened and piled the data on top of each other without clearing the previous call before it. How do you clear the call???</p>
<p>Thanks</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 22nd 2010, 7:38:05 pm">June 22nd 2010</span>
								by <span class='authorname'>Carlos Mosqueda</span><br>
								<a class="icon-bg icon-link" href="../../question/37261/reload-data-dynamically-or-with-javascript.html#answer-74761" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-79791">
				
						<section>
							<p>I am having the same issue with the label data just piling on top of the previous data.  How do you wipe the label text and only put the new data in?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 1st 2010, 9:32:33 pm">July 1st 2010</span>
								by <span class='authorname'>Kyle Borg</span><br>
								<a class="icon-bg icon-link" href="../../question/37261/reload-data-dynamically-or-with-javascript.html#answer-79791" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Kyle,</p>
<p>I just abandoned the setInterval idea and wrapped the whole thing in a function and called it using a double tap or swipe or whatever you want to do. I added the eventListener to the window. And what I had to do was you add the content to the window, then you have to remove it everytime the call is made. So you set your variables globally at the top of your js document outside the function. </p>
<p>We put an if statement in to see if the first time loaded was = true then run then add the items to the stage, else .remove the views, labels, table or whatever you are showing your data with and then add it at the end. </p>
<p>You actually have to remove the elements before adding them back onto the stage</p>
<p>Decently complicated and sucked trying to figure out.<br>In essence, the issue with using setInterval is doing is running the function and getting the data and because there is no &quot;.remove&quot; in the function we had to do that.</p>
<p>Thing to note, since Android pauses an application when not in use, even if you have setInterval, it will not keep the interval going and possibly cause a memory leak because when it starts up again, there is an issue with the interval. Just FYI.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 2nd 2010, 3:43:03 pm">July 2nd 2010</span>
											by <span class='authorname'>Carlos Mosqueda</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-79801">
				
						<section>
							<p>Ok - you can find a fairly comprehensive snippet <a href="http:&#x2F;&#x2F;gist.github.com&#x2F;460839">http:&#x2F;&#x2F;gist.github.com&#x2F;460839</a></p>
<p>It&#39;s fairly well documented - but not tested (I&#39;m busy working on something else).</p>
<p>Android Only:<br>Regarding UI controls, if you&#39;re using a tableview which is loaded with JS objects AND you have a map between the ID&#39;s returned from the server and the array index of your currentData - then as long as you don&#39;t insertBefore or insertAfter - you can use the ID map to update the rows.</p>
<p>It&#39;s something like:</p>
<pre><code class="hljs"><span class="hljs-comment">// Setup</span>
<span class="hljs-variable"><span class="hljs-keyword">var</span> currentData</span> = new Array();
<span class="hljs-variable"><span class="hljs-keyword">var</span> indexMap</span> = new Array();

<span class="hljs-comment">// Data</span>
<span class="hljs-variable"><span class="hljs-keyword">var</span> dataItem</span> = {ID:<span class="hljs-string">"001"</span>, title:<span class="hljs-string">"test"</span>};

<span class="hljs-comment">// Mapping</span>
currentData.push(dataItem);
<span class="hljs-variable"><span class="hljs-keyword">var</span> lastID</span> = currentData.length;
indexMap[dataItem.ID]=lastID;

<span class="hljs-comment">// Load the data</span>
tableview.setData(currentData);

<span class="hljs-comment">// Now you can pull the index of the row in currentData using the map</span>
<span class="hljs-comment">// when you need to update a row</span>
<span class="hljs-variable"><span class="hljs-keyword">var</span> updateRowFromServer</span> = {ID:<span class="hljs-string">"001"</span>,title:<span class="hljs-string">"Foo"</span>};
<span class="hljs-variable"><span class="hljs-keyword">var</span> position</span> = indexMap[updateRowFromServer.ID];
<span class="hljs-comment">// First update our source data</span>
currentData[position] = updateRowFromServer;

tableview.update(position, updateRowFromServer);
</code></pre><p>Feel free to ask for clarification.<br>Updated: fixed a few typos in the gist above</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 2nd 2010, 12:30:06 am">July 2nd 2010</span>
								by <span class='authorname'>David Ashwood</span><br>
								<a class="icon-bg icon-link" href="../../question/37261/reload-data-dynamically-or-with-javascript.html#answer-79801" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
