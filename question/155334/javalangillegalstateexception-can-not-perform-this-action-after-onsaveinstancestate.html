<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>java.lang.IllegalStateException: Can not perform this action after onSaveInstanceState Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>java.lang.IllegalStateException: Can not perform this action after onSaveInstanceState</h1>
		</header>
		<section>
			<p>Device: Android 4.2.2 (Nexus 4) and SGS2 (4.?)</p>
<p>SDK: 3.1.1</p>
<p>Map v2</p>
<p>Hi,<br>I got some strange error message appearing, when I try to add a mapview to another view:</p>
<pre><code class="hljs"> <span class="hljs-list">(<span class="hljs-keyword">main</span>)</span> <span class="hljs-list">[<span class="hljs-keyword">25864</span>,<span class="hljs-number">25864</span>] Sending event: exception on thread: main msg:java.lang.RuntimeException: Unable to resume activity {com.vx.app/org.appcelerator.titanium.TiActivity}: java.lang.IllegalStateException: Can not perform this action after onSaveInstanceState<span class="hljs-comment">; Titanium 3.1.1,2013/06/15 16:10,f7592c1</span>
 java.lang.RuntimeException: Unable to resume activity {com.vx.app/org.appcelerator.titanium.TiActivity}: java.lang.IllegalStateException: Can not perform this action after onSaveInstanceState
     at android.app.ActivityThread.performResumeActivity<span class="hljs-list">(<span class="hljs-keyword">ActivityThread.java:2742</span>)</span>
     at android.app.ActivityThread.handleResumeActivity<span class="hljs-list">(<span class="hljs-keyword">ActivityThread.java:2771</span>)</span>
     at android.app.ActivityThread$H.handleMessage<span class="hljs-list">(<span class="hljs-keyword">ActivityThread.java:1276</span>)</span>
     at android.os.Handler.dispatchMessage<span class="hljs-list">(<span class="hljs-keyword">Handler.java:99</span>)</span>
     at android.os.Looper.loop<span class="hljs-list">(<span class="hljs-keyword">Looper.java:137</span>)</span>
     at android.app.ActivityThread.main<span class="hljs-list">(<span class="hljs-keyword">ActivityThread.java:5041</span>)</span>
     at java.lang.reflect.Method.invokeNative<span class="hljs-list">(<span class="hljs-keyword">Native</span> Method)</span>
     at java.lang.reflect.Method.invoke<span class="hljs-list">(<span class="hljs-keyword">Method.java:511</span>)</span>
     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run<span class="hljs-list">(<span class="hljs-keyword">ZygoteInit.java:793</span>)</span>
     at com.android.internal.os.ZygoteInit.main<span class="hljs-list">(<span class="hljs-keyword">ZygoteInit.java:560</span>)</span>
     at dalvik.system.NativeStart.main<span class="hljs-list">(<span class="hljs-keyword">Native</span> Method)</span>
 Caused by: java.lang.IllegalStateException: Can not perform this action after onSaveInstanceState
     at android.support.v4.app.FragmentManagerImpl.checkStateLoss<span class="hljs-list">(<span class="hljs-keyword">FragmentManager.java:1314</span>)</span>
     at android.support.v4.app.FragmentManagerImpl.enqueueAction<span class="hljs-list">(<span class="hljs-keyword">FragmentManager.java:1325</span>)</span>
     at android.support.v4.app.BackStackRecord.commitInternal<span class="hljs-list">(<span class="hljs-keyword">BackStackRecord.java:548</span>)</span>
     at android.support.v4.app.BackStackRecord.commit<span class="hljs-list">(<span class="hljs-keyword">BackStackRecord.java:532</span>)</span>
     at org.appcelerator.titanium.view.TiUIFragment.&lt;init&gt;<span class="hljs-list">(<span class="hljs-keyword">TiUIFragment.java:42</span>)</span>
     at ti.map.TiUIMapView.&lt;init&gt;<span class="hljs-list">(<span class="hljs-keyword">TiUIMapView.java:49</span>)</span>
     at ti.map.ViewProxy.createView<span class="hljs-list">(<span class="hljs-keyword">ViewProxy.java:63</span>)</span>
     at org.appcelerator.titanium.proxy.TiViewProxy.handleGetView<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:452</span>)</span>
     at org.appcelerator.titanium.proxy.TiViewProxy.getOrCreateView<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:438</span>)</span>
     at org.appcelerator.titanium.proxy.TiViewProxy.realizeViews<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:476</span>)</span>
     at org.appcelerator.titanium.proxy.TiViewProxy.handleGetView<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:460</span>)</span>
     at org.appcelerator.titanium.proxy.TiViewProxy.getOrCreateView<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:438</span>)</span>
     at org.appcelerator.titanium.proxy.TiViewProxy.handleAdd<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:555</span>)</span>
     at org.appcelerator.titanium.proxy.TiViewProxy.handleMessage<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:214</span>)</span>
     at android.os.Handler.dispatchMessage<span class="hljs-list">(<span class="hljs-keyword">Handler.java:95</span>)</span>
     at org.appcelerator.kroll.common.TiMessenger.dispatchMessage<span class="hljs-list">(<span class="hljs-keyword">TiMessenger.java:364</span>)</span>
     at org.appcelerator.kroll.common.TiMessenger.dispatchPendingMessages<span class="hljs-list">(<span class="hljs-keyword">TiMessenger.java:349</span>)</span>
     at org.appcelerator.kroll.common.TiMessenger$2.getResult<span class="hljs-list">(<span class="hljs-keyword">TiMessenger.java:234</span>)</span>
     at org.appcelerator.kroll.common.TiMessenger.sendBlockingMessage<span class="hljs-list">(<span class="hljs-keyword">TiMessenger.java:261</span>)</span>
     at org.appcelerator.kroll.common.TiMessenger.sendBlockingRuntimeMessage<span class="hljs-list">(<span class="hljs-keyword">TiMessenger.java:186</span>)</span>
     at org.appcelerator.kroll.KrollProxy.fireSyncEvent<span class="hljs-list">(<span class="hljs-keyword">KrollProxy.java:740</span>)</span>
     at org.appcelerator.titanium.TiBaseActivity.onRestart<span class="hljs-list">(<span class="hljs-keyword">TiBaseActivity.java:1109</span>)</span>
     at android.app.Instrumentation.callActivityOnRestart<span class="hljs-list">(<span class="hljs-keyword">Instrumentation.java:1174</span>)</span>
     at android.app.Activity.performRestart<span class="hljs-list">(<span class="hljs-keyword">Activity.java:5163</span>)</span>
     at android.app.Activity.performResume<span class="hljs-list">(<span class="hljs-keyword">Activity.java:5174</span>)</span>
     at android.app.ActivityThread.performResumeActivity<span class="hljs-list">(<span class="hljs-keyword">ActivityThread.java:2732</span>)</span>
     ... <span class="hljs-number">10</span> more</span>
</code></pre><p>I can&#39;t post all the code (some thousand lines) but here are the interesting parts and a short description:</p>
<p>I have a main menu with 3 items. Item 2 is a map. When I click on item 2 the map will open (working fine). Now I want to open the map from item 3. I open a new window in menu item 3:</p>
<pre><code class="hljs">var win = Ti.UI.createWindow({
        <span class="hljs-string">name :</span> <span class="hljs-string">"window"</span>, <span class="hljs-string">backgroundImage :</span> <span class="hljs-string">"images/bg.png"</span>, <span class="hljs-string">backgroundRepeat :</span> <span class="hljs-literal">true</span>, <span class="hljs-string">navBarHidden :</span> <span class="hljs-literal">true</span>, <span class="hljs-string">height :</span> Ti.UI.FILL, <span class="hljs-string">width :</span> Ti.UI.FILL
    });

win.open({});
</code></pre><p>there is a button that will close the window (so I&#39;m back to item 3 view) and switch the main menu to item 2 via code:</p>
<pre><code class="hljs">view_back.addEventListener(<span class="hljs-string">"click"</span>, function(e) {
                win.close();

                <span class="hljs-keyword">if</span> (selectMenu != <span class="hljs-literal">null</span>) {
                    selectMenu({
                        <span class="hljs-string">id :</span> <span class="hljs-number">1</span>, <span class="hljs-string">lon :</span> lon, <span class="hljs-string">lat :</span> lat, <span class="hljs-string">m_id :</span> m_id
                    });
                }


            })
</code></pre><p>selectMenu is the same function I call when clicking item 2 from the main menu, but now its just called via script insted of the click event:</p>
<pre><code class="hljs"><span class="hljs-label">current_content</span> = <span class="hljs-preprocessor">require</span>(<span class="hljs-string">"aroundme"</span>).createView({
                    lon : <span class="hljs-preprocessor">opt</span>.lon, lat : <span class="hljs-preprocessor">opt</span>.lat, m_id : <span class="hljs-preprocessor">opt</span>.m_id
                })<span class="hljs-comment">;</span>
                view_content.<span class="hljs-keyword">add(current_content.getView());</span>
</code></pre><p>but now it will crash with the error message from above when the view_content.add() line is called. I used debug on device to step through all lines and everything is looking fine until I reach the last line.</p>
<p>I have the following sdk settings inside my tiapp.xml:</p>
<pre><code class="hljs">&lt;uses-sdk <span class="hljs-string">android:</span>minSdkVersion=<span class="hljs-string">"9"</span> <span class="hljs-string">android:</span>targetSdkVersion=<span class="hljs-string">"10"</span>/&gt;
</code></pre><p>Searching around the internet brings up some stackoverflow threads but nothing in combination with titanium.<br>Hopefully someone knows an answer. If you need some more information please ask. I don&#39;t really know where to start looking. BTW: no problem on iOS!</p>
<p>Thanks</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="July 26th 2013, 6:36:52 pm">July 26th 2013</span>
				by <span class='authorname'>Michael Gangolf</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>exception</span></li>
					
						<li><span class='tagname'>java</span></li>
					
				</ul>
			

			<section>
				<h5>4 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>For a better understanding:</p>
<p>You have one &quot;root&quot; window containing your menu and selecting a menu item opens a new heavyweight window. right?</p>
<p>I have problems to follow your explanation here</p>
<pre><code class="hljs"><span class="hljs-comment">"Now I want to open the map from item 3. I open a new window in menu item 3
there is a button that will close the window (so I'm back to item 3 view) and switch the main menu to item 2 via code"</span>
</code></pre><p>I don&#39;t really get what you mean by an &quot;item&quot; or &quot;menu&quot; - is it a view, a window, a tab?</p>
<p>I know, you cannot post your entire code here, but your snippets doesn&#39;t really point out the issue. There is some context missing. E.g. what is <strong>view_content</strong> and what does its <strong>add</strong> function do? And is <strong>current_content.getView()</strong> the map view in that case?</p>
<p>btw: please use the latest sdk: <strong>android:targetSdkVersion=&quot;18&quot;</strong></p>
</div>
							<div class="author">
								&mdash; commented <span title="July 26th 2013, 8:15:33 pm">July 26th 2013</span>
								by <span class='authorname'>Manuel Lehner</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>sorry about the confusion. I have a main menu: top row, tab like but containing of views. So I have 3 views on top which I use for the main navigation. view_content is a view below the main menu where I load all my content into. So menu item 2 is my map view. When I click the view it will load the mapview inside view_content.</p>
<p>To create my view I made some commonjs files (eg. aroundme.js) and with .getView() I&#39;ll receive the view that was created and put this inside the view_content.</p>
<p>Working:</p>
<p>Clicking main menu item 2 -&gt; creating the aroundme mapview -&gt; putting it in view_content -&gt; works fine</p>
<p>Crashing:</p>
<p>Clickign main menu item 3 -&gt; creating another view -&gt; putting it in view_content -&gt; click a button inside view_content -&gt; create an overlay window (when I just use createWindow and open it will create a heavyweight window, or?) -&gt; click button in overlay window to open mapview -&gt; crash </p>
<p>I&#39;m trying to add a &quot;close&quot; eventlistener to be sure that the heavyweight window is closed before chaning to the mapview. Perhaps that will help. But I haven&#39;t had this strange error message before so its strange.</p>
</div>
							<div class="author">
								&mdash; commented <span title="July 26th 2013, 9:04:20 pm">July 26th 2013</span>
								by <span class='authorname'>Michael Gangolf</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>won&#39;t I lose &quot;available devices&quot; (inside the market) when I set targetSDK to the highest version?</p>
</div>
							<div class="author">
								&mdash; commented <span title="July 26th 2013, 9:06:13 pm">July 26th 2013</span>
								by <span class='authorname'>Michael Gangolf</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>The targetSDK attribute tells the system that you have tested your app for this API Level and that there is no need for system-provided compatibility behaviors between your targetSDK and the running API Level. If you are testing on a Nexus 4 with 4.2.2, you can set your targetSDK to at least <em>17</em> since this is your running API Level.</p>
</div>
							<div class="author">
								&mdash; commented <span title="July 27th 2013, 9:18:38 am">July 27th 2013</span>
								by <span class='authorname'>Manuel Lehner</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-266430">
				
						<section>
							<p>I&#39;ve written a little example to reproduce your issue, but I&#39;m not able to create this exception. Maybe you can review and edit my code to re-create your error:</p>
<p><strong>app.js</strong></p>
<pre><code class="hljs"><span class="hljs-comment">// base window</span>
<span class="hljs-keyword">var</span> win = Ti.UI.createWindow({
    backgroundColor: <span class="hljs-string">'white'</span>,
    navBarHidden: <span class="hljs-literal">true</span>,
    layout:<span class="hljs-string">'vertical'</span>
});

<span class="hljs-comment">// content views</span>
<span class="hljs-keyword">var</span> ContentView = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ContentView'</span>);
<span class="hljs-keyword">var</span> firstView = <span class="hljs-keyword">new</span> ContentView({backgroundColor: <span class="hljs-string">'blue'</span>, opacity: <span class="hljs-number">1</span>});
<span class="hljs-keyword">var</span> secondView = <span class="hljs-keyword">new</span> ContentView({backgroundColor: <span class="hljs-string">'yellow'</span>});
<span class="hljs-keyword">var</span> thirdView = <span class="hljs-keyword">new</span> ContentView({backgroundColor: <span class="hljs-string">'red'</span>});
<span class="hljs-keyword">var</span> selectedItem = firstView;

<span class="hljs-comment">// menu</span>
<span class="hljs-keyword">var</span> menu = Ti.UI.createView({
    height: <span class="hljs-string">'18%'</span>,
    width: Ti.UI.FILL,
    layout: <span class="hljs-string">'horizontal'</span>
});
<span class="hljs-keyword">var</span> item1 = Ti.UI.createView({
    height: Ti.UI.FILL,
    width: <span class="hljs-string">'33%'</span>,
    backgroundColor: <span class="hljs-string">'blue'</span>,
    borderColor: <span class="hljs-string">'white'</span>,
    borderWidth: <span class="hljs-string">'2dp'</span>
});
item1.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    setContentView(firstView);
});
menu.add(item1);
<span class="hljs-keyword">var</span> item2 = Ti.UI.createView({
    height: Ti.UI.FILL,
    width: <span class="hljs-string">'33%'</span>,
    backgroundColor: <span class="hljs-string">'yellow'</span>,
    borderColor: <span class="hljs-string">'white'</span>,
    borderWidth: <span class="hljs-string">'2dp'</span>
});
item2.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    setContentView(secondView);
});
menu.add(item2);
<span class="hljs-keyword">var</span> item3 = Ti.UI.createView({
    height: Ti.UI.FILL,
    width: <span class="hljs-string">'33%'</span>,
    backgroundColor: <span class="hljs-string">'red'</span>,
    borderColor: <span class="hljs-string">'white'</span>,
    borderWidth: <span class="hljs-string">'2dp'</span>
});
item3.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    setContentView(thirdView);
});
menu.add(item3);

<span class="hljs-comment">// content</span>
<span class="hljs-keyword">var</span> content = Ti.UI.createView({
    top: <span class="hljs-string">'2%'</span>,
    height: <span class="hljs-string">'80%'</span>,
    width: Ti.UI.FILL
});

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setContentView</span>(<span class="hljs-params">view</span>)</span>{
    <span class="hljs-keyword">if</span> (selectedItem !== view){
        selectedItem.getView().animate({
            opacity: <span class="hljs-number">0</span>,
            duration: <span class="hljs-number">300</span>
        });

        view.getView().animate({
            opacity: <span class="hljs-number">1</span>,
            duration: <span class="hljs-number">300</span>
        });

        selectedItem = view;        
    }
};

content.add(firstView.getView());
content.add(secondView.getView());
content.add(thirdView.getView());

<span class="hljs-comment">// new heavyweight window</span>
<span class="hljs-keyword">var</span> newWinBtn = Ti.UI.createButton({
    title: <span class="hljs-string">'open Window'</span>
});
newWinBtn.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> newWin = Ti.UI.createWindow({
        backgroundColor: <span class="hljs-string">'white'</span>,
        navBarHidden : <span class="hljs-literal">true</span>, <span class="hljs-comment">//makes it heavyweight </span>
        height : Ti.UI.FILL, 
        width : Ti.UI.FILL
    });
    <span class="hljs-keyword">var</span> selectSecondMenuItemBtn = Ti.UI.createButton({
        title: <span class="hljs-string">'close and show 2nd Menu'</span>
    });
    selectSecondMenuItemBtn.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        setContentView(secondView);
        newWin.close();
    });
    newWin.add(selectSecondMenuItemBtn);
    newWin.open();
});
thirdView.getView().add(newWinBtn);

win.add(menu);
win.add(content);
win.open();
</code></pre><p><strong>ContentView.js</strong></p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ContentView</span><span class="hljs-params">(args)</span></span>{

    <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = Ti.UI.createView({
        width: Ti.UI.FILL,
        height: Ti.UI.FILL,
        backgroundColor: args.backgroundColor || <span class="hljs-string">'white'</span>,
        opacity: args.opacity || <span class="hljs-number">0</span>
    });

    <span class="hljs-keyword">return</span> {
        getView: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
        }
    }
};

module.exports = ContentView;
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 27th 2013, 9:06:37 am">July 27th 2013</span>
								by <span class='authorname'>Manuel Lehner</span><br>
								<a class="icon-bg icon-link" href="../../question/155334/javalangillegalstateexception-can-not-perform-this-action-after-onsaveinstancestate.html#answer-266430" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
