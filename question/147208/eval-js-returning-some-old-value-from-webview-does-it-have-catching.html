<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>eval JS returning some old value from WebView (does it have catching) » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>eval JS returning some old value from WebView (does it have catching)</h1>
		</header>
		<section>
			<p>I am using SignalR to push messages from the server to mobile applicaton. It is something similar to Node.js.</p>
<p>However it can only work with a webview. So what I did is that I load an html from the server containing the following JS code</p>
<pre><code class="hljs">chat.client.setNewOrder = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{<span class="hljs-comment">//this is called by the server</span>

                    _newOrderArgs = e;

                    ready++; <span class="hljs-comment">//mark refresh</span>
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getReady</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> ready;
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getNewOrder</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> resgetNewOrder = _newOrderArgs;
            _newOrderArgs = <span class="hljs-literal">null</span>;

            <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(resgetNewOrder);

        }
</code></pre><p>I use a timer to get the value of ready each 500ms. If the value is greater than the last, it means a new order arrived.<br>I extract the value of ready and  _newOrderArgs using<br>ticks)</p>
<pre><code class="hljs"><span class="hljs-title">var</span> val = webView.evalJS(<span class="hljs-string">'getReady()'</span>);
<span class="hljs-title">orderArgsString</span> = webView.evalJS(<span class="hljs-string">'getNewOrder()'</span>);
</code></pre><p>The problem that when I test this code on my android device running Android 2.3, getNewOrder returns the value of getReady and sometimes even viceversa. Sometimes the value returned by getReady is null or undefined, although it should never have this value</p>
<p>So what could happen in here?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="January 21st 2013, 6:33:12 pm">January 21st 2013</span>
				by <span class='authorname'>Ryan popa</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>signalr webview eval</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>0</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>0 Answers</h3>

	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
