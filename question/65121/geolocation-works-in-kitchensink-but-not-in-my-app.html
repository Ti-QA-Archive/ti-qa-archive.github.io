<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title> Geolocation works in Kitchensink, but not in my app Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1> Geolocation works in Kitchensink, but not in my app</h1>
		</header>
		<section>
			<p>I&#39;ve installed the KitchenSink on my Droid and its geolocation code works fine. Notably, the GPS icon appears in my notification bar the entire time that page is active.</p>
<p>I copy that code to my app, pretty much changing only variable names where the GPS data is saved. The GPS icon flashes briefly on the notification bar but does not stay. Sometimes my app will pull up the current location, sometimes a cached location from hour earlier. Most of the time, my app simply hangs and I have to force stop it.</p>
<p>Needless to say, this is quite frustrating. I&#39;ve gone over the code in K-S and my code and there are no differences that should matter. The K-S code updates to labels on the screen. My code updates the values of text fields on a user entry form. But other than that, I haven&#39;t changed anything that should matter.</p>
<p>Currently I&#39;m working with SDK version=1.4.2, timestamp=09&#x2F;24&#x2F;10 09:47, githash=949bc7 and the KitchenSink pulled from github that same day. But, this has been the same behavior with every SDK&#x2F;nightly build back to the 1.4.0 release.</p>
<p>I&#39;ve posted my version of the geo code at <a href="http:&#x2F;&#x2F;pastie.org&#x2F;1184264">http:&#x2F;&#x2F;pastie.org&#x2F;1184264</a></p>
<p>Any suggestions?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="September 27th 2010, 11:50:21 am">September 27th 2010</span>
				by <span class='authorname'>Tim Poulsen</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>geolocation</span></li>
					
						<li><span class='tagname'>mobile</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>7</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>7 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-120251">
				
						<section>
							<p>Have you monitored the log messages on device to see if you&#39;re getting any errors? You can use <code>adb -d logcat</code> or the <code>ddms</code> tool from the ADK&#x2F;tools folder.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 27th 2010, 1:18:33 pm">September 27th 2010</span>
								by <span class='authorname'>Don Thorp</span><br>
								<a class="icon-bg icon-link" href="../../question/65121/geolocation-works-in-kitchensink-but-not-in-my-app.html#answer-120251" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-120261">
				
						<section>
							<p>Have you monitored the log messages on device to see if you&#39;re getting any errors? You can use <code>adb -d logcat</code> or the <code>ddms</code> tool from the ADK&#x2F;tools folder.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 27th 2010, 1:18:41 pm">September 27th 2010</span>
								by <span class='authorname'>Don Thorp</span><br>
								<a class="icon-bg icon-link" href="../../question/65121/geolocation-works-in-kitchensink-but-not-in-my-app.html#answer-120261" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-120271">
				
						<section>
							<p>Thanks for the reply Don. I had not tried that. I think I understand what the log messages are saying and I can see location events firing. But, that might also be due to a change I made to my app (see below). I&#39;ll have to see if there&#39;s a way to save that log on the device and pull it later so that I can take my app on the road for testing.</p>
<p>One difference between the Kitchen Sink and my app is that K-S constantly outputs the location data where mine saves it in variables which aren&#39;t read&#x2F;output till the user taps a button which opens a view. </p>
<p>So, I added a Lat&#x2F;Long label to my UI and output the one-shot and current values to that label. In brief testing, this seems to keep my app from hanging. But the GPS icon still does not appear in the notification bar. I haven&#39;t traveled enough to see if it&#39;s actually being updated or not. It might not be because if I turn off my Droid&#39;s GPS, I don&#39;t get a warning message and initial lat&#x2F;long values are output. So, maybe it&#39;s just pulling cached data.</p>
<p>I&#39;ll take a long walk now and see if the app keeps up with the location changes.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 27th 2010, 1:31:43 pm">September 27th 2010</span>
								by <span class='authorname'>Tim Poulsen</span><br>
								<a class="icon-bg icon-link" href="../../question/65121/geolocation-works-in-kitchensink-but-not-in-my-app.html#answer-120271" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-120331">
				
						<section>
							<p>As best as I can tell from logcat, the event listener is never firing. I had my Droid connected to my laptop with <code>adb -d logcat</code> running and I walked around. I see:</p>
<pre><code class="hljs">D/libgps ( <span class="hljs-number">1086</span>): status_cb: <span class="hljs-function"><span class="hljs-title">GPS_STATUS_SESSION_BEGIN</span><span class="hljs-params">(<span class="hljs-number">1</span>)</span></span>
...
I/TiAPI (<span class="hljs-number">31123</span>): (kroll$<span class="hljs-number">3</span>) [<span class="hljs-number">60</span>,<span class="hljs-number">1755</span>] geo - current location: ...
D/libgps ( <span class="hljs-number">1086</span>): <span class="hljs-function"><span class="hljs-title">GpsInterface_stop</span><span class="hljs-params">()</span></span>
E/libgps ( <span class="hljs-number">1086</span>): <span class="hljs-function"><span class="hljs-title">recv_command_status</span><span class="hljs-params">()</span></span> : fix returned error <span class="hljs-tag">code</span> <span class="hljs-number">9</span>
...
D/libgps ( <span class="hljs-number">1086</span>): status_cb: <span class="hljs-function"><span class="hljs-title">GPS_STATUS_SESSION_END</span><span class="hljs-params">(<span class="hljs-number">2</span>)</span></span>
</code></pre><p>And then that&#39;s the last GPS related info from my app. The <code>geo - current location</code> line is the Ti.API.info() call from my code. This is in the one-time GPS section.</p>
<p>I see continual firings of the event listener when running the Kitchen Sink. For this test, I re-copied the Kitchen Sink code into my text. This time, the only change I made was to comment out lines updating UI labels I don&#39;t have. </p>
<p>I&#39;ve checked the AndroidManifest and tiapp.xml on both projects and they each contain the same resource type stuff. Obviously, my files has names, etc. related to my app that don&#39;t match those in the K-S files.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 27th 2010, 3:30:22 pm">September 27th 2010</span>
								by <span class='authorname'>Tim Poulsen</span><br>
								<a class="icon-bg icon-link" href="../../question/65121/geolocation-works-in-kitchensink-but-not-in-my-app.html#answer-120331" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>What I would suggest is to create a small test project with just the location listener part of it. Make sure that you set the location listener from within a heavyweight window so it get&#39;s the Android pause&#x2F;resume messages to actually turn on the listener.</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 27th 2010, 3:48:59 pm">September 27th 2010</span>
											by <span class='authorname'>Don Thorp</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-121171">
				
						<section>
							<p>Don, your comment clued me in to the solution to the problem. You said &quot;set the location listener from within a heavyweight window so it get&#39;s the Android pause&#x2F;resume messages to actually turn on the listener&quot;. I realized that in my app, the geolocation code was in a window opened within the main app.js context. In the KitchenSink, it&#39;s loaded in a sub-context (via the hasChild facility of a table row). </p>
<p>I made a new app to test this out. Geolocation code right in a window fails to fire the location event listener. Load it into a subcontext and it works. </p>
<p>So, start a new project and you get the two-tabs&#x2F;windows configuration. Put the geolocation code into a file called geo.js. Add the new tab as shown below and it works:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> win3 = Titanium.UI.createWindow({
    url:<span class="hljs-string">'geo.js'</span>,
    title:<span class="hljs-string">'Geo'</span>
});
<span class="hljs-keyword">var</span> tab3 = Titanium.UI.createTab({
    icon:<span class="hljs-string">'KS_nav_ui.png'</span>,
    title:<span class="hljs-string">'Geo'</span>,
    <span class="hljs-built_in">window</span>:win3
});
tabGroup.addTab(tab3);
</code></pre><p>I&#39;ve modified my app to load the window containing the geolocation code in this way and now it works! I still have some cleanup&#x2F;restructuring to do with the rest of my app to support this new structure. But, it seems to be working as expected now.</p>
<p>Thanks!<br>Tim</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 29th 2010, 11:39:07 am">September 29th 2010</span>
								by <span class='authorname'>Tim Poulsen</span><br>
								<a class="icon-bg icon-link" href="../../question/65121/geolocation-works-in-kitchensink-but-not-in-my-app.html#answer-121171" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-176321">
				
						<section>
							<p>by chance i&#39;ve found this discussion. look a bit like my problem too. i&#39;d be interested in why it works with the tabgroup approach and not in the window? i&#39;ve made the same observation, with the code straight from the kitchen sink. works in a window opened from a tab, but not from (fullscreen)windows opened from within another window. any idea anybody?<br>(sdk 1.5.1, android)<br>âu </p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 10th 2011, 10:45:09 pm">January 10th 2011</span>
								by <span class='authorname'>u no</span><br>
								<a class="icon-bg icon-link" href="../../question/65121/geolocation-works-in-kitchensink-but-not-in-my-app.html#answer-176321" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-176331">
				
						<section>
							<p>At this point, I don&#39;t recall the solution to the problem. My app is working (and published). The geo code is in a heavyweight window. I know at one point I was trying to put the geolocation stuff in a function and call it on demand. You can&#39;t do that because the geo services are asynchronous.</p>
<p>On android, I call the geolocation stuff once, then set the event handler to fire every time the user moves 5 meters. On iphone, I did put the geo code in a function, which gets called every 15 seconds via setInterval. I had to tweak my code to handle the occasional null values in lat&#x2F;long &amp; address variables in case the async nature rears its ugly head.</p>
<p>Sorry I&#39;m not being more help. But I just don&#39;t remember what I was doing wrong at this stage of the game and what I did differently to get it working.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 11th 2011, 12:09:04 am">January 11th 2011</span>
								by <span class='authorname'>Tim Poulsen</span><br>
								<a class="icon-bg icon-link" href="../../question/65121/geolocation-works-in-kitchensink-but-not-in-my-app.html#answer-176331" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
