<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>startLayout / finishLayout deprecated? » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>startLayout / finishLayout deprecated?</h1>
		</header>
		<section>
			<p>Hi, I am developing an App for iPad.<br>I need to add many children to a view at one point in the application.<br>It seems that the updateLayout method ist called for every child, even if I place parent.startLayout() … parent.finishLayout() around it. Same thing if I use SetVisible instead of adding and removing.</p>
<p>If startLayout finishLayout is deprecated, what is the way to do it. The applications gets really slow like this.</p>
<p>Thank in adavnce.</p>
<p>Tonio</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="November 26th 2012, 7:57:10 pm">November 26th 2012</span>
				by <span class='authorname'>Tonio Seiler</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>ipad</span></li>
					
						<li><span class='tagname'>performance</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Please provide some code so we can see what you ha e achieved so far and exactly what approach you have taken and the scale of the problem.</p>
<p>Neither are deprecated as they would say so and they give plenty of notice.</p>
<p>Chances are your problem is simply the direction you have taken, as even complicated layouts can be archived with very little use if any of startLayout, finishLayout and even postLayout.</p>
</div>
							<div class="author">
								&mdash; commented <span title="November 26th 2012, 9:00:34 pm">November 26th 2012</span>
								by <span class='authorname'>Malcolm Hollingsworth</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>-1</span> Votes</div>
			<div class="answers"><span>4</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>4 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-251732">
				
						<section>
							<p>My Code goes like this</p>
<pre><code class="hljs">
<span class="hljs-keyword">parent</span> = createView();

<span class="hljs-keyword">for</span> () {
    child = createButton();
    child.setVisible(<span class="hljs-keyword">false</span>);
        <span class="hljs-keyword">parent</span>.add(child);
}

<span class="hljs-keyword">parent</span>.startLayout();

<span class="hljs-keyword">for</span> (....) {
      <span class="hljs-keyword">if</span> (something) {
            child = children[i];
                child.setVisible(<span class="hljs-keyword">true</span>);
    }

}
<span class="hljs-keyword">parent</span>.finishLayout();
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 26th 2012, 10:59:07 pm">November 26th 2012</span>
								by <span class='authorname'>Tonio Seiler</span><br>
								<a class="icon-bg icon-link" href="../../question/145095/startlayout--finishlayout-deprecated.html#answer-251732" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>I am willing to help you, but you have provided an outline with little substance.  We need something to work through.</p>
<p>I am not sure if you believe you have something so unique you fear others may take it, I can only speak for myself - but I aim here to help.</p>
<p>If you really do want our help then give some code that is complete enough to reproduce in a test app including an idea of what you are trying to achieve and what problems you are seeing.</p>
<p>If you truly are concerned then you are likely smart enough to create an equivalent example that keeps your work secure.  If that is not your concern then either show some actual code or do not - your choice.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 26th 2012, 11:27:49 pm">November 26th 2012</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-251733">
				
						<section>
							<p>Ok I try to break it down, its little messi, under construction:</p>
<p>Here my code</p>
<pre><code class="hljs"><span class="hljs-type">Ti</span>.include('constants.js');

//not important
<span class="hljs-title">var</span> <span class="hljs-type">MapLegend</span> = require('ui/mapLegend').<span class="hljs-type">MapLegend</span>;
<span class="hljs-title">var</span> <span class="hljs-type">BaseWindow</span> = require('ui/components/baseWindow').<span class="hljs-type">BaseWindow</span>;

<span class="hljs-title">exports</span>.<span class="hljs-type">MapWindow</span> = function <span class="hljs-type">MapWindow</span>(_navController) {

    var navController = _navController;
    var state = <span class="hljs-type">MAP_ZOOM_STATE_OVERVIEW</span>;
    var openBefore = false;

//<span class="hljs-type">BaseWindow</span> has just some overlay for loading animation
    var <span class="hljs-keyword">instance</span> = new <span class="hljs-type">BaseWindow</span>({
        title : '<span class="hljs-type">Map'</span>,
        backgroundColor : '#<span class="hljs-number">000000</span>',
        fullscreen : true,
        navBarHidden : true
    });
<span class="hljs-class">
    <span class="hljs-keyword">instance</span>.orientationModes = [<span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.<span class="hljs-type">LANDSCAPE_LEFT</span>];
    <span class="hljs-keyword">instance</span>.layout = 'absolute';
    <span class="hljs-keyword">instance</span>.workButtons = undefined;
    <span class="hljs-keyword">instance</span>.detailMaps = undefined;

    var currentDetailsMap = undefined;

    var scrollView = <span class="hljs-type">Titanium</span>.<span class="hljs-type">UI</span>.createScrollView<span class="hljs-container">({
        <span class="hljs-title">contentWidth</span> : '<span class="hljs-title">auto'</span>,
        <span class="hljs-title">contentHeight</span> : '<span class="hljs-title">auto'</span>,
        <span class="hljs-title">showVerticalScrollIndicator</span> : <span class="hljs-title">false</span>,
        <span class="hljs-title">showHorizontalScrollIndicator</span> : <span class="hljs-title">false</span>,
        <span class="hljs-title">top</span> : 0,
        <span class="hljs-title">left</span> : 0,
        <span class="hljs-title">width</span> : '100%',
        <span class="hljs-title">height</span> : '100%',
        <span class="hljs-title">backgroundColor</span> : '<span class="hljs-title">black'</span>,
        <span class="hljs-title">minZoomScale</span> : 0.35,
        <span class="hljs-title">maxZoomScale</span> : 2.0,
        <span class="hljs-title">zoomScale</span> : <span class="hljs-type">MAP_ZOOM_SCALE_OVERVIEW</span>,
        <span class="hljs-title">layout</span> : '<span class="hljs-title">absolute'</span>,
        <span class="hljs-title">disableBounce</span> : <span class="hljs-title">true</span>
    })</span>;

    scrollView.addEventListener<span class="hljs-container">('<span class="hljs-title">postlayout'</span>, <span class="hljs-title">function</span>(<span class="hljs-title">e</span>)</span> {
        //<span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">('<span class="hljs-title">postlayout'</span>)</span>;
    });

    scrollView.addEventListener<span class="hljs-container">('<span class="hljs-title">scale'</span>, <span class="hljs-title">function</span>(<span class="hljs-title">e</span>)</span> {
        if <span class="hljs-container">(<span class="hljs-title">e</span>.<span class="hljs-title">scale</span> &lt; <span class="hljs-type">MAP_ZOOM_THRESHOLD</span> &amp;&amp; <span class="hljs-title">state</span> == <span class="hljs-type">MAP_ZOOM_STATE_DETAILS</span>)</span> {
            <span class="hljs-keyword">instance</span>.changeToOverview<span class="hljs-container">()</span>;
        } else if <span class="hljs-container">(<span class="hljs-title">e</span>.<span class="hljs-title">scale</span> &gt;= <span class="hljs-type">MAP_ZOOM_THRESHOLD</span> &amp;&amp; <span class="hljs-title">state</span> == <span class="hljs-type">MAP_ZOOM_STATE_OVERVIEW</span>)</span> {
            <span class="hljs-keyword">instance</span>.changeToDetails<span class="hljs-container">()</span>;
        }
    });
    <span class="hljs-keyword">instance</span>.scrollView = scrollView;
    <span class="hljs-keyword">instance</span>.add<span class="hljs-container">(<span class="hljs-title">scrollView</span>)</span>;

    <span class="hljs-keyword">instance</span>.scrollViewAnimation = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createAnimation<span class="hljs-container">({
        <span class="hljs-title">duration</span> : 500
    })</span>;

    <span class="hljs-keyword">instance</span>.createWorkPin = function<span class="hljs-container">(<span class="hljs-title">_work</span>, <span class="hljs-title">_width</span>, <span class="hljs-title">_height</span>, <span class="hljs-title">_showOnOverview</span>, <span class="hljs-title">_existing</span>)</span> {

        var left = _work.mapPosition.x - _width / 2;
        var top = _work.mapPosition.y - _height / 2;

        if <span class="hljs-container">(<span class="hljs-title">_existing</span> != <span class="hljs-title">undefined</span> &amp;&amp; <span class="hljs-title">_existing</span>.<span class="hljs-title">length</span> != 0)</span> {
            for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">j</span> = 0; <span class="hljs-title">j</span> &lt; <span class="hljs-title">_existing</span>.<span class="hljs-title">length</span>; <span class="hljs-title">j</span>++)</span> {
                var b1 = _existing[j];
                if <span class="hljs-container">(<span class="hljs-title">b1</span>.<span class="hljs-title">works</span> != <span class="hljs-title">undefined</span> &amp;&amp; <span class="hljs-title">b1</span>.<span class="hljs-title">works</span>[0].<span class="hljs-title">room</span> != <span class="hljs-title">undefined</span>)</span> {
                    if <span class="hljs-container">(<span class="hljs-title">b1</span>.<span class="hljs-title">left</span> == <span class="hljs-title">left</span> &amp;&amp; <span class="hljs-title">b1</span>.<span class="hljs-title">top</span> == <span class="hljs-title">top</span> &amp;&amp; <span class="hljs-title">b1</span>.<span class="hljs-title">works</span>[0].<span class="hljs-title">room</span>.<span class="hljs-title">floor</span>.<span class="hljs-title">id</span> == <span class="hljs-title">_work</span>.<span class="hljs-title">room</span>.<span class="hljs-title">floor</span>.<span class="hljs-title">id</span>)</span> {
                        var tmp = b1.works;
                        tmp.push<span class="hljs-container">(<span class="hljs-title">_work</span>)</span>;
                        b1.works = tmp;
                        return undefined;
                    }
                }
            }
        }

        var button = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createButton<span class="hljs-container">({
            <span class="hljs-title">width</span> : <span class="hljs-title">_width</span>,
            <span class="hljs-title">height</span> : <span class="hljs-title">_height</span>,
            <span class="hljs-title">visible</span> : <span class="hljs-title">true</span>,
            <span class="hljs-title">backgroundImage</span> : <span class="hljs-type">PAINTING_PIN_FILE</span>,
            <span class="hljs-title">backgroundSelectedImage</span> : <span class="hljs-type">PAINTING_PIN_SELECTED_FILE</span>,
            <span class="hljs-title">zIndex</span> : 40,
            <span class="hljs-title">opacity</span> : 1.0,
            <span class="hljs-title">visible</span> : <span class="hljs-title">true</span>,
        })</span>;

        //wieso auch immer
        var tmp = [];
        tmp[0] = _work;
        button.works = tmp;

        //button.map = undefined;
        button.showOnOverview = _showOnOverview;

        if <span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">room</span> != <span class="hljs-title">undefined</span> &amp;&amp; <span class="hljs-title">_work</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> == 0 &amp;&amp; <span class="hljs-title">_work</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> == 0)</span> {
            button.setLeft<span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> - <span class="hljs-title">button</span>.<span class="hljs-title">width</span> / 2)</span>;
            button.setTop<span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> - <span class="hljs-title">button</span>.<span class="hljs-title">height</span> / 2)</span>;
        } else {
            button.setLeft<span class="hljs-container">(<span class="hljs-title">left</span>)</span>;
            button.setTop<span class="hljs-container">(<span class="hljs-title">top</span>)</span>;
        }

        button.addEventListener<span class="hljs-container">('<span class="hljs-title">click'</span>, <span class="hljs-title">instance</span>.<span class="hljs-title">onWorkButtonClicked</span>)</span>;

        return button;
    };

    <span class="hljs-keyword">instance</span>.onWorkButtonClicked = function<span class="hljs-container">(<span class="hljs-title">e</span>)</span> {
        <span class="hljs-keyword">instance</span>.showLoadingAndShadow<span class="hljs-container">()</span>;
        navController.hideMapAndShowWork<span class="hljs-container">(<span class="hljs-title">e</span>.<span class="hljs-title">source</span>.<span class="hljs-title">works</span>[0])</span>;
        //just to make sure
        /*if <span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> != <span class="hljs-keyword">instance</span>.scrollView.<span class="hljs-type">MAP_ZOOM_SCALE_DETAILS</span>)
            <span class="hljs-keyword">instance</span>.scrollView.setZoomScale<span class="hljs-container">(<span class="hljs-type">MAP_ZOOM_SCALE_DETAILS</span>)</span>;*/
        <span class="hljs-keyword">instance</span>.hideLoadingAndShadow<span class="hljs-container">()</span>;
    };

   //called once on app startup
    <span class="hljs-keyword">instance</span>.updateData = function<span class="hljs-container">(<span class="hljs-title">_artBook</span>)</span> {

        var buttons = [];
        for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">_artBook</span>.<span class="hljs-title">works</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
            var w = _artBook.works[i];
            var width = 20;
            var height = 20;
            var showOnOverview = false;

            //if only one room, make them bigger
            var roomsOnThisFloor = artBook.getRooms<span class="hljs-container">(<span class="hljs-title">w</span>.<span class="hljs-title">room</span>.<span class="hljs-title">floor</span>)</span>.length;
            if <span class="hljs-container">(<span class="hljs-title">roomsOnThisFloor</span> == 1)</span> {
                width *= 2;
                height *= 2;
                showOnOverview = true;
            }

            var b = <span class="hljs-keyword">instance</span>.createWorkPin<span class="hljs-container">(<span class="hljs-title">w</span>, <span class="hljs-title">width</span>, <span class="hljs-title">height</span>, <span class="hljs-title">showOnOverview</span>, <span class="hljs-title">buttons</span>)</span>;
            if <span class="hljs-container">(<span class="hljs-title">b</span> != <span class="hljs-title">undefined</span>)</span> {
                //scrollView.add<span class="hljs-container">(<span class="hljs-title">b</span>)</span>;
                buttons.push<span class="hljs-container">(<span class="hljs-title">b</span>)</span>;
            }
        }
        <span class="hljs-keyword">instance</span>.workButtons = buttons;


        var detailMaps = [];
        for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">navController</span>.<span class="hljs-title">artBook</span>.<span class="hljs-title">floors</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
            var floor = navController.artBook.floors[i];

            /*var of = <span class="hljs-type">Ti</span>.<span class="hljs-type">Filesystem</span>.getFile<span class="hljs-container">(<span class="hljs-type">Titanium</span>.<span class="hljs-type">Filesystem</span>.<span class="hljs-title">applicationDataDirectory</span>, <span class="hljs-title">floor</span>.<span class="hljs-title">imgSrc</span>)</span>;
            var ko = floor.id;
            var overviewMap = <span class="hljs-type">Titanium</span>.<span class="hljs-type">UI</span>.createImageView<span class="hljs-container">({
                <span class="hljs-title">image</span> : <span class="hljs-title">of</span>.<span class="hljs-title">getNativePath</span>()</span>,
                width : floor.imgWidth,
                height : floor.imgHeight,
                top : 0,
                left : 0,
                opacity : 0,
                zIndex : 10,
                mapId : ko
            });
            overviewMaps.push<span class="hljs-container">(<span class="hljs-title">overviewMap</span>)</span>;*/

            var df = <span class="hljs-type">Ti</span>.<span class="hljs-type">Filesystem</span>.getFile<span class="hljs-container">(<span class="hljs-type">Titanium</span>.<span class="hljs-type">Filesystem</span>.<span class="hljs-title">applicationDataDirectory</span>, <span class="hljs-title">floor</span>.<span class="hljs-title">detailedImgSrc</span>)</span>;
            var kd = floor.id;
            var detailsMap = <span class="hljs-type">Titanium</span>.<span class="hljs-type">UI</span>.createImageView<span class="hljs-container">({
                <span class="hljs-title">image</span> : <span class="hljs-title">df</span>.<span class="hljs-title">getNativePath</span>()</span>,
                width : floor.detailedImgWidth,
                height : floor.detailedImgHeight,
                top : 0,
                left : 0,
                opacity : 0,
                zIndex : 20,
                mapId : kd
            });
            detailMaps.push<span class="hljs-container">(<span class="hljs-title">detailsMap</span>)</span>;
            scrollView.add<span class="hljs-container">(<span class="hljs-title">detailsMap</span>)</span>;

            //assign buttons and maps
            for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">j</span> = 0; <span class="hljs-title">j</span> &lt; <span class="hljs-title">instance</span>.<span class="hljs-title">workButtons</span>.<span class="hljs-title">length</span>; <span class="hljs-title">j</span>++)</span> {
                var b1 = <span class="hljs-keyword">instance</span>.workButtons[j];
                if <span class="hljs-container">(<span class="hljs-title">b1</span>.<span class="hljs-title">works</span>[0].<span class="hljs-title">room</span> != <span class="hljs-title">undefined</span>)</span> {
                    if <span class="hljs-container">(<span class="hljs-title">b1</span>.<span class="hljs-title">works</span>[0].<span class="hljs-title">room</span>.<span class="hljs-title">floor</span>.<span class="hljs-title">id</span> == <span class="hljs-title">detailsMap</span>.<span class="hljs-title">mapId</span>)</span> {
                        //b1.map = detailsMap;
                        detailsMap.add<span class="hljs-container">(<span class="hljs-title">b1</span>)</span>;
                    }
                }
            }

        }
        <span class="hljs-keyword">instance</span>.detailMaps = detailMaps;
        currentDetailsMap = <span class="hljs-keyword">instance</span>.detailMaps[0];
        currentDetailsMap.setOpacity<span class="hljs-container">(1)</span>;
    };

    <span class="hljs-keyword">instance</span>.gotoFloorFinalize = function<span class="hljs-container">()</span> {
        scrollView.setOpacity<span class="hljs-container">(0.0)</span>;

        //show hide correct map
        for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">instance</span>.<span class="hljs-title">detailMaps</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
            if <span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">detailMaps</span>[<span class="hljs-title">i</span>].<span class="hljs-title">mapId</span> == <span class="hljs-title">navController</span>.<span class="hljs-title">currentFloorId</span>)</span> {
                <span class="hljs-keyword">instance</span>.activateMaps<span class="hljs-container">(<span class="hljs-title">i</span>)</span>;
                //<span class="hljs-keyword">instance</span>.detailMaps[i].setOpacity<span class="hljs-container">(0)</span>;
            }
        }

        if <span class="hljs-container">(<span class="hljs-title">state</span> != <span class="hljs-type">MAP_ZOOM_STATE_OVERVIEW</span>)</span> {
            <span class="hljs-keyword">instance</span>.changeToOverview<span class="hljs-container">()</span>;
            scrollView.setZoomScale<span class="hljs-container">(<span class="hljs-type">MAP_ZOOM_SCALE_OVERVIEW</span>)</span>;
        }

        //scroll to correct position
        //var om = currentOverviewMap;
        var om = currentDetailsMap;
        var sx = <span class="hljs-container">(<span class="hljs-title">om</span>.<span class="hljs-title">getWidth</span>()</span> * scrollView.getZoomScale<span class="hljs-container">()</span> - <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.displayCaps.platformWidth - <span class="hljs-keyword">instance</span>.legend.width) / 2;
        var sy = <span class="hljs-container">(<span class="hljs-title">om</span>.<span class="hljs-title">getHeight</span>()</span> * scrollView.getZoomScale<span class="hljs-container">()</span> - <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.displayCaps.platformHeight) / 2;
        sx = sx &gt; 0 ? sx : 0;
        sy = sy &gt; 0 ? sy : 0;
        //scrollView.scrollTo<span class="hljs-container">(<span class="hljs-title">sx</span>, <span class="hljs-title">sy</span>)</span>;
        scrollView.setContentOffset<span class="hljs-container">({
            <span class="hljs-title">x</span> : <span class="hljs-title">sx</span>,
            <span class="hljs-title">y</span> : <span class="hljs-title">sy</span>
        }, {
            <span class="hljs-title">animated</span> : <span class="hljs-title">false</span>
        })</span>;
    }

    <span class="hljs-keyword">instance</span>.gotoFloor = function<span class="hljs-container">(<span class="hljs-title">_floor</span>, <span class="hljs-title">_animate</span>)</span> {

        <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">('<span class="hljs-title">go</span> <span class="hljs-title">to</span> <span class="hljs-title">floor'</span>)</span>;

        if <span class="hljs-container">(<span class="hljs-title">_animate</span>)</span> {

            <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">('1')</span>;

            <span class="hljs-keyword">instance</span>.showLoadingAndShadow<span class="hljs-container">()</span>;
            navController.currentFloorId = _floor.id;
            <span class="hljs-keyword">instance</span>.scrollViewAnimation.setOpacity<span class="hljs-container">(0.0)</span>;

            var floors = navController.artBook.floors;
            for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">floors</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
                if <span class="hljs-container">(<span class="hljs-title">floors</span>[<span class="hljs-title">i</span>].<span class="hljs-title">id</span> == <span class="hljs-title">_floor</span>.<span class="hljs-title">id</span>)</span> {
                    <span class="hljs-keyword">instance</span>.legend.expand<span class="hljs-container">(<span class="hljs-title">i</span>, <span class="hljs-title">false</span>)</span>;
                }
            }

            var completeHandler = function<span class="hljs-container">()</span> {
                <span class="hljs-keyword">instance</span>.scrollViewAnimation.removeEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
                <span class="hljs-keyword">instance</span>.gotoFloorFinalize<span class="hljs-container">()</span>;                

                setTimeout<span class="hljs-container">(<span class="hljs-title">function</span>()</span> {
                    <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">(123)</span>;
                    scrollView.setOpacity<span class="hljs-container">(1)</span>;
                    <span class="hljs-keyword">instance</span>.hideLoadingAndShadow<span class="hljs-container">()</span>;
                }, 500);
            };

            <span class="hljs-keyword">instance</span>.scrollViewAnimation.addEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
            scrollView.animate<span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">scrollViewAnimation</span>)</span>;
            navController.currentFloorId = _floor.id
        } else {
            <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">('2')</span>;
            var floors = navController.artBook.floors;
            for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">floors</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
                if <span class="hljs-container">(<span class="hljs-title">floors</span>[<span class="hljs-title">i</span>].<span class="hljs-title">id</span> == <span class="hljs-title">_floor</span>.<span class="hljs-title">id</span>)</span> {
                    <span class="hljs-keyword">instance</span>.legend.expand<span class="hljs-container">(<span class="hljs-title">i</span>, <span class="hljs-title">false</span>)</span>;
                }
            }
            <span class="hljs-keyword">instance</span>.gotoFloorFinalize<span class="hljs-container">()</span>; 
            scrollView.setOpacity<span class="hljs-container">(1)</span>;
            navController.currentFloorId = _floor.id;
        }

    }

    <span class="hljs-keyword">instance</span>.gotoRoom = function<span class="hljs-container">(<span class="hljs-title">_room</span>)</span> {

        <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">('<span class="hljs-title">go</span> <span class="hljs-title">to</span> <span class="hljs-title">room'</span>)</span>;

        <span class="hljs-keyword">instance</span>.showLoadingAndShadow<span class="hljs-container">()</span>;
        if <span class="hljs-container">(<span class="hljs-title">navController</span>.<span class="hljs-title">currentFloorId</span> == <span class="hljs-title">_room</span>.<span class="hljs-title">floor</span>.<span class="hljs-title">id</span>)</span> {

            <span class="hljs-keyword">instance</span>.scrollViewAnimation.setOpacity<span class="hljs-container">(0.0)</span>;

            var completeHandler = function<span class="hljs-container">()</span> {
                <span class="hljs-keyword">instance</span>.scrollViewAnimation.removeEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
                scrollView.setOpacity<span class="hljs-container">(0.0)</span>;

                if <span class="hljs-container">(<span class="hljs-title">state</span> != <span class="hljs-type">MAP_ZOOM_STATE_DETAILS</span>)</span> {
                    <span class="hljs-keyword">instance</span>.changeToDetails<span class="hljs-container">()</span>;
                    scrollView.setZoomScale<span class="hljs-container">(<span class="hljs-type">MAP_ZOOM_SCALE_DETAILS</span>)</span>;
                }

                var sx = <span class="hljs-container">(<span class="hljs-title">_room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span>)</span> / 2));
                var sy = <span class="hljs-container">(<span class="hljs-title">_room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span>)</span> / 2)) + 40;
                /*if <span class="hljs-container">(<span class="hljs-title">_room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> == 0 &amp;&amp; <span class="hljs-title">_room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> == 0)</span> {
                 sx = <span class="hljs-container">(<span class="hljs-title">_room</span>.<span class="hljs-title">floor</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span>)</span> / 2));
                 sy = <span class="hljs-container">(<span class="hljs-title">_room</span>.<span class="hljs-title">floor</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span>)</span> / 2)) + 40;
                 }*/

                sx = sx &gt; 0 ? sx : 0;
                sy = sy &gt; 0 ? sy : 0;
                //scrollView.scrollTo<span class="hljs-container">(<span class="hljs-title">sx</span>, <span class="hljs-title">sy</span>)</span>;
                scrollView.setContentOffset<span class="hljs-container">({
                    <span class="hljs-title">x</span> : <span class="hljs-title">sx</span>,
                    <span class="hljs-title">y</span> : <span class="hljs-title">sy</span>
                }, {
                    <span class="hljs-title">animated</span> : <span class="hljs-title">false</span>
                })</span>;

                setTimeout<span class="hljs-container">(<span class="hljs-title">function</span>()</span> {
                    //scrollView.setOpacity<span class="hljs-container">(1.0)</span>;
                    <span class="hljs-keyword">instance</span>.scrollViewAnimation.setOpacity<span class="hljs-container">(1.0)</span>;
                    scrollView.animate<span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">scrollViewAnimation</span>)</span>;
                    <span class="hljs-keyword">instance</span>.hideLoadingAndShadow<span class="hljs-container">()</span>;
                }, 500);
            };
            <span class="hljs-keyword">instance</span>.scrollViewAnimation.addEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
            scrollView.animate<span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">scrollViewAnimation</span>)</span>;

        } else {
            <span class="hljs-keyword">instance</span>.gotoFloor<span class="hljs-container">(<span class="hljs-title">_room</span>.<span class="hljs-title">floor</span>, <span class="hljs-title">true</span>)</span>;
            setTimeout<span class="hljs-container">(<span class="hljs-title">function</span>()</span> {
                <span class="hljs-keyword">instance</span>.gotoRoom<span class="hljs-container">(<span class="hljs-title">_room</span>)</span>;
                <span class="hljs-keyword">instance</span>.hideLoadingAndShadow<span class="hljs-container">()</span>;
            }, 500);
        }

    }

    <span class="hljs-keyword">instance</span>.gotoWork = function<span class="hljs-container">(<span class="hljs-title">_work</span>)</span> {

        <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">('<span class="hljs-title">go</span> <span class="hljs-title">to</span> <span class="hljs-title">work'</span>)</span>;

        if <span class="hljs-container">(<span class="hljs-title">_work</span> != <span class="hljs-title">undefined</span>)</span> {

            navController.currentFloorId = _work.room.floor.id;

            //make sure current maps are displayed
            if <span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">scrollView</span>.<span class="hljs-title">opacity</span> == 0)</span>
                <span class="hljs-keyword">instance</span>.scrollView.setOpacity<span class="hljs-container">(1.0)</span>;

            /*for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">instance</span>.<span class="hljs-title">overviewMaps</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
                if <span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">overviewMaps</span>[<span class="hljs-title">i</span>].<span class="hljs-title">mapId</span> == <span class="hljs-title">navController</span>.<span class="hljs-title">currentFloorId</span>)</span> {
                    <span class="hljs-keyword">instance</span>.legend.expand<span class="hljs-container">(<span class="hljs-title">i</span>, <span class="hljs-title">false</span>)</span>;
                    <span class="hljs-keyword">instance</span>.activateMaps<span class="hljs-container">(<span class="hljs-title">i</span>)</span>;
                }
            }*/
            for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">instance</span>.<span class="hljs-title">detailMaps</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
                if <span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">detailMaps</span>[<span class="hljs-title">i</span>].<span class="hljs-title">mapId</span> == <span class="hljs-title">navController</span>.<span class="hljs-title">currentFloorId</span>)</span> {
                    <span class="hljs-keyword">instance</span>.legend.expand<span class="hljs-container">(<span class="hljs-title">i</span>, <span class="hljs-title">false</span>)</span>;
                    <span class="hljs-keyword">instance</span>.activateMaps<span class="hljs-container">(<span class="hljs-title">i</span>)</span>;
                    //<span class="hljs-keyword">instance</span>.detailMaps[i].setOpacity<span class="hljs-container">(1)</span>;
                } else {
                    //<span class="hljs-keyword">instance</span>.detailMaps[i].setOpacity<span class="hljs-container">(0)</span>;
                }
            }

            if <span class="hljs-container">(<span class="hljs-title">state</span> != <span class="hljs-type">MAP_ZOOM_STATE_DETAILS</span>)</span> {
                <span class="hljs-keyword">instance</span>.scrollView.setZoomScale<span class="hljs-container">(<span class="hljs-type">MAP_ZOOM_SCALE_DETAILS</span>)</span>;
                <span class="hljs-keyword">instance</span>.changeToDetails<span class="hljs-container">()</span>;
            }
        }

        var wbs = <span class="hljs-keyword">instance</span>.workButtons;
        var sx = 0;
        var sy = 0;
        for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">wbs</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
            wbs[i].setBackgroundImage<span class="hljs-container">(<span class="hljs-type">PAINTING_PIN_FILE</span>)</span>;
            for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">j</span> = 0; <span class="hljs-title">j</span> &lt; <span class="hljs-title">wbs</span>[<span class="hljs-title">i</span>].<span class="hljs-title">works</span>.<span class="hljs-title">length</span>; <span class="hljs-title">j</span>++)</span> {
                if <span class="hljs-container">(<span class="hljs-title">wbs</span>[<span class="hljs-title">i</span>].<span class="hljs-title">works</span>[<span class="hljs-title">j</span>].<span class="hljs-title">id</span> == <span class="hljs-title">_work</span>.<span class="hljs-title">id</span>)</span> {
                    wbs[i].setBackgroundImage<span class="hljs-container">(<span class="hljs-type">PAINTING_PIN_HERE_FILE</span>)</span>;
                    if <span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> == 0 || <span class="hljs-title">_work</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> == 0)</span> {
                        sx = <span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span> / 2)</span>));
                        sy = <span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span> / 2)</span>)) + 40;
                    } else {
                        sx = <span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span> / 2)</span>));
                        sy = <span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span> / 2)</span>)) + 40;
                    }
                    break;
                }
            }
        }

        sx = sx &gt; 0 ? sx : 0;
        sy = sy &gt; 0 ? sy : 0;

        if <span class="hljs-container">(!<span class="hljs-title">openBefore</span>)</span> {
            setTimeout<span class="hljs-container">(<span class="hljs-title">function</span>()</span> {
                scrollView.setContentOffset<span class="hljs-container">({
                    <span class="hljs-title">x</span> : <span class="hljs-title">sx</span>,
                    <span class="hljs-title">y</span> : <span class="hljs-title">sy</span>
                }, {
                    <span class="hljs-title">animated</span> : <span class="hljs-title">false</span>
                })</span>;
                openBefore = true;
            }, 500);
        } else {
            scrollView.setContentOffset<span class="hljs-container">({
                <span class="hljs-title">x</span> : <span class="hljs-title">sx</span>,
                <span class="hljs-title">y</span> : <span class="hljs-title">sy</span>
            }, {
                <span class="hljs-title">animated</span> : <span class="hljs-title">false</span>
            })</span>;
        }
    };

    <span class="hljs-keyword">instance</span>.changeToOverview = function<span class="hljs-container">()</span> {

        state = <span class="hljs-type">MAP_ZOOM_STATE_OVERVIEW</span>;

        /*var a = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createAnimation<span class="hljs-container">({
            <span class="hljs-title">duration</span> : 300
        })</span>;
        a.setOpacity<span class="hljs-container">(0.0)</span>;
        var completeHandler = function<span class="hljs-container">()</span> {
            a.removeEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
            currentDetailsMap.setOpacity<span class="hljs-container">(0.0)</span>;
        };
        a.addEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
        currentDetailsMap.animate<span class="hljs-container">(<span class="hljs-title">a</span>)</span>;*/

        //<span class="hljs-keyword">instance</span>.checkButtonVisibility<span class="hljs-container">()</span>;

    }

    <span class="hljs-keyword">instance</span>.changeToDetails = function<span class="hljs-container">()</span> {

        state = <span class="hljs-type">MAP_ZOOM_STATE_DETAILS</span>;

        /*if <span class="hljs-container">(<span class="hljs-title">currentDetailsMap</span>.<span class="hljs-title">getOpacity</span>()</span> != 1) {

            var a = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createAnimation<span class="hljs-container">({
                <span class="hljs-title">duration</span> : 300
            })</span>;
            a.setOpacity<span class="hljs-container">(1)</span>;
            var completeHandler = function<span class="hljs-container">()</span> {
                a.removeEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
                currentDetailsMap.setOpacity<span class="hljs-container">(1)</span>;
            };
            a.addEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
            currentDetailsMap.animate<span class="hljs-container">(<span class="hljs-title">a</span>)</span>;
        }*/

        //<span class="hljs-keyword">instance</span>.checkButtonVisibility<span class="hljs-container">()</span>;

    }

    <span class="hljs-keyword">instance</span>.activateMaps = function<span class="hljs-container">(<span class="hljs-title">_index</span>)</span> {

        <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">('<span class="hljs-title">activate</span> <span class="hljs-title">maps</span>: ' + <span class="hljs-title">_index</span>)</span>;

        //var tmp1 = currentOverviewMap;
        var tmp2 = currentDetailsMap;
        /*if <span class="hljs-container">(<span class="hljs-title">tmp1</span> != <span class="hljs-title">undefined</span>)</span>
            tmp1.setOpacity<span class="hljs-container">(0)</span>;*/
        /*if <span class="hljs-container">(<span class="hljs-title">tmp2</span> != <span class="hljs-title">undefined</span>)</span>
            tmp2.setOpacity<span class="hljs-container">(0)</span>;*/

        //currentOverviewMap = <span class="hljs-keyword">instance</span>.overviewMaps[_index];
        currentDetailsMap = <span class="hljs-keyword">instance</span>.detailMaps[_index];


        /*if <span class="hljs-container">(<span class="hljs-title">scrollView</span>.<span class="hljs-title">children</span>.<span class="hljs-title">indexOf</span>(<span class="hljs-title">currentOverviewMap</span>)</span> == -1) {

            if <span class="hljs-container">(<span class="hljs-title">tmp1</span> != <span class="hljs-title">undefined</span>)</span>
                scrollView.remove<span class="hljs-container">(<span class="hljs-title">tmp1</span>)</span>;
            scrollView.add<span class="hljs-container">(<span class="hljs-title">currentOverviewMap</span>)</span>;
        }*/

        if <span class="hljs-container">(<span class="hljs-title">scrollView</span>.<span class="hljs-title">children</span>.<span class="hljs-title">indexOf</span>(<span class="hljs-title">currentDetailsMap</span>)</span> != -1) {
            /*if <span class="hljs-container">(<span class="hljs-title">tmp2</span> != <span class="hljs-title">undefined</span>)</span>
                scrollView.remove<span class="hljs-container">(<span class="hljs-title">tmp2</span>)</span>;
            scrollView.add<span class="hljs-container">(<span class="hljs-title">currentDetailsMap</span>)</span>;*/
            //tmp1.setOpacity<span class="hljs-container">(0)</span>;
            if <span class="hljs-container">(<span class="hljs-title">tmp2</span> != <span class="hljs-title">undefined</span>)</span>
                tmp2.setOpacity<span class="hljs-container">(0)</span>;
            //currentOverviewMap.setOpacity<span class="hljs-container">(1)</span>;
            currentDetailsMap.setOpacity<span class="hljs-container">(1)</span>;
        }

        //<span class="hljs-type">Set</span> button visibility
        //<span class="hljs-keyword">instance</span>.checkButtonVisibility<span class="hljs-container">()</span>;

    };

    /*<span class="hljs-keyword">instance</span>.checkButtonVisibility = function<span class="hljs-container">()</span> {

        scrollView.startLayout<span class="hljs-container">()</span>;

        //room buttons
        for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">instance</span>.<span class="hljs-title">roomButtons</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
            var b = <span class="hljs-keyword">instance</span>.roomButtons[i];
            if <span class="hljs-container">(<span class="hljs-title">b</span>.<span class="hljs-title">map</span> == <span class="hljs-title">currentOverviewMap</span>)</span> {
                if <span class="hljs-container">(<span class="hljs-title">state</span> == <span class="hljs-type">MAP_ZOOM_STATE_OVERVIEW</span>)</span> {
                    b.setVisible<span class="hljs-container">(<span class="hljs-title">true</span>)</span>;
                } else {
                    b.setVisible<span class="hljs-container">(<span class="hljs-title">false</span>)</span>;
                }
            } else {
                b.setVisible<span class="hljs-container">(<span class="hljs-title">false</span>)</span>;
            }
        }

        //work buttons
        for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">instance</span>.<span class="hljs-title">workButtons</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
            var b = <span class="hljs-keyword">instance</span>.workButtons[i];
            if <span class="hljs-container">(<span class="hljs-title">b</span>.<span class="hljs-title">map</span> == <span class="hljs-title">currentDetailsMap</span>)</span> {
                if <span class="hljs-container">(<span class="hljs-title">state</span> == <span class="hljs-type">MAP_ZOOM_STATE_OVERVIEW</span>)</span> {
                    if <span class="hljs-container">(<span class="hljs-title">b</span>.<span class="hljs-title">showOnOverview</span>)</span> {
                        b.setVisible<span class="hljs-container">(<span class="hljs-title">true</span>)</span>;
                    } else {
                        b.setVisible<span class="hljs-container">(<span class="hljs-title">false</span>)</span>;
                    }
                } else {
                    b.setVisible<span class="hljs-container">(<span class="hljs-title">true</span>)</span>;
                }
            } else {
                b.setVisible<span class="hljs-container">(<span class="hljs-title">false</span>)</span>;
            }
        }

        scrollView.finishLayout<span class="hljs-container">()</span>;
    }*/

    <span class="hljs-keyword">instance</span>.createOverlay = function<span class="hljs-container">()</span> {

        var overlayWidth = 36;
        var overlayHeight = 30;
        var overlayOpacity = 0.8;

        var top = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createView<span class="hljs-container">({
            <span class="hljs-title">top</span> : 0,
            <span class="hljs-title">left</span> : 0,
            <span class="hljs-title">width</span> : <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span>,
            <span class="hljs-title">height</span> : <span class="hljs-title">overlayHeight</span>,
            <span class="hljs-title">backgroundColor</span> : '#000000',
            <span class="hljs-title">opacity</span> : <span class="hljs-title">overlayOpacity</span>,
        })</span>;
        <span class="hljs-keyword">instance</span>.add<span class="hljs-container">(<span class="hljs-title">top</span>)</span>;

        var bottom = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createView<span class="hljs-container">({
            <span class="hljs-title">top</span> : <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span> - <span class="hljs-title">overlayHeight</span>,
            <span class="hljs-title">left</span> : 0,
            <span class="hljs-title">width</span> : <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span>,
            <span class="hljs-title">height</span> : <span class="hljs-title">overlayHeight</span>,
            <span class="hljs-title">backgroundColor</span> : '#000000',
            <span class="hljs-title">opacity</span> : <span class="hljs-title">overlayOpacity</span>,
        })</span>;
        <span class="hljs-keyword">instance</span>.add<span class="hljs-container">(<span class="hljs-title">bottom</span>)</span>;

        var left = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createView<span class="hljs-container">({
            <span class="hljs-title">top</span> : <span class="hljs-title">overlayHeight</span>,
            <span class="hljs-title">left</span> : 0,
            <span class="hljs-title">width</span> : 12,
            <span class="hljs-title">height</span> : <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span> - 2 * <span class="hljs-title">overlayHeight</span>,
            <span class="hljs-title">backgroundColor</span> : '#000000',
            <span class="hljs-title">opacity</span> : <span class="hljs-title">overlayOpacity</span>,
        })</span>;
        <span class="hljs-keyword">instance</span>.add<span class="hljs-container">(<span class="hljs-title">left</span>)</span>;

        var right = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createView<span class="hljs-container">({
            <span class="hljs-title">top</span> : <span class="hljs-title">overlayHeight</span>,
            <span class="hljs-title">left</span> : <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span> - <span class="hljs-title">overlayWidth</span>,
            <span class="hljs-title">width</span> : <span class="hljs-title">overlayWidth</span>,
            <span class="hljs-title">height</span> : <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span> - 2 * <span class="hljs-title">overlayHeight</span>,
            <span class="hljs-title">backgroundColor</span> : '#000000',
            <span class="hljs-title">opacity</span> : <span class="hljs-title">overlayOpacity</span>,
        })</span>;
        <span class="hljs-keyword">instance</span>.add<span class="hljs-container">(<span class="hljs-title">right</span>)</span>;

        var close = <span class="hljs-type">Titanium</span>.<span class="hljs-type">UI</span>.createButton<span class="hljs-container">({
            <span class="hljs-title">title</span> : '',
            <span class="hljs-title">width</span> : 35,
            <span class="hljs-title">height</span> : 35,
            <span class="hljs-title">top</span> : <span class="hljs-title">overlayHeight</span> + 6,
            <span class="hljs-title">right</span> : <span class="hljs-title">overlayWidth</span> + 6,
            <span class="hljs-title">backgroundImage</span> : <span class="hljs-type">CLOSE_BUTTON_FILE</span>,
            <span class="hljs-title">backgroundSelectedImage</span> : <span class="hljs-type">CLOSE_BUTTON_SELECTED_FILE</span>,
            <span class="hljs-title">opacity</span> : 0.5
        })</span>;
        close.addEventListener<span class="hljs-container">('<span class="hljs-title">click'</span>, <span class="hljs-title">function</span>(<span class="hljs-title">e</span>)</span> {
            <span class="hljs-keyword">instance</span>.legend.collapse<span class="hljs-container">(<span class="hljs-title">false</span>)</span>;
            navController.hideMap<span class="hljs-container">()</span>;
        });
        <span class="hljs-keyword">instance</span>.add<span class="hljs-container">(<span class="hljs-title">close</span>)</span>;

    };

    <span class="hljs-keyword">instance</span>.createLegend = function<span class="hljs-container">()</span> {
        <span class="hljs-keyword">instance</span>.legend = new <span class="hljs-type">MapLegend</span><span class="hljs-container">(<span class="hljs-title">navController</span>)</span>;
        <span class="hljs-keyword">instance</span>.add<span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">legend</span>)</span>;
    };

    <span class="hljs-keyword">instance</span>.createOverlay<span class="hljs-container">()</span>;
    <span class="hljs-keyword">instance</span>.createLegend<span class="hljs-container">()</span>;

    <span class="hljs-keyword">instance</span>.onLanguageChange = function<span class="hljs-container">(<span class="hljs-title">lang</span>)</span> {

    };
    <span class="hljs-type">Ti</span>.<span class="hljs-type">App</span>.addEventListener<span class="hljs-container">(<span class="hljs-type">LANGUAGE_CHANGED</span>, <span class="hljs-title">instance</span>.<span class="hljs-title">onLanguageChange</span>)</span>;

    return <span class="hljs-keyword">instance</span>;
};</span>
</code></pre><p>The thing i talk about is in the method instance.checkButtonVisibility:</p>
<p>Thanks Tonio</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 26th 2012, 11:39:57 pm">November 26th 2012</span>
								by <span class='authorname'>Tonio Seiler</span><br>
								<a class="icon-bg icon-link" href="../../question/145095/startlayout--finishlayout-deprecated.html#answer-251733" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-251734">
				
						<section>
							<p>Ti.include(&#39;constants.js&#39;);</p>
<p>var MapLegend = require(&#39;ui&#x2F;mapLegend&#39;).MapLegend;<br>var BaseWindow = require(&#39;ui&#x2F;components&#x2F;baseWindow&#39;).BaseWindow;</p>
<p>exports.MapWindow = function MapWindow(_navController) {</p>
<pre><code class="hljs"><span class="hljs-title">var</span> navController = _navController;
<span class="hljs-title">var</span> state = <span class="hljs-type">MAP_ZOOM_STATE_OVERVIEW</span>;
<span class="hljs-title">var</span> openBefore = false;

<span class="hljs-title">var</span> <span class="hljs-keyword">instance</span> = new <span class="hljs-type">BaseWindow</span>({
    title : '<span class="hljs-type">Map'</span>,
    backgroundColor : '#<span class="hljs-number">000000</span>',
    fullscreen : true,
    navBarHidden : true
});
<span class="hljs-class">
<span class="hljs-keyword">instance</span>.orientationModes = [<span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.<span class="hljs-type">LANDSCAPE_LEFT</span>];
<span class="hljs-keyword">instance</span>.layout = 'absolute';

//<span class="hljs-keyword">instance</span>.roomButtons = undefined;
<span class="hljs-keyword">instance</span>.workButtons = undefined;
//<span class="hljs-keyword">instance</span>.overviewMaps = undefined;
<span class="hljs-keyword">instance</span>.detailMaps = undefined;

//var currentOverviewMap = undefined;
var currentDetailsMap = undefined;

var scrollView = <span class="hljs-type">Titanium</span>.<span class="hljs-type">UI</span>.createScrollView<span class="hljs-container">({
    <span class="hljs-title">contentWidth</span> : '<span class="hljs-title">auto'</span>,
    <span class="hljs-title">contentHeight</span> : '<span class="hljs-title">auto'</span>,
    <span class="hljs-title">showVerticalScrollIndicator</span> : <span class="hljs-title">false</span>,
    <span class="hljs-title">showHorizontalScrollIndicator</span> : <span class="hljs-title">false</span>,
    <span class="hljs-title">top</span> : 0,
    <span class="hljs-title">left</span> : 0,
    <span class="hljs-title">width</span> : '100%',
    <span class="hljs-title">height</span> : '100%',
    <span class="hljs-title">backgroundColor</span> : '<span class="hljs-title">black'</span>,
    <span class="hljs-title">minZoomScale</span> : 0.35,
    <span class="hljs-title">maxZoomScale</span> : 2.0,
    <span class="hljs-title">zoomScale</span> : <span class="hljs-type">MAP_ZOOM_SCALE_OVERVIEW</span>,
    <span class="hljs-title">layout</span> : '<span class="hljs-title">absolute'</span>,
    <span class="hljs-title">disableBounce</span> : <span class="hljs-title">true</span>
})</span>;

scrollView.addEventListener<span class="hljs-container">('<span class="hljs-title">postlayout'</span>, <span class="hljs-title">function</span>(<span class="hljs-title">e</span>)</span> {
    //<span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">('<span class="hljs-title">postlayout'</span>)</span>;
});

scrollView.addEventListener<span class="hljs-container">('<span class="hljs-title">scale'</span>, <span class="hljs-title">function</span>(<span class="hljs-title">e</span>)</span> {
    if <span class="hljs-container">(<span class="hljs-title">e</span>.<span class="hljs-title">scale</span> &lt; <span class="hljs-type">MAP_ZOOM_THRESHOLD</span> &amp;&amp; <span class="hljs-title">state</span> == <span class="hljs-type">MAP_ZOOM_STATE_DETAILS</span>)</span> {
        <span class="hljs-keyword">instance</span>.changeToOverview<span class="hljs-container">()</span>;
    } else if <span class="hljs-container">(<span class="hljs-title">e</span>.<span class="hljs-title">scale</span> &gt;= <span class="hljs-type">MAP_ZOOM_THRESHOLD</span> &amp;&amp; <span class="hljs-title">state</span> == <span class="hljs-type">MAP_ZOOM_STATE_OVERVIEW</span>)</span> {
        <span class="hljs-keyword">instance</span>.changeToDetails<span class="hljs-container">()</span>;
    }
});
<span class="hljs-keyword">instance</span>.scrollView = scrollView;
<span class="hljs-keyword">instance</span>.add<span class="hljs-container">(<span class="hljs-title">scrollView</span>)</span>;

<span class="hljs-keyword">instance</span>.scrollViewAnimation = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createAnimation<span class="hljs-container">({
    <span class="hljs-title">duration</span> : 500
})</span>;

<span class="hljs-keyword">instance</span>.createWorkPin = function<span class="hljs-container">(<span class="hljs-title">_work</span>, <span class="hljs-title">_width</span>, <span class="hljs-title">_height</span>, <span class="hljs-title">_showOnOverview</span>, <span class="hljs-title">_existing</span>)</span> {

    var left = _work.mapPosition.x - _width / 2;
    var top = _work.mapPosition.y - _height / 2;

    if <span class="hljs-container">(<span class="hljs-title">_existing</span> != <span class="hljs-title">undefined</span> &amp;&amp; <span class="hljs-title">_existing</span>.<span class="hljs-title">length</span> != 0)</span> {
        for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">j</span> = 0; <span class="hljs-title">j</span> &lt; <span class="hljs-title">_existing</span>.<span class="hljs-title">length</span>; <span class="hljs-title">j</span>++)</span> {
            var b1 = _existing[j];
            if <span class="hljs-container">(<span class="hljs-title">b1</span>.<span class="hljs-title">works</span> != <span class="hljs-title">undefined</span> &amp;&amp; <span class="hljs-title">b1</span>.<span class="hljs-title">works</span>[0].<span class="hljs-title">room</span> != <span class="hljs-title">undefined</span>)</span> {
                if <span class="hljs-container">(<span class="hljs-title">b1</span>.<span class="hljs-title">left</span> == <span class="hljs-title">left</span> &amp;&amp; <span class="hljs-title">b1</span>.<span class="hljs-title">top</span> == <span class="hljs-title">top</span> &amp;&amp; <span class="hljs-title">b1</span>.<span class="hljs-title">works</span>[0].<span class="hljs-title">room</span>.<span class="hljs-title">floor</span>.<span class="hljs-title">id</span> == <span class="hljs-title">_work</span>.<span class="hljs-title">room</span>.<span class="hljs-title">floor</span>.<span class="hljs-title">id</span>)</span> {
                    var tmp = b1.works;
                    tmp.push<span class="hljs-container">(<span class="hljs-title">_work</span>)</span>;
                    b1.works = tmp;
                    return undefined;
                }
            }
        }
    }

    var button = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createButton<span class="hljs-container">({
        <span class="hljs-title">width</span> : <span class="hljs-title">_width</span>,
        <span class="hljs-title">height</span> : <span class="hljs-title">_height</span>,
        <span class="hljs-title">visible</span> : <span class="hljs-title">true</span>,
        <span class="hljs-title">backgroundImage</span> : <span class="hljs-type">PAINTING_PIN_FILE</span>,
        <span class="hljs-title">backgroundSelectedImage</span> : <span class="hljs-type">PAINTING_PIN_SELECTED_FILE</span>,
        <span class="hljs-title">zIndex</span> : 40,
        <span class="hljs-title">opacity</span> : 1.0,
        <span class="hljs-title">visible</span> : <span class="hljs-title">true</span>,
    })</span>;

    //wieso auch immer
    var tmp = [];
    tmp[0] = _work;
    button.works = tmp;

    //button.map = undefined;
    button.showOnOverview = _showOnOverview;

    if <span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">room</span> != <span class="hljs-title">undefined</span> &amp;&amp; <span class="hljs-title">_work</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> == 0 &amp;&amp; <span class="hljs-title">_work</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> == 0)</span> {
        button.setLeft<span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> - <span class="hljs-title">button</span>.<span class="hljs-title">width</span> / 2)</span>;
        button.setTop<span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> - <span class="hljs-title">button</span>.<span class="hljs-title">height</span> / 2)</span>;
    } else {
        button.setLeft<span class="hljs-container">(<span class="hljs-title">left</span>)</span>;
        button.setTop<span class="hljs-container">(<span class="hljs-title">top</span>)</span>;
    }

    button.addEventListener<span class="hljs-container">('<span class="hljs-title">click'</span>, <span class="hljs-title">instance</span>.<span class="hljs-title">onWorkButtonClicked</span>)</span>;

    return button;
};

<span class="hljs-keyword">instance</span>.onWorkButtonClicked = function<span class="hljs-container">(<span class="hljs-title">e</span>)</span> {
    <span class="hljs-keyword">instance</span>.showLoadingAndShadow<span class="hljs-container">()</span>;
    navController.hideMapAndShowWork<span class="hljs-container">(<span class="hljs-title">e</span>.<span class="hljs-title">source</span>.<span class="hljs-title">works</span>[0])</span>;
    //just to make sure
    /*if <span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> != <span class="hljs-keyword">instance</span>.scrollView.<span class="hljs-type">MAP_ZOOM_SCALE_DETAILS</span>)
        <span class="hljs-keyword">instance</span>.scrollView.setZoomScale<span class="hljs-container">(<span class="hljs-type">MAP_ZOOM_SCALE_DETAILS</span>)</span>;*/
    <span class="hljs-keyword">instance</span>.hideLoadingAndShadow<span class="hljs-container">()</span>;
};

/*<span class="hljs-keyword">instance</span>.createRoomPin = function<span class="hljs-container">(<span class="hljs-title">_room</span>, <span class="hljs-title">_label</span>)</span> {

    var fn1 = <span class="hljs-type">ROOM_PIN_FILE</span>.replace<span class="hljs-container">('[<span class="hljs-title">x</span>]', <span class="hljs-title">_label</span>)</span>;
    var fn2 = <span class="hljs-type">ROOM_PIN_SELECTED_FILE</span>.replace<span class="hljs-container">('[<span class="hljs-title">x</span>]', <span class="hljs-title">_label</span>)</span>;

    var b = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createButton<span class="hljs-container">({
        <span class="hljs-title">backgroundImage</span> : <span class="hljs-title">fn1</span>,
        <span class="hljs-title">backgroundSelectedImage</span> : <span class="hljs-title">fn2</span>,
        <span class="hljs-title">width</span> : 90,
        <span class="hljs-title">height</span> : 112,
        <span class="hljs-title">visible</span> : <span class="hljs-title">true</span>,
        <span class="hljs-title">zIndex</span> : 30,
        <span class="hljs-title">visible</span> : <span class="hljs-title">false</span>,
    })</span>;
    b.room = _room;
    b.map = undefined;

    b.setLeft<span class="hljs-container">(<span class="hljs-title">_room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> - <span class="hljs-title">b</span>.<span class="hljs-title">width</span> / 2)</span>;
    b.setTop<span class="hljs-container">(<span class="hljs-title">_room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> - <span class="hljs-title">b</span>.<span class="hljs-title">height</span>)</span>;

    b.addEventListener<span class="hljs-container">('<span class="hljs-title">click'</span>, <span class="hljs-title">instance</span>.<span class="hljs-title">onRoomButtonClicked</span>)</span>;

    return b;
};*/

/*<span class="hljs-keyword">instance</span>.onRoomButtonClicked = function<span class="hljs-container">(<span class="hljs-title">e</span>)</span> {
    var sx = <span class="hljs-container">(<span class="hljs-title">e</span>.<span class="hljs-title">source</span>.<span class="hljs-title">room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">(<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span> / 2)</span>);
    sx = sx &gt; 0 ? sx : 0;
    var sy = <span class="hljs-container">(<span class="hljs-title">e</span>.<span class="hljs-title">source</span>.<span class="hljs-title">room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">(<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span> / 2)</span>);
    sy = sy &gt; 0 ? sy : 0;
    scrollView.scrollTo<span class="hljs-container">(<span class="hljs-title">sx</span>, <span class="hljs-title">sy</span>)</span>;

    setTimeout<span class="hljs-container">(<span class="hljs-title">function</span>()</span> {
        scrollView.setZoomScale<span class="hljs-container">(<span class="hljs-type">MAP_ZOOM_SCALE_DETAILS</span>)</span>;
    }, 600);
};*/

<span class="hljs-keyword">instance</span>.updateData = function<span class="hljs-container">(<span class="hljs-title">_artBook</span>)</span> {

    var buttons = [];
    for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">_artBook</span>.<span class="hljs-title">works</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
        var w = _artBook.works[i];
        var width = 20;
        var height = 20;
        var showOnOverview = false;

        //if only one room, make them bigger
        var roomsOnThisFloor = artBook.getRooms<span class="hljs-container">(<span class="hljs-title">w</span>.<span class="hljs-title">room</span>.<span class="hljs-title">floor</span>)</span>.length;
        if <span class="hljs-container">(<span class="hljs-title">roomsOnThisFloor</span> == 1)</span> {
            width *= 2;
            height *= 2;
            showOnOverview = true;
        }

        var b = <span class="hljs-keyword">instance</span>.createWorkPin<span class="hljs-container">(<span class="hljs-title">w</span>, <span class="hljs-title">width</span>, <span class="hljs-title">height</span>, <span class="hljs-title">showOnOverview</span>, <span class="hljs-title">buttons</span>)</span>;
        if <span class="hljs-container">(<span class="hljs-title">b</span> != <span class="hljs-title">undefined</span>)</span> {
            //scrollView.add<span class="hljs-container">(<span class="hljs-title">b</span>)</span>;
            buttons.push<span class="hljs-container">(<span class="hljs-title">b</span>)</span>;
        }
    }
    <span class="hljs-keyword">instance</span>.workButtons = buttons;

    /*buttons = [];
    for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">_artBook</span>.<span class="hljs-title">rooms</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {

        var l = '00' + <span class="hljs-container">(<span class="hljs-title">i</span> + 1)</span>;
        l = l.substr<span class="hljs-container">(<span class="hljs-title">l</span>.<span class="hljs-title">length</span> - 2, 2)</span>;
        var b = <span class="hljs-keyword">instance</span>.createRoomPin<span class="hljs-container">(<span class="hljs-title">_artBook</span>.<span class="hljs-title">rooms</span>[<span class="hljs-title">i</span>], <span class="hljs-title">l</span>)</span>;
        scrollView.add<span class="hljs-container">(<span class="hljs-title">b</span>)</span>;
        buttons[i] = b;

    }
    <span class="hljs-keyword">instance</span>.roomButtons = buttons;*/

    var detailMaps = [];
    //var overviewMaps = [];
    for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">navController</span>.<span class="hljs-title">artBook</span>.<span class="hljs-title">floors</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
        var floor = navController.artBook.floors[i];

        /*var of = <span class="hljs-type">Ti</span>.<span class="hljs-type">Filesystem</span>.getFile<span class="hljs-container">(<span class="hljs-type">Titanium</span>.<span class="hljs-type">Filesystem</span>.<span class="hljs-title">applicationDataDirectory</span>, <span class="hljs-title">floor</span>.<span class="hljs-title">imgSrc</span>)</span>;
        var ko = floor.id;
        var overviewMap = <span class="hljs-type">Titanium</span>.<span class="hljs-type">UI</span>.createImageView<span class="hljs-container">({
            <span class="hljs-title">image</span> : <span class="hljs-title">of</span>.<span class="hljs-title">getNativePath</span>()</span>,
            width : floor.imgWidth,
            height : floor.imgHeight,
            top : 0,
            left : 0,
            opacity : 0,
            zIndex : 10,
            mapId : ko
        });
        overviewMaps.push<span class="hljs-container">(<span class="hljs-title">overviewMap</span>)</span>;*/

        var df = <span class="hljs-type">Ti</span>.<span class="hljs-type">Filesystem</span>.getFile<span class="hljs-container">(<span class="hljs-type">Titanium</span>.<span class="hljs-type">Filesystem</span>.<span class="hljs-title">applicationDataDirectory</span>, <span class="hljs-title">floor</span>.<span class="hljs-title">detailedImgSrc</span>)</span>;
        var kd = floor.id;
        var detailsMap = <span class="hljs-type">Titanium</span>.<span class="hljs-type">UI</span>.createImageView<span class="hljs-container">({
            <span class="hljs-title">image</span> : <span class="hljs-title">df</span>.<span class="hljs-title">getNativePath</span>()</span>,
            width : floor.detailedImgWidth,
            height : floor.detailedImgHeight,
            top : 0,
            left : 0,
            opacity : 0,
            zIndex : 20,
            mapId : kd
        });
        detailMaps.push<span class="hljs-container">(<span class="hljs-title">detailsMap</span>)</span>;
        scrollView.add<span class="hljs-container">(<span class="hljs-title">detailsMap</span>)</span>;

        //assign buttons and maps
        for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">j</span> = 0; <span class="hljs-title">j</span> &lt; <span class="hljs-title">instance</span>.<span class="hljs-title">workButtons</span>.<span class="hljs-title">length</span>; <span class="hljs-title">j</span>++)</span> {
            var b1 = <span class="hljs-keyword">instance</span>.workButtons[j];
            if <span class="hljs-container">(<span class="hljs-title">b1</span>.<span class="hljs-title">works</span>[0].<span class="hljs-title">room</span> != <span class="hljs-title">undefined</span>)</span> {
                if <span class="hljs-container">(<span class="hljs-title">b1</span>.<span class="hljs-title">works</span>[0].<span class="hljs-title">room</span>.<span class="hljs-title">floor</span>.<span class="hljs-title">id</span> == <span class="hljs-title">detailsMap</span>.<span class="hljs-title">mapId</span>)</span> {
                    //b1.map = detailsMap;
                    detailsMap.add<span class="hljs-container">(<span class="hljs-title">b1</span>)</span>;
                }
            }
        }

        /*for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">j</span> = 0; <span class="hljs-title">j</span> &lt; <span class="hljs-title">instance</span>.<span class="hljs-title">roomButtons</span>.<span class="hljs-title">length</span>; <span class="hljs-title">j</span>++)</span> {
            var room = <span class="hljs-keyword">instance</span>.roomButtons[j].room;
            if <span class="hljs-container">(<span class="hljs-title">room</span> != <span class="hljs-title">undefined</span>)</span> {
                if <span class="hljs-container">(<span class="hljs-title">room</span>.<span class="hljs-title">floor</span>.<span class="hljs-title">id</span> == <span class="hljs-title">overviewMap</span>.<span class="hljs-title">mapId</span>)</span> {
                    <span class="hljs-keyword">instance</span>.roomButtons[j].map = overviewMap;
                }
            }
        }*/
    }
    //<span class="hljs-keyword">instance</span>.overviewMaps = overviewMaps;
    <span class="hljs-keyword">instance</span>.detailMaps = detailMaps;
    currentDetailsMap = <span class="hljs-keyword">instance</span>.detailMaps[0];
    currentDetailsMap.setOpacity<span class="hljs-container">(1)</span>;
};

<span class="hljs-keyword">instance</span>.gotoFloorFinalize = function<span class="hljs-container">()</span> {
    scrollView.setOpacity<span class="hljs-container">(0.0)</span>;

    //show hide correct map
    for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">instance</span>.<span class="hljs-title">detailMaps</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
        if <span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">detailMaps</span>[<span class="hljs-title">i</span>].<span class="hljs-title">mapId</span> == <span class="hljs-title">navController</span>.<span class="hljs-title">currentFloorId</span>)</span> {
            <span class="hljs-keyword">instance</span>.activateMaps<span class="hljs-container">(<span class="hljs-title">i</span>)</span>;
            //<span class="hljs-keyword">instance</span>.detailMaps[i].setOpacity<span class="hljs-container">(0)</span>;
        }
    }

    if <span class="hljs-container">(<span class="hljs-title">state</span> != <span class="hljs-type">MAP_ZOOM_STATE_OVERVIEW</span>)</span> {
        <span class="hljs-keyword">instance</span>.changeToOverview<span class="hljs-container">()</span>;
        scrollView.setZoomScale<span class="hljs-container">(<span class="hljs-type">MAP_ZOOM_SCALE_OVERVIEW</span>)</span>;
    }

    //scroll to correct position
    //var om = currentOverviewMap;
    var om = currentDetailsMap;
    var sx = <span class="hljs-container">(<span class="hljs-title">om</span>.<span class="hljs-title">getWidth</span>()</span> * scrollView.getZoomScale<span class="hljs-container">()</span> - <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.displayCaps.platformWidth - <span class="hljs-keyword">instance</span>.legend.width) / 2;
    var sy = <span class="hljs-container">(<span class="hljs-title">om</span>.<span class="hljs-title">getHeight</span>()</span> * scrollView.getZoomScale<span class="hljs-container">()</span> - <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.displayCaps.platformHeight) / 2;
    sx = sx &gt; 0 ? sx : 0;
    sy = sy &gt; 0 ? sy : 0;
    //scrollView.scrollTo<span class="hljs-container">(<span class="hljs-title">sx</span>, <span class="hljs-title">sy</span>)</span>;
    scrollView.setContentOffset<span class="hljs-container">({
        <span class="hljs-title">x</span> : <span class="hljs-title">sx</span>,
        <span class="hljs-title">y</span> : <span class="hljs-title">sy</span>
    }, {
        <span class="hljs-title">animated</span> : <span class="hljs-title">false</span>
    })</span>;
}

<span class="hljs-keyword">instance</span>.gotoFloor = function<span class="hljs-container">(<span class="hljs-title">_floor</span>, <span class="hljs-title">_animate</span>)</span> {

    <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">('<span class="hljs-title">go</span> <span class="hljs-title">to</span> <span class="hljs-title">floor'</span>)</span>;

    if <span class="hljs-container">(<span class="hljs-title">_animate</span>)</span> {

        <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">('1')</span>;

        <span class="hljs-keyword">instance</span>.showLoadingAndShadow<span class="hljs-container">()</span>;
        navController.currentFloorId = _floor.id;
        <span class="hljs-keyword">instance</span>.scrollViewAnimation.setOpacity<span class="hljs-container">(0.0)</span>;

        var floors = navController.artBook.floors;
        for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">floors</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
            if <span class="hljs-container">(<span class="hljs-title">floors</span>[<span class="hljs-title">i</span>].<span class="hljs-title">id</span> == <span class="hljs-title">_floor</span>.<span class="hljs-title">id</span>)</span> {
                <span class="hljs-keyword">instance</span>.legend.expand<span class="hljs-container">(<span class="hljs-title">i</span>, <span class="hljs-title">false</span>)</span>;
            }
        }

        var completeHandler = function<span class="hljs-container">()</span> {
            <span class="hljs-keyword">instance</span>.scrollViewAnimation.removeEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
            <span class="hljs-keyword">instance</span>.gotoFloorFinalize<span class="hljs-container">()</span>;                

            setTimeout<span class="hljs-container">(<span class="hljs-title">function</span>()</span> {
                <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">(123)</span>;
                scrollView.setOpacity<span class="hljs-container">(1)</span>;
                <span class="hljs-keyword">instance</span>.hideLoadingAndShadow<span class="hljs-container">()</span>;
            }, 500);
        };

        <span class="hljs-keyword">instance</span>.scrollViewAnimation.addEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
        scrollView.animate<span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">scrollViewAnimation</span>)</span>;
        navController.currentFloorId = _floor.id
    } else {
        <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">('2')</span>;
        var floors = navController.artBook.floors;
        for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">floors</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
            if <span class="hljs-container">(<span class="hljs-title">floors</span>[<span class="hljs-title">i</span>].<span class="hljs-title">id</span> == <span class="hljs-title">_floor</span>.<span class="hljs-title">id</span>)</span> {
                <span class="hljs-keyword">instance</span>.legend.expand<span class="hljs-container">(<span class="hljs-title">i</span>, <span class="hljs-title">false</span>)</span>;
            }
        }
        <span class="hljs-keyword">instance</span>.gotoFloorFinalize<span class="hljs-container">()</span>; 
        scrollView.setOpacity<span class="hljs-container">(1)</span>;
        navController.currentFloorId = _floor.id;
    }

}

<span class="hljs-keyword">instance</span>.gotoRoom = function<span class="hljs-container">(<span class="hljs-title">_room</span>)</span> {

    <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">('<span class="hljs-title">go</span> <span class="hljs-title">to</span> <span class="hljs-title">room'</span>)</span>;

    <span class="hljs-keyword">instance</span>.showLoadingAndShadow<span class="hljs-container">()</span>;
    if <span class="hljs-container">(<span class="hljs-title">navController</span>.<span class="hljs-title">currentFloorId</span> == <span class="hljs-title">_room</span>.<span class="hljs-title">floor</span>.<span class="hljs-title">id</span>)</span> {

        <span class="hljs-keyword">instance</span>.scrollViewAnimation.setOpacity<span class="hljs-container">(0.0)</span>;

        var completeHandler = function<span class="hljs-container">()</span> {
            <span class="hljs-keyword">instance</span>.scrollViewAnimation.removeEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
            scrollView.setOpacity<span class="hljs-container">(0.0)</span>;

            if <span class="hljs-container">(<span class="hljs-title">state</span> != <span class="hljs-type">MAP_ZOOM_STATE_DETAILS</span>)</span> {
                <span class="hljs-keyword">instance</span>.changeToDetails<span class="hljs-container">()</span>;
                scrollView.setZoomScale<span class="hljs-container">(<span class="hljs-type">MAP_ZOOM_SCALE_DETAILS</span>)</span>;
            }

            var sx = <span class="hljs-container">(<span class="hljs-title">_room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span>)</span> / 2));
            var sy = <span class="hljs-container">(<span class="hljs-title">_room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span>)</span> / 2)) + 40;
            /*if <span class="hljs-container">(<span class="hljs-title">_room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> == 0 &amp;&amp; <span class="hljs-title">_room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> == 0)</span> {
             sx = <span class="hljs-container">(<span class="hljs-title">_room</span>.<span class="hljs-title">floor</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span>)</span> / 2));
             sy = <span class="hljs-container">(<span class="hljs-title">_room</span>.<span class="hljs-title">floor</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span>)</span> / 2)) + 40;
             }*/

            sx = sx &gt; 0 ? sx : 0;
            sy = sy &gt; 0 ? sy : 0;
            //scrollView.scrollTo<span class="hljs-container">(<span class="hljs-title">sx</span>, <span class="hljs-title">sy</span>)</span>;
            scrollView.setContentOffset<span class="hljs-container">({
                <span class="hljs-title">x</span> : <span class="hljs-title">sx</span>,
                <span class="hljs-title">y</span> : <span class="hljs-title">sy</span>
            }, {
                <span class="hljs-title">animated</span> : <span class="hljs-title">false</span>
            })</span>;

            setTimeout<span class="hljs-container">(<span class="hljs-title">function</span>()</span> {
                //scrollView.setOpacity<span class="hljs-container">(1.0)</span>;
                <span class="hljs-keyword">instance</span>.scrollViewAnimation.setOpacity<span class="hljs-container">(1.0)</span>;
                scrollView.animate<span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">scrollViewAnimation</span>)</span>;
                <span class="hljs-keyword">instance</span>.hideLoadingAndShadow<span class="hljs-container">()</span>;
            }, 500);
        };
        <span class="hljs-keyword">instance</span>.scrollViewAnimation.addEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
        scrollView.animate<span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">scrollViewAnimation</span>)</span>;

    } else {
        <span class="hljs-keyword">instance</span>.gotoFloor<span class="hljs-container">(<span class="hljs-title">_room</span>.<span class="hljs-title">floor</span>, <span class="hljs-title">true</span>)</span>;
        setTimeout<span class="hljs-container">(<span class="hljs-title">function</span>()</span> {
            <span class="hljs-keyword">instance</span>.gotoRoom<span class="hljs-container">(<span class="hljs-title">_room</span>)</span>;
            <span class="hljs-keyword">instance</span>.hideLoadingAndShadow<span class="hljs-container">()</span>;
        }, 500);
    }

}

<span class="hljs-keyword">instance</span>.gotoWork = function<span class="hljs-container">(<span class="hljs-title">_work</span>)</span> {

    <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">('<span class="hljs-title">go</span> <span class="hljs-title">to</span> <span class="hljs-title">work'</span>)</span>;

    if <span class="hljs-container">(<span class="hljs-title">_work</span> != <span class="hljs-title">undefined</span>)</span> {

        navController.currentFloorId = _work.room.floor.id;

        //make sure current maps are displayed
        if <span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">scrollView</span>.<span class="hljs-title">opacity</span> == 0)</span>
            <span class="hljs-keyword">instance</span>.scrollView.setOpacity<span class="hljs-container">(1.0)</span>;

        /*for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">instance</span>.<span class="hljs-title">overviewMaps</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
            if <span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">overviewMaps</span>[<span class="hljs-title">i</span>].<span class="hljs-title">mapId</span> == <span class="hljs-title">navController</span>.<span class="hljs-title">currentFloorId</span>)</span> {
                <span class="hljs-keyword">instance</span>.legend.expand<span class="hljs-container">(<span class="hljs-title">i</span>, <span class="hljs-title">false</span>)</span>;
                <span class="hljs-keyword">instance</span>.activateMaps<span class="hljs-container">(<span class="hljs-title">i</span>)</span>;
            }
        }*/
        for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">instance</span>.<span class="hljs-title">detailMaps</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
            if <span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">detailMaps</span>[<span class="hljs-title">i</span>].<span class="hljs-title">mapId</span> == <span class="hljs-title">navController</span>.<span class="hljs-title">currentFloorId</span>)</span> {
                <span class="hljs-keyword">instance</span>.legend.expand<span class="hljs-container">(<span class="hljs-title">i</span>, <span class="hljs-title">false</span>)</span>;
                <span class="hljs-keyword">instance</span>.activateMaps<span class="hljs-container">(<span class="hljs-title">i</span>)</span>;
                //<span class="hljs-keyword">instance</span>.detailMaps[i].setOpacity<span class="hljs-container">(1)</span>;
            } else {
                //<span class="hljs-keyword">instance</span>.detailMaps[i].setOpacity<span class="hljs-container">(0)</span>;
            }
        }

        if <span class="hljs-container">(<span class="hljs-title">state</span> != <span class="hljs-type">MAP_ZOOM_STATE_DETAILS</span>)</span> {
            <span class="hljs-keyword">instance</span>.scrollView.setZoomScale<span class="hljs-container">(<span class="hljs-type">MAP_ZOOM_SCALE_DETAILS</span>)</span>;
            <span class="hljs-keyword">instance</span>.changeToDetails<span class="hljs-container">()</span>;
        }
    }

    var wbs = <span class="hljs-keyword">instance</span>.workButtons;
    var sx = 0;
    var sy = 0;
    for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">wbs</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
        wbs[i].setBackgroundImage<span class="hljs-container">(<span class="hljs-type">PAINTING_PIN_FILE</span>)</span>;
        for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">j</span> = 0; <span class="hljs-title">j</span> &lt; <span class="hljs-title">wbs</span>[<span class="hljs-title">i</span>].<span class="hljs-title">works</span>.<span class="hljs-title">length</span>; <span class="hljs-title">j</span>++)</span> {
            if <span class="hljs-container">(<span class="hljs-title">wbs</span>[<span class="hljs-title">i</span>].<span class="hljs-title">works</span>[<span class="hljs-title">j</span>].<span class="hljs-title">id</span> == <span class="hljs-title">_work</span>.<span class="hljs-title">id</span>)</span> {
                wbs[i].setBackgroundImage<span class="hljs-container">(<span class="hljs-type">PAINTING_PIN_HERE_FILE</span>)</span>;
                if <span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> == 0 || <span class="hljs-title">_work</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> == 0)</span> {
                    sx = <span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span> / 2)</span>));
                    sy = <span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">room</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span> / 2)</span>)) + 40;
                } else {
                    sx = <span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">x</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span> / 2)</span>));
                    sy = <span class="hljs-container">(<span class="hljs-title">_work</span>.<span class="hljs-title">mapPosition</span>.<span class="hljs-title">y</span> * <span class="hljs-title">scrollView</span>.<span class="hljs-title">getZoomScale</span>()</span> - <span class="hljs-container">((<span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span> / 2)</span>)) + 40;
                }
                break;
            }
        }
    }

    sx = sx &gt; 0 ? sx : 0;
    sy = sy &gt; 0 ? sy : 0;

    if <span class="hljs-container">(!<span class="hljs-title">openBefore</span>)</span> {
        setTimeout<span class="hljs-container">(<span class="hljs-title">function</span>()</span> {
            scrollView.setContentOffset<span class="hljs-container">({
                <span class="hljs-title">x</span> : <span class="hljs-title">sx</span>,
                <span class="hljs-title">y</span> : <span class="hljs-title">sy</span>
            }, {
                <span class="hljs-title">animated</span> : <span class="hljs-title">false</span>
            })</span>;
            openBefore = true;
        }, 500);
    } else {
        scrollView.setContentOffset<span class="hljs-container">({
            <span class="hljs-title">x</span> : <span class="hljs-title">sx</span>,
            <span class="hljs-title">y</span> : <span class="hljs-title">sy</span>
        }, {
            <span class="hljs-title">animated</span> : <span class="hljs-title">false</span>
        })</span>;
    }
};

<span class="hljs-keyword">instance</span>.changeToOverview = function<span class="hljs-container">()</span> {

    state = <span class="hljs-type">MAP_ZOOM_STATE_OVERVIEW</span>;

    /*var a = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createAnimation<span class="hljs-container">({
        <span class="hljs-title">duration</span> : 300
    })</span>;
    a.setOpacity<span class="hljs-container">(0.0)</span>;
    var completeHandler = function<span class="hljs-container">()</span> {
        a.removeEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
        currentDetailsMap.setOpacity<span class="hljs-container">(0.0)</span>;
    };
    a.addEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
    currentDetailsMap.animate<span class="hljs-container">(<span class="hljs-title">a</span>)</span>;*/

    //<span class="hljs-keyword">instance</span>.checkButtonVisibility<span class="hljs-container">()</span>;

}

<span class="hljs-keyword">instance</span>.changeToDetails = function<span class="hljs-container">()</span> {

    state = <span class="hljs-type">MAP_ZOOM_STATE_DETAILS</span>;

    /*if <span class="hljs-container">(<span class="hljs-title">currentDetailsMap</span>.<span class="hljs-title">getOpacity</span>()</span> != 1) {

        var a = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createAnimation<span class="hljs-container">({
            <span class="hljs-title">duration</span> : 300
        })</span>;
        a.setOpacity<span class="hljs-container">(1)</span>;
        var completeHandler = function<span class="hljs-container">()</span> {
            a.removeEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
            currentDetailsMap.setOpacity<span class="hljs-container">(1)</span>;
        };
        a.addEventListener<span class="hljs-container">('<span class="hljs-title">complete'</span>, <span class="hljs-title">completeHandler</span>)</span>;
        currentDetailsMap.animate<span class="hljs-container">(<span class="hljs-title">a</span>)</span>;
    }*/

    //<span class="hljs-keyword">instance</span>.checkButtonVisibility<span class="hljs-container">()</span>;

}

<span class="hljs-keyword">instance</span>.activateMaps = function<span class="hljs-container">(<span class="hljs-title">_index</span>)</span> {

    <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info<span class="hljs-container">('<span class="hljs-title">activate</span> <span class="hljs-title">maps</span>: ' + <span class="hljs-title">_index</span>)</span>;

    //var tmp1 = currentOverviewMap;
    var tmp2 = currentDetailsMap;
    /*if <span class="hljs-container">(<span class="hljs-title">tmp1</span> != <span class="hljs-title">undefined</span>)</span>
        tmp1.setOpacity<span class="hljs-container">(0)</span>;*/
    /*if <span class="hljs-container">(<span class="hljs-title">tmp2</span> != <span class="hljs-title">undefined</span>)</span>
        tmp2.setOpacity<span class="hljs-container">(0)</span>;*/

    //currentOverviewMap = <span class="hljs-keyword">instance</span>.overviewMaps[_index];
    currentDetailsMap = <span class="hljs-keyword">instance</span>.detailMaps[_index];


    /*if <span class="hljs-container">(<span class="hljs-title">scrollView</span>.<span class="hljs-title">children</span>.<span class="hljs-title">indexOf</span>(<span class="hljs-title">currentOverviewMap</span>)</span> == -1) {

        if <span class="hljs-container">(<span class="hljs-title">tmp1</span> != <span class="hljs-title">undefined</span>)</span>
            scrollView.remove<span class="hljs-container">(<span class="hljs-title">tmp1</span>)</span>;
        scrollView.add<span class="hljs-container">(<span class="hljs-title">currentOverviewMap</span>)</span>;
    }*/

    if <span class="hljs-container">(<span class="hljs-title">scrollView</span>.<span class="hljs-title">children</span>.<span class="hljs-title">indexOf</span>(<span class="hljs-title">currentDetailsMap</span>)</span> != -1) {
        /*if <span class="hljs-container">(<span class="hljs-title">tmp2</span> != <span class="hljs-title">undefined</span>)</span>
            scrollView.remove<span class="hljs-container">(<span class="hljs-title">tmp2</span>)</span>;
        scrollView.add<span class="hljs-container">(<span class="hljs-title">currentDetailsMap</span>)</span>;*/
        //tmp1.setOpacity<span class="hljs-container">(0)</span>;
        if <span class="hljs-container">(<span class="hljs-title">tmp2</span> != <span class="hljs-title">undefined</span>)</span>
            tmp2.setOpacity<span class="hljs-container">(0)</span>;
        //currentOverviewMap.setOpacity<span class="hljs-container">(1)</span>;
        currentDetailsMap.setOpacity<span class="hljs-container">(1)</span>;
    }

    //<span class="hljs-type">Set</span> button visibility
    //<span class="hljs-keyword">instance</span>.checkButtonVisibility<span class="hljs-container">()</span>;

};

/*<span class="hljs-keyword">instance</span>.checkButtonVisibility = function<span class="hljs-container">()</span> {

    scrollView.startLayout<span class="hljs-container">()</span>;

    //room buttons
    for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">instance</span>.<span class="hljs-title">roomButtons</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
        var b = <span class="hljs-keyword">instance</span>.roomButtons[i];
        if <span class="hljs-container">(<span class="hljs-title">b</span>.<span class="hljs-title">map</span> == <span class="hljs-title">currentOverviewMap</span>)</span> {
            if <span class="hljs-container">(<span class="hljs-title">state</span> == <span class="hljs-type">MAP_ZOOM_STATE_OVERVIEW</span>)</span> {
                b.setVisible<span class="hljs-container">(<span class="hljs-title">true</span>)</span>;
            } else {
                b.setVisible<span class="hljs-container">(<span class="hljs-title">false</span>)</span>;
            }
        } else {
            b.setVisible<span class="hljs-container">(<span class="hljs-title">false</span>)</span>;
        }
    }

    //work buttons
    for <span class="hljs-container">(<span class="hljs-title">var</span> <span class="hljs-title">i</span> = 0; <span class="hljs-title">i</span> &lt; <span class="hljs-title">instance</span>.<span class="hljs-title">workButtons</span>.<span class="hljs-title">length</span>; <span class="hljs-title">i</span>++)</span> {
        var b = <span class="hljs-keyword">instance</span>.workButtons[i];
        if <span class="hljs-container">(<span class="hljs-title">b</span>.<span class="hljs-title">map</span> == <span class="hljs-title">currentDetailsMap</span>)</span> {
            if <span class="hljs-container">(<span class="hljs-title">state</span> == <span class="hljs-type">MAP_ZOOM_STATE_OVERVIEW</span>)</span> {
                if <span class="hljs-container">(<span class="hljs-title">b</span>.<span class="hljs-title">showOnOverview</span>)</span> {
                    b.setVisible<span class="hljs-container">(<span class="hljs-title">true</span>)</span>;
                } else {
                    b.setVisible<span class="hljs-container">(<span class="hljs-title">false</span>)</span>;
                }
            } else {
                b.setVisible<span class="hljs-container">(<span class="hljs-title">true</span>)</span>;
            }
        } else {
            b.setVisible<span class="hljs-container">(<span class="hljs-title">false</span>)</span>;
        }
    }

    scrollView.finishLayout<span class="hljs-container">()</span>;
}*/

<span class="hljs-keyword">instance</span>.createOverlay = function<span class="hljs-container">()</span> {

    var overlayWidth = 36;
    var overlayHeight = 30;
    var overlayOpacity = 0.8;

    var top = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createView<span class="hljs-container">({
        <span class="hljs-title">top</span> : 0,
        <span class="hljs-title">left</span> : 0,
        <span class="hljs-title">width</span> : <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span>,
        <span class="hljs-title">height</span> : <span class="hljs-title">overlayHeight</span>,
        <span class="hljs-title">backgroundColor</span> : '#000000',
        <span class="hljs-title">opacity</span> : <span class="hljs-title">overlayOpacity</span>,
    })</span>;
    <span class="hljs-keyword">instance</span>.add<span class="hljs-container">(<span class="hljs-title">top</span>)</span>;

    var bottom = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createView<span class="hljs-container">({
        <span class="hljs-title">top</span> : <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span> - <span class="hljs-title">overlayHeight</span>,
        <span class="hljs-title">left</span> : 0,
        <span class="hljs-title">width</span> : <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span>,
        <span class="hljs-title">height</span> : <span class="hljs-title">overlayHeight</span>,
        <span class="hljs-title">backgroundColor</span> : '#000000',
        <span class="hljs-title">opacity</span> : <span class="hljs-title">overlayOpacity</span>,
    })</span>;
    <span class="hljs-keyword">instance</span>.add<span class="hljs-container">(<span class="hljs-title">bottom</span>)</span>;

    var left = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createView<span class="hljs-container">({
        <span class="hljs-title">top</span> : <span class="hljs-title">overlayHeight</span>,
        <span class="hljs-title">left</span> : 0,
        <span class="hljs-title">width</span> : 12,
        <span class="hljs-title">height</span> : <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span> - 2 * <span class="hljs-title">overlayHeight</span>,
        <span class="hljs-title">backgroundColor</span> : '#000000',
        <span class="hljs-title">opacity</span> : <span class="hljs-title">overlayOpacity</span>,
    })</span>;
    <span class="hljs-keyword">instance</span>.add<span class="hljs-container">(<span class="hljs-title">left</span>)</span>;

    var right = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createView<span class="hljs-container">({
        <span class="hljs-title">top</span> : <span class="hljs-title">overlayHeight</span>,
        <span class="hljs-title">left</span> : <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformWidth</span> - <span class="hljs-title">overlayWidth</span>,
        <span class="hljs-title">width</span> : <span class="hljs-title">overlayWidth</span>,
        <span class="hljs-title">height</span> : <span class="hljs-type">Ti</span>.<span class="hljs-type">Platform</span>.<span class="hljs-title">displayCaps</span>.<span class="hljs-title">platformHeight</span> - 2 * <span class="hljs-title">overlayHeight</span>,
        <span class="hljs-title">backgroundColor</span> : '#000000',
        <span class="hljs-title">opacity</span> : <span class="hljs-title">overlayOpacity</span>,
    })</span>;
    <span class="hljs-keyword">instance</span>.add<span class="hljs-container">(<span class="hljs-title">right</span>)</span>;

    var close = <span class="hljs-type">Titanium</span>.<span class="hljs-type">UI</span>.createButton<span class="hljs-container">({
        <span class="hljs-title">title</span> : '',
        <span class="hljs-title">width</span> : 35,
        <span class="hljs-title">height</span> : 35,
        <span class="hljs-title">top</span> : <span class="hljs-title">overlayHeight</span> + 6,
        <span class="hljs-title">right</span> : <span class="hljs-title">overlayWidth</span> + 6,
        <span class="hljs-title">backgroundImage</span> : <span class="hljs-type">CLOSE_BUTTON_FILE</span>,
        <span class="hljs-title">backgroundSelectedImage</span> : <span class="hljs-type">CLOSE_BUTTON_SELECTED_FILE</span>,
        <span class="hljs-title">opacity</span> : 0.5
    })</span>;
    close.addEventListener<span class="hljs-container">('<span class="hljs-title">click'</span>, <span class="hljs-title">function</span>(<span class="hljs-title">e</span>)</span> {
        <span class="hljs-keyword">instance</span>.legend.collapse<span class="hljs-container">(<span class="hljs-title">false</span>)</span>;
        navController.hideMap<span class="hljs-container">()</span>;
    });
    <span class="hljs-keyword">instance</span>.add<span class="hljs-container">(<span class="hljs-title">close</span>)</span>;

};

<span class="hljs-keyword">instance</span>.createLegend = function<span class="hljs-container">()</span> {
    <span class="hljs-keyword">instance</span>.legend = new <span class="hljs-type">MapLegend</span><span class="hljs-container">(<span class="hljs-title">navController</span>)</span>;
    <span class="hljs-keyword">instance</span>.add<span class="hljs-container">(<span class="hljs-title">instance</span>.<span class="hljs-title">legend</span>)</span>;
};

<span class="hljs-keyword">instance</span>.createOverlay<span class="hljs-container">()</span>;
<span class="hljs-keyword">instance</span>.createLegend<span class="hljs-container">()</span>;

<span class="hljs-keyword">instance</span>.onLanguageChange = function<span class="hljs-container">(<span class="hljs-title">lang</span>)</span> {

};
<span class="hljs-type">Ti</span>.<span class="hljs-type">App</span>.addEventListener<span class="hljs-container">(<span class="hljs-type">LANGUAGE_CHANGED</span>, <span class="hljs-title">instance</span>.<span class="hljs-title">onLanguageChange</span>)</span>;

return <span class="hljs-keyword">instance</span>;</span>
</code></pre><p>};</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 26th 2012, 11:42:22 pm">November 26th 2012</span>
								by <span class='authorname'>Tonio Seiler</span><br>
								<a class="icon-bg icon-link" href="../../question/145095/startlayout--finishlayout-deprecated.html#answer-251734" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-251792">
				
						<section>
							<p>startLayout&#x2F;finishLayout was deprecated in favor of ?<a href="http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;3.0&#x2F;#!&#x2F;api&#x2F;Titanium.Proxy-method-applyProperties">Ti.Proxy.applyProperties</a> in 3.0 and newer. If you are using 3.0 or newer, you might give it a try. There are a variety of reasons for slow performance though, as Malcolm stated, so this method may or may not help performance.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 27th 2012, 5:33:12 pm">November 27th 2012</span>
								by <span class='authorname'>Bryan Hughes</span><br>
								<a class="icon-bg icon-link" href="../../question/145095/startlayout--finishlayout-deprecated.html#answer-251792" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
