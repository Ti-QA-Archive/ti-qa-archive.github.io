<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Cannot send file via httpclient within android, please help !! » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Cannot send file via httpclient within android, please help !!</h1>
		</header>
		<section>
			<p>I use following code to try to upload a file to a asp.net server, but it&#39;s cannot work:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();
        <span class="hljs-keyword">var</span> source = Ti.Filesystem.getFile(Ti.Filesystem.resourcesDirectory + <span class="hljs-string">'/images/thumb-video.png'</span>);
        <span class="hljs-keyword">var</span> data = {
            image: source.read(),
            test:<span class="hljs-string">'== just for test in android=='</span>
        };

        xhr.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
            <span class="hljs-comment">//do something...</span>

        };
        xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
            <span class="hljs-comment">//do something...</span>
        };

        xhr.setRequestHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'multipart/form-data'</span>);
        xhr.setRequestHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'image/png'</span>);
        xhr.setRequestHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'application/x-www-form-urlencoded'</span>);
        xhr.open(<span class="hljs-string">"POST"</span>, <span class="hljs-string">"http://192.168.11.184:8089/API/UploadFile"</span>);

        xhr.send(data);
</code></pre><p>if I send the text data and it&#39;s work , but if I send the blob file, always show the following error:</p>
<pre><code class="hljs">W/System.err( <span class="hljs-number">1608</span>): java.lang.IllegalArgumentException: size &lt; <span class="hljs-number">0</span>
W/System.err( <span class="hljs-number">1608</span>):     at java.io.ByteArrayOutputStream.&lt;init&gt;(ByteArrayOutputStream.java:<span class="hljs-number">65</span>)
W/System.err( <span class="hljs-number">1608</span>):     at org.appcelerator.kroll.util.KrollStreamHelper.toByteArray(KrollStreamHelper.java:<span class="hljs-number">79</span>)
W/System.err( <span class="hljs-number">1608</span>):     at org.appcelerator.titanium.TiBlob.getBytes(TiBlob.java:<span class="hljs-number">266</span>)
W/System.err( <span class="hljs-number">1608</span>):     at ti.modules.titanium.network.TiHTTPClient.addTitaniumFileAsPostData(TiHTTPClient.java:<span class="hljs-number">945</span>)
W/System.err( <span class="hljs-number">1608</span>):     at ti.modules.titanium.network.TiHTTPClient.send(TiHTTPClient.java:<span class="hljs-number">1116</span>)
W/System.err( <span class="hljs-number">1608</span>):     at ti.modules.titanium.network.HTTPClientProxy.send(HTTPClientProxy.java:<span class="hljs-number">118</span>)
W/System.err( <span class="hljs-number">1608</span>):     at org.appcelerator.kroll.runtime.v8.V8Function.nativeInvoke(Native Method)
W/System.err( <span class="hljs-number">1608</span>):     at org.appcelerator.kroll.runtime.v8.V8Function.callSync(V8Function.java:<span class="hljs-number">57</span>)
W/System.err( <span class="hljs-number">1608</span>):     at org.appcelerator.kroll.runtime.v8.V8Function.call(V8Function.java:<span class="hljs-number">43</span>)
W/System.err( <span class="hljs-number">1608</span>):     at org.appcelerator.kroll.runtime.v8.V8Function$<span class="hljs-number">1.</span>run(V8Function.java:<span class="hljs-number">70</span>)
W/System.err( <span class="hljs-number">1608</span>):     at android.os.Handler.handleCallback(Handler.java:<span class="hljs-number">605</span>)
W/System.err( <span class="hljs-number">1608</span>):     at android.os.Handler.dispatchMessage(Handler.java:<span class="hljs-number">92</span>)
W/System.err( <span class="hljs-number">1608</span>):     at android.os.Looper.loop(Looper.java:<span class="hljs-number">137</span>)
W/System.err( <span class="hljs-number">1608</span>):     at org.appcelerator.kroll.KrollRuntime$KrollRuntimeThread.run(KrollRuntime.java:<span class="hljs-number">112</span>)
E/TiExceptionHandler( <span class="hljs-number">1608</span>): (main) [<span class="hljs-number">400</span>,<span class="hljs-number">3522</span>] ----- Titanium Javascript Runtime Error -----
E/TiExceptionHandler( <span class="hljs-number">1608</span>): (main) [<span class="hljs-number">0</span>,<span class="hljs-number">3522</span>] - In alloy/controllers/home.js:<span class="hljs-number">118</span>,<span class="hljs-number">17</span>
E/TiExceptionHandler( <span class="hljs-number">1608</span>): (main) [<span class="hljs-number">1</span>,<span class="hljs-number">3523</span>] - Message: Uncaught Error: size &lt; <span class="hljs-number">0</span>
E/TiExceptionHandler( <span class="hljs-number">1608</span>): (main) [<span class="hljs-number">0</span>,<span class="hljs-number">3523</span>] - Source:             xhr.send(data);
</code></pre><p>I have tried everything what can I do, but still cannnot work, I have tried to use the Titanium SDK 3.1 and 3.2 (download from http:&#x2F;&#x2F;builds.appcelerator.com.s3.amazonaws.com&#x2F;index.html#master)</p>
<p>By the way, the above code in ios is very well, I can get the data from server side use </p>
<p><code>HttpContext.Current.Request.Files</code></p>
<p>Please help, thanks!</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="May 13th 2013, 9:12:51 am">May 13th 2013</span>
				by <span class='authorname'>Winson Qiu</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android,httpclient</span></li>
					
						<li><span class='tagname'>post</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-262615">
				
						<section>
							<p>Try setting your headers after you open but before send.</p>
<pre><code class="hljs">xhr.open(<span class="hljs-string">"<span class="hljs-keyword">POST</span>"</span>, <span class="hljs-string">"http://192.168.11.184:8089/API/UploadFile"</span>);
xhr.setRequestHeader('Content-Type', 'multipart/form-data');
xhr.setRequestHeader('Content-Type', 'image/png');
xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
xhr.send(data);
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 13th 2013, 9:33:14 am">May 13th 2013</span>
								by <span class='authorname'>Stephen Feather</span><br>
								<a class="icon-bg icon-link" href="question/152294/cannot-send-file-via-httpclient-within-android-please-help-#answer-262615" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>thanks for your reply, but I have tried this before, still fail, and it seem cannot get the json data to post, if i use &quot;GET&quot; method, there is no error but the file data cannot sent out, or do you have other ways to convert the file to string to sent to server? (I have tried to use base64encode, but it&#39;s just return blob format so still fail and same result)</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 13th 2013, 11:37:33 am">May 13th 2013</span>
											by <span class='authorname'>Winson Qiu</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-262651">
				
						<section>
							<p>I have found the solution, it&#39;s need to disable the fastdev in android:</p>
<pre><code class="hljs">&lt;<span class="hljs-keyword">property</span> <span class="hljs-property">name</span>=<span class="hljs-string">"ti.android.fastdev"</span> type=<span class="hljs-string">"bool"</span>&gt;<span class="hljs-constant">false</span>&lt;/<span class="hljs-keyword">property</span>&gt;
</code></pre><p>but in the server side, still cannot use HttpFileCollection to get the file, it&#39;s need to use HttpPostedFileBase for get each one.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 14th 2013, 1:41:10 am">May 14th 2013</span>
								by <span class='authorname'>Winson Qiu</span><br>
								<a class="icon-bg icon-link" href="question/152294/cannot-send-file-via-httpclient-within-android-please-help-#answer-262651" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
