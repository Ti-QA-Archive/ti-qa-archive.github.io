<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Grow heap (frag case) to MB for byte allocation Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Grow heap (frag case) to MB for byte allocation</h1>
		</header>
		<section>
			<p>Hello everything, I try to generate thumbnails from images and as a result I receive leakage of memory.<br>From the main window I open the second window with a photo of galleries. When opening a new window there is a generation of thumbnails:</p>
<p><code>var itemFullPath = storageDirectoryNativePath + Titanium.Filesystem.separator + directoryItems[i].toString();
var currentItem = Ti.Filesystem.getFile(itemFullPath);    
var blob = currentItem.read();
var thumbnailImage = blob.imageAsThumbnail(100);</code></p>
<p>in the console begins is shown:</p>
<p><code>[WARN][TiImageHelper( 7583)] (KrollRuntimeThread) [527,202741] Unable to add rounded corners. Invalid corner radius or borderSize for imageWithRoundedCorner
[INFO][dalvikvm-heap( 7583)] Grow heap (frag case) to 39.775MB for 19660816-byte allocation
[WARN][TiImageHelper( 7583)] (KrollRuntimeThread) [521,203262] Unable to add rounded corners. Invalid corner radius or borderSize for imageWithRoundedCorner
[INFO][dalvikvm-heap( 7583)] Grow heap (frag case) to 39.833MB for 19660816-byte allocation
[INFO][SurfaceFlinger(  100)] [SurfaceFlinger] frames:10, duration:1.050000, fps:9.515434
[WARN][TiImageHelper( 7583)] (KrollRuntimeThread) [535,203797] Unable to add rounded corners. Invalid corner radius or borderSize for imageWithRoundedCorner
[INFO][dalvikvm-heap( 7583)] Grow heap (frag case) to 39.889MB for 19660816-byte allocation
[WARN][TiImageHelper( 7583)] (KrollRuntimeThread) [474,204271] Unable to add rounded corners. Invalid corner radius or borderSize for imageWithRoundedCorner
[INFO][dalvikvm-heap( 7583)] Grow heap (frag case) to 39.947MB for 19660816-byte allocation
[INFO][SurfaceFlinger(  100)] [SurfaceFlinger] frames:10, duration:1.039000, fps:9.615705</code></p>
<p>then I close gallery, I nullify images and I come back to the main window. And when again you open gallery and memory continues to grow:</p>
<p><code>[INFO][dalvikvm-heap( 7583)] Grow heap (frag case) to 40.004MB for 19660816-byte allocation
[WARN][TiImageHelper( 7583)] (KrollRuntimeThread) [622,205404] Unable to add rounded corners. Invalid corner radius or borderSize for imageWithRoundedCorner
[INFO][dalvikvm-heap( 7583)] Grow heap (frag case) to 40.055MB for 19660816-byte allocation</code></p>
<p>eventually there is in the console a message:</p>
<p><code>[ERROR][dalvikvm-heap( 7583)] Out of memory on a 19660816-byte allocation.</code></p>
<p>and crash.</p>
<p>if to clean <code>var thumbnailImage = blob.imageAsThumbnail(100);</code> leaks don&#39;t happen and in the console is shown nothing from above listed.</p>
<p>SDK 3.1.1, physical device Google nexus - Android 4.1 (at the android of 2.3 everything works perfectly)<br>Titanium Studio, build: 3.1.1.201306112235<br>(c) Copyright 2012-2013 by Appcelerator, Inc.  All rights reserved.<br>Build: jenkins-titanium-rcp-master-466 (origin&#x2F;master)<br>Date: 11 June 2013, 22:38:40</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="July 3rd 2013, 8:31:13 am">July 3rd 2013</span>
				by <span class='authorname'>Den Kov</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>leak memory</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>can you provide some code snippet here so that we can have a loo too?</p>
</div>
							<div class="author">
								&mdash; commented <span title="July 3rd 2013, 11:02:22 am">July 3rd 2013</span>
								by <span class='authorname'>Ashish Nigam</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-265407">
				
						<section>
							<p>Hello Den,</p>
<p>You can use imagefactory module for compress the image file.</p>
<p>Try this module and let me know if it help.</p>
<p> -<a href="https:&#x2F;&#x2F;github.com&#x2F;appcelerator&#x2F;titanium_modules&#x2F;tree&#x2F;master&#x2F;imagefactory">https:&#x2F;&#x2F;github.com&#x2F;appcelerator&#x2F;titanium_modules&#x2F;tree&#x2F;master&#x2F;imagefactory</a></p>
<p>&#x2F;&#x2F;Sample for compress the image</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> ImageFactory = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ImageFactory'</span>);
<span class="hljs-keyword">var</span>  newBlob = ImageFactory.compress(blob, <span class="hljs-number">0.25</span>);
    <span class="hljs-keyword">var</span> filename = Titanium.Filesystem.applicationDataDirectory + <span class="hljs-string">"/newflower.jpg"</span>;
    f = Titanium.Filesystem.getFile(filename);
    f.write(newBlob);

    <span class="hljs-keyword">var</span> alert = Ti.UI.createAlertDialog({
        title: <span class="hljs-string">'Image Factory'</span>,
        message: <span class="hljs-string">'Compressed image saved to newflower.jpg with compression quality of 25%'</span>
    });
    alert.show();
</code></pre><p>Thanks<br>Jigar</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 4th 2013, 5:33:08 pm">July 4th 2013</span>
								by <span class='authorname'>Jigar Maheshwari</span><br>
								<a class="icon-bg icon-link" href="../../question/154406/grow-heap-frag-case-to-mb-for-byte-allocation.html#answer-265407" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Thank you Jigar, Even if we nullfy its still getting grow, so if we compress also after manytimes if we click on it. it will eventually grow. So is there any solution to make it null and zero when its destroyed?</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 17th 2013, 6:08:00 am">December 17th 2013</span>
											by <span class='authorname'>Dont Know What to do</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
