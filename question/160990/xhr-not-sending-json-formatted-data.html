<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>XHR not sending JSON-formatted data Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>XHR not sending JSON-formatted data</h1>
		</header>
		<section>
			<p>HI all,</p>
<p>I&#39;m using this <a href="https:&#x2F;&#x2F;github.com&#x2F;raulriera&#x2F;XHR?source=c">XHR module</a> to post my data to a web service. Immediately before the send, my data is in this form:</p>
<pre><code class="hljs">{
   "<span class="hljs-attribute">last_visit</span>":<span class="hljs-value"><span class="hljs-number">1388382103.17</span></span>,
   "<span class="hljs-attribute">first_visit</span>":<span class="hljs-value"><span class="hljs-number">1387478168.109</span></span>,
   "<span class="hljs-attribute">this_visit</span>":<span class="hljs-value"><span class="hljs-number">1387478168.109</span></span>,
   "<span class="hljs-attribute">latitude</span>":<span class="hljs-value"><span class="hljs-number">37.78583526611328</span></span>,
   "<span class="hljs-attribute">longitude</span>":<span class="hljs-value">-<span class="hljs-number">122.40641784667969</span></span>,
   "<span class="hljs-attribute">opted_out</span>":<span class="hljs-value"><span class="hljs-number">0</span></span>,
   "<span class="hljs-attribute">opted_in</span>":<span class="hljs-value"><span class="hljs-number">1</span></span>,
   "<span class="hljs-attribute">user_id</span>":<span class="hljs-value"><span class="hljs-number">1</span></span>,
   "<span class="hljs-attribute">locale</span>":<span class="hljs-value"><span class="hljs-string">"en"</span></span>,
   "<span class="hljs-attribute">device_maker</span>":<span class="hljs-value"><span class="hljs-string">"unknown"</span></span>,
   "<span class="hljs-attribute">device_model</span>":<span class="hljs-value"><span class="hljs-string">"Simulator"</span></span>,
   "<span class="hljs-attribute">os_platform</span>":<span class="hljs-value"><span class="hljs-string">"iPhone OS"</span></span>,
   "<span class="hljs-attribute">os_version</span>":<span class="hljs-value"><span class="hljs-string">"7.0.3"</span>
</span>}
</code></pre><p>All well and good. But when I examine the $_POST variable on the server side, the output, sent as json as indicated with this log message <code>[INFO] contentType: application&amp;#x2F;json</code>, is not received as JSON. Rather, it&#39;s all converted to one long string:</p>
<pre><code class="hljs"><span class="hljs-type">string</span> '{
    <span class="hljs-string">"device_maker"</span> = unknown;
    <span class="hljs-string">"device_model"</span> = Simulator;
    <span class="hljs-string">"first_visit"</span> = <span class="hljs-string">"1387478168.109"</span>;
    <span class="hljs-string">"last_visit"</span> = <span class="hljs-string">"1388358490.638"</span>;
    latitude = <span class="hljs-string">"37.78583526611328"</span>;
    locale = en;
    longitude = <span class="hljs-string">"-122.4064178466797"</span>;
    <span class="hljs-string">"opted_in"</span> = <span class="hljs-number">1</span>;
    <span class="hljs-string">"opted_out"</span> = <span class="hljs-number">0</span>;
    <span class="hljs-string">"os_platform"</span> = <span class="hljs-string">"iPhone OS"</span>;
    <span class="hljs-string">"os_version"</span> = <span class="hljs-string">"7.0.3"</span>;
    <span class="hljs-string">"this_visit"</span> = <span class="hljs-string">"1387478168.109"</span>;
    <span class="hljs-string">"user_id"</span> = <span class="hljs-number">1</span>;
}' (<span class="hljs-property">length</span>=<span class="hljs-number">389</span>)
</code></pre><p>Can anyone clue me in to what could possibly be going on with this transformation? What could cause an xhr post that says it&#39;s sending json-encoded data to actually send string data? I made no modfications to the module itself. So, I have no idea how to start debugging this issue. All the code works, the author&#39;s and mine. It&#39;s just that the data are incorrectly encoded.</p>
<p>If someone could examine that module in the <code>xhr.js</code> file starting with the function <code>XHR.prototype.post = function(url, data, onSuccess, onError, extraParams)</code>, maybe you can see something that isn&#39;t readily apparent to me.</p>
<p>As always, your help is appreciated.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="December 30th 2013, 11:10:29 am">December 30th 2013</span>
				by <span class='authorname'>Michael Stelly</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>$_post</span></li>
					
						<li><span class='tagname'>json</span></li>
					
						<li><span class='tagname'>xhr</span></li>
					
				</ul>
			

			<section>
				<h5>3 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Ranjith made a good point. But I have tried that before like this: <code>xhr.send(JSON.stringify(data));</code> I forgot to mention it. Server side, I var_dumped that portion of <code>$_POST</code> two different ways: </p>
<pre><code class="hljs">var_dump<span class="hljs-list">($_POST[<span class="hljs-string">"attributes"</span>])</span><span class="hljs-comment">;</span>
and
var_dump<span class="hljs-list">(<span class="hljs-keyword">json_decode</span><span class="hljs-list">($_POST[<span class="hljs-quoted">'attributes</span>'])</span>)</span><span class="hljs-comment">;</span>
</code></pre><p>Both ways returned null to the success callback</p>
<pre><code class="hljs">[INFO] onSuccessCallback: <span class="hljs-tag">&lt;<span class="hljs-title">pre</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">'xdebug-var-dump'</span> <span class="hljs-attribute">dir</span>=<span class="hljs-value">'ltr'</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">font</span> <span class="hljs-attribute">color</span>=<span class="hljs-value">'#3465a4'</span>&gt;</span>null<span class="hljs-tag">&lt;/<span class="hljs-title">font</span>&gt;</span>
</code></pre></div>
							<div class="author">
								&mdash; commented <span title="December 30th 2013, 3:04:18 pm">December 30th 2013</span>
								by <span class='authorname'>Michael Stelly</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>I replaced the XHR module with the stripped-down example pulled the Ti.Network.HTTPClient doc. </p>
<pre><code class="hljs">    <span class="hljs-keyword">var</span> url = <span class="hljs-string">"http://localhost:8888/test.php"</span>;
    // <span class="hljs-type">Create</span> the <span class="hljs-literal">result</span> <span class="hljs-keyword">object</span>
    <span class="hljs-keyword">var</span> <span class="hljs-literal">result</span> = {};
    <span class="hljs-keyword">var</span> client = <span class="hljs-type">Ti</span>.<span class="hljs-type">Network</span>.createHTTPClient({
        // function called <span class="hljs-keyword">when</span> the response data <span class="hljs-keyword">is</span> available
        onload : function(e) {
            <span class="hljs-literal">result</span>.status = client.status == <span class="hljs-number">200</span> ? <span class="hljs-string">"ok"</span> : client.status;
            <span class="hljs-literal">result</span>.data = client.responseText;
            onSuccessCallback(<span class="hljs-literal">result</span>);
        },
        // function called <span class="hljs-keyword">when</span> an error occurs, including a timeout
        onerror : function(e) {
            <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.debug(e.error);
            alert('error');
        },
        timeout : <span class="hljs-number">5000</span> // <span class="hljs-keyword">in</span> milliseconds
    });
    // <span class="hljs-type">Prepare</span> the connection.
    client.open(<span class="hljs-string">"POST"</span>, url);
    client.setRequestHeader('<span class="hljs-type">Content</span>-<span class="hljs-type">Type</span>', 'application/json');

    // <span class="hljs-type">Send</span> the request.
    client.send(tracker);
</code></pre><p>I get the same result. Is there a setting on an Apache webserver that might possibly affect how this data is interpreted on the server side?</p>
</div>
							<div class="author">
								&mdash; commented <span title="December 30th 2013, 5:42:25 pm">December 30th 2013</span>
								by <span class='authorname'>Michael Stelly</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>After discussing the issue with the author of the XHR module, it appears he never designed it to work with the Backbone data model and Alloy. He thinks that may be the issue although I don&#39;t know why the data can be viewed as json-formatted correctly before it&#39;s sent and not formatted correctly afterwards. If anyone can shed some light on this issue, I&#39;d most appreciate it.</p>
</div>
							<div class="author">
								&mdash; commented <span title="December 31st 2013, 12:15:29 am">December 31st 2013</span>
								by <span class='authorname'>Michael Stelly</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-273232">
				
						<section>
							<p>Hi,</p>
<p>Try <code>xhr.send(JSON.stringify(postData));</code></p>
<p>ref: <a href="http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;latest&#x2F;#!&#x2F;api&#x2F;Global.JSON-method-stringify">http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;latest&#x2F;#!&#x2F;api&#x2F;Global.JSON-method-stringify</a></p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 30th 2013, 12:25:11 pm">December 30th 2013</span>
								by <span class='authorname'>Ranjith Kumar Nagella</span><br>
								<a class="icon-bg icon-link" href="question/160990/xhr-not-sending-json-formatted-data#answer-273232" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-1</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
