<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>reopening a database after reinstallation of app Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>reopening a database after reinstallation of app</h1>
		</header>
		<section>
			<p>Hi there, </p>
<p>we got a problem with a database for our app that contains user generated content we would like to preserve in between app updates WHILE developing.</p>
<p>It works alright in the simulator, but not on the devices. </p>
<p>If we reinstall&#x2F;update the app on the device, the previously generated database cannot be re-opened or read correctly apparently - nothing is shown. We got no more information about what goes wrong, no error is being thrown so the database seems to be still there(? -&gt; can&#39;t debug on the device). </p>
<p>Our app also comes with a standard default database which contains a sample entry, yet that data is not shown either IF there has been a user database before.</p>
<p>It appears as if any subsequent opening of a database after an app update either corrupts or destroys the previous database we would like to preserve. </p>
<p>Same goes with a database which was backed up with the app - once the app was backed up and played back onto the device, the content in the database can&#39;t be accessed. </p>
<p>Only uninstalling the app (and thus the database which sits in its sandbox as well) does give us access to the (normal, default) database back. </p>
<p>I guess what I want to say is how to preserve a database which contains user generated content between app updates. Does anyone else see this problem? I am not talking about regurlar, &quot;official&quot; updates, but app updates while still developing the app and checking the app on the devices.</p>
<p>Thank you for your time and consideration, </p>
<p>Christophe Leske<br>www.multimedial.de</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="May 10th 2011, 9:03:22 am">May 10th 2011</span>
				by <span class='authorname'>Christophe Leske</span>
			</div>

			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-207539">
				
						<section>
							<p>when you install new apps (or update old apps, that it&#39;s basically the same) you lose all of your previous data. You should make a copy of the database somewhere else (ftp repositories or similar) and copy it back from time to time, just during debugging.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 10th 2011, 11:06:12 am">May 10th 2011</span>
								by <span class='authorname'>Alberto Marcone</span><br>
								<a class="icon-bg icon-link" href="../../question/119479/reopening-a-database-after-reinstallation-of-app.html#answer-207539" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-207541">
				
						<section>
							<p>Hi Alberto, </p>
<p>thank you very much for your answer.</p>
<p>The strange thing is however that when over-installing (=updating) an existing app, the default database (which comes with the app) is not being used. </p>
<p>Thus, we got three states:</p>
<ul>
<li><p>the app has freshly been installed (no previous instance of it) =&gt; default database gets installed and opened correctly (which I can check due to its sample entry)</p>
</li>
<li><p>the app has been used a while - there is now user generated content in the database, and whenever we start the app, we can query the content normally (the normal standard behaviour you would expect from an associated database)</p>
</li>
<li><p>now when you UPDATE the app, the database somehow gets corrupted or blocks something or does something equally strange, as the new app does not start up the the default database you would get if you installed the app &quot;freshly&quot; onto the device, meaning with no previous instance installled, nor do I get the &quot;previous&quot; copy which I would like to preserve.</p>
</li>
</ul>
<p>If I manually delete the app before reinstalling it, then the default database which is supposed to install along with the app is being shown. So it looks as if when updating the app, not everything in its sandbox is being wiped. (I am using the writable document folder of the app for storing my user database in  it). </p>
<p>Using ftp to back up the database is unfortunately out of the question for my app due to various reasons.</p>
<p>Looking forward to more comments, </p>
<p>thanks again for your hints though.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 10th 2011, 12:18:06 pm">May 10th 2011</span>
								by <span class='authorname'>Christophe Leske</span><br>
								<a class="icon-bg icon-link" href="../../question/119479/reopening-a-database-after-reinstallation-of-app.html#answer-207541" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-207553">
				
						<section>
							<p>Without seeing your code, it is hard to guess what you are doing wrong.  By default, you should NOT lose any of your data.</p>
<p>When you use Ti.Database.open(), if the named database does not exist yet it creates a new empty database.</p>
<p>When you use Ti.Database.install(), it first checks if the named database exists.  If so, it acts just like open() and uses the existing database including any previously created tables and data.  If the named database does not exist yet, it copies the database file from the resources folder to initialize the named database instead of starting with an empty database.</p>
<p>It is more typical for a developer to ask the opposite problem.  That is, how to make a revised version of the database in the resources folder of an app update to replace a previous version, for the sake of getting a new schema or new default data.</p>
<p>So you are doing something in your code to cause the loss of the data, but without seeing the code we are shooting in the dark.  In the app.js startup, do you have something akin to this?</p>
<p>```<br>var myDb = Ti.Database.open(&#39;myDatabase&#39;);<br>myDb.remove();<br>myDb = Ti.Database.install(&#39;myDatabase.sqlite&#39;, &#39;myDatabase&#39; );<br>~~~</p>
<p>The above code snippet can be used to force a fresh install of the resources database file with each execution, but that is rarely what you want to have happen except in unique circumstances.  Typically you&#39;d use only the install() command, and if you needed to change the schema of an installed user use ALTER TABLE or CREATE TABLE IF NOT EXISTS or whatever is needed for your scenario.</p>
<p>Can you provide a code snippet of your app.js database setup code?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 10th 2011, 3:15:15 pm">May 10th 2011</span>
								by <span class='authorname'>Doug Handy</span><br>
								<a class="icon-bg icon-link" href="../../question/119479/reopening-a-database-after-reinstallation-of-app.html#answer-207553" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hello Doug, </p>
<p>and thank you very much for your hint. I am on the go now, but will publish more code if needed later on today.I am definetely not using the open(), remove() route to force a fresh install of the database. I wasn&#39;t aware of the trick at the time, i am instead trying to reinstall a database called &quot;Diary.db&quot; every time on startup:</p>
<p>multimedialHelper.openDiaryDB=function() {</p>
<pre><code class="hljs"><span class="hljs-variable"><span class="hljs-keyword">var</span> diaryDBFile</span>=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory+<span class="hljs-string">"/Diary.db"</span>);

<span class="hljs-keyword">if</span> (!diaryDBFile.exists())
{
    <span class="hljs-comment">// copy the original DB from the resources directory</span>
    diaryDBFile=multimedialHelper.copyDB(<span class="hljs-string">"Diary.db"</span>);

}

multimedialHelper.showInfo(diaryDBFile);

<span class="hljs-keyword">return</span> Ti.Database.install(diaryDBFile.nativePath, <span class="hljs-string">"Diary.db"</span>);
</code></pre><p>};</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 11th 2011, 4:10:34 am">May 11th 2011</span>
											by <span class='authorname'>Christophe Leske</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Sorry for the odd formattingâ¦</p>
<p>One more time:</p>
<hr>
<p>multimedialHelper.openDiaryDB=function() {</p>
<pre><code class="hljs"><span class="hljs-variable"><span class="hljs-keyword">var</span> diaryDBFile</span>=Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory+<span class="hljs-string">"/Diary.db"</span>);

<span class="hljs-keyword">if</span> (!diaryDBFile.exists())
{
    <span class="hljs-comment">// copy the original DB from the resources directory</span>
    diaryDBFile=multimedialHelper.copyDB(<span class="hljs-string">"Diary.db"</span>);

}

multimedialHelper.showInfo(diaryDBFile);

<span class="hljs-keyword">return</span> Ti.Database.install(diaryDBFile.nativePath, <span class="hljs-string">"Diary.db"</span>);
</code></pre><h2 id="-">};</h2>
</p>
										<div class="author">
											&mdash; commented <span title="May 11th 2011, 4:11:31 am">May 11th 2011</span>
											by <span class='authorname'>Christophe Leske</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
