<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>NSTimer in Titanium module » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>NSTimer in Titanium module</h1>
		</header>
		<section>
			<p>Hi guys,</p>
<p>I am working with on Titanium module for iOS and I need to use NSTimer inside of the module. Turns out these are not working very well. I have create a simple xcode project that has this code:</p>
<pre><code class="hljs">- (<span class="hljs-keyword">void</span>)viewDidLoad
{
    [<span class="hljs-keyword">super</span> viewDidLoad];
    <span class="hljs-comment">// Do any additional setup after loading the view, typically from a nib.</span>

    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"Starting timer"</span>);
    <span class="hljs-built_in">NSTimer</span> *aTimer = [<span class="hljs-built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="hljs-number">10.0</span>
                                                       target:<span class="hljs-keyword">self</span>
                                                     selector:<span class="hljs-keyword">@selector</span>(timerFired:)
                                                     userInfo:<span class="hljs-literal">nil</span>
                                                      repeats:<span class="hljs-literal">YES</span>];
    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"Timer started"</span>);
}

- (<span class="hljs-keyword">void</span>)didReceiveMemoryWarning
{
    [<span class="hljs-keyword">super</span> didReceiveMemoryWarning];
    <span class="hljs-comment">// Dispose of any resources that can be recreated.</span>
}


-(<span class="hljs-keyword">void</span>)timerFired:(<span class="hljs-built_in">NSTimer</span> *) theTimer
{
    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"timerFired @ %@"</span>, [theTimer fireDate]);
}
</code></pre><p>And I am receiving valid output every 10 seconds:</p>
<pre><code class="hljs"><span class="hljs-number">2012</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">29</span>:<span class="hljs-number">19.114</span> test2[<span class="hljs-number">4688</span>:c07] Starting timer
<span class="hljs-number">2012</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">29</span>:<span class="hljs-number">19.115</span> test2[<span class="hljs-number">4688</span>:c07] Timer started
<span class="hljs-number">2012</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">29</span>:<span class="hljs-number">29.116</span> test2[<span class="hljs-number">4688</span>:c07] timerFired @ <span class="hljs-number">2012</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">12</span>:<span class="hljs-number">29</span>:<span class="hljs-number">29</span> +<span class="hljs-number">0000</span>
<span class="hljs-number">2012</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">29</span>:<span class="hljs-number">39.115</span> test2[<span class="hljs-number">4688</span>:c07] timerFired @ <span class="hljs-number">2012</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">12</span>:<span class="hljs-number">29</span>:<span class="hljs-number">39</span> +<span class="hljs-number">0000</span>
<span class="hljs-number">2012</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">29</span>:<span class="hljs-number">49.115</span> test2[<span class="hljs-number">4688</span>:c07] timerFired @ <span class="hljs-number">2012</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">12</span>:<span class="hljs-number">29</span>:<span class="hljs-number">49</span> +<span class="hljs-number">0000</span>
<span class="hljs-number">2012</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">29</span>:<span class="hljs-number">59.115</span> test2[<span class="hljs-number">4688</span>:c07] timerFired @ <span class="hljs-number">2012</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">12</span>:<span class="hljs-number">29</span>:<span class="hljs-number">59</span> +<span class="hljs-number">0000</span>
<span class="hljs-number">2012</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">30</span>:<span class="hljs-number">09.115</span> test2[<span class="hljs-number">4688</span>:c07] timerFired @ <span class="hljs-number">2012</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">12</span>:<span class="hljs-number">30</span>:<span class="hljs-number">09</span> +<span class="hljs-number">0000</span>
<span class="hljs-number">2012</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">13</span>:<span class="hljs-number">30</span>:<span class="hljs-number">19.114</span> test2[<span class="hljs-number">4688</span>:c07] timerFired @ <span class="hljs-number">2012</span>-<span class="hljs-number">11</span>-<span class="hljs-number">23</span> <span class="hljs-number">12</span>:<span class="hljs-number">30</span>:<span class="hljs-number">19</span> +<span class="hljs-number">0000</span>
</code></pre><p>However when I create a simple timer module that uses this code all I get is &quot;Starting timer&quot; and &quot;timer started&quot; output. The timer itself is not being run, no exceptions are thrown or any warnings are given.</p>
<p>Did anyone of you had opportunity to use NSTimers with Titanium? Seems Titanium is doing some thread tricks… Just wonder how setTimeout and setInterval functions were coded.</p>
<p>No, I cannot use built-in titanium functions- it must be inside in the module. Using latest Titanium 2.1.4. It acts the same both on simulator as well as on iOS device(s).</p>
<p>Any help is much appreciated.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="November 23rd 2012, 10:37:56 am">November 23rd 2012</span>
				by <span class='authorname'>Piotr Pozniak</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>ios</span></li>
					
						<li><span class='tagname'>module</span></li>
					
						<li><span class='tagname'>nstimer</span></li>
					
						<li><span class='tagname'>threads</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>It would be great if someone from appcelerator could chime in here. We&#39;re running into the exact same issue on our project. Looking through titanium&#39;s code I&#39;ve found this - https:&#x2F;&#x2F;github.com&#x2F;appcelerator&#x2F;titanium_mobile&#x2F;blob&#x2F;master&#x2F;iphone&#x2F;Classes&#x2F;TiMediaAudioPlayerProxy.m. Specifically line 83. What&#39;s the significance of &quot;retain&quot;?</p>
</div>
							<div class="author">
								&mdash; commented <span title="March 7th 2013, 12:25:29 pm">March 7th 2013</span>
								by <span class='authorname'>Joe Longstreet</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>I&#39;m fairly new to app development but I&#39;ve noticed that neither NSTimer or NSTimeInterval seems to work properly within a Titanium app. It seems anything that needs to bind to the current run loop is failing. I&#39;d like to know if there&#39;s another way to get this to work.  I noticed that the Titanium modules derive from TiProxy instead of TiModule, I&#39;m not sure if that&#39;s significant or not.</p>
</div>
							<div class="author">
								&mdash; commented <span title="March 7th 2013, 2:17:05 pm">March 7th 2013</span>
								by <span class='authorname'>Todd Greathouse</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>3</span> Votes</div>
			<div class="answers"><span>5</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>5 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-252642">
				
						<section>
							<p>I have had the exact same issue with NSTimers in a native iOS module. I&#39;ve spent a good long while investigating it, and what I believe the problem is is that the runloop that the NSTimers bind to does not actually run or loop as it would in a purely native app, and hence the timers will never fire. </p>
<p>I have had no success with any direct manipulation of the runloop, and in general have not yet found any solution to this issue.</p>
<p>Unfortunately I have the same issue as you in that I need a way for them to be able to to work within the native module. In my case it is because i am relying on a third party native framework which uses NSTimers.</p>
<p>If anyone is able to progress any further at all on making specifically NSTimers work in any way, please let us know!</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 13th 2012, 12:55:13 am">December 13th 2012</span>
								by <span class='authorname'>Jonathan Wrigley</span><br>
								<a class="icon-bg icon-link" href="../../question/145005/nstimer-in-titanium-module.html#answer-252642" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Exactly! Unfortunately after some days we gave up. Fortunately for us that we could ask our partners to change their framework, so it is working now without timers.<br>NSTimer seems not to work at all in the titanium modules (I was not able to make it work). Please keep this in mind when designing the TI module.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 14th 2012, 2:32:23 pm">December 14th 2012</span>
											by <span class='authorname'>Piotr Pozniak</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>2</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-258280">
				
						<section>
							<p>We finally got it to work in our module, I&#39;m not sure why this particular syntax works, but here it is implemented in an event listener named &quot;timecode&quot;. I suspect it&#39;s binding the timer to mainRunLoop that makes it work.</p>
<pre><code class="hljs">
-(<span class="hljs-typename">void</span>)<span class="hljs-string">_listenerAdded:</span>(NSString *)type <span class="hljs-string">count:</span>(<span class="hljs-typename">int</span>)count
{
    <span class="hljs-keyword">if</span> (count == <span class="hljs-number">1</span> &amp;&amp; [type <span class="hljs-string">isEqualToString:</span>@<span class="hljs-string">"timecode"</span>])
    {
        timeDict = [[NSMutableDictionary alloc] <span class="hljs-string">initWithObjectsAndKeys:</span>nil, @<span class="hljs-string">"timecode"</span>, nil];
        timer = [[NSTimer <span class="hljs-string">timerWithTimeInterval:</span><span class="hljs-number">5.0</span> <span class="hljs-string">target:</span>self <span class="hljs-string">selector:</span><span class="hljs-annotation">@selector</span>(<span class="hljs-string">fireTimecodeEvent:</span>) <span class="hljs-string">userInfo:</span>nil <span class="hljs-string">repeats:</span>YES] retain];
        [[NSRunLoop mainRunLoop] <span class="hljs-string">addTimer:</span>timer <span class="hljs-string">forMode:</span>NSDefaultRunLoopMode];
    }
}

-(<span class="hljs-typename">void</span>)<span class="hljs-string">_listenerRemoved:</span>(NSString *)type <span class="hljs-string">count:</span>(<span class="hljs-typename">int</span>)count
{
    <span class="hljs-keyword">if</span> (count == <span class="hljs-number">0</span> &amp;&amp; [type <span class="hljs-string">isEqualToString:</span>@<span class="hljs-string">"timecode"</span>])
    {
        [timer invalidate];
        timer = nil;
    }
}

-(<span class="hljs-typename">void</span>)<span class="hljs-string">fireTimecodeEvent:</span>(NSTimer *)updateTimer
{
    <span class="hljs-typename">double</span> value = [[NSDate date] timeIntervalSince1970];
    NSString *returnString = [NSString <span class="hljs-string">stringWithFormat:</span>@<span class="hljs-string">"%lf"</span>, value];
    [timeDict <span class="hljs-string">setObject:</span>returnString <span class="hljs-string">forKey:</span>@<span class="hljs-string">"timecode"</span>];
    [self <span class="hljs-string">fireEvent:</span>@<span class="hljs-string">"timecode"</span> <span class="hljs-string">withObject:</span>timeDict];
}
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 7th 2013, 7:57:40 pm">March 7th 2013</span>
								by <span class='authorname'>Todd Greathouse</span><br>
								<a class="icon-bg icon-link" href="../../question/145005/nstimer-in-titanium-module.html#answer-258280" rel="permalink">permalink</a>
							</div>

							<h5>3 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Todd Greathouse is a genius.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 7th 2013, 8:11:39 pm">March 7th 2013</span>
											by <span class='authorname'>Joe Longstreet</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I&#39;m not clear on how this works, can you show your whole module file? Also, are you adding a &quot;timecode&quot; event listener to the module in Titanium? Or is this self-contained in the module?</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 4th 2013, 2:47:13 pm">September 4th 2013</span>
											by <span class='authorname'>Justin Toth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Never mind I got it working.</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 4th 2013, 4:02:03 pm">September 4th 2013</span>
											by <span class='authorname'>Justin Toth</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>2</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-251577">
				
						<section>
							<p>hi,<br>do not know why you want like this but instead you can call this function from titanium also with </p>
<pre><code class="hljs">setInterval(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{

},<span class="hljs-number">1000</span>);
<span class="hljs-comment">//1000 = 1 sec.</span>
</code></pre><p>function</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 23rd 2012, 11:38:39 am">November 23rd 2012</span>
								by <span class='authorname'>Mitul Bhalia</span><br>
								<a class="icon-bg icon-link" href="../../question/145005/nstimer-in-titanium-module.html#answer-251577" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Sorry Mitul, but it cannot be done from Titanium level. It has to be done from TI module. And more important things is why it is not working (any timer, even those I have in separate libraries&#x2F;frameworks).</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 23rd 2012, 2:27:14 pm">November 23rd 2012</span>
											by <span class='authorname'>Piotr Pozniak</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>ok , if you are creating a module then there is one method called <em>*startup</em>. this method is called when the module is first loaded so try to put code in this method.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 26th 2012, 3:57:17 am">November 26th 2012</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-1</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-251578">
				
						<section>
							<p>I know you want a reply to answer your question but how I don&#39;t have it :) I&#39;d like to suggest you this module:<br>https:&#x2F;&#x2F;marketplace.appcelerator.com&#x2F;apps&#x2F;2658?1444056113</p>
<p>Maybe it helps and saves you from banging your head :)</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 23rd 2012, 11:57:16 am">November 23rd 2012</span>
								by <span class='authorname'>Dan Tamas</span><br>
								<a class="icon-bg icon-link" href="../../question/145005/nstimer-in-titanium-module.html#answer-251578" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-1</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-252742">
				
						<section>
							<p>Hi, Piotr, you are trying to use </p>
<pre><code class="hljs">- (<span class="hljs-keyword">void</span>)viewDidLoad
{
    [<span class="hljs-keyword">super</span> viewDidLoad];
    <span class="hljs-comment">// Do any additional setup after loading the view, typically from a nib.</span>

    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"Starting timer"</span>);
    <span class="hljs-built_in">NSTimer</span> *aTimer = [<span class="hljs-built_in">NSTimer</span> scheduledTimerWithTimeInterval:<span class="hljs-number">10.0</span>
                                                       target:<span class="hljs-keyword">self</span>
                                                     selector:<span class="hljs-keyword">@selector</span>(timerFired:)
                                                     userInfo:<span class="hljs-literal">nil</span>
                                                      repeats:<span class="hljs-literal">YES</span>];
    <span class="hljs-built_in">NSLog</span>(<span class="hljs-string">@"Timer started"</span>);
}
</code></pre><p>In titanium module viewDidLoad is not the correct method to be used. and try to run the Timer in UI thread.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 14th 2012, 6:57:55 am">December 14th 2012</span>
								by <span class='authorname'>Ashish Nigam</span><br>
								<a class="icon-bg icon-link" href="../../question/145005/nstimer-in-titanium-module.html#answer-252742" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Actually this code is from simple test app to check whether NSTimer I wrote is working (crated with xcode). In TI Module I put timer execution in starTimer method in TimerProxy class. It was useless anyway. Thanks for your effort :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 14th 2012, 2:35:46 pm">December 14th 2012</span>
											by <span class='authorname'>Piotr Pozniak</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>if you could share some code info for timer then i can help. Happy Coding Anyway</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 14th 2012, 2:40:51 pm">December 14th 2012</span>
											by <span class='authorname'>Ashish Nigam</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-1</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
