<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>lose of type in commonJS module » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>lose of type in commonJS module</h1>
		</header>
		<section>
			<p>Hi guys</p>
<p>I have a commonJS file that looks after the data and presentation for a trip. I can create and display the view okay. What I want to do now is add a new view within the top view, but I get a TypeError. </p>
<p>The top-level function, ridesWindow, simply create the rideComponent object, and then calls the rideComponent.show() function to create the UI. The rideComponent.getMainView() is then used to retrieve the top level view from the RideComponent object, and added to win.</p>
<p>As part of the show() function, a event listener is created that will call expandTrip if rideComponent is clicked at all, and, as expected, this does get called correctly. In expandTrip, a new view is created and added to the top level view.</p>
<p>Now the problem,  I get the error &quot;Uncaught TypeError: cannot call method &#39;add&#39; of undefined&quot; with the source listed as &quot;this.rideComponent.add(extendedView)&quot;. I have tried a number of different approaches, but I can&#39;t get past this problem. </p>
<pre><code class="hljs">   Thanks <span class="hljs-keyword">for</span> any <span class="hljs-built_in">help</span>, Richard
</code></pre><pre><code class="hljs">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">ridesWindow</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> rideComponent = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ui/handheld/RideComponent'</span>);

    <span class="hljs-keyword">var</span> win = Titanium.UI.createWindow ({ layout:<span class="hljs-string">'vertical'</span> });

    <span class="hljs-keyword">this</span>.myRide = <span class="hljs-keyword">new</span> rideComponent(<span class="hljs-string">'driver'</span>, <span class="hljs-string">'Party with Dave'</span>);
    <span class="hljs-keyword">this</span>.myRide.show();
    win.add(<span class="hljs-keyword">this</span>.myRide.getMainView());
}
</code></pre><pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">RideComponent</span>(<span class="hljs-params">type, title</span>) </span>{
    <span class="hljs-keyword">this</span>.title = title;
    <span class="hljs-keyword">this</span>.type = type;
}

RideComponent.prototype.show = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) 
</span>{
    <span class="hljs-keyword">this</span>.rideComponent = Ti.UI.createView ({ layout:<span class="hljs-string">'vertical'</span> });    
    <span class="hljs-keyword">var</span> titleText = Titanium.UI.createLabel ({ text:<span class="hljs-keyword">this</span>.title });
    <span class="hljs-keyword">var</span> tripTypeImage = Ti.UI.createImageView ({ image :<span class="hljs-string">'/image/driver.png'</span> });

    <span class="hljs-keyword">this</span>.rideComponent.add(titleText);
    <span class="hljs-keyword">this</span>.rideComponent.add(TypeImage);

    <span class="hljs-keyword">this</span>.rideComponent.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-keyword">this</span>.expandTrip);
}

RideComponent.prototype.getMainView = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.rideComponent;
}

RideComponent.prototype.expandTrip = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)
</span>{
    <span class="hljs-keyword">var</span> extendedView = Ti.UI.createView ({ layout:<span class="hljs-string">'vertical'</span>, });
    <span class="hljs-keyword">this</span>.rideComponent.add(extendedView);
}

<span class="hljs-built_in">module</span>.exports = RideComponent;
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="September 18th 2012, 8:34:56 pm">September 18th 2012</span>
				by <span class='authorname'>Richard George</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>commonjs</span></li>
					
						<li><span class='tagname'>ood</span></li>
					
						<li><span class='tagname'>typeerror</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-247514">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>Hi Richard,</p>
<p>Function expandTrip() is called through an event handler. In this context, the &quot;this&quot; pointer does not point to the object in which the function has been defined. This is an oddity of the Javascript language definition.</p>
<p>A common workaround is to save the &quot;this&quot; pointer into another variable and refer to it from a closure. In your case, try changing expandTrip into a closure defined within addEventListener. Then assign &quot;this&quot; to &quot;that&quot; and refer to &quot;that&quot; from the body of the closure:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> that = <span class="hljs-keyword">this</span>;
<span class="hljs-keyword">this</span>.rideComponent.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
</span>{
    <span class="hljs-keyword">var</span> extendedView = Ti.UI.createView ({ layout:<span class="hljs-string">'vertical'</span>, });
    that.rideComponent.add(extendedView);
});
</code></pre><p>Closures can take their &quot;outer&quot; context with them, so &quot;that&quot; will still be pointing to the current object when the closure is called later through an event. </p>
<p>Regards,</p>
<p>Christoph</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 19th 2012, 4:02:59 am">September 19th 2012</span>
								by <span class='authorname'>Christoph Berger</span><br>
								<a class="icon-bg icon-link" href="question/142383/lose-of-type-in-commonjs-module#answer-247514" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Thank you very much :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 19th 2012, 9:10:39 am">September 19th 2012</span>
											by <span class='authorname'>Richard George</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
