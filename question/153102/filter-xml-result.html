<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>filter xml result » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>filter xml result</h1>
		</header>
		<section>
			<p>Hi,</p>
<p>i was create app that display offer list with 18 category.</p>
<p>When the app star, i receive xml item that i record into database. After i display the result into tableview depending on whether the user selects a particular category.</p>
<p>But now it&#39;s too long for download xml data and save into database and display it.  2 minutes to display firt results.</p>
<p>There are 500 offers to download.</p>
<p>I think it&#39;s possible to download xml data and make filter to display directly each catégorie of offer into a different tableview depending on whether the user selects a particular category into tablview without having to record in a database</p>
<p>today i use sql request to filter the result. are there a solution to meke the same work without base ?</p>
<p>thank you.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="May 31st 2013, 10:20:46 am">May 31st 2013</span>
				by <span class='authorname'>patrice aschenbrenner</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>database</span></li>
					
						<li><span class='tagname'>filter xml result</span></li>
					
						<li><span class='tagname'>xml</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-263680">
				
						<section>
							<p>Hi</p>
<p>From your description I am not sure if you problem is the download speed, the transfer to the database or the retrieval back from the database?</p>
<p>I am going to guess it is the transfer to the database;</p>
<p>You should prefix your insert code - which I am guessing in in a loop - so this goes before.</p>
<pre><code class="hljs"><span class="hljs-comment">// assumes db = the name of your database object as you have not </span>
<span class="hljs-comment">// provided a code example you will need to change to suit your code</span>
<span class="hljs-keyword">db</span>.execute(<span class="hljs-string">"BEGIN IMMEDIATE TRANSACTION"</span>);
</code></pre><p>And then after the loop you commit the inserts;</p>
<pre><code class="hljs">db.<span class="hljs-built_in">execute</span>(<span class="hljs-string">"COMMIT TRANSACTION"</span>)<span class="hljs-comment">;</span>
</code></pre><p>This tells the database to add all the inserts in ONE go - much faster.  This should be done in smaller batches but 500 are OK.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 31st 2013, 11:16:06 am">May 31st 2013</span>
								by <span class='authorname'>Malcolm Hollingsworth</span><br>
								<a class="icon-bg icon-link" href="../../question/153102/filter-xml-result.html#answer-263680" rel="permalink">permalink</a>
							</div>

							<h5>10 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Malcom, you can show my app here :</p>
<p>https:&#x2F;&#x2F;itunes.apple.com&#x2F;fr&#x2F;app&#x2F;assu-pocket&#x2F;id601401473?mt=8</p>
<p>and you can see my problem.  When the app start, it&#39;s very too long for download and display all the offer. I dont know if it&#39;s my code, the database or xml  ?</p>
<p>I can put code part here if you want. What do you need of part ?</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 31st 2013, 12:00:21 pm">May 31st 2013</span>
											by <span class='authorname'>patrice aschenbrenner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>here my function on database.js file for record xml data on Offre table.</p>
<pre><code class="hljs"> <span class="hljs-transposed_variable">db.</span>execute(<span class="hljs-string">'CREATE TABLE IF NOT EXISTS Offres      ( id INTEGER PRIMARY KEY, Ref TEXT, Type_produit TEXT, Compagnie TEXT, Site TEXT, Logo TEXT, Dept TEXT, Offre TEXT, Type_offre TEXT, Date_validite TEXT, Partenaire TEXT, Email TEXT ,Conditions TEXT,Nos_plus TEXT, Parrain TEXT, Code_promo TEXT, Jaime TEXT )'</span>);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insertOffre</span> <span class="hljs-params">(Ref, Type_produit, Compagnie, Site, Logo, Dept, Offre, Type_offre, Date_validite, Partenaire, Email, Conditions, Nos_plus, Parrain, Code_promo, Jaime)</span>{</span>
    var sql = <span class="hljs-string">"INSERT INTO Offres (Ref, Type_produit, Compagnie, Site, Logo, Dept, Offre, Type_offre, Date_validite, Partenaire, Email, Conditions, Nos_plus, Parrain, Code_promo, Jaime) VALUES ("</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Ref.replace("</span><span class="hljs-string">'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'</span>, <span class="hljs-string">";
    sql = sql + "</span><span class="hljs-string">'"</span> + <span class="hljs-transposed_variable">Type_produit.</span>replace(<span class="hljs-string">"'</span><span class="hljs-string">", "</span><span class="hljs-string">''</span><span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Compagnie.replace("</span><span class="hljs-string">'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'</span>, <span class="hljs-string">";
    sql = sql + "</span><span class="hljs-string">'"</span> + <span class="hljs-transposed_variable">Site.</span>replace(<span class="hljs-string">"'</span><span class="hljs-string">", "</span><span class="hljs-string">''</span><span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Logo.replace("</span><span class="hljs-string">'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'</span>, <span class="hljs-string">";
    sql = sql + "</span><span class="hljs-string">'"</span> + <span class="hljs-transposed_variable">Dept.</span>replace(<span class="hljs-string">"'</span><span class="hljs-string">", "</span><span class="hljs-string">''</span><span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Offre.replace("</span>&amp;euro;<span class="hljs-string">", "</span>€<span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Type_offre.replace("</span><span class="hljs-string">'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'</span>, <span class="hljs-string">";
    sql = sql + "</span><span class="hljs-string">'"</span> + <span class="hljs-transposed_variable">Date_validite.</span>replace(<span class="hljs-string">"'</span><span class="hljs-string">", "</span><span class="hljs-string">''</span><span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Partenaire.replace("</span><span class="hljs-string">'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'</span>, <span class="hljs-string">";
    sql = sql + "</span><span class="hljs-string">'"</span> + <span class="hljs-transposed_variable">Email.</span>replace(<span class="hljs-string">"'</span><span class="hljs-string">", "</span><span class="hljs-string">''</span><span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Conditions.replace("</span>&amp;apos;<span class="hljs-string">", "</span><span class="hljs-string">''</span><span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Nos_plus.replace("</span>&amp;euro;<span class="hljs-string">", "</span>€<span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Parrain.replace("</span><span class="hljs-string">'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'</span>, <span class="hljs-string">";
    sql = sql + "</span><span class="hljs-string">'"</span> + <span class="hljs-transposed_variable">Code_promo.</span>replace(<span class="hljs-string">"'</span><span class="hljs-string">", "</span><span class="hljs-string">''</span><span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Jaime.replace("</span><span class="hljs-string">'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'</span>)<span class="hljs-string">";
    db.execute(sql);
    return db.lastInsertRowId;
    db.close();
}</span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="May 31st 2013, 12:13:22 pm">May 31st 2013</span>
											by <span class='authorname'>patrice aschenbrenner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>and this my function to load xml data and record result with insertOffre() function:</p>
<pre><code class="hljs">

<span class="javascript"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAssurance</span>(<span class="hljs-params"></span>)
</span>{



    db.execute(<span class="hljs-string">'DELETE FROM Offres'</span>);
    <span class="hljs-keyword">var</span> data = [];
    <span class="hljs-comment">// déclaration du client http</span>
    <span class="hljs-keyword">var</span> xhr = Titanium.Network.createHTTPClient();
    <span class="hljs-comment">//xhr.open('GET', 'http://www.assu-pocket.fr/xml/rss4.xml');</span>
    xhr.open(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'http://www.assu-pocket.fr/components/com_assupocket/export/.....php'</span>);
    xhr.send();
    <span class="hljs-comment">//Process when dowloading is going on</span>

    xhr.ondatastream = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) 
    </span>{
           <span class="hljs-comment">//Change the progress bar value with downloading progression</span>
        ind.value = e.progress;
        Ti.API.info(<span class="hljs-string">'ONSENDSTREAM - PROGRESS: '</span> + e.progress);

        <span class="hljs-comment">//messageLabel.text= 'merci de patienter'+(Math.floor(e.progress*0.5*100) *2)+'% chargé';     </span>
    };



     xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)
     </span>{
         <span class="hljs-comment">//Ti.API.info(this.responseText);</span>
         <span class="hljs-keyword">var</span> xml = <span class="hljs-keyword">this</span>.responseXML;
         <span class="hljs-keyword">var</span> items = xml.documentElement.getElementsByTagName(<span class="hljs-string">"item"</span>);



         <span class="hljs-comment">// boucle pour afficher les résultats</span>
         <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; items.length; i++)
         {
             <span class="hljs-keyword">var</span> Ref             = items.item(i).getElementsByTagName(<span class="hljs-string">"id"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Type_produit = items.item(i).getElementsByTagName(<span class="hljs-string">"type_produit"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Compagnie      = items.item(i).getElementsByTagName(<span class="hljs-string">"compagnie"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Site          = items.item(i).getElementsByTagName(<span class="hljs-string">"site"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Logo          = items.item(i).getElementsByTagName(<span class="hljs-string">"logo"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Dept         = items.item(i).getElementsByTagName(<span class="hljs-string">"departement"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Offre         = items.item(i).getElementsByTagName(<span class="hljs-string">"offre"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Type_offre     = items.item(i).getElementsByTagName(<span class="hljs-string">"type_offre"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Date_validite= items.item(i).getElementsByTagName(<span class="hljs-string">"date_validite"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Partenaire     = items.item(i).getElementsByTagName(<span class="hljs-string">"partenaire"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Email         = items.item(i).getElementsByTagName(<span class="hljs-string">"email"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Conditions     = items.item(i).getElementsByTagName(<span class="hljs-string">"conditions"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Nos_plus     = items.item(i).getElementsByTagName(<span class="hljs-string">"nos_plus"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Parrain         = items.item(i).getElementsByTagName(<span class="hljs-string">"parrain"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Code_promo     = items.item(i).getElementsByTagName(<span class="hljs-string">"code_promo"</span>).item(<span class="hljs-number">0</span>).firstChild.text;
             <span class="hljs-keyword">var</span> Jaime     = items.item(i).getElementsByTagName(<span class="hljs-string">"jaime"</span>).item(<span class="hljs-number">0</span>).firstChild.text;

             <span class="hljs-comment">// traitement caractères</span>
             <span class="hljs-keyword">var</span> Offre = Offre.replace(<span class="hljs-regexp">/&amp;euro;/g</span>, <span class="hljs-string">"€"</span>);
             <span class="hljs-keyword">var</span> Conditions  = Conditions.replace(<span class="hljs-regexp">/&amp;euro;/g</span>, <span class="hljs-string">"€"</span>);
             <span class="hljs-keyword">var</span> Nos_plus  = Nos_plus.replace(<span class="hljs-regexp">/&amp;euro;/g</span>, <span class="hljs-string">"€"</span>);

             <span class="hljs-keyword">var</span> Conditions = Conditions.replace(<span class="hljs-regexp">/&gt;/g</span>, <span class="hljs-string">" &gt; "</span>);
            <span class="hljs-keyword">var</span> Conditions = Conditions.replace(<span class="hljs-regexp">/&amp;amp;/g</span>, <span class="hljs-string">" &amp; "</span>);
            <span class="hljs-keyword">var</span> Nos_plus = Nos_plus.replace(<span class="hljs-regexp">/&gt;/g</span>, <span class="hljs-string">" &gt; "</span>);
            <span class="hljs-keyword">var</span> Nos_plus = Nos_plus.replace(<span class="hljs-regexp">/&amp;amp;/g</span>, <span class="hljs-string">" &amp; "</span>);

             insertOffre(Ref,Type_produit, Compagnie, Site, Logo, Dept, Offre, Type_offre, Date_validite, Partenaire, Email, Conditions, Nos_plus, Parrain, Code_promo, Jaime);
             Ti.API.info(Ref, Type_produit, Compagnie, Site, Logo, Dept, Offre, Type_offre, Date_validite, Partenaire, Email, Conditions, Nos_plus, Parrain, Code_promo, Jaime);
        };
         <span class="hljs-comment">//var choix = 'Tous';</span>
        <span class="hljs-comment">//var index = 5;</span>
        <span class="hljs-comment">//getOffres(choix, index);</span>



        <span class="hljs-keyword">var</span> starviewAnimation = Ti.UI.createAnimation({
            curve:Ti.UI.ANIMATION_CURVE_EASE_OUT,
            opacity: <span class="hljs-number">0</span>,
            delay:<span class="hljs-number">0</span>,
            duration:<span class="hljs-number">300</span>
        });
        starview.animate(starviewAnimation )


     }
 <span class="hljs-comment">//////////////////////////</span>
}  <span class="hljs-comment">// end function getAssurance</span></span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="May 31st 2013, 12:16:14 pm">May 31st 2013</span>
											by <span class='authorname'>patrice aschenbrenner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>So where i put your code ?</p>
<p>db.execute(&quot;BEGIN IMMEDIATE TRANSACTION&quot;);</p>
<p>and</p>
<p>db.execute(&quot;COMMIT TRANSACTION&quot;);</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 31st 2013, 12:17:28 pm">May 31st 2013</span>
											by <span class='authorname'>patrice aschenbrenner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>The most important thing you have to do is to start working out WHERE the speed bottle neck(s) are.  The easiest way to do this is to include statements like;</p>
<pre><code class="hljs">// section = <span class="hljs-operator"><span class="hljs-keyword">replace</span> this <span class="hljs-keyword">with</span> the <span class="hljs-keyword">module</span> <span class="hljs-keyword">name</span>
// subsection = point <span class="hljs-keyword">in</span> <span class="hljs-keyword">function</span> <span class="hljs-keyword">to</span> <span class="hljs-keyword">show</span> <span class="hljs-keyword">where</span> you logged
Ti.API.info(<span class="hljs-string">'sectionname.subsection: '</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());</span>
</code></pre><p>When you have a few of these, see the difference between the times, look at the largest times and then focus your efforts there.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 31st 2013, 12:22:05 pm">May 31st 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>As follows;</p>
<pre><code class="hljs">db.execute<span class="hljs-comment">("BEGIN IMMEDIATE TRANSACTION")</span>;
<span class="hljs-comment">// boucle pour afficher les résultats</span>
for<span class="hljs-comment">(var i = 0; i &lt; items.length; i++)</span>
...
</code></pre><p>and then;</p>
<pre><code class="hljs">    ...
    insertOffre(Ref,Type_produit, Compagnie, Site, Logo, Dept, Offre, Type_offre, Date_validite, Partenaire, Email, Conditions, Nos_plus, Parrain, Code_promo, Jaime)<span class="hljs-comment">;</span>
    Ti.API.info(Ref, Type_produit, Compagnie, Site, Logo, Dept, Offre, Type_offre, Date_validite, Partenaire, Email, Conditions, Nos_plus, Parrain, Code_promo, Jaime)<span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span>
db.execute("COMMIT TRANSACTION")<span class="hljs-comment">;</span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="May 31st 2013, 12:25:25 pm">May 31st 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>ok i was put your code :</p>
<pre><code class="hljs">

<span class="stata">
<span class="hljs-keyword">db</span>.execute(<span class="hljs-string">"BEGIN IMMEDIATE TRANSACTION"</span>);
         <span class="hljs-comment">// boucle pour afficher les résultats</span>
         <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = 0; i &lt; items.length; i++)
         {
             <span class="hljs-keyword">var</span> Ref             = items.item(i).getElementsByTagName(<span class="hljs-string">"id"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Type_produit = items.item(i).getElementsByTagName(<span class="hljs-string">"type_produit"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Compagnie      = items.item(i).getElementsByTagName(<span class="hljs-string">"compagnie"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Site          = items.item(i).getElementsByTagName(<span class="hljs-string">"site"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Logo          = items.item(i).getElementsByTagName(<span class="hljs-string">"logo"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Dept         = items.item(i).getElementsByTagName(<span class="hljs-string">"departement"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Offre         = items.item(i).getElementsByTagName(<span class="hljs-string">"offre"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Type_offre     = items.item(i).getElementsByTagName(<span class="hljs-string">"type_offre"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Date_validite= items.item(i).getElementsByTagName(<span class="hljs-string">"date_validite"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Partenaire     = items.item(i).getElementsByTagName(<span class="hljs-string">"partenaire"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Email         = items.item(i).getElementsByTagName(<span class="hljs-string">"email"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Conditions     = items.item(i).getElementsByTagName(<span class="hljs-string">"conditions"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Nos_plus     = items.item(i).getElementsByTagName(<span class="hljs-string">"nos_plus"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Parrain         = items.item(i).getElementsByTagName(<span class="hljs-string">"parrain"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Code_promo     = items.item(i).getElementsByTagName(<span class="hljs-string">"code_promo"</span>).item(0).firstChild.text;
             <span class="hljs-keyword">var</span> Jaime     = items.item(i).getElementsByTagName(<span class="hljs-string">"jaime"</span>).item(0).firstChild.text;

             <span class="hljs-comment">// traitement caractères</span>
             <span class="hljs-keyword">var</span> Offre = Offre.<span class="hljs-keyword">replace</span>(/&amp;euro;/<span class="hljs-keyword">g</span>, <span class="hljs-string">"€"</span>);
             <span class="hljs-keyword">var</span> Conditions  = Conditions.<span class="hljs-keyword">replace</span>(/&amp;euro;/<span class="hljs-keyword">g</span>, <span class="hljs-string">"€"</span>);
             <span class="hljs-keyword">var</span> Nos_plus  = Nos_plus.<span class="hljs-keyword">replace</span>(/&amp;euro;/<span class="hljs-keyword">g</span>, <span class="hljs-string">"€"</span>);

             <span class="hljs-keyword">var</span> Conditions = Conditions.<span class="hljs-keyword">replace</span>(/&gt;/<span class="hljs-keyword">g</span>, <span class="hljs-string">" &gt; "</span>);
            <span class="hljs-keyword">var</span> Conditions = Conditions.<span class="hljs-keyword">replace</span>(/&amp;amp;/<span class="hljs-keyword">g</span>, <span class="hljs-string">" &amp; "</span>);
            <span class="hljs-keyword">var</span> Nos_plus = Nos_plus.<span class="hljs-keyword">replace</span>(/&gt;/<span class="hljs-keyword">g</span>, <span class="hljs-string">" &gt; "</span>);
            <span class="hljs-keyword">var</span> Nos_plus = Nos_plus.<span class="hljs-keyword">replace</span>(/&amp;amp;/<span class="hljs-keyword">g</span>, <span class="hljs-string">" &amp; "</span>);


             function insertOffre (Ref, Type_produit, Compagnie, Site, Logo, Dept, Offre, Type_offre, Date_validite, Partenaire, Email, Conditions, Nos_plus, Parrain, Code_promo, Jaime){
            <span class="hljs-keyword">var</span> sql = <span class="hljs-string">"INSERT INTO Offres (Ref, Type_produit, Compagnie, Site, Logo, Dept, Offre, Type_offre, Date_validite, Partenaire, Email, Conditions, Nos_plus, Parrain, Code_promo, Jaime) VALUES ("</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Ref.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Type_produit.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Compagnie.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Site.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Logo.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Dept.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Offre.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"&amp;euro;"</span>, <span class="hljs-string">"€"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Type_offre.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Date_validite.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Partenaire.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Email.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Conditions.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"&amp;apos;"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Nos_plus.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"&amp;euro;"</span>, <span class="hljs-string">"€"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Parrain.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Code_promo.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"', "</span>;
            sql = sql + <span class="hljs-string">"'"</span> + Jaime.<span class="hljs-keyword">replace</span>(<span class="hljs-string">"'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"')"</span>;
            <span class="hljs-keyword">db</span>.execute(sql);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">db</span>.lastInsertRowId;
            <span class="hljs-keyword">db</span>.<span class="hljs-keyword">close</span>();
}
             insertOffre(Ref,Type_produit, Compagnie, Site, Logo, Dept, Offre, Type_offre, Date_validite, Partenaire, Email, Conditions, Nos_plus, Parrain, Code_promo, Jaime);
             <span class="hljs-comment">//Ti.API.info(Ref, Type_produit, Compagnie, Site, Logo, Dept, Offre, Type_offre, Date_validite, Partenaire, Email, Conditions, Nos_plus, Parrain, Code_promo, Jaime);</span>
        };
        <span class="hljs-keyword">db</span>.execute(<span class="hljs-string">"COMMIT TRANSACTION"</span>);</span>
</code></pre><p>and is better.  i test with wifi and before is take 8 sc  and now 4 sc.<br>i try in 3G connexion.</p>
<p>sorry but  i don&#39;t understand you solution :</p>
<pre><code class="hljs">
Ti.API.info(<span class="hljs-string">'sectionname.subsection: '</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="May 31st 2013, 1:04:59 pm">May 31st 2013</span>
											by <span class='authorname'>patrice aschenbrenner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>This code;</p>
<pre><code class="hljs">Ti.API.info(<span class="hljs-string">'sectionname.subsection: '</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>());
</code></pre><p>Is not a solution but a way to determine WHERE the slow downs are.</p>
<p>You place one BEFORE a block of code and one AFTER.  This way you can quickly work out if this section takes less than a second or several seconds.  If a block takes several seconds then you read through that code looking to see if you can optimise the code or process.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 31st 2013, 1:10:05 pm">May 31st 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>This function can be tweaked to perform better - but it is unlikely this will be the slow down.</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">insertOffre</span> <span class="hljs-params">(Ref, Type_produit, Compagnie, Site, Logo, Dept, Offre, Type_offre, Date_validite, Partenaire, Email, Conditions, Nos_plus, Parrain, Code_promo, Jaime)</span>{</span>
    var sql = <span class="hljs-string">"INSERT INTO Offres (Ref, Type_produit, Compagnie, Site, Logo, Dept, Offre, Type_offre, Date_validite, Partenaire, Email, Conditions, Nos_plus, Parrain, Code_promo, Jaime) VALUES ("</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Ref.replace("</span><span class="hljs-string">'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'</span>, <span class="hljs-string">";
    sql = sql + "</span><span class="hljs-string">'"</span> + <span class="hljs-transposed_variable">Type_produit.</span>replace(<span class="hljs-string">"'</span><span class="hljs-string">", "</span><span class="hljs-string">''</span><span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Compagnie.replace("</span><span class="hljs-string">'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'</span>, <span class="hljs-string">";
    sql = sql + "</span><span class="hljs-string">'"</span> + <span class="hljs-transposed_variable">Site.</span>replace(<span class="hljs-string">"'</span><span class="hljs-string">", "</span><span class="hljs-string">''</span><span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Logo.replace("</span><span class="hljs-string">'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'</span>, <span class="hljs-string">";
    sql = sql + "</span><span class="hljs-string">'"</span> + <span class="hljs-transposed_variable">Dept.</span>replace(<span class="hljs-string">"'</span><span class="hljs-string">", "</span><span class="hljs-string">''</span><span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Offre.replace("</span>&amp;euro;<span class="hljs-string">", "</span>€<span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Type_offre.replace("</span><span class="hljs-string">'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'</span>, <span class="hljs-string">";
    sql = sql + "</span><span class="hljs-string">'"</span> + <span class="hljs-transposed_variable">Date_validite.</span>replace(<span class="hljs-string">"'</span><span class="hljs-string">", "</span><span class="hljs-string">''</span><span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Partenaire.replace("</span><span class="hljs-string">'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'</span>, <span class="hljs-string">";
    sql = sql + "</span><span class="hljs-string">'"</span> + <span class="hljs-transposed_variable">Email.</span>replace(<span class="hljs-string">"'</span><span class="hljs-string">", "</span><span class="hljs-string">''</span><span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Conditions.replace("</span>&amp;apos;<span class="hljs-string">", "</span><span class="hljs-string">''</span><span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Nos_plus.replace("</span>&amp;euro;<span class="hljs-string">", "</span>€<span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Parrain.replace("</span><span class="hljs-string">'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'</span>, <span class="hljs-string">";
    sql = sql + "</span><span class="hljs-string">'"</span> + <span class="hljs-transposed_variable">Code_promo.</span>replace(<span class="hljs-string">"'</span><span class="hljs-string">", "</span><span class="hljs-string">''</span><span class="hljs-string">") + "</span><span class="hljs-string">', "</span>;
    sql = sql + <span class="hljs-string">"'</span><span class="hljs-string">" + Jaime.replace("</span><span class="hljs-string">'"</span>, <span class="hljs-string">"''"</span>) + <span class="hljs-string">"'</span>)<span class="hljs-string">";
    db.execute(sql);
    return db.lastInsertRowId;
    db.close();
}</span>
</code></pre><p>Would be much better as follows;</p>
<pre><code class="hljs">function insertOffre (Ref, Type_produit, Compagnie, Site, Logo, Dept, Offre, Type_offre, Date_validite, Partenaire, Email, Conditions, Nos_plus, Parrain, Code_promo, Jaime){
    <span class="hljs-keyword">var</span> sql = <span class="hljs-string">"INSERT INTO Offres (Ref, Type_produit, Compagnie, Site, Logo, Dept, Offre, Type_offre, Date_validite, Partenaire, Email, Conditions, Nos_plus, Parrain, Code_promo, Jaime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);"</span>;
    <span class="hljs-keyword">var</span> vals = [
        Ref,
        Type_produit,
        Compagnie,
        Site,
        Logo,
        Dept,
        Offre,
        Type_offre,
        Date_validite,
        Partenaire,
        Email,
        Conditions,
        Nos_plus,
        Parrain,
        Code_promo,
        Jaime
    ];
    <span class="hljs-keyword">db</span>.execute(sql, vals);
    <span class="hljs-keyword">var</span> id = <span class="hljs-keyword">db</span>.lastInsertRowId;
    <span class="hljs-keyword">db</span>.<span class="hljs-keyword">close</span>();
    <span class="hljs-keyword">return</span> id;
}
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="May 31st 2013, 1:14:42 pm">May 31st 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>If you are testing on a device then the time logging function I mentioned needs to be tweaked.  You should create a function to log entries to a text file on the device and then add an option to email yourself the log file.</p>
<p>WITHOUT this bottle neck performance information you will simply be guessing as to where the problem is.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 31st 2013, 3:06:19 pm">May 31st 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-263687">
				
						<section>
							<p>i did a test with only xml data donwloaded and the time is very long.<br>so it&#39;s not the database record the problem ??  I don&#39;t understand because in wifi it&#39;s very quick 8 second and with 3G it doen&#39;t work  the activity indicator load but nothing ??</p>
<p>have you an idea ,..</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 31st 2013, 1:48:23 pm">May 31st 2013</span>
								by <span class='authorname'>patrice aschenbrenner</span><br>
								<a class="icon-bg icon-link" href="../../question/153102/filter-xml-result.html#answer-263687" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Quick tip; next time - please comment on the related answer or the actual question if there is no answer - rather than creating a whole new answer which is really a comment - it makes it harder in the future to work out threads if any answers score change or other answers are added. (You are not being told off)</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 31st 2013, 3:04:40 pm">May 31st 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
