<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>problem to populate a picker through a web service Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>problem to populate a picker through a web service</h1>
		</header>
		<section>
			<p>I&#39;m trying to populate a picker through a web service. web service works correctly returns the data I require the problem is with the method picker.add (data) is not just data, but when I load an array directly everything seems fine. any suggestions?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="January 10th 2013, 9:46:39 pm">January 10th 2013</span>
				by <span class='authorname'>Efrain Hernandez Caballero</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>data</span></li>
					
						<li><span class='tagname'>picker</span></li>
					
						<li><span class='tagname'>xhr</span></li>
					
				</ul>
			

			<section>
				<h5>3 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Missing from you question are several pieces of information that will help you obtain a speedy and accurate answer;</p>
<ul>
<li>Titanium SDK Version?</li>
<li>Primary Target Platform; Android, iOS or both?</li>
<li>A code snippet that can be used to determine what you have achieved so far</li>
</ul>
</div>
							<div class="author">
								&mdash; commented <span title="January 10th 2013, 9:51:32 pm">January 10th 2013</span>
								by <span class='authorname'>Malcolm Hollingsworth</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>better yet, post a copy of the <code>data</code> array that you are trying to add to picker.</p>
</div>
							<div class="author">
								&mdash; commented <span title="January 10th 2013, 10:00:22 pm">January 10th 2013</span>
								by <span class='authorname'>Anthony Decena</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>I responded in the bottom. I made a similar example filling a tableView and this is filled correctly. But I have not the picker results</p>
</div>
							<div class="author">
								&mdash; commented <span title="January 10th 2013, 10:00:47 pm">January 10th 2013</span>
								by <span class='authorname'>Efrain Hernandez Caballero</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-254292">
				
						<section>
							<p><code>My code is something like this</code></p>
<pre><code class="hljs">
<span class="hljs-keyword">var</span> data = []; 
<span class="hljs-keyword">var</span> picker = Ti.UI.createPicker();
win.add(picker);

getData(); 


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getData</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();

    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">var</span> json = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.responseText);

        <span class="hljs-keyword">var</span> success = json.list;

        <span class="hljs-keyword">if</span>(success.length &gt; <span class="hljs-number">0</span>){
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;success.length; i++){
                data[i] = Ti.UI.createPickerRow({
                    title: success[i].title
                })
            }
        }

        picker.add(data);
    }

    xhr.open(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'http://www.sample.com/service/'</span>);
    xhr.send();
}
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 10th 2013, 9:57:50 pm">January 10th 2013</span>
								by <span class='authorname'>Efrain Hernandez Caballero</span><br>
								<a class="icon-bg icon-link" href="question/146729/problem-to-populate-a-picker-through-a-web-service.html#answer-254292" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>This is not an answer to your question, rather it is sample code that you should provide in the comments of the original question. Would you mind adding the code to your original question (as a comment) so that we can keep your question organized? I will then delete this response so it wont cause any confusion. Thank you.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 10th 2013, 10:09:41 pm">January 10th 2013</span>
											by <span class='authorname'>Carter Lathrop</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-254294">
				
						<section>
							<p>Hi</p>
<p>As Anthony says we are going to need to see the returned about or snippet of the object, as we cannot tell from this if it returns a node <strong>list</strong> if that node is an array and that array contains a <strong>title</strong> node for each element.</p>
<p>You could add the following debug line;</p>
<pre><code class="hljs"><span class="hljs-attribute">...</span>
Ti<span class="hljs-built_in">.</span>API<span class="hljs-built_in">.</span>info(<span class="hljs-string">'rows: '</span> + <span class="hljs-built_in">data</span><span class="hljs-built_in">.</span>lenth);
picker<span class="hljs-built_in">.</span>add(<span class="hljs-built_in">data</span>);
<span class="hljs-attribute">...</span>
</code></pre><p>Btw it is pointless providing code that is &quot;something like this&quot; as it is very hard to check; typos, code errors and syntax errors to name a few if we do not have the actual code.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 10th 2013, 10:11:52 pm">January 10th 2013</span>
								by <span class='authorname'>Malcolm Hollingsworth</span><br>
								<a class="icon-bg icon-link" href="question/146729/problem-to-populate-a-picker-through-a-web-service.html#answer-254294" rel="permalink">permalink</a>
							</div>

							<h5>3 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Please also provide the other information I requested for your question as it may prove useful.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 10th 2013, 10:13:15 pm">January 10th 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p><code>WebService.js</code></p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">webService</span>(<span class="hljs-params">_options</span>) </span>{
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isBrowserEnvironment</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span> &amp;&amp; <span class="hljs-built_in">window</span>.navigator) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }
    } <span class="hljs-keyword">catch</span>(e) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }

  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isAppceleratorTitanium</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">try</span> {
      <span class="hljs-keyword">if</span> (Titanium) {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
      } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
      }
    } <span class="hljs-keyword">catch</span>(e) {
      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
    }
  }

  <span class="hljs-comment">//A generic extend function - thanks MooTools</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">extend</span>(<span class="hljs-params">original, extended</span>) </span>{
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> (extended || {})) {
      <span class="hljs-keyword">if</span> (original.hasOwnProperty(key)) {
        original[key] = extended[key];
      }
    }
    <span class="hljs-keyword">return</span> original;
  }

  <span class="hljs-comment">//Check if an object is an array</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">isArray</span>(<span class="hljs-params">obj</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Object</span>.prototype.toString.call(obj) == <span class="hljs-string">'[object Array]'</span>;
  }

  <span class="hljs-comment">//Grab an XMLHTTPRequest Object</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getXHR</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> xhr;
    <span class="hljs-keyword">if</span> (isBrowserEnvironment()) {
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.XMLHttpRequest) {
        xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();
      }
      <span class="hljs-keyword">else</span> {
        xhr = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"Microsoft.XMLHTTP"</span>);
      }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isAppceleratorTitanium()) {
      xhr = Titanium.Network.createHTTPClient();
    }
    <span class="hljs-keyword">return</span> xhr;
  }

  <span class="hljs-comment">//Parse a string and create an XML DOM object</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">xmlDomFromString</span>(<span class="hljs-params">_xml</span>) </span>{
    <span class="hljs-keyword">var</span> xmlDoc = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">if</span> (isBrowserEnvironment()) {
      <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span>.DOMParser) {
        parser = <span class="hljs-keyword">new</span> DOMParser();
        xmlDoc = parser.parseFromString(_xml,<span class="hljs-string">"text/xml"</span>);
      }
      <span class="hljs-keyword">else</span> {
        xmlDoc = <span class="hljs-keyword">new</span> ActiveXObject(<span class="hljs-string">"Microsoft.XMLDOM"</span>);
        xmlDoc.async = <span class="hljs-string">"false"</span>;
        xmlDoc.loadXML(_xml); 
      }
    }
    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (isAppceleratorTitanium()) {
      xmlDoc = Titanium.XML.parseString(_xml);
    }
    <span class="hljs-keyword">return</span> xmlDoc;
  }

  <span class="hljs-comment">// Convert a JavaScript object to an XML string - takes either an</span>
  <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">convertToXml</span>(<span class="hljs-params">_obj, namespacePrefix</span>) </span>{
    <span class="hljs-keyword">var</span> xml = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">if</span> (isArray(_obj)) {
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; _obj.length; i++) {
        xml += convertToXml(_obj[i], namespacePrefix);
      }
    } <span class="hljs-keyword">else</span> {
      <span class="hljs-comment">//For now assuming we either have an array or an object graph</span>
      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> _obj) {
        <span class="hljs-keyword">if</span> (namespacePrefix &amp;&amp; namespacePrefix.length) {
          xml += <span class="hljs-string">'&lt;'</span> + namespacePrefix + <span class="hljs-string">':'</span> + key + <span class="hljs-string">'&gt;'</span>;
        } <span class="hljs-keyword">else</span> {
          xml += <span class="hljs-string">'&lt;'</span>+key+<span class="hljs-string">'&gt;'</span>;
        }
        <span class="hljs-keyword">if</span> (isArray(_obj[key]) || (<span class="hljs-keyword">typeof</span> _obj[key] == <span class="hljs-string">'object'</span> &amp;&amp; _obj[key] != <span class="hljs-literal">null</span>)) {
          xml += convertToXml(_obj[key]);
        }
        <span class="hljs-keyword">else</span> {
          xml += _obj[key];
        }
        <span class="hljs-keyword">if</span> (namespacePrefix &amp;&amp; namespacePrefix.length) {
          xml += <span class="hljs-string">'&lt;/'</span> + namespacePrefix + <span class="hljs-string">':'</span> + key + <span class="hljs-string">'&gt;'</span>;
        } <span class="hljs-keyword">else</span> {
          xml += <span class="hljs-string">'&lt;/'</span>+key+<span class="hljs-string">'&gt;'</span>;
        }
      }
    }    
    <span class="hljs-keyword">return</span> xml;
  }

  <span class="hljs-comment">// Client Configuration</span>
  <span class="hljs-keyword">var</span> config = extend({
    endpoint:<span class="hljs-string">'http://localhost'</span>,
    targetNamespace: <span class="hljs-string">'http://localhost'</span>,
    envelopeBegin: <span class="hljs-string">'&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;soap:Envelope xmlns:ns0="PLACEHOLDER" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/"&gt;&lt;soap:Body&gt;'</span>,
    envelopeEnd: <span class="hljs-string">'&lt;/soap:Body&gt;&lt;/soap:Envelope&gt;'</span>
  },_options);

  <span class="hljs-comment">// Invoke a web service</span>
  <span class="hljs-keyword">this</span>.invoke = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_soapAction,_body,_callback</span>) </span>{    
    <span class="hljs-comment">//Build request body </span>
    <span class="hljs-keyword">var</span> body = _body;

    <span class="hljs-comment">//Allow straight string input for XML body - if not, build from object</span>
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> body !== <span class="hljs-string">'string'</span>) {
      body = <span class="hljs-string">'&lt;ns0:'</span>+_soapAction+<span class="hljs-string">'&gt;'</span>;
      body += convertToXml(_body, <span class="hljs-string">'ns0'</span>);
      body += <span class="hljs-string">'&lt;/ns0:'</span>+_soapAction+<span class="hljs-string">'&gt;'</span>;
    }

    <span class="hljs-keyword">var</span> ebegin = config.envelopeBegin;
    config.envelopeBegin = ebegin.replace(<span class="hljs-string">'PLACEHOLDER'</span>, config.targetNamespace);

    <span class="hljs-comment">//Build Soapaction header - if no trailing slash in namespace, need to splice one in for soap action</span>
    <span class="hljs-keyword">var</span> soapAction = <span class="hljs-string">''</span>;
    <span class="hljs-keyword">if</span> (config.targetNamespace.lastIndexOf(<span class="hljs-string">'/'</span>) != config.targetNamespace.length - <span class="hljs-number">1</span>) {
      soapAction = config.targetNamespace+<span class="hljs-string">'/'</span>+_soapAction;
    }
    <span class="hljs-keyword">else</span> {
      soapAction = config.targetNamespace+_soapAction;
    }

    <span class="hljs-comment">//POST XML document to service endpoint</span>
    <span class="hljs-keyword">var</span> xhr = getXHR();
    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
      _callback.call(<span class="hljs-keyword">this</span>, xmlDomFromString(<span class="hljs-keyword">this</span>.responseText));
    };
    xhr.open(<span class="hljs-string">'POST'</span>,config.endpoint);
        xhr.setRequestHeader(<span class="hljs-string">'Content-Type'</span>, <span class="hljs-string">'text/xml'</span>);
        xhr.setRequestHeader(<span class="hljs-string">'SOAPAction'</span>, soapAction);
        xhr.send(config.envelopeBegin+body+config.envelopeEnd);
  };
};
<span class="hljs-built_in">module</span>.exports = webService;
</code></pre><p><code>app.js</code></p>
<pre><code class="hljs">    <span class="hljs-keyword">var</span> webService = <span class="hljs-built_in">require</span>(<span class="hljs-string">'/lib/webService'</span>);

    <span class="hljs-keyword">var</span> callWebService = <span class="hljs-keyword">new</span> webService({endpoint : <span class="hljs-string">'http://www.service.com/service'</span>,targetNamespace: <span class="hljs-string">'http://tempuri.org/'</span>});


<span class="hljs-keyword">var</span> win = Ti.UI.createWindow();
<span class="hljs-keyword">var</span> picker = Ti.UI.createPicker();

win.add(picker);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getData</span>(<span class="hljs-params"></span>)</span>{
    <span class="hljs-keyword">var</span> data = [];

    <span class="hljs-keyword">var</span> callParams = {
        strQuery: <span class="hljs-string">'select ID,TITLE from menu'</span>,
        strRootNode: <span class="hljs-string">'_'</span>,
        strItemNode: <span class="hljs-string">'res'</span>
    };

    callWebService.invoke(<span class="hljs-string">'getDataXML'</span>, callParams, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">xmlDoc</span>)</span>{
        <span class="hljs-keyword">var</span> results = xmlDoc.documentElement.getElementsByTagName(<span class="hljs-string">"res"</span>);
        <span class="hljs-keyword">if</span> (results &amp;&amp; results.length&gt;<span class="hljs-number">0</span>){
            <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;results.length; i++){
                <span class="hljs-keyword">var</span> item = results.item(i);
                <span class="hljs-keyword">var</span> _id = item.getElementsByTagName(<span class="hljs-string">'ID'</span>).item(<span class="hljs-number">0</span>).text,
                    _title = item.getElementsByTagName(<span class="hljs-string">'TITLE'</span>).item(<span class="hljs-number">0</span>).text;

                row = Ti.UI.createPickerRow({
                    title: _title
                });

                data[i] = row;
            }
        }

        Ti.API.info(data.length) <span class="hljs-comment">// results 6</span>
        picker.add(data);
    });    
};

win.open();
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="January 10th 2013, 10:21:10 pm">January 10th 2013</span>
											by <span class='authorname'>Efrain Hernandez Caballero</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Wow you were generous when you said &quot;something like this&quot;, this is using soap to return XML rather than simple httpClient call for JSON.  You are also creating a very cross platform system that uses elements outside of titanium and is pure HTML.</p>
<p>You either know what you are doing or have glued lots of code together and are hoping for the best.  I will assume you know what you are doing.</p>
<ul>
<li><p>What does <strong>_title</strong> return?  Add an extra <strong>Ti.API.info</strong> line inside the loop and confirm it returns back what you expect.</p>
</li>
<li><p>Can you (for testing only) move these lines of code;</p>
</li>
</ul>
<pre><code class="hljs">var picker = Ti.UI.createPicker()<span class="hljs-comment">;</span>
win.add(picker)<span class="hljs-comment">;</span>
</code></pre><p>Below</p>
<pre><code class="hljs"><span class="hljs-tag">Ti</span><span class="hljs-class">.API</span><span class="hljs-class">.info</span>(<span class="hljs-tag">data</span><span class="hljs-class">.length</span>);
<span class="hljs-tag">picker</span><span class="hljs-class">.add</span>(<span class="hljs-tag">data</span>);
</code></pre><p>Still want to know those other answers.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 10th 2013, 10:51:08 pm">January 10th 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
