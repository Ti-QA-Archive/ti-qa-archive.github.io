<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>File upload speed » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>File upload speed</h1>
		</header>
		<section>
			<p>My app uploads an image to my own Rails web service. It is safe to say that the upload process is much faster in the simulator than in the device. I&#39;m trying to find ways that I can improve this.</p>
<p>I assume that the primary factor is the network connection. The simulator uses my ethernet connection, while the device uses 3G. Is device memory also a potential issue?</p>
<p>It seems like other apps transfer files much faster. Would sockets be faster than XHR on a single POST request? I would think they would be the same.</p>
<p>I appreciate any suggestions you might have regarding upload performance, thanks!</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="November 13th 2011, 10:17:11 pm">November 13th 2011</span>
				by <span class='authorname'>Micah Alcorn</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>device</span></li>
					
						<li><span class='tagname'>file</span></li>
					
						<li><span class='tagname'>image</span></li>
					
						<li><span class='tagname'>simulator</span></li>
					
						<li><span class='tagname'>xhr</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>I think the only way to know for sure if 3G is the culprit is to get your device to connect to a wifi network connected to broadband assuming your development PC is on broadband giving you this speed on your simulator device. For me, upload speed on my broadband connection isn&#39;t much better than 3G. If you could somehow install a broadband speed test app on your simulator and test device, for true speed comparison you would know for sure.</p>
</div>
							<div class="author">
								&mdash; commented <span title="November 13th 2011, 10:28:24 pm">November 13th 2011</span>
								by <span class='authorname'>Darren Adams</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>So assuming that it is, is there anything I can do to optimize?</p>
</div>
							<div class="author">
								&mdash; commented <span title="November 13th 2011, 10:44:51 pm">November 13th 2011</span>
								by <span class='authorname'>Micah Alcorn</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-223257">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>What are you uploading? How big are the images and what are you benchmarking against when you say the uploads are slow?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 13th 2011, 11:04:49 pm">November 13th 2011</span>
								by <span class='authorname'>Aaron Saunders</span><br>
								<a class="icon-bg icon-link" href="question/128178/file-upload-speed.html#answer-223257" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Currently I am uploading photos from iPhone, which I guess could range from 2-8MPs. The 5MP version is +&#x2F;-4.4MB. My benchmark is just experience using other photo sharing apps. My uploads from the device sometimes approach one minute, which is my XHR timeout(60000). This just seems to be entirely too long in my experience. More importantly, I plan to add video in a future version, which will become much more of a problem.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 13th 2011, 11:16:53 pm">November 13th 2011</span>
											by <span class='authorname'>Micah Alcorn</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>What other photo sharing apps? Are they uploading the full high mega pixel photo to the server?</p>
<p>There are plenty of apps out there that have been developed using appcelerator that uploads photos and videos to facebook &amp; twitter successfully; I dont think this is really a platform&#x2F;framework issue, it is more of an architecture issue… it is simply going to take a long time to upload a fullsize photo with from your iphone, sometimes it just is what it is.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 13th 2011, 11:21:22 pm">November 13th 2011</span>
											by <span class='authorname'>Aaron Saunders</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Got it, thanks. Would compression be a potential cure? Do you know of any libraries or Titanium examples off hand? I saw that there is a Plus Module for zipping, but I have read that zipping video does not help much.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 13th 2011, 11:25:08 pm">November 13th 2011</span>
											by <span class='authorname'>Micah Alcorn</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>compression is not going to work, I think you are over thinking this one… I have written a few apps that involved uploading files&#x2F;photos and Appceleartor works fine, you just need to upload smaller versions of the image.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 13th 2011, 11:38:16 pm">November 13th 2011</span>
											by <span class='authorname'>Aaron Saunders</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-223713">
				
						<section>
							<p>i have found my uploads from an iphone device tend to take around 45-60 seconds over WIFI. Do you mind me asking if you have any issues uploading over 3G on the device. My photo uploading app works fine over WIFI but i get no response with an xhr request on 3G, so it would be extremely helpful to know if you have got it working so i can tell if it&#39;s an issue with my code or Titanium itself?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 18th 2011, 9:51:10 pm">November 18th 2011</span>
								by <span class='authorname'>Jon Odell</span><br>
								<a class="icon-bg icon-link" href="question/128178/file-upload-speed.html#answer-223713" rel="permalink">permalink</a>
							</div>

							<h5>7 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Works 75% of the time over 3G. Sometimes it loses the connection for some reason. When it does work, the speed is very unpredictable.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 18th 2011, 10:01:50 pm">November 18th 2011</span>
											by <span class='authorname'>Micah Alcorn</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Thanks Micah. Would you be able to do me a massive favour and have a quick look through the below code for my upload function in my iPhone app. Like i said it works perfect over WIFI but over a 3G network nothing gets sent at all, is there anything obvious or that you would change that may fix it? I desperately need this to work, even if it is only 75% of the time..</p>
<p>(full code can be seen here: http:&#x2F;&#x2F;pastie.org&#x2F;private&#x2F;obmdcgokkxt2nsulz0xmg)</p>
<pre><code class="hljs"><span class="hljs-comment">//Upload function - start once image selected in handle image event</span>
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">upload</span><span class="hljs-params">(media_file)</span></span>{
  Ti.App.idleTimerDisabled = <span class="hljs-literal">false</span>; 
  Ti.App.idleTimerDisabled = <span class="hljs-literal">true</span>;

  <span class="hljs-keyword">var</span> xhr = Titanium.Network.createHTTPClient();
  xhr.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
    Ti.API.info(<span class="hljs-string">'IN ERROR '</span> + e.error);
  };
  xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    Ti.API.info(<span class="hljs-string">'DONE! - IN ONLOAD '</span> + <span class="hljs-keyword">this</span>.status + <span class="hljs-string">' readyState '</span> + <span class="hljs-keyword">this</span>.readyState);
    Ti.App.idleTimerDisabled = <span class="hljs-literal">false</span>;
  };
   xhr.onsendstream = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
    Ti.API.info(<span class="hljs-string">'in onsendstream : progress:'</span>+e.progress+<span class="hljs-string">' - : status '</span>+<span class="hljs-keyword">this</span>.status+<span class="hljs-string">'  readystate:'</span>+<span class="hljs-keyword">this</span>.readyState);
  };

   <span class="hljs-keyword">var</span> endPoint = <span class="hljs-string">'http://www.xxxxxx.com/testing/titanium_upload.php'</span>;

   xhr.enableKeepAlive=<span class="hljs-literal">false</span>;
   xhr.setTimeout(<span class="hljs-number">1000000</span>);

  xhr.open(<span class="hljs-string">'POST'</span>,endPoint);

  xhr.send({server_filename:itemNumber, userfile:media_file});
}
<span class="hljs-comment">////</span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="November 18th 2011, 10:09:09 pm">November 18th 2011</span>
											by <span class='authorname'>Jon Odell</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Are you getting an error message? Your timeout seems to be entirely too long. Mine is 60000 which is probably unnecessary. I don&#39;t know anything about <code>enableKeepAlive</code> other than what others have posted here. I don&#39;t know if it would affect 3G. You might also try adding some feedback via the <code>onsendstream</code> callback to see if it is losing connection, or never making it.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 18th 2011, 10:24:17 pm">November 18th 2011</span>
											by <span class='authorname'>Micah Alcorn</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Oh sorry, I overlooked your onsendstream somehow.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 18th 2011, 10:25:22 pm">November 18th 2011</span>
											by <span class='authorname'>Micah Alcorn</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>i had set the timeout so high after trying numerous different amounts, including 60000 (1 minute). I get no error messages in the console, and i do get the onsendstream callback show up in there but my PHP script shows the values that are sent within xhr.send as empty over a 3G connection so they just don&#39;t seem to send. If i was to send a basic variable or string then it works, but as soon as i try and send an image it fails (have tried loads of different file sizes including 150bytes so size shouldn&#39;t be causing it) </p>
<p>Could i ask what iphone ios sdk you are using? And if possible are you able to post a snippet of the code you are using on your upload function so i could test it and check if it works my end?</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 18th 2011, 11:53:41 pm">November 18th 2011</span>
											by <span class='authorname'>Jon Odell</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>But it works fine with wifi? It sounds to me like you have a server-side issue, but I guess not if wifi is working. I would think that you would need to specify the request header, but I am not using php. With Rails it is necessary and I also have to carefully construct my parameters. Not sure how much help this will be, but here is my function:</p>
<pre><code class="hljs">otg.remote.createPhoto = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(candidate)</span> </span>{
    <span class="hljs-keyword">if</span> (isBusy===<span class="hljs-literal">false</span>) {
        isBusy = <span class="hljs-literal">true</span>;
        <span class="hljs-keyword">var</span> filePath = Ti.Filesystem.getFile(Ti.Filesystem.tempDirectory,candidate.fileStamp + <span class="hljs-string">'.png'</span>);
        <span class="hljs-keyword">var</span> tempFile = filePath.read();
        <span class="hljs-keyword">var</span> api_token = Ti.App.Properties.getString(<span class="hljs-string">'api_token'</span>);
          <span class="hljs-keyword">var</span> params = {
              <span class="hljs-string">'api_token'</span>:api_token,
              <span class="hljs-string">'photo[caption]'</span>:candidate.caption,
              <span class="hljs-string">'photo[image]'</span>:tempFile,
              <span class="hljs-string">'photo[file_stamp]'</span>:candidate.fileStamp
          };
          <span class="hljs-keyword">var</span> xhr = Titanium.Network.createHTTPClient();
          xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.status===<span class="hljs-number">201</span>) {
                <span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span>;i&lt;uploadsQueue.length;i++) {
                    <span class="hljs-keyword">if</span> (uploadsQueue[i].fileStamp===candidate.fileStamp) {
                        uploadsQueue.splice(i,<span class="hljs-number">1</span>);
                    }
                }
                otg.ui.confirmation(candidate);
                otg.device.removeFile(candidate.fileStamp);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// Not sure why this would happen. //</span>
                otg.recall = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                    otg.device.processUploads();
                };
                otg.remote.handleResponse(<span class="hljs-keyword">this</span>.status);
            }
            isBusy = <span class="hljs-literal">false</span>;
            pinged = <span class="hljs-literal">false</span>;
          };
          xhr.setTimeout(<span class="hljs-number">60000</span>);
          xhr.onsendstream = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
              <span class="hljs-keyword">var</span> upload = {};
              upload.id = candidate.fileStamp;
              upload.progress = e.progress;
            otg.ui.streamProgress(upload);
          };
        xhr.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
            otg.recall = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                otg.device.processUploads();
            };
            otg.remote.handleResponse(<span class="hljs-keyword">this</span>.status);
            isBusy = <span class="hljs-literal">false</span>;
          };
          xhr.open(<span class="hljs-string">'POST'</span>, domain + <span class="hljs-string">'/photos'</span>);
          xhr.setRequestHeader(<span class="hljs-string">"Content-Type"</span>,<span class="hljs-string">"multipart/form-data"</span>);
          xhr.send(params);
      } <span class="hljs-keyword">else</span> {
          otg.device.processUploads();
      }
};
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="November 19th 2011, 12:01:31 am">November 19th 2011</span>
											by <span class='authorname'>Micah Alcorn</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Yep there isn&#39;t a problem when uploading to the server over WIFI, only 3G fails, which is odd. Thanks for posting this, your right as it may not be useful as it uses Rails and not PHP but i&#39;ll see if i can adapt it. I&#39;ll definately try adding a requestHeader to the xhr</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 19th 2011, 12:11:25 am">November 19th 2011</span>
											by <span class='authorname'>Jon Odell</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
