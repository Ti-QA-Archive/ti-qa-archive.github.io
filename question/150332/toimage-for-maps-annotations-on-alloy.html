<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>toImage() for maps annotations on Alloy » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>toImage() for maps annotations on Alloy</h1>
		</header>
		<section>
			<p>Hey there.</p>
<p>I&#39;m trying to make a custom annotation image using a view and the toImage() method. However, I can&#39;t find a way to make it work properly. I&#39;m trying to accomplish this with Alloy, SDK 3.0.2 and testing it on Android.</p>
<p>Here&#39;s some code:</p>
<p>something.xml:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> annotationView = Alloy.createController(<span class="hljs-string">'annotation'</span>).getView();
<span class="hljs-keyword">var</span> annotation = Titanium.<span class="hljs-built_in">Map</span>.createAnnotation({
    <span class="hljs-comment">// ...</span>
    image: annotationView.toImage()
});
</code></pre><p>annotation.xml:</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">Alloy</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">View</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">ImageView</span> <span class="hljs-attribute">image</span>=<span class="hljs-value">"/images/no_avatar.png"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">View</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">Alloy</span>&gt;</span>
</code></pre><p>Am I missing something?</p>
<p>Thanks in advance!</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="April 2nd 2013, 4:30:24 am">April 2nd 2013</span>
				by <span class='authorname'>Demostenes Garcia</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>alloy</span></li>
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>annotation</span></li>
					
						<li><span class='tagname'>toimage</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-259792">
				
						<section>
							<p>hi,</p>
<p>try this one..</p>
<pre><code class="hljs"><span class="hljs-tag">image</span>: <span class="hljs-tag">annotationView</span><span class="hljs-class">.toImage</span>()<span class="hljs-class">.media</span>;
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 2nd 2013, 4:41:32 am">April 2nd 2013</span>
								by <span class='authorname'>Mitul Bhalia</span><br>
								<a class="icon-bg icon-link" href="question/150332/toimage-for-maps-annotations-on-alloy.html#answer-259792" rel="permalink">permalink</a>
							</div>

							<h5>25 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>I thought this would work, after I read that <code>toImage()</code> method returns and object, not a Blob. However, it didn&#39;t work at all :-&#x2F;.</p>
<p>Tried without Alloy, but it didn&#39;t work as well.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 2nd 2013, 11:16:48 pm">April 2nd 2013</span>
											by <span class='authorname'>Demostenes Garcia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>but for android we should use the above because when you stringify <strong>annotationView.toImage()</strong> then you come to know exactly.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 3rd 2013, 4:03:37 am">April 3rd 2013</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Mitul, tried both <code>annotationView.toImage().media</code> and <code>annotationView.toImage()</code> with no luck.</p>
<p>Not sure if the issue is concerning on the children views or if this is a bug related to Android itself.</p>
<p>Did you have any chance to try to recreate the issue?</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 3rd 2013, 2:54:00 pm">April 3rd 2013</span>
											by <span class='authorname'>Demostenes Garcia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>ok, try one more time.</p>
<p>this time just add <strong>annotationView</strong> in your current window and then try to get toImage().media.<br>and also set backgroundColor of annotationView so it helps you to know that view is created.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 4th 2013, 2:46:44 am">April 4th 2013</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I made the following:</p>
<pre><code class="hljs">&lt;View id=<span class="hljs-string">"annotation"</span> backgroundColor=<span class="hljs-string">"red"</span> <span class="hljs-variable">height</span>=<span class="hljs-string">"50dp"</span> <span class="hljs-variable">width</span>=<span class="hljs-string">"50dp"</span>&gt;
    &lt;ImageView <span class="hljs-built_in">image</span>=<span class="hljs-string">"/images/no_avatar.png"</span> <span class="hljs-variable">width</span>=<span class="hljs-string">"45dp"</span> <span class="hljs-variable">height</span>=<span class="hljs-string">"45dp"</span> /&gt;
&lt;/View&gt;
&lt;View id=<span class="hljs-string">"mapview"</span> ns=<span class="hljs-string">"Ti.Map"</span> mapType=<span class="hljs-string">"Ti.Map.STANDARD_TYPE"</span> animate=<span class="hljs-string">"true"</span> regionFit=<span class="hljs-string">"true"</span> userLocation=<span class="hljs-string">"true"</span> /&gt;
</code></pre><p>but <strong><a href="http:&#x2F;&#x2F;d.pr&#x2F;i&#x2F;JrFa">this is how it looks</a></strong>. Really odd how the children views are not visible at all.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 4th 2013, 3:27:49 am">April 4th 2013</span>
											by <span class='authorname'>Demostenes Garcia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>ok, are you setting remote url to imageView…?</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 4th 2013, 3:34:24 am">April 4th 2013</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Mitul. Nope, as shown in the code, is a local image (<code>image=&amp;#39;&amp;#x2F;images&amp;#x2F;no_avatar.png&amp;#39;</code>).</p>
<p>Thanks in advance!</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 4th 2013, 3:36:07 am">April 4th 2013</span>
											by <span class='authorname'>Demostenes Garcia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>ok, have you checked image path..?</p>
<p>where you put <strong>no_avatar.png</strong> image..?</p>
<p>if you create a custom images folder then try to put the image in <strong>app&#x2F;assets&#x2F;android</strong> folder and then set it like..</p>
<pre><code class="hljs">&lt;ImageView <span class="hljs-built_in">image</span>=<span class="hljs-string">"no_avatar.png"</span> <span class="hljs-variable">width</span>=<span class="hljs-string">"45dp"</span> <span class="hljs-variable">height</span>=<span class="hljs-string">"45dp"</span> /&gt;
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="April 4th 2013, 3:49:13 am">April 4th 2013</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Yep, I triple-checked the paths: <a href="http:&#x2F;&#x2F;d.pr&#x2F;i&#x2F;JrFa">http:&#x2F;&#x2F;d.pr&#x2F;i&#x2F;JrFa</a>.</p>
<p>And then I add the annotation like <code>$.annotation.toImage().media</code></p>
</p>
										<div class="author">
											&mdash; commented <span title="April 4th 2013, 3:51:28 am">April 4th 2013</span>
											by <span class='authorname'>Demostenes Garcia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>but i suspect that there is a path problem. ok just set imageview&#39;s backgroundColor so that we exactly know that imageview is added or not..</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 4th 2013, 3:54:30 am">April 4th 2013</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>This is the result: <a href="http:&#x2F;&#x2F;d.pr&#x2F;i&#x2F;3J0h">http:&#x2F;&#x2F;d.pr&#x2F;i&#x2F;3J0h</a></p>
<p>I added a blue background just to check if the image was properly added. It is added on the regular view (up) but not on the annotation (down)</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 4th 2013, 4:18:30 am">April 4th 2013</span>
											by <span class='authorname'>Demostenes Garcia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>so as said , its the problem of path …. right..?</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 4th 2013, 4:21:45 am">April 4th 2013</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I&#39;ll recheck the paths tomorrow in the very morning and let you know (it&#39;s 2 am here, hehe).</p>
<p>Thanks A LOT for your support Mitul!</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 4th 2013, 4:37:44 am">April 4th 2013</span>
											by <span class='authorname'>Demostenes Garcia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>ok, no problem.<br>anytime.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 4th 2013, 4:45:22 am">April 4th 2013</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Mitul, tried everything, even tried with a remote image but I have the same result: both boxes, the red and the blue one, are shown. :-&#x2F;</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 4th 2013, 10:54:26 pm">April 4th 2013</span>
											by <span class='authorname'>Demostenes Garcia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>ok, first try to add this view in window and see image is shown or not….if you can see image then try to get annotation image in on load evetn of image</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 5th 2013, 3:12:06 am">April 5th 2013</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I have created the view  to display the map. And in the bottom of the map there is one button. When<br>user click on that button it will take the screenshot &#x2F; take the image of the map. It is working fine in iOS but in android it will capture black image rather then the proper image of the map.</p>
<p>Find the below is my code.. Below function will display the map.</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">GetCurrentLocation</span>(<span class="hljs-params"></span>)</span>{
        Titanium.Geolocation.getCurrentPosition(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{
            <span class="hljs-keyword">if</span> (e.error){
                alert(<span class="hljs-string">'HFL cannot get your current location'</span>);
                _CallBack();
                <span class="hljs-comment">/*mapview = Map.createView({
                    mapType: Map.SATELLITE_TYPE,
                    region: {latitude: 39.9319917, longitude: -104.8842739, latitudeDelta:0.01, longitudeDelta:0.01},
                    animate:true,
                    regionFit:true,
                    userLocation:true
                });
                MapsLoaded = true;
                 ContainerView.add(mapview);
                CreateGrid();*/</span>
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-keyword">var</span> longitude = e.coords.longitude;
            <span class="hljs-keyword">var</span> latitude = e.coords.latitude;
            mapview = <span class="hljs-built_in">Map</span>.createView({
                mapType: <span class="hljs-built_in">Map</span>.SATELLITE_TYPE,
                region: {latitude: latitude, longitude: longitude, latitudeDelta:<span class="hljs-number">0.01</span>, longitudeDelta:<span class="hljs-number">0.01</span>},
                animate:<span class="hljs-literal">true</span>,
                regionFit:<span class="hljs-literal">true</span>,
                userLocation:<span class="hljs-literal">true</span>
            });
            <span class="hljs-comment">// mapview = Ti.UI.createView();</span>
            <span class="hljs-comment">//mapview.setBackgroundImage("/images/bg.png");</span>
            MapsLoaded = <span class="hljs-literal">true</span>;
             ContainerView.add(mapview);
            CreateGrid();
        });
    }
</code></pre><p>=========================</p>
<p>Below code is use to take the screenshot &#x2F; capture the map as image and saved. Image is in the proper<br>place  but in android it save as a black image.</p>
<pre><code class="hljs"><span class="hljs-keyword">this</span>.SaveImage = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">var</span> _storage = Ti.Filesystem.getFile(Ti.Filesystem.getExternalStorageDirectory()).getParent().nativePath;
  <span class="hljs-keyword">var</span> file = Titanium.Filesystem.getFile(_storage , <span class="hljs-string">'Downloads'</span>, <span class="hljs-string">'mapview.png'</span>);
  file.write(mapview.toImage().media);
}
</code></pre><p>I have also used the below code but the result is same in android.</p>
<pre><code class="hljs">
Ti.Media.takeScreenshot(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(<span class="hljs-keyword">event</span>)</span><span class="hljs-comment">{

   Ti.Media.saveToPhotoGallery(mapview.toImage().media);
}</span>);</span>
</code></pre><p>How can I get this to work?</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 14th 2015, 7:12:54 am">May 14th 2015</span>
											by <span class='authorname'>ishit vohra</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I do not know what is the problem because at first look, your code should work but if it doesn&#39;t then you can use another method to take image and that is <a href="http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;3.0&#x2F;#!&#x2F;api&#x2F;Modules.Map.View-method-snapshot">snapshot</a>.<br>Try this method and let me know what happened.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 14th 2015, 9:16:56 am">May 14th 2015</span>
											by <span class='authorname'>Rhys Maddocks</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Its Mitul Bhalia not Rhys Maddocks. :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 14th 2015, 9:18:57 am">May 14th 2015</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>mitul, can you please give example how to use snapshot method.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 14th 2015, 10:10:03 am">May 14th 2015</span>
											by <span class='authorname'>ishit vohra</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>can someone please explain how it work?</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 14th 2015, 10:24:35 am">May 14th 2015</span>
											by <span class='authorname'>ishit vohra</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I haven not used yet..but its very easy. Have you read the doc carefully? Its already defined there.<br>You need to use it with event listener so when you fire this method, you can catch the blob image from that event listener.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 15th 2015, 4:02:17 am">May 15th 2015</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Mitul,</p>
<p>Thanks for your answer.  Find the below code that we use and successfully store the map image as<br>we want using the snapshot method.</p>
<pre><code class="hljs">
<span class="hljs-keyword">this</span>.SaveImage = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">var</span> _storage = Ti.Filesystem.getFile(Ti.Filesystem.getExternalStorageDirectory()).getParent().nativePath;
  <span class="hljs-keyword">var</span> file = Titanium.Filesystem.getFile(_storage , <span class="hljs-string">'Downloads'</span>, <span class="hljs-string">'mapview.png'</span>);

   mapview.snapshot();

   mapview.addEventListener(<span class="hljs-string">"onsnapshotready"</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{

         file.write(e.snapshot);

   });                            

}
</code></pre><p>Again thank you very much.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 15th 2015, 10:39:35 am">May 15th 2015</span>
											by <span class='authorname'>ishit vohra</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi,</p>
<p>I want to create Annotations with different color. I have use tintcolor and pincolor but its not works and i have hex color code like #00400E , #004005 etc.</p>
<p>Any one have any idea that how to create different Annotations with different color.</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 3rd 2015, 9:34:56 am">June 3rd 2015</span>
											by <span class='authorname'>ishit vohra</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi,</p>
<p>I want to create Annotations with different color. I have use tintcolor and pincolor but its not works and i have hex color code like #00400E , #004005 etc.</p>
<p>Any one have any idea that how to create different Annotations with different color in  <strong>android</strong>.</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 3rd 2015, 9:45:27 am">June 3rd 2015</span>
											by <span class='authorname'>ishit vohra</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-259791">
				
						<section>
							<p>Hello Demostenes,</p>
<p>You can try like this :</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> annotationView = Alloy.createController(<span class="hljs-string">'annotation'</span>).getView();
<span class="hljs-keyword">var</span> annotation = Titanium.<span class="hljs-built_in">Map</span>.createAnnotation({
    <span class="hljs-comment">// ...</span>
    image: annotationView
});
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 2nd 2013, 4:33:21 am">April 2nd 2013</span>
								by <span class='authorname'>Jigar Maheshwari</span><br>
								<a class="icon-bg icon-link" href="question/150332/toimage-for-maps-annotations-on-alloy.html#answer-259791" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Jigar. This answer is basically the same code that I provided.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 3rd 2013, 2:54:48 pm">April 3rd 2013</span>
											by <span class='authorname'>Demostenes Garcia</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-1</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
