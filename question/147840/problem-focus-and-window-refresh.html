<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>problem focus and window refresh » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>problem focus and window refresh</h1>
		</header>
		<section>
			<p>Hello,</p>
<p>I have a window which displays member information with an edit button.<br>When I click edit I open a modal form in full and once I close the form and return to my page.</p>
<p>the information has been updated but the old ones are always displayed below that is unreadable. Is this focus is bad, I do not understand</p>
<p>My code:</p>
<pre><code class="hljs">Ti.include(<span class="hljs-string">'../database.js'</span>);
var win = Titanium.UI.currentWindow;
win.backgroundImage =<span class="hljs-string">'../iphone/images/bg.png'</span>;
win.barColor = <span class="hljs-string">'#502C22'</span>;

function getInfos(){



var base = db.execute(<span class="hljs-string">'SELECT * FROM User'</span>);
var results = [];



    <span class="hljs-keyword">while</span>(base.isValidRow()){

    var baseNom = base.fieldByName(<span class="hljs-string">'Nom'</span>);
    <span class="hljs-keyword">if</span> (baseNom === <span class="hljs-keyword">null</span>){
        var baseNom = <span class="hljs-string">'Non reseigné'</span>;

    }
    var basePrenom = base.fieldByName(<span class="hljs-string">'Prenom'</span>);
    <span class="hljs-keyword">if</span> (basePrenom  === <span class="hljs-keyword">null</span>){
        var basePrenom  = <span class="hljs-string">'Non reseigné'</span>;

    }
    var baseDept = base.fieldByName(<span class="hljs-string">'Dept'</span>);
    <span class="hljs-keyword">if</span> (baseDept === <span class="hljs-keyword">null</span>){
        var baseDept = <span class="hljs-string">'Non reseigné'</span>;

    }
    var baseEmail= base.fieldByName(<span class="hljs-string">'Email'</span>);
    <span class="hljs-keyword">if</span> (baseEmail === <span class="hljs-keyword">null</span>){
        var baseEmail = <span class="hljs-string">'Non reseigné'</span>;

    }
    var baseTelephone = base.fieldByName(<span class="hljs-string">'Telephone'</span>);
    <span class="hljs-keyword">if</span> (baseTelephone === <span class="hljs-keyword">null</span>){
        var baseTelephone = <span class="hljs-string">'Non reseigné'</span>;

    }

    base.next();
    }




    var fiche = Titanium.UI.createView({
    <span class="hljs-variable">height</span>: <span class="hljs-number">300</span>,
    <span class="hljs-variable">width</span>: <span class="hljs-number">300</span>,
    top: <span class="hljs-number">0</span>,
    left: <span class="hljs-number">10</span>,
    <span class="hljs-comment">//backgroundColor: '#FFF',</span>
    <span class="hljs-comment">//borderRadius: 5</span>
    });

    var avatar = Titanium.UI.createImageView({
    <span class="hljs-built_in">image</span>:<span class="hljs-string">'../imgs/avatar.png'</span>,
    <span class="hljs-variable">width</span>:<span class="hljs-number">127</span>,
    <span class="hljs-variable">height</span>:<span class="hljs-number">150</span>,
    left: <span class="hljs-number">10</span>,
    top: <span class="hljs-number">20</span>

    });
    fiche.<span class="hljs-built_in">add</span>(avatar);
    win.<span class="hljs-built_in">add</span>(fiche);

    var Nom = Titanium.UI.createLabel({

    <span class="hljs-variable">height</span>: <span class="hljs-number">30</span>,
    <span class="hljs-variable">width</span>: <span class="hljs-number">300</span>,
    top: <span class="hljs-number">20</span>,
    left: <span class="hljs-number">150</span>,
    font: {fontSize:<span class="hljs-number">13</span>, fontWeight: <span class="hljs-string">'bold'</span>},
     <span class="hljs-built_in">color</span>: <span class="hljs-string">'#0173BC'</span>,
    <span class="hljs-built_in">text</span>: <span class="hljs-string">'Nom: '</span>+ baseNom
    });
    win.<span class="hljs-built_in">add</span>(Nom);

    var Prenom = Titanium.UI.createLabel({
    <span class="hljs-variable">height</span>: <span class="hljs-number">30</span>,
    <span class="hljs-variable">width</span>: <span class="hljs-number">300</span>,
    top: <span class="hljs-number">50</span>,
    left: <span class="hljs-number">150</span>,
    font: {fontSize:<span class="hljs-number">13</span>, fontWeight: <span class="hljs-string">'bold'</span>},
     <span class="hljs-built_in">color</span>: <span class="hljs-string">'#0173BC'</span>,
    <span class="hljs-built_in">text</span>: <span class="hljs-string">'Prénom: '</span>+ basePrenom
    });
    win.<span class="hljs-built_in">add</span>(Prenom);

    var Dept = Titanium.UI.createLabel({
    <span class="hljs-variable">height</span>: <span class="hljs-number">30</span>,
    <span class="hljs-variable">width</span>: <span class="hljs-number">300</span>,
    top: <span class="hljs-number">80</span>,
    left: <span class="hljs-number">150</span>,
    font: {fontSize:<span class="hljs-number">13</span>, fontWeight: <span class="hljs-string">'bold'</span>},
     <span class="hljs-built_in">color</span>: <span class="hljs-string">'#0173BC'</span>,
    <span class="hljs-built_in">text</span>: <span class="hljs-string">'Dépt: '</span>+ baseDept
    });
    win.<span class="hljs-built_in">add</span>(Dept);

    var Email = Titanium.UI.createLabel({
    <span class="hljs-variable">height</span>: <span class="hljs-number">30</span>,
    <span class="hljs-variable">width</span>: <span class="hljs-number">160</span>,
    top: <span class="hljs-number">110</span>,
    left: <span class="hljs-number">150</span>,
    font: {fontSize:<span class="hljs-number">13</span>, fontWeight: <span class="hljs-string">'bold'</span>},
     <span class="hljs-built_in">color</span>: <span class="hljs-string">'#0173BC'</span>,
    <span class="hljs-built_in">text</span>: <span class="hljs-string">'Email: '</span>+ baseEmail
    });
    win.<span class="hljs-built_in">add</span>(Email);

    var Telephone = Titanium.UI.createLabel({
    <span class="hljs-variable">height</span>: <span class="hljs-number">30</span>,
    <span class="hljs-variable">width</span>: <span class="hljs-number">300</span>,
    top: <span class="hljs-number">140</span>,
    left: <span class="hljs-number">150</span>,
    font: {fontSize:<span class="hljs-number">13</span>, fontWeight: <span class="hljs-string">'bold'</span>},
     <span class="hljs-built_in">color</span>: <span class="hljs-string">'#0173BC'</span>,
    <span class="hljs-built_in">text</span>: <span class="hljs-string">'Tél: '</span>+ baseTelephone
    });
    win.<span class="hljs-built_in">add</span>(Telephone);


<span class="hljs-comment">//}//and if</span>




    <span class="hljs-comment">// message d'explication</span>
    var Explication = Titanium.UI.createLabel({
    <span class="hljs-variable">height</span>: <span class="hljs-string">'auto'</span>,
    <span class="hljs-variable">width</span>: <span class="hljs-number">280</span>,
    top: <span class="hljs-number">200</span>,
    left: <span class="hljs-number">20</span>,
    font: {fontSize:<span class="hljs-number">13</span>, fontWeight: <span class="hljs-string">'normal'</span>},
     <span class="hljs-built_in">color</span>: <span class="hljs-string">'#502C22'</span>,
    <span class="hljs-built_in">text</span>: <span class="hljs-string">'Afin de vous éviter de remplir à chaque fois le formulaire de demande de devis, vos données sont sauvergardées puis transmisent automatiquement aux partenaires que vous sélectionnez. '</span>,
    });
    win.<span class="hljs-built_in">add</span>(Explication );


    <span class="hljs-comment">//bouton effacer</span>
    var boutonEffacer = Titanium.UI.createButton({
    title:<span class="hljs-string">'Supprimer'</span>,<span class="hljs-comment">//le nom du bouton</span>
    font: {fontSize:<span class="hljs-number">18</span>, fontWeight: <span class="hljs-string">'bold'</span>},
    backgroundImage:<span class="hljs-string">'../iphone/images/boutonM.png'</span>,
    <span class="hljs-variable">width</span>:<span class="hljs-number">280</span>,<span class="hljs-comment">//taille en largeur du champ</span>
    <span class="hljs-variable">height</span>:<span class="hljs-number">37</span>,<span class="hljs-comment">// taille de la hauteur du champ</span>
    top:<span class="hljs-number">365</span>,
    <span class="hljs-comment">//top:250,// On place le textfiled à 180 px du haut de la fenêtre</span>
    left:<span class="hljs-number">20</span><span class="hljs-comment">// Position par rapport à la gauche    </span>

    })
    win.<span class="hljs-built_in">add</span>(boutonEffacer);



    boutonEffacer.addEventListener(<span class="hljs-string">'click'</span>,function(e){
    deleteUser();
    Ti.UI.createAlertDialog({message:<span class="hljs-string">'Vos informations ont bien été supprimées !'</span>}).show();

    var base = db.execute(<span class="hljs-string">'SELECT  Nom,Prenom,Dept,Email,Telephone FROM User'</span>);
    var results = [];
    win.close();    
    });

    <span class="hljs-comment">//bouton modifier</span>
    var boutonModifier= Titanium.UI.createButton({
    title:<span class="hljs-string">'Modifier'</span>,
    font: {fontSize:<span class="hljs-number">18</span>, fontWeight: <span class="hljs-string">'bold'</span>},
    backgroundImage:<span class="hljs-string">'../iphone/images/bouton.png'</span>,
    <span class="hljs-variable">width</span>:<span class="hljs-number">280</span>,<span class="hljs-comment">//taille en largeur du champ</span>
    <span class="hljs-variable">height</span>:<span class="hljs-number">37</span>,<span class="hljs-comment">// taille de la hauteur du champ</span>
    top:<span class="hljs-number">315</span>,
    <span class="hljs-comment">//top:290,// On place le textfiled à 180 px du haut de la fenêtre</span>
    left:<span class="hljs-number">20</span>

    })
    win.<span class="hljs-built_in">add</span>(boutonModifier);



    boutonModifier.addEventListener(<span class="hljs-string">'click'</span>,function(e){
    var win1 = Titanium.UI.createWindow({    
    title: <span class="hljs-string">'Formulaire'</span>,
    url:<span class="hljs-string">'modifier.js'</span>,
    <span class="hljs-variable">height</span>:<span class="hljs-number">440</span>,
    barImage: <span class="hljs-string">'../iphone/images/navbar2.png'</span>,

    });

    var btn1 = Titanium.UI.createButton({
        <span class="hljs-variable">width</span>:<span class="hljs-number">51</span>,
        <span class="hljs-variable">height</span>: <span class="hljs-number">30</span>,
        backgroundImage:<span class="hljs-string">'../iphone/images/bouton_retour.png'</span>,
    });

    win1.setLeftNavButton(btn1);

    btn1.addEventListener(<span class="hljs-string">'click'</span>,function(e)
    {
        win1.close();

    });

    <span class="hljs-comment">//win1.open({modal:true});</span>
    win1.<span class="hljs-built_in">open</span>({modal:<span class="hljs-keyword">true</span>,modalTransitionStyle:Ti.UI.iPhone.MODAL_TRANSITION_STYLE_FLIP_HORIZONTAL});

    });
<span class="hljs-comment">//}</span>
}<span class="hljs-comment">//     fin getInfos</span>
win.addEventListener(<span class="hljs-string">'focus'</span>, getInfos);
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="February 4th 2013, 2:11:35 pm">February 4th 2013</span>
				by <span class='authorname'>patrice aschenbrenner</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>focus</span></li>
					
						<li><span class='tagname'>ghost records</span></li>
					
						<li><span class='tagname'>refresh result</span></li>
					
						<li><span class='tagname'>refresh window</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p><code>the old ones are always displayed below that is unreadable</code> - not quite sure what this means. maybe a better description or a screenshot would help.</p>
</div>
							<div class="author">
								&mdash; commented <span title="February 4th 2013, 2:26:46 pm">February 4th 2013</span>
								by <span class='authorname'>Anthony Decena</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-256062">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>It looks like you are repeatedly adding the labels to the window. So, each time you get focus, you are adding another set of labels over the top of the last. This is what is making the text look strange.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 4th 2013, 3:54:46 pm">February 4th 2013</span>
								by <span class='authorname'>Nick Milner</span><br>
								<a class="icon-bg icon-link" href="question/147840/problem-focus-and-window-refresh.html#answer-256062" rel="permalink">permalink</a>
							</div>

							<h5>9 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>ok so how do you refresh the window ?</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 4th 2013, 4:12:17 pm">February 4th 2013</span>
											by <span class='authorname'>patrice aschenbrenner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>if i delete the focus and the getInfos function the database are refresh  but do not refresh the window.<br>I must to close the window and open it again.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 4th 2013, 4:17:10 pm">February 4th 2013</span>
											by <span class='authorname'>patrice aschenbrenner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Create the labels etc and save them in variables in module scope (ie outside of the function). Do this only once. Then just update the values each time in your focus loop using the variables you stored the label in</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 4th 2013, 4:32:17 pm">February 4th 2013</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Sorry but could you give me an example please</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 4th 2013, 4:44:55 pm">February 4th 2013</span>
											by <span class='authorname'>patrice aschenbrenner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>A cut down example</p>
<pre><code class="hljs">Ti.<span class="hljs-keyword">include</span>(<span class="hljs-string">'../database.js'</span>);
<span class="hljs-keyword">var</span> win = Titanium.UI.currentWindow;

<span class="hljs-keyword">var</span> Nom;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initWindow</span><span class="hljs-params">(win)</span>
</span>{

   Nom = Titanium.UI.createLabel({ 
    height: <span class="hljs-number">30</span>,
    width: <span class="hljs-number">300</span>,
    top: <span class="hljs-number">20</span>,
    left: <span class="hljs-number">150</span>,
    font: {fontSize:<span class="hljs-number">13</span>, fontWeight: <span class="hljs-string">'bold'</span>},
    color: <span class="hljs-string">'#0173BC'</span>,
    });

    win.add(Nom);

}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInfos</span><span class="hljs-params">()</span></span>{

 <span class="hljs-keyword">var</span> base = db.execute(<span class="hljs-string">'SELECT * FROM User'</span>);
<span class="hljs-keyword">var</span> results = [];

<span class="hljs-keyword">var</span> baseNom ;


    <span class="hljs-keyword">if</span>(base.isValidRow()){

    baseNom = base.fieldByName(<span class="hljs-string">'Nom'</span>);

   <span class="hljs-keyword">if</span> (baseNom === <span class="hljs-literal">null</span>){
        baseNom = <span class="hljs-string">'Non reseigné'</span>;
    }

  }

    Nom.text = baseNom; 


}<span class="hljs-comment">//  fin getInfos</span>


initWindow(win);

win.addEventListener(<span class="hljs-string">'focus'</span>, getInfos);
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="February 6th 2013, 10:32:51 am">February 6th 2013</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Thank you for you example. i tried this code but there are one error:<br>message = &#39;undefined&#39; is not an object (evaluating &#39;Nom.text = baseNom&#39;);</p>
<p>Do you see where is the error  ?</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 6th 2013, 11:25:19 am">February 6th 2013</span>
											by <span class='authorname'>patrice aschenbrenner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Sorry it&#39;s ok that work perfectly.</p>
<p> thank you very very very much ; )</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 6th 2013, 11:33:08 am">February 6th 2013</span>
											by <span class='authorname'>patrice aschenbrenner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>If you feel this has answered your question then mark is as anwered so that others can find it.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 6th 2013, 12:08:43 pm">February 6th 2013</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>ok</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 6th 2013, 12:39:28 pm">February 6th 2013</span>
											by <span class='authorname'>patrice aschenbrenner</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-256228">
				
						<section>
							<p>toc toc toc there are nobody for help me ?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 6th 2013, 10:10:57 am">February 6th 2013</span>
								by <span class='authorname'>patrice aschenbrenner</span><br>
								<a class="icon-bg icon-link" href="question/147840/problem-focus-and-window-refresh.html#answer-256228" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-256283">
				
						<section>
							<p>How can i find variable whith tis code ?</p>
<p>You use Nom.text = baseNom for send the var at the label &#39;Nom&quot; as text ok.</p>
<p>But I must to get a variable for use in another sql query</p>
<p>ex : </p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getInfos</span><span class="hljs-params">()</span></span>{

<span class="hljs-keyword">var</span> base = db.execute(<span class="hljs-string">'SELECT * FROM User'</span>);
<span class="hljs-keyword">var</span> results = [];

<span class="hljs-keyword">var</span> baseNom ;
<span class="hljs-keyword">var</span> baseDept ;

    <span class="hljs-keyword">if</span>(base.isValidRow()){

    baseNom = base.fieldByName(<span class="hljs-string">'Nom'</span>);
    baseDept = base.fieldByName(<span class="hljs-string">'Dept'</span>);



  }

    Nom.text = baseNom; 


}<span class="hljs-comment">//  fin getInfos</span>

<span class="hljs-comment">// i must get baseDept for check it</span>

<span class="hljs-keyword">if</span> ( baseDept != <span class="hljs-string">'77'</span>)
{
 alert ( <span class="hljs-string">' it'</span>s no possible<span class="hljs-string">');
 }</span>
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 7th 2013, 6:25:11 am">February 7th 2013</span>
								by <span class='authorname'>patrice aschenbrenner</span><br>
								<a class="icon-bg icon-link" href="question/147840/problem-focus-and-window-refresh.html#answer-256283" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
