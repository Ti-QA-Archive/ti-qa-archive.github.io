<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Ti.include on Android after main load does not have global scope » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Ti.include on Android after main load does not have global scope</h1>
		</header>
		<section>
			<p>I found out the hard way that files &quot;lazy&quot; loaded with Ti.include after the main app loads, do not have access to the global namespace and therefore is pretty much useless for that purpose. So I am using this tasty little treat instead.</p>
<pre><code class="hljs">eval<span class="hljs-list">(<span class="hljs-keyword">String</span><span class="hljs-list">(<span class="hljs-keyword">Ti</span>.Filesystem.getFile<span class="hljs-list">(<span class="hljs-quoted">'filename</span>.js')</span>.read<span class="hljs-list">()</span>)</span>)</span><span class="hljs-comment">;</span>
</code></pre><p>Maybe someone else will find this helpful.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="July 22nd 2011, 1:17:36 pm">July 22nd 2011</span>
				by <span class='authorname'>Dan Frist</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>global namespace</span></li>
					
						<li><span class='tagname'>include</span></li>
					
						<li><span class='tagname'>lazy load</span></li>
					
						<li><span class='tagname'>ti.include</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Had exactly the same issue.. Really nasty fix, but awesome that you sorted it…</p>
</div>
							<div class="author">
								&mdash; commented <span title="September 28th 2011, 12:06:30 pm">September 28th 2011</span>
								by <span class='authorname'>Trevor Ward</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>2</span> Votes</div>
			<div class="answers"><span>4</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>4 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-214078">
				
						<section>
							<p>Can you give an example of what you&#39;re calling &quot;lazy loading&quot;?  eval() is slower than Ti.include and should be avoided if possible.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 22nd 2011, 1:28:33 pm">July 22nd 2011</span>
								by <span class='authorname'>Kevin Whinnery</span><br>
								<a class="icon-bg icon-link" href="question/123045/tiinclude-on-android-after-main-load-does-not-have-global-scope#answer-214078" rel="permalink">permalink</a>
							</div>

							<h5>10 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>By &quot;lasy loading&quot; I mean loading a js file with js objects (like windows and views) after the app has loaded and only when the user wants to go there. It makes the app start faster and keeps memory clear until&#x2F;unless it&#39;s really needed.</p>
<p><a href="http:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Lazy_loading">http:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Lazy_loading</a></p>
<p>Btw, Ti.include works fine for this in iOS. :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 22nd 2011, 1:34:18 pm">July 22nd 2011</span>
											by <span class='authorname'>Dan Frist</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>You ought to be able to Ti.include scripts on demand on Android as well - I really would like to see your code if you don&#39;t mind (or if you could put together an example of a Ti.include call which isn&#39;t working as you expect).</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 22nd 2011, 5:21:40 pm">July 22nd 2011</span>
											by <span class='authorname'>Kevin Whinnery</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Dan, </p>
<p>I&#39;m having the same type of issue as well.  Mostly an issue on the Android platform.  Had to rewrite a lot coding and restructure…</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 22nd 2011, 9:26:55 pm">July 22nd 2011</span>
											by <span class='authorname'>Vinh Bui</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Seriously fellas, I would like to help if I can!  Ti.include really ought to work just fine in most cases.  If you can show examples of where it fails I can help you troubleshoot.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 22nd 2011, 9:30:57 pm">July 22nd 2011</span>
											by <span class='authorname'>Kevin Whinnery</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>app.js </p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> tabGroup = Titanium.UI.createTabGroup();

<span class="hljs-keyword">var</span> <span class="hljs-keyword">win</span> = Titanium.UI.createWindow({  
    title:'<span class="hljs-keyword">Tab</span>',
});

<span class="hljs-keyword">var</span> <span class="hljs-keyword">tab</span> = Titanium.UI.createTab({  
    title:'<span class="hljs-keyword">Tab</span>',
    <span class="hljs-keyword">window</span>: <span class="hljs-keyword">win</span>
});

<span class="hljs-keyword">var</span> <span class="hljs-keyword">label</span> = Titanium.UI.createLabel({
    text:'Click Me'
});

<span class="hljs-keyword">var</span> global_variable = 'This is a <span class="hljs-keyword">global</span> variable';

<span class="hljs-keyword">label</span>.addEventListener('click', function() {
    Ti.<span class="hljs-keyword">include</span>('another_file.js');
    <span class="hljs-comment">//eval(String(Ti.Filesystem.getFile('another_file.js').read()));</span>
    Ti.API.info(variable);
});

<span class="hljs-keyword">win</span>.add(<span class="hljs-keyword">label</span>);

tabGroup.addTab(<span class="hljs-keyword">tab</span>);  

tabGroup.<span class="hljs-keyword">open</span>();
</code></pre><p>&lt;br&gt;<br>another_file.js</p>
<pre><code class="hljs">
var <span class="hljs-annotation">variable</span> = <span class="hljs-string">'something'</span>;

Ti.API.info(global<span class="hljs-number">_</span><span class="hljs-annotation">variable</span>);
</code></pre><p>&lt;br&gt;<br>Results:</p>
<p>Message: ReferenceError: &quot;global_variable&quot; is not defined. (file:&#x2F;&#x2F;&#x2F;android_asset&#x2F;Resources&#x2F;another_file.js#3)</p>
<p>Followed by:</p>
<p>Message: ReferenceError: &quot;variable&quot; is not defined. (file:&#x2F;&#x2F;&#x2F;android_asset&#x2F;Resources&#x2F;app.js#20)</p>
<p>&lt;br&gt;<br>Then if you use my eval line, it works as expected.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 25th 2011, 1:54:22 pm">July 25th 2011</span>
											by <span class='authorname'>Dan Frist</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>On my Droid 2 running Android 2.2 (Froyo) and Titanium Mobile 1.7.2, your code works unchanged.  What environment are you seeing problems with?</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 25th 2011, 3:48:55 pm">July 25th 2011</span>
											by <span class='authorname'>Kevin Whinnery</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Android 2.3.4, Titanium Mobile 1.7.2</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 25th 2011, 3:51:39 pm">July 25th 2011</span>
											by <span class='authorname'>Dan Frist</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Device or emulator?</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 25th 2011, 3:53:08 pm">July 25th 2011</span>
											by <span class='authorname'>Kevin Whinnery</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Oh, sorry, device. (The emulator running 2.3.3 is really wacky with FastDev.)</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 25th 2011, 3:54:49 pm">July 25th 2011</span>
											by <span class='authorname'>Dan Frist</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I am also having issues with this, Kevin, any updates?</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 22nd 2011, 7:55:09 pm">November 22nd 2011</span>
											by <span class='authorname'>andrew royce</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-214329">
				
						<section>
							<p>Downloading required Android updates to take a look.  I also rarely use the emulator only because poking around it is so slow, and doesn&#39;t accurate reflect how the app will look and feel.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 25th 2011, 4:27:35 pm">July 25th 2011</span>
								by <span class='authorname'>Kevin Whinnery</span><br>
								<a class="icon-bg icon-link" href="question/123045/tiinclude-on-android-after-main-load-does-not-have-global-scope#answer-214329" rel="permalink">permalink</a>
							</div>

							<h5>10 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Yeah, the Android emulator sucks compared to just about every other emulator&#x2F;simulator I&#39;ve used (except maybe BlackBerry, lol).</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 25th 2011, 4:30:15 pm">July 25th 2011</span>
											by <span class='authorname'>Dan Frist</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>whoops, meant to put that in a comment.  :&#x2F;</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 25th 2011, 4:31:07 pm">July 25th 2011</span>
											by <span class='authorname'>Kevin Whinnery</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I too am having a similar issue, but having a hard time getting it into a small use case. In my case, I am wondering if because some of my include files are large (about 400 lines) Titanium is not fully loading them before calling the lines of code immediately following them. However, like the original poster changing to eval seems to work.</p>
<p>Can anyone comment on how &quot;synchronous&quot; Ti.include is?</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 27th 2011, 2:20:42 pm">July 27th 2011</span>
											by <span class='authorname'>Mike Robinson</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Kevin, I finally found a weird use case related to this problem. Can you comment on why this is happening the way it is?</p>
<p><a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;124003&#x2F;android-tiinclude-works-on-tableview-not-from-main-window">Use case question</a></p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2011, 3:57:30 pm">August 9th 2011</span>
											by <span class='authorname'>Vinh Bui</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I don&#39;t know why Ti.include doesn&#39;t work in android after the initial load of the app. But I do know how to get around it. :)</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">include</span><span class="hljs-params">(target)</span> </span>{
    <span class="hljs-comment">// All targets are relative to Resources/ folder</span>
    <span class="hljs-keyword">if</span>(isAndroid){
        <span class="hljs-keyword">eval</span>(String(Ti.Filesystem.getFile(target+<span class="hljs-string">'_'</span>).read()));
        <span class="hljs-comment">// I think this works too...but I haven't tried it. </span>
        <span class="hljs-comment">// eval(Ti.Filesystem.getFile(target+'_').read().text);</span>
    }
    <span class="hljs-keyword">else</span> {
        Ti.<span class="hljs-keyword">include</span>(<span class="hljs-string">'/'</span>+target);
    }
}

<span class="hljs-keyword">include</span>(<span class="hljs-string">'filename.js'</span>);
</code></pre><p>For why I add the &quot;_&quot; in Android, see <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;123773&#x2F;titaniumfilesystemgetfile-not-working-when-in-production-state">this thread</a>. </p>
<p>Basically I rename all the .js files to .js_ (with Mac automator it&#39;s easy) before deploying to Android Market so that Titanium doesn&#39;t convert them to byte code like it wants to. The app is fast. No problems with eval for me. Of course I&#39;d rather not have to use it. :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2011, 4:23:52 pm">August 9th 2011</span>
											by <span class='authorname'>Dan Frist</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Dan, have you tried setting the compile js property in your TiApp.xml to false? Looking at the build script it appears to evaluate this even during production builds. It might be easer than renaming all of your files all of the time.</p>
<pre><code class="hljs">&lt;<span class="hljs-keyword">property</span> <span class="hljs-property">name</span>=<span class="hljs-string">"ti.android.compilejs"</span> type=<span class="hljs-string">"bool"</span>&gt;<span class="hljs-constant">false</span>&lt;/<span class="hljs-keyword">property</span>&gt;
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="August 9th 2011, 4:30:54 pm">August 9th 2011</span>
											by <span class='authorname'>Mike Robinson</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Cool, no I didn&#39;t know about that. I&#39;ll try that. Thanks Mike! :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2011, 4:32:16 pm">August 9th 2011</span>
											by <span class='authorname'>Dan Frist</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hmm, got </p>
<pre><code class="hljs">E/<span class="hljs-function"><span class="hljs-title">TiApplication</span><span class="hljs-params">(  <span class="hljs-number">823</span>)</span></span>: (main) [<span class="hljs-number">148</span>,<span class="hljs-number">206</span>] APP PROXY: [Ti.App]
D/<span class="hljs-function"><span class="hljs-title">KrollContext</span><span class="hljs-params">(  <span class="hljs-number">823</span>)</span></span>: (kroll$<span class="hljs-number">1</span>: app:<span class="hljs-comment">//app.js) [22,228] Running pre-compiled script: app.js</span>
E/<span class="hljs-function"><span class="hljs-title">KrollContext</span><span class="hljs-params">(  <span class="hljs-number">823</span>)</span></span>: (kroll$<span class="hljs-number">1</span>: app:<span class="hljs-comment">//app.js) [0,228] Couldn't find pre-compiled class for script: app.js</span>
E/<span class="hljs-function"><span class="hljs-title">KrollContext</span><span class="hljs-params">(  <span class="hljs-number">823</span>)</span></span>: java<span class="hljs-class">.lang</span><span class="hljs-class">.ClassNotFoundException</span>: com<span class="hljs-class">.iwbnin</span><span class="hljs-class">.js</span><span class="hljs-class">.app</span>
</code></pre><p>when I added</p>
<pre><code class="hljs">&lt;<span class="hljs-keyword">property</span> <span class="hljs-property">name</span>=<span class="hljs-string">"ti.android.compilejs"</span> type=<span class="hljs-string">"bool"</span>&gt;<span class="hljs-constant">false</span>&lt;/<span class="hljs-keyword">property</span>&gt;
</code></pre><p>to my tiapp.xml</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2011, 4:49:31 pm">August 9th 2011</span>
											by <span class='authorname'>Dan Frist</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I typically use that property to force compiling while in development, so I am usually setting true, but it did look like the build script reads &amp; respects it in production compiles as well.</p>
<p>While I cannot say that it works, did you do a complete clean before recompiling? I could see that causing an issue.</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2011, 5:26:38 pm">August 9th 2011</span>
											by <span class='authorname'>Mike Robinson</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Yeah, I did.</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2011, 5:28:53 pm">August 9th 2011</span>
											by <span class='authorname'>Dan Frist</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-221584">
				
						<section>
							<p>I can confirm that this problem exists in both SDK 1.7.2 and 1.7.3.</p>
<p>If the include is the main part of the JS file, everything works fine, but if the include is moved to a function, the global variable scope is lost on Android. </p>
<p>Very easy to reproduce:</p>
<p>File 1.js:</p>
<p>Ti.API.info(&#39;This is 1.js. Hello=&#39;  + hello);</p>
<p>File App.js: (change addEventListener in the default app)</p>
<p>label1.addEventListener(&#39;click&#39;, function()<br>{<br>   Ti.include(&#39;1.js&#39;);<br>}</p>
<p>This results in<br>[ERROR] ReferenceError: &quot;hello&quot; is not defined. (file:&#x2F;&#x2F;&#x2F;android_asset&#x2F;Resources&#x2F;1.js|)</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="October 22nd 2011, 12:58:32 pm">October 22nd 2011</span>
								by <span class='authorname'>Martin Israelsen</span><br>
								<a class="icon-bg icon-link" href="question/123045/tiinclude-on-android-after-main-load-does-not-have-global-scope#answer-221584" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-224030">
				
						<section>
							<p>Any Updates on this issue?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 22nd 2011, 7:47:10 pm">November 22nd 2011</span>
								by <span class='authorname'>andrew royce</span><br>
								<a class="icon-bg icon-link" href="question/123045/tiinclude-on-android-after-main-load-does-not-have-global-scope#answer-224030" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
