<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Is it still okay to use Ti.App? » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Is it still okay to use Ti.App?</h1>
		</header>
		<section>
			<p>Hi All,</p>
<p>I am working working around some of the memory issues I am having with 1.7.2.</p>
<p>I have shared database library, containing all DB calls.</p>
<p>In my testing I have moved the db object into app.js and assigned it to Ti.App.dbObj. This object is then used by the DB library, which is included in each of the many contexts my app uses. This avoids a new db object being created in each context.</p>
<p>Obviously I want to move to a single context app, but there is a lot rework that needs to be done (there are 30 windows and approximately 15k lines of code) so it will be a while coming.</p>
<p>In the mean time, doing this seems to have reduced the crashes to segfaults and made them significantly rarer. So what I&#39;d like to know is if this is safe to do with 1.7.2?</p>
<p>Any ideas?</p>
<p>Nick</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="September 3rd 2011, 1:07:29 pm">September 3rd 2011</span>
				by <span class='authorname'>Nick The Geek</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>1.7.2</span></li>
					
						<li><span class='tagname'>database</span></li>
					
						<li><span class='tagname'>ios</span></li>
					
						<li><span class='tagname'>mobile</span></li>
					
						<li><span class='tagname'>ti.app</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-218096">
				
						<section>
							<p>You can find some info here: <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;124742&#x2F;tiappfoobar-not-accessable-or-changeable">http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;124742&#x2F;tiappfoobar-not-accessable-or-changeable</a></p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 3rd 2011, 1:09:54 pm">September 3rd 2011</span>
								by <span class='authorname'>Ivan Škugor</span><br>
								<a class="icon-bg icon-link" href="../../question/125118/is-it-still-okay-to-use-tiapp.html#answer-218096" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Ivan,</p>
<p>thanks for that, I&#39;ve been reading all of the Q&amp;A questions on this matter.</p>
<p>I don&#39;t like global variables and avoid them at all costs, but I am a little stuck here. 1.7.2 seems to cause my app to crash. Putting the database object into Ti.App has significantly helped.</p>
<p>It seems that in the future using Ti.App will be completely phased out but there seems to have been very little guidance especially in timelines from Appcelerator on these issues cf. the major changes in 1.7.x from 1.6.x. </p>
<p>I might have distribute at 1.7.2 with a global db object and then re-write for an update.</p>
<p>Nick</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 3rd 2011, 1:19:43 pm">September 3rd 2011</span>
											by <span class='authorname'>Nick The Geek</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-218097">
				
						<section>
							<p>I don&#39;t see a problem with <strong>one</strong> global variable that would act as namespace. Ti.<em> (and Ti.App.</em>) is very similar concept. Global namespace variable is actually common practice in DOM environment and DOM based libraries&#x2F;frameworks. You shouldn&#39;t be confused with &quot;don&#39;t use global variables&quot; paradigm, I think better version of that paradigm is &quot;don&#39;t misuse global variables&quot;.</p>
<p>Anyway, I think that creating solution with bad practice is not good solution. Rewrite is what you need. :)</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 3rd 2011, 2:19:29 pm">September 3rd 2011</span>
								by <span class='authorname'>Ivan Škugor</span><br>
								<a class="icon-bg icon-link" href="../../question/125118/is-it-still-okay-to-use-tiapp.html#answer-218097" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Sorry, this should be a comment.</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 3rd 2011, 2:24:29 pm">September 3rd 2011</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-218099">
				
						<section>
							<p>While I would not recommend it for new development, it seems &quot;safe&quot; through SDK 1.7.2 if you have used it in existing projects.  You just need to be aware that <em>could</em> change anytime you try a new SDK build.  As long as you are aware of that and make sure you run proper unit tests when you change SDKs, in theory I think you would be &quot;safe&quot;.  If you make project changes and use the same SDK level you do now, I would not expect it to break.</p>
<p>That said, there is another way to stay multiple context and yet use a single DB object reference with pretty minimal changes to your code.  I would strongly suggest it is &quot;safer&quot; for future SDK levels because it should continue to work even if &#x2F; when polluting Ti.App with your own objects fails.</p>
<p>All you need to do is pass the DB object reference as a custom property on each window you create.  If I follow the question right, I think you do something like this now:</p>
<pre><code class="hljs"><span class="hljs-comment">// in app.js</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">db</span> = Ti.Database.<span class="hljs-keyword">open</span>('myDatabase');
Ti.<span class="hljs-keyword">App</span>.dbObj = <span class="hljs-keyword">db</span>;
<span class="hljs-keyword">var</span> newWindow = Ti.UI.createWindow({
    title: 'My Title',
    url: 'some.js'
});

<span class="hljs-comment">// in dbLibrary.js</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">db</span> = Ti.<span class="hljs-keyword">App</span>.dbObj;

<span class="hljs-comment">// in other window *.js</span>
<span class="hljs-keyword">include</span>(dbLibrary.js);
<span class="hljs-keyword">db</span>.execute(...);
</code></pre><p>Am I right?  If so, just change to something like this:</p>
<pre><code class="hljs"><span class="hljs-comment">// in app.js</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">db</span> = Ti.Database.<span class="hljs-keyword">open</span>('myDatabase');
<span class="hljs-keyword">var</span> newWindow = Ti.UI.createWindow({
    title: 'My Title',    
    url: 'some.js',
    dbObj: <span class="hljs-keyword">db</span>
});

<span class="hljs-comment">// in dbLibrary.js</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">db</span> = Ti.UI.currentWindow.dbObj;

<span class="hljs-comment">// in other window *.js</span>
<span class="hljs-keyword">include</span>(dbLibrary.js);
<span class="hljs-keyword">db</span>.execute(...);
</code></pre><p>As you can see, the code change is minimal yet you avoid polluting Ti.App with your own objects.  This should be more &quot;future proof&quot;.</p>
<p>Even better would be one more level of abstraction, putting the database object into a namespace then passing the namespace to each window.  That allows you to easily grow the number of objects &#x2F; properties passed:</p>
<pre><code class="hljs"><span class="hljs-comment">// in app.js</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">app</span> = {};
<span class="hljs-keyword">var</span> <span class="hljs-keyword">app</span>.dbObj = Ti.Database.<span class="hljs-keyword">open</span>('myDatabase');
<span class="hljs-keyword">var</span> newWindow = Ti.UI.createWindow({
    title: 'My Title',    
    url: 'some.js',
    myApp: <span class="hljs-keyword">app</span>
});

<span class="hljs-comment">// in dbLibrary.js</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">app</span> = Ti.UI.currentWindow.myApp;

<span class="hljs-comment">// in other window *.js</span>
<span class="hljs-keyword">include</span>(dbLibrary.js);
<span class="hljs-keyword">app</span>.dbObj.execute(...);
</code></pre><p>You can now add whatever you want to the app namespace and they essentially become global to your other contexts.  If you refer to app.dbObj directly you don&#39;t even need <code>var db = app.dbObj;</code> in dbLibrary.js, which may save a minor amount of memory in each new window.</p>
<p>If you prefer not to scan your *.js and replace db.method() with app.dbObj.method(), then you can still do similar to my second code block:</p>
<pre><code class="hljs"><span class="hljs-comment">// in dbLibrary.js</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">app</span> = Ti.UI.currentWindow.myApp;
<span class="hljs-keyword">var</span> <span class="hljs-keyword">db</span> = <span class="hljs-keyword">app</span>.dbObj;

<span class="hljs-comment">// in other window *.js</span>
<span class="hljs-keyword">include</span>(dbLibrary.js);
<span class="hljs-keyword">db</span>.execute(...);
</code></pre><p>Hope I explained that well enough to make it clear.</p>
<p>Bottom line is while I think what you are doing is relatively &quot;safe&quot; at SDK 1.7.2, my personal opinion is that you can make it &quot;safer&quot; with fairly trivial code changes while still using the multiple context paradigm.</p>
<p>IMHO.  YMMV.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 3rd 2011, 2:26:34 pm">September 3rd 2011</span>
								by <span class='authorname'>Doug Handy</span><br>
								<a class="icon-bg icon-link" href="../../question/125118/is-it-still-okay-to-use-tiapp.html#answer-218099" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Doug,</p>
<p>All of my db functions are in their own namespace.</p>
<p>If instance the db in app.js and then pass the whole object and name space around, each time i change context it throws this warning:</p>
<pre><code class="hljs">[WARN] Creating [<span class="hljs-tag">object</span> TiDatabase] <span class="hljs-keyword">in</span> <span class="hljs-tag">a</span> different context than the calling function.
</code></pre><p>So I was hesitant about doing this. Hence my question about Ti.App.</p>
<p>I&#39;ve started the process of a re-write to a single context but it will take a while.</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 3rd 2011, 11:06:44 pm">September 3rd 2011</span>
											by <span class='authorname'>Nick The Geek</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>That&#39;s because &quot;TiDatabase&quot; object is not JSON serializable. Should work, although.</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 4th 2011, 7:58:11 am">September 4th 2011</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
