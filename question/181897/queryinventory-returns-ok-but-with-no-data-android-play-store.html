<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>queryInventory returns ok, but with no data Android Play Store... » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>queryInventory returns ok, but with no data Android Play Store...</h1>
		</header>
		<section>
			<p>Hi all!</p>
<p>I can buy items just fine but queryInventory returns no inventory. The response from the play store server is &#39;okay&#39; and success: true and the code is 0, so I&#39;m getting a successful reply… It just has no items in it!</p>
<p>The products don&#39;t need to propagate to servers - They have been up for months, they contain a mixture of managed and unmanaged items and I can successfully purchase and consume them just fine.</p>
<pre><code class="hljs"><span class="hljs-tag">InAppBilling</span><span class="hljs-class">.queryInventory</span>(<span class="hljs-rules">{
    <span class="hljs-rule"><span class="hljs-attribute">moreItems</span>:<span class="hljs-value"> [<span class="hljs-string">'item'</span>]  
</span></span></span>});
</code></pre><p>or</p>
<pre><code class="hljs"><span class="hljs-tag">InAppBilling</span><span class="hljs-class">.queryInventory</span>(<span class="hljs-rules">{
}</span>);
</code></pre><pre><code class="hljs">queryComplete = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">queryResponse</span>)</span>{
    alert(<span class="hljs-built_in">JSON</span>.stringify(queryResponse)); <span class="hljs-comment">//  This displays the server response fine. There's no inventory though!</span>
};
</code></pre><p>Any advice would be gratefully received.</p>
<p>Many thanks in advance,</p>
<p>Robin</p>
<p>iab module: v3.0.0</p>
<p>Titanium Studio, build: 3.4.1.201410281727<br>(c) Copyright 2012-2014 by Appcelerator, Inc.  All rights reserved.</p>
<p>Build: jenkins-titanium-rcp-master-202 (origin&#x2F;master)<br>Date: 28 October 2014, 17:28:23</p>
<p>Building using SDK 2.5.1 (I need this later version for Facebook API v2.x support)</p>
<p>Windows 7 Ultimate, 64 Bit, SP 1.</p>
<p>Testing on a Samsung Galaxy S2</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="April 8th 2015, 9:22:36 am">April 8th 2015</span>
				by <span class='authorname'>Robin Williams</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>billing</span></li>
					
						<li><span class='tagname'>inappbilling</span></li>
					
						<li><span class='tagname'>inventory</span></li>
					
						<li><span class='tagname'>query</span></li>
					
						<li><span class='tagname'>queryinventory</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Gah! Sorry - that&#39;s built using SDK <em>3</em>.5.1 !</p>
</div>
							<div class="author">
								&mdash; commented <span title="April 8th 2015, 9:23:13 am">April 8th 2015</span>
								by <span class='authorname'>Robin Williams</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p><img src="http:&#x2F;&#x2F;img.photobucket.com&#x2F;albums&#x2F;v260&#x2F;evil_dr_fish&#x2F;Appcelerator%20Screenshots&#x2F;Query%20Complete_zpso9eckyxp.png" alt="Screenshot of Server Response"></p>
</div>
							<div class="author">
								&mdash; commented <span title="April 8th 2015, 10:40:38 am">April 8th 2015</span>
								by <span class='authorname'>Robin Williams</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-287031">
				
						<section>
							<p><em>bump</em> Anybody please?</p>
<p>This is one of the few bugs left in my game before being able to go for an initial release! :D</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 15th 2015, 3:05:23 pm">April 15th 2015</span>
								by <span class='authorname'>Robin Williams</span><br>
								<a class="icon-bg icon-link" href="question/181897/queryinventory-returns-ok-but-with-no-data-android-play-store.html#answer-287031" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Did you manage to solve this? I have exactly the same problem :(</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 2nd 2015, 11:28:06 am">June 2nd 2015</span>
											by <span class='authorname'>Nuno Donato</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Nuno,</p>
<p>Yes and no… Part user error on my part (or rather very unclear instructions on the part of the module) and partly to do with either the module or google…</p>
<p>So…<br>Where I went wrong:<br>The response you receive from google is an object that actually contains methods… trying to directly access the data will fail as above appearing to have no inventory…</p>
<p>HOWEVER if you access it using the correct method you will find there is actually the stuff you were expecting.</p>
<p>So… eg:</p>
<pre><code class="hljs">InAppBilling.addEventListener(<span class="hljs-string">'queryinventorycomplete'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{ queryComplete(e); });

<span class="hljs-comment">// after the queryinventorycomplete event is fired:</span>

queryComplete = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(queryResponse)</span></span>{

    <span class="hljs-keyword">var</span> items = [<span class="hljs-string">'product1'</span>,<span class="hljs-string">'product2'</span>,<span class="hljs-string">'product3'</span>,<span class="hljs-string">'product4'</span>];
    inventory = queryResponse.inventory;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, numberOfItems = items.length; i &lt; numberOfItems; i += <span class="hljs-number">1</span> ){
alert( items[i] + <span class="hljs-string">" : "</span> + inventory.hasDetails(items[i]) );

        <span class="hljs-keyword">if</span> (inventory.hasPurchase(items[i])){
            <span class="hljs-keyword">var</span> thisPurchase = inventory.getPurchase(items[i]);
            fulfilOrder(thisPurchase.productId, thisPurchase.purchaseState);
            InAppBilling.consume({ purchases: thisPurchase });
        };  <span class="hljs-comment">//  END if statement</span>

    };  <span class="hljs-comment">//  END For loop</span>

    numberOfItems = <span class="hljs-literal">null</span>;
    i = <span class="hljs-literal">null</span>;
    inventory = <span class="hljs-literal">null</span>;
    thisPurchase = <span class="hljs-literal">null</span>;
    items = <span class="hljs-literal">null</span>;

};  <span class="hljs-comment">//  END QUERY COMPLETE</span>
</code></pre><p>Now in all fairness to the example given in the module, this is how they show to do it… It would normally seem obvious to try to access it directly like I did in my original code snippet but you HAVE to access it via the <code>getPurchase()</code> method.</p>
<p>However there still some kind of error as when you do the query inventory, I find that it doesn&#39;t seem to return any items that have been &#39;consumed&#39;.</p>
<p>I need to know about in case someone is reinstalling the game in order to ensure they have their lifetime purchases (eg removing adverts for ever)! I&#39;m guessing, once again there is probably a gap in my knowledge but for now I will simply never &#39;consume&#39; certain items but it won&#39;t let me know that someone has consumed &quot;product x&quot; 7 times… I would need to update that product in the game that they had bought it many times already!</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 2nd 2015, 7:42:57 pm">June 2nd 2015</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
