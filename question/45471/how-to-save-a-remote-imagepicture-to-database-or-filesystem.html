<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>How to save a remote image/picture to database or filesystem » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>How to save a remote image/picture to database or filesystem</h1>
		</header>
		<section>
			<p>I create a remote imageview, I want to save the remote image to database or filesystem.<br>I tried this code:</p>
<hr>
<p>var img_url = &quot;http:&#x2F;&#x2F;www.google.com&#x2F;intl&#x2F;en_ALL&#x2F;images&#x2F;srpr&#x2F;logo1w.png&quot;;<br>var remote_image_view = Ti.UI.createImageView({<br>    url:img_url<br>});<br>var db = Ti.Database.open(&quot;imgdb4&quot;);<br>db.execute(&#39;CREATE TABLE IF NOT EXISTS DATABASETEST  (ID TEXT, IMAGE BLOB)&#39;);<br>db.execute(&#39;DELETE FROM DATABASETEST&#39;);</p>
<p>&#x2F;&#x2F;add a listener, when the remote img has been download:<br>remote_image_view.addEventListener(&quot;load&quot;,function(e){<br>    &#x2F;&#x2F;after download<br>    Ti.API.info(e.source.toBlob());&#x2F;&#x2F;output: [INFO] [object TiBlob]<br>    try{<br>        &#x2F;&#x2F;I tried use e.source.toBlob(), but looks not work<br>        db.execute(&#39;INSERT INTO DATABASETEST (ID, IMAGE) VALUES(?,?)&#39;,&quot;picture name&quot;,e.source.toBlob());<br>    }catch(E){<br>        &#x2F;&#x2F;I got error,<br>        alert(E);<br>    }<br>});<br>&#x2F;&#x2F;add imageview to the window</p>
<h2 id="ti-ui-currentwindow-add-remote_image_view-">Ti.UI.currentWindow.add(remote_image_view);</h2>
<p>var btn_show_db_image = Titanium.UI.createButton({<br>    title:&#39;I am a Button&#39;,<br>    width:200,<br>    height:40,<br>    top:60<br>});</p>
<p>btn_show_db_image.addEventListener(&quot;click&quot;,function(e){<br>    try{<br>        &#x2F;&#x2F;Try to retrive the image from database and use for another imageview<br>        var rows = db.execute(&#39;SELECT * FROM DATABASETEST&#39;);<br>        var db_image_view = Ti.UI.createImageView({<br>            image:rows.fieldByName(&#39;IMAGE&#39;).toBlob()<br>        });<br>        rows.close();<br>        Ti.UI.currentWindow.add(db_image_view);<br>    }catch(E){<br>        &#x2F;&#x2F;my app crashed<br>        alert(E);<br>    }</p>
<p>});<br>Ti.UI.currentWindow.add(btn_show_db_image);</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="July 23rd 2010, 3:30:45 am">July 23rd 2010</span>
				by <span class='authorname'>Ding Hua</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>blob</span></li>
					
						<li><span class='tagname'>database</span></li>
					
						<li><span class='tagname'>file</span></li>
					
						<li><span class='tagname'>image</span></li>
					
						<li><span class='tagname'>remote</span></li>
					
						<li><span class='tagname'>save</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>6</span> Votes</div>
			<div class="answers"><span>7</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>7 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-105321">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>I have a function made for this:</p>
<pre><code class="hljs">

<span class="actionscript"><span class="hljs-keyword">var</span> get_remote_file =  <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(filename, url, fn_end, fn_progress )</span> </span>{
    <span class="hljs-keyword">var</span> file_obj = {file:filename, url:url, path: <span class="hljs-literal">null</span>};

    <span class="hljs-keyword">var</span> file = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,filename);
    <span class="hljs-keyword">if</span> ( file.exists() ) {
        file_obj.path = Titanium.Filesystem.applicationDataDirectory+Titanium.Filesystem.separator;
        fn_end(file_obj);
    }
    <span class="hljs-keyword">else</span> {

        <span class="hljs-keyword">if</span> ( Titanium.Network.online ) {
            <span class="hljs-keyword">var</span> c = Titanium.Network.createHTTPClient();

            c.setTimeout(<span class="hljs-number">10000</span>);
            c.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>
            </span>{

                <span class="hljs-keyword">if</span> (c.status == <span class="hljs-number">200</span> ) {


                    <span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,filename);
                    f.write(<span class="hljs-keyword">this</span>.responseData);
                    file_obj.path = Titanium.Filesystem.applicationDataDirectory+Titanium.Filesystem.separator;
                }

                <span class="hljs-keyword">else</span> {
                    file_obj.error = <span class="hljs-string">'file not found'</span>; <span class="hljs-comment">// to set some errors codes</span>
                }
                fn_end(file_obj);

            };
            c.ondatastream = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
            </span>{

                <span class="hljs-keyword">if</span> ( fn_progress ) fn_progress(e.progress);
            };
            c.error = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
            </span>{

                file_obj.error = e.error;
                fn_end(file_obj);
            };
            c.open(<span class="hljs-string">'GET'</span>,url);
            c.send();            
        }
        <span class="hljs-keyword">else</span> {
            file_obj.error = <span class="hljs-string">'no internet'</span>;
            fn_end(file_obj);
        }


    }
};</span>
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="August 25th 2010, 12:09:57 am">August 25th 2010</span>
								by <span class='authorname'>Dan Tamas</span><br>
								<a class="icon-bg icon-link" href="question/45471/how-to-save-a-remote-imagepicture-to-database-or-filesystem#answer-105321" rel="permalink">permalink</a>
							</div>

							<h5>11 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>greate function! works perfect on Iphone, but Android failed :( with error: java.lang.NullPointerException:uriString </p>
<p>any ideas?</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 26th 2010, 8:08:05 am">August 26th 2010</span>
											by <span class='authorname'>Petr Cervenka</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I tried calling this function this way, but it didn&#39;t work. Can you assist?</p>
<p>get_remote_file(&#39;iphoneimage.jpg&#39;,&#39;http:&#x2F;&#x2F;nickbodmer.com&#x2F;temp&#x2F;iphoneimage.jpg&#39;);</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 3rd 2010, 1:58:07 am">December 3rd 2010</span>
											by <span class='authorname'>Nick Bodmer</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>can someone post a little example for this function?</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 20th 2010, 11:44:40 am">December 20th 2010</span>
											by <span class='authorname'>ben roe</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>absolutely great solution! thanks for that. take a beer ;)</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 23rd 2011, 6:47:30 am">January 23rd 2011</span>
											by <span class='authorname'>Sebastian Klaus</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>usage is like get_remote_file(&quot;file.txt&quot;, strCategoryFileUrl, Ti.API.info, null);</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2011, 10:30:11 am">March 16th 2011</span>
											by <span class='authorname'>Dirk Krause</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Thx for the Code, Dan!</p>
<p>I added a slight variation. My version has a boolean &#39;AlwaysLoad&#39;. If set to true, it assumes that there is an initial file that can be used while in offline mode, and always gets the current file from the server while online. If set to offline again, it uses the actual file.</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> get_remote_file = function(filename, url, fn_end, fn_progress, boolAlwaysload){
    <span class="hljs-keyword">var</span> file_obj = {
        <span class="hljs-keyword">file</span>: filename,
        url: url,
        path: null
    };

    <span class="hljs-keyword">var</span> <span class="hljs-keyword">file</span> = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory, filename);
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">file</span>.exists() &amp;&amp; !boolAlwaysload){
        file_obj.path = Titanium.Filesystem.applicationDataDirectory + Titanium.Filesystem.separator;
        fn_end(file_obj);
    }
    <span class="hljs-keyword">else</span>{
        <span class="hljs-keyword">if</span> (Titanium.Network.online){
            <span class="hljs-keyword">var</span> c = Titanium.Network.createHTTPClient();

            c.setTimeout(10000);
            c.onload = function()
            {

                <span class="hljs-keyword">if</span> (c.status == 200){
                    <span class="hljs-literal">log</span>('finished downloading ' + filename + ' from ' + url);

                    <span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory, filename);
                    f.write(this.responseData);
                    file_obj.path = Titanium.Filesystem.applicationDataDirectory + Titanium.Filesystem.separator;
                }

                <span class="hljs-keyword">else</span>{
                    file_obj.<span class="hljs-keyword">error</span> = '<span class="hljs-keyword">file</span> not found';
                    <span class="hljs-comment">// to set some errors codes</span>
                }
                fn_end(file_obj);

            };
            c.ondatastream = function(<span class="hljs-keyword">e</span>)
            {
                <span class="hljs-literal">log</span>('progress ' + filename + ':' + <span class="hljs-keyword">e</span>.progress);
                <span class="hljs-keyword">if</span> (fn_progress) fn_progress(<span class="hljs-keyword">e</span>.progress);
            };
            c.<span class="hljs-keyword">error</span> = function(<span class="hljs-keyword">e</span>)
            {
                <span class="hljs-literal">log</span>('<span class="hljs-keyword">error</span> ' + <span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span>);
                file_obj.<span class="hljs-keyword">error</span> = <span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span>;
                fn_end(file_obj);
            };
            c.<span class="hljs-keyword">open</span>('GET', url);
            c.send();
        }
        <span class="hljs-keyword">else</span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">file</span>.exists() &amp;&amp; boolAlwaysload){
                file_obj.path = Titanium.Filesystem.applicationDataDirectory + Titanium.Filesystem.separator;
                fn_end(file_obj);
            }
            <span class="hljs-keyword">else</span>
            {
                file_obj.<span class="hljs-keyword">error</span> = '<span class="hljs-keyword">no</span> internet';
                fn_end(file_obj);
            }
        }
    }
};
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 16th 2011, 10:35:28 am">March 16th 2011</span>
											by <span class='authorname'>Dirk Krause</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>It took me a little bit of time to figure out how this works, but here is a working app.js that you can plug into a new file and test with.</p>
<pre><code class="hljs"><span class="hljs-comment">/*
 * A good example of caching images to the device.
 */</span>


<span class="hljs-keyword">var</span> win = Ti.UI.createWindow();
win.addEventListener(<span class="hljs-string">"open"</span>, onOpen);
win.open();

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onOpen</span><span class="hljs-params">(e)</span></span>{    
    get_remote_file(<span class="hljs-string">"Wiki.png"</span>, <span class="hljs-string">"http://upload.wikimedia.org/wikipedia/en/b/bc/Wiki.png"</span>, onComplete, onProgress)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onComplete</span><span class="hljs-params">(file)</span></span>{
    <span class="hljs-keyword">var</span> img = Ti.UI.createImageView({
        image:  file.path + file.file
    });
    win.add(img);
}
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">onProgress</span><span class="hljs-params">(progress)</span></span>{
    TI.API.info(<span class="hljs-string">"progress being made "</span> + progress);
}


<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">get_remote_file</span><span class="hljs-params">(filename, url, fn_end, fn_progress )</span> </span>{
    <span class="hljs-keyword">var</span> file_obj = {file:filename, url:url, path: <span class="hljs-literal">null</span>};

    <span class="hljs-keyword">var</span> file = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,filename);
    <span class="hljs-keyword">if</span> ( file.exists() ) {
        file_obj.path = Titanium.Filesystem.applicationDataDirectory+Titanium.Filesystem.separator;
        fn_end(file_obj);
    }
    <span class="hljs-keyword">else</span> {

        <span class="hljs-keyword">if</span> ( Titanium.Network.online ) {
            <span class="hljs-keyword">var</span> c = Titanium.Network.createHTTPClient();

            c.setTimeout(<span class="hljs-number">10000</span>);
            c.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>
            </span>{

                <span class="hljs-keyword">if</span> (c.status == <span class="hljs-number">200</span> ) {


                    <span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,filename);
                    f.write(<span class="hljs-keyword">this</span>.responseData);
                    file_obj.path = Titanium.Filesystem.applicationDataDirectory+Titanium.Filesystem.separator;

                }<span class="hljs-keyword">else</span>{
                    file_obj.error = <span class="hljs-string">'file not found'</span>; <span class="hljs-comment">// to set some errors codes</span>
                }
                fn_end(file_obj);

            };
            c.ondatastream = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
            </span>{

                <span class="hljs-keyword">if</span> ( fn_progress ) fn_progress(e.progress);
            };
            c.error = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
            </span>{

                file_obj.error = e.error;
                fn_end(file_obj);
            };
            c.open(<span class="hljs-string">'GET'</span>,url);
            c.send();           
        }
        <span class="hljs-keyword">else</span> {
            file_obj.error = <span class="hljs-string">'no internet'</span>;
            fn_end(file_obj);
        }


    }
};
</code></pre><p>The file_object is passed to the fn_complete callback. while testing, be sure to delete the app from simulator, because if its already downloaded a file with the wrong data, or no image data, the next time you try to test, the file won&#39;t be re-downloaded.</p>
<p>Enjoy!<br>Aaron @codecommando</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 19th 2012, 4:00:20 pm">February 19th 2012</span>
											by <span class='authorname'>Digital Surgeons</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I really like this function, though it does not work on the actual device. I have tried other functions as well. Including ones I have made myself and while they all worked in the emulator, none work on the actual device.<br>does anybody know why?</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 27th 2012, 3:10:11 pm">February 27th 2012</span>
											by <span class='authorname'>brandon martin</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I&#39;m experiencing persistent problems with this function in any version after 1.8.<em>, including the new 2.</em> GA release. I&#39;d be really really appreciative if someone could shine any light on what could resolve this issue.. what I see happening (not happening rather) is that the onLoad() is not being fired - and the files don&#39;t appear to be saving.</p>
<p>I&#39;ve tried this with a blank project as well as in my fully fledged projects and it won&#39;t work after 1.8.* :( Doesn&#39;t seem to be synchronous anymore, is this because of the newer versions?</p>
<pre><code class="hljs">
<span class="hljs-keyword">var</span> win = Ti.UI.currentWindow;

<span class="hljs-keyword">var</span> appframeworkstorage = Titanium.Filesystem.applicationDataDirectory + <span class="hljs-string">'/'</span>;

<span class="hljs-keyword">var</span> get_remote_file = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">filename, url, forced, fn_end, fn_progress </span>)
</span>{
    <span class="hljs-keyword">var</span> file_obj = {file:filename, url:url, path: <span class="hljs-literal">null</span>};

    <span class="hljs-keyword">var</span> file = Titanium.Filesystem.getFile(appframeworkstorage,filename);
    <span class="hljs-keyword">if</span> (file.exists() &amp;&amp; forced == <span class="hljs-string">"0"</span>)
    {
        file_obj.path = appframeworkstorage;
        fn_end(file_obj);
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-keyword">if</span>(Titanium.Network.online)
        {
            <span class="hljs-keyword">var</span> c = Titanium.Network.createHTTPClient();
            c.setTimeout(<span class="hljs-number">10000</span>);
            c.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)
            </span>{
                alert(<span class="hljs-string">'onLoad'</span>);
                <span class="hljs-keyword">if</span> (c.status == <span class="hljs-number">200</span> )
                {
                    <span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(appframeworkstorage,filename);
                    f.write(<span class="hljs-keyword">this</span>.responseData);
                    f.remoteBackup = <span class="hljs-literal">false</span>;
                    file_obj.path = appframeworkstorage;
                    fn_end(file_obj);
                    <span class="hljs-keyword">if</span>(f.extension() == <span class="hljs-string">"zip"</span>)
                    {
                        <span class="hljs-keyword">var</span> zipfile = <span class="hljs-built_in">require</span>(<span class="hljs-string">"zipfile"</span>);
                        <span class="hljs-keyword">var</span> appDir = Ti.Network.decodeURIComponent(appframeworkstorage).replace(<span class="hljs-string">'file://localhost'</span>, <span class="hljs-string">''</span>);
                        zipfile.extract(appDir+filename, appDir);                                    
                        zipfile = <span class="hljs-literal">false</span>;
                        appDir = <span class="hljs-literal">false</span>;
                        f.deleteFile();
                    }
                    f = <span class="hljs-literal">false</span>;
                }
                <span class="hljs-keyword">else</span>
                {
                    file_obj.error = <span class="hljs-string">'file not found'</span>; <span class="hljs-comment">// to set some errors codes</span>
                    fn_end(file_obj);
                }
            };
            c.ondatastream = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)
            </span>{
                <span class="hljs-keyword">if</span> ( fn_progress ) 
                fn_progress(e.progress);
            };
            c.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)
            </span>{
                <span class="hljs-comment">//</span>
            };
            c.error = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)
            </span>{
                file_obj.error = e.error;
                fn_end(file_obj);
                alert(<span class="hljs-string">'Error with Download'</span>);
            };
            c.open(<span class="hljs-string">'GET'</span>,url, <span class="hljs-literal">false</span>);
            c.send();
            c = <span class="hljs-literal">false</span>;           
        }
        <span class="hljs-keyword">else</span>
        {
            file_obj.error = <span class="hljs-string">'no internet'</span>;
            fn_end(file_obj);
        }
    }
};

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> d=<span class="hljs-number">0</span>;d&lt;<span class="hljs-number">200</span>;d++)
{
    Ti.API.info(<span class="hljs-string">'Starting File Download '</span> + d);
    get_remote_file(
        <span class="hljs-string">'http://www.google.com'</span>,
        <span class="hljs-string">'test'</span> + d + <span class="hljs-string">'.html'</span>,
        <span class="hljs-string">'1'</span>,
        <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fileobj</span>)
        </span>{
            Ti.API.info(fileobj);
        }, 
        <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">fileprogress</span>)
        </span>{
            Ti.API.info(fileprogress);
        }
    );

}
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="April 17th 2012, 5:02:20 pm">April 17th 2012</span>
											by <span class='authorname'>P Sweeney</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hey P! </p>
<p>Did you manage to fix this? I bumped into this problem as well. The onprogress returns with 1 indicating full progress immeditately. But ofcourse it didnt work out… </p>
<p>Would be great if you could post your solution to this &gt;1.8 </p>
<p>cheers, Roeland</p>
</p>
										<div class="author">
											&mdash; commented <span title="October 5th 2012, 11:10:30 am">October 5th 2012</span>
											by <span class='authorname'>Roeland P</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>This is working for me at the moment:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> get_remote_file = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(filename, url, forced, fn_error, fn_progress, fn_complete)</span>
</span>{
    <span class="hljs-keyword">var</span> file_obj = {file:filename, url:url + <span class="hljs-string">'/'</span> + filename, path: <span class="hljs-literal">null</span>};

    <span class="hljs-keyword">var</span> file = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,filename);
    <span class="hljs-keyword">if</span> (file.exists() &amp;&amp; forced == <span class="hljs-string">"0"</span>)
    {
        file_obj.path = Titanium.Filesystem.applicationDataDirectory+Titanium.Filesystem.separator;
        <span class="hljs-comment">//fn_end(file_obj);</span>
        <span class="hljs-keyword">if</span> ( fn_complete ) fn_complete(<span class="hljs-string">'complete'</span>);
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-keyword">if</span>(Titanium.Network.online == <span class="hljs-literal">true</span>)
        {
            <span class="hljs-comment">//alert('Going to download file now');</span>
            <span class="hljs-keyword">var</span> c = Titanium.Network.createHTTPClient();
            c.setTimeout(<span class="hljs-number">20000</span>);
            c.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
            </span>{
                <span class="hljs-comment">//alert('onload ' + filename);</span>
                <span class="hljs-keyword">if</span> (c.status == <span class="hljs-number">200</span> )
                {
                    <span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,filename);
                    f.write(<span class="hljs-keyword">this</span>.responseData);
                    f.remoteBackup = <span class="hljs-literal">false</span>;
                    file_obj.path = Titanium.Filesystem.applicationDataDirectory;
                    <span class="hljs-comment">//fn_end(file_obj);</span>

                    f = <span class="hljs-literal">false</span>;
                    <span class="hljs-comment">//f = null;</span>
                    file = <span class="hljs-literal">null</span>;
                }
                <span class="hljs-keyword">else</span>
                {
            file_obj.error = <span class="hljs-string">'file not found'</span>; <span class="hljs-comment">// to set some errors codes</span>
                   alert(<span class="hljs-string">'File not found'</span>);
            n_end(file_obj);
                }
                <span class="hljs-keyword">if</span> ( fn_complete ) fn_complete(<span class="hljs-string">'complete'</span>);
            };
            c.ondatastream = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
            </span>{
                <span class="hljs-comment">//alert('ondatastream');</span>
                <span class="hljs-keyword">if</span> ( fn_progress ) fn_progress(e.progress);
            };
            c.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
            </span>{
                <span class="hljs-comment">//alert('Error downloading file: ' + filename);</span>
                file_obj.error = e.error;
                f = <span class="hljs-literal">null</span>;
                file = <span class="hljs-literal">null</span>;
                fn_error(file_obj);
            };
            c.open(<span class="hljs-string">'GET'</span>,url + <span class="hljs-string">'/'</span> + filename);
            <span class="hljs-comment">//alert('about to send');</span>
            c.send();           
        }
        <span class="hljs-keyword">else</span>
        {
            file_obj.error = <span class="hljs-string">'no internet'</span>;
            alert(<span class="hljs-string">'No connectivity.. '</span>);
            <span class="hljs-comment">//fn_end(file_obj);</span>
        }
    }
};
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="October 5th 2012, 11:38:00 am">October 5th 2012</span>
											by <span class='authorname'>P Sweeney</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>17</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-224372">
				
						<section>
							<p>Yop,</p>
<p>Needs a bit of error handling but it&#39;s straightforward :</p>
<pre><code class="hljs">getRemoteFile: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(file, remote)</span> </span>{
         <span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,file);
         <span class="hljs-keyword">if</span> (!f.exists()) {
             <span class="hljs-keyword">var</span> c = Titanium.Network.createHTTPClient();
             c.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                 f.write(<span class="hljs-keyword">this</span>.responseData);
             }
            c.open(<span class="hljs-string">'GET'</span>,remote, <span class="hljs-literal">true</span>);
             c.send();         
         }
         <span class="hljs-keyword">return</span> f.nativePath;
     }
</code></pre><p>It takes an (filename, remote uri) as arguments , looks on the FS to see if it&#39;s there, else download it, store it and  finally return the path on the file sytem as a string (absolute path, should be crossplatform).</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 28th 2011, 1:13:59 am">November 28th 2011</span>
								by <span class='authorname'>Gregory Boddin</span><br>
								<a class="icon-bg icon-link" href="question/45471/how-to-save-a-remote-imagepicture-to-database-or-filesystem#answer-224372" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>3</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-185681">
				
						<section>
							<p>hey everybody,</p>
<p>i got a problem with the filesystem savings of titanium. i use this function:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> c = Titanium.Network.createHTTPClient();

            c.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
                <span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(<span class="hljs-string">'images/retailer/'</span> + branch.newsId +<span class="hljs-string">".jpg"</span>);
                <span class="hljs-keyword">if</span> (!f.exists()) {
                    f.write(<span class="hljs-keyword">this</span>.responseData);
                }

                addAnnotation(f.nativePath, branch, branchArray);
            };
            <span class="hljs-comment">// open the client</span>
            c.open(<span class="hljs-string">'GET'</span>,url);
            <span class="hljs-comment">// send the data</span>
            c.send();
</code></pre><p>everything works fine on emulator and he saves the pictures in the right folder but if i use this function on the iphone the photos wont be saved. i use the images on a map as a annotation but ill get the red dots everywhere.</p>
<p>note:<br>the images i already downloaded on the emulator will be shown on the map. just the new ones dont appear.</p>
<p>anyone knows about this bug or is it a problem of the system rights ?</p>
<p>best regards<br>vitalij</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 26th 2011, 2:26:10 pm">January 26th 2011</span>
								by <span class='authorname'>Vitalij Dadaschjanz</span><br>
								<a class="icon-bg icon-link" href="question/45471/how-to-save-a-remote-imagepicture-to-database-or-filesystem#answer-185681" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>On the iPhone the resources folder is readonly. You need to write it on the application data folder</p>
<pre><code class="hljs">       <span class="hljs-variable"><span class="hljs-keyword">var</span> f</span> = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,filename);
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="January 26th 2011, 4:33:15 pm">January 26th 2011</span>
											by <span class='authorname'>Dan Tamas</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>thanks mate. everything worked fine</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 28th 2011, 9:09:56 am">January 28th 2011</span>
											by <span class='authorname'>Vitalij Dadaschjanz</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-208628">
				
						<section>
							<p>Does &quot;write&quot; happen instantaneously? </p>
<p>when I do this….</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,filename);
<span class="hljs-keyword">if</span>(f.exists()) { <span class="hljs-keyword">trace</span>(<span class="hljs-string">'file exists'</span>); } <span class="hljs-keyword">else</span> {<span class="hljs-keyword">trace</span>(<span class="hljs-string">"file doesnt exist"</span>);}
</code></pre><p>It always says file not found.  Maybe I have to wait a little before doing exist check?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 26th 2011, 10:18:31 pm">May 26th 2011</span>
								by <span class='authorname'>D Choi</span><br>
								<a class="icon-bg icon-link" href="question/45471/how-to-save-a-remote-imagepicture-to-database-or-filesystem#answer-208628" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-165861">
				
						<section>
							<p>here it is:</p>
<pre><code class="hljs">get_remote_file =  function<span class="hljs-list">(
   <span class="hljs-quoted">'saved_on_the_device</span>.html',
   <span class="hljs-quoted">'http</span><span class="hljs-keyword">://yahoo</span>.com',
   function<span class="hljs-list">(<span class="hljs-keyword">fileobj</span>)</span>{
Ti.API.info<span class="hljs-list">(<span class="hljs-keyword">fileobj</span>)</span>
   alert<span class="hljs-list">(<span class="hljs-quoted">'done</span>')</span>
 }, 
  function<span class="hljs-list">(<span class="hljs-keyword">progress</span>)</span>{
Ti.API.info<span class="hljs-list">(<span class="hljs-keyword">progress</span>)</span>
}

 )</span>
</code></pre><p>If you already have the file on the device will serve what u have on the device else will save what it gets from the net</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 20th 2010, 1:02:19 pm">December 20th 2010</span>
								by <span class='authorname'>Dan Tamas</span><br>
								<a class="icon-bg icon-link" href="question/45471/how-to-save-a-remote-imagepicture-to-database-or-filesystem#answer-165861" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Dan,</p>
<p>How do I get access to the file_obj path and file_obj file properties i.e..</p>
<pre><code class="hljs">var file_obj = {<span class="hljs-string">file:</span>filename, <span class="hljs-string">url:</span>url, <span class="hljs-string">path:</span> <span class="hljs-literal">null</span>};
</code></pre><p>inside the function you posted previously? </p>
<p>Also, I&#39;m not sure I understand what you mean, by &quot;if you already have the file on the device will serve what u have on the device else will save what it gets from the net&quot;. </p>
<p>So what is the return value when calling the get_remote_file function when the file is already on the device?</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 3rd 2011, 5:45:36 am">April 3rd 2011</span>
											by <span class='authorname'>Dennis Lo</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-1</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-222480">
				
						<section>
							<p>With my code, I&#39;m getting between 7-10 files downloaded before it decides to stop. There are 72 images to download, yet it decides to cut short at any given number.</p>
<p>Any idea why this could be happening?</p>
<pre><code class="hljs">
<span class="hljs-keyword">var</span> get_remote_file = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(filename, url, fn_end, fn_progress )</span>
        </span>{
            <span class="hljs-keyword">var</span> file_obj = {file:filename, url:url, path: <span class="hljs-literal">null</span>};

            <span class="hljs-keyword">var</span> file = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,filename);
            <span class="hljs-keyword">if</span> ( file.exists() )
            {
                file_obj.path = Titanium.Filesystem.applicationDataDirectory+Titanium.Filesystem.separator;
                fn_end(file_obj);
            }
            <span class="hljs-keyword">else</span>
            {
                <span class="hljs-keyword">if</span> ( Titanium.Network.online )
                {
                    <span class="hljs-keyword">var</span> c = Titanium.Network.createHTTPClient();
                    c.setTimeout(<span class="hljs-number">10000</span>);
                    c.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>
                    </span>{
                        <span class="hljs-keyword">if</span> (c.status == <span class="hljs-number">200</span> )
                        {
                            <span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory,filename);
                            f.write(<span class="hljs-keyword">this</span>.responseData);
                            file_obj.path = Titanium.Filesystem.applicationDataDirectory;
                            fn_end(file_obj);
                        }
                        <span class="hljs-keyword">else</span>
                        {
                            file_obj.error = <span class="hljs-string">'file not found'</span>; <span class="hljs-comment">// to set some errors codes</span>
                            fn_end(file_obj);
                        }
                    };
                    c.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
                    </span>{
                        <span class="hljs-keyword">if</span>(e.readyState == <span class="hljs-number">4</span>)
                        {
                            fn_end(file_obj);
                        }
                    };
                    c.ondatastream = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
                    </span>{
                        <span class="hljs-keyword">if</span> ( fn_progress ) fn_progress(e.progress);
                    };
                    c.error = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
                    </span>{
                        file_obj.error = e.error;
                        fn_end(file_obj);
                        alert(<span class="hljs-string">'Error with Download'</span>);
                    };
                    c.open(<span class="hljs-string">'GET'</span>,url);
                    c.send();           
                }
                <span class="hljs-keyword">else</span>
                {
                    file_obj.error = <span class="hljs-string">'no internet'</span>;
                    fn_end(file_obj);
                }
            }
        };
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> d=<span class="hljs-number">0</span>;d&lt;items[c].prereqs.length;d++)
    {



        get_remote_file(
            items[c].prereqs[d].imagename,
            items[c].prereqs[d].imagesource,
            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(fileobj)</span>
            </span>{
                Ti.API.info(fileobj);
            }, 
            <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(progress)</span>
            </span>{
                Ti.API.info(progress);
            }
        );

    }
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 2nd 2011, 8:03:26 pm">November 2nd 2011</span>
								by <span class='authorname'>P Sweeney</span><br>
								<a class="icon-bg icon-link" href="question/45471/how-to-save-a-remote-imagepicture-to-database-or-filesystem#answer-222480" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Ah ha.. I resolved this by simply setting the &#39;false&#39; param to c.open:</p>
<pre><code class="hljs">c.<span class="hljs-keyword">open</span>(<span class="hljs-symbol">'GET'</span>, url, <span class="hljs-literal">false</span>);
</code></pre><p>Now all my downloads occur in order and async.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 3rd 2011, 8:49:25 am">November 3rd 2011</span>
											by <span class='authorname'>P Sweeney</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-1</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-105301">
				
						<section>
							<p>I&#39;m interested into this. I want to know how to download an image from a server and store it locally without using an imageView.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="August 24th 2010, 10:21:51 pm">August 24th 2010</span>
								by <span class='authorname'>Eneko Alonso</span><br>
								<a class="icon-bg icon-link" href="question/45471/how-to-save-a-remote-imagepicture-to-database-or-filesystem#answer-105301" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-4</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
