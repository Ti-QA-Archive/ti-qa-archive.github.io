<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>REST api url calls Work in browsers (pc &amp; mobile) but NOT in Mobile app - get 400 Bad Request » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>REST api url calls Work in browsers (pc &amp; mobile) but NOT in Mobile app - get 400 Bad Request</h1>
		</header>
		<section>
			<p>Hi Folks,</p>
<p>I haven&#39;t beat my head against a wall like this in some time.  I have a perplexing and maddening problem.</p>
<p>I have googled my brains out for three (3) days.</p>
<p>I am going to make this question as simple as possible.  I have a RESTful service setup on a server.  The APIs I have built work BOTH in the mock client Taffy (a CFML REST framework) provides AND in any browser I try.  I enter the GET URL and the data spits back.</p>
<p>BUT…</p>
<p>Whenever I do any of the dozens of minor variations of the HTTPClient methods I have tried over the last three days, I get 400 Bad Request.</p>
<p>The only unusual thing about the URL is that there are slashes in the query URI part.  But I have tried encoding them or turning autoencode true or false.  It doesn&#39;t matter, it&#39;s always 400 Bad Request.</p>
<p>eg.  http:&#x2F;&#x2F;something.domain.com&#x2F;api&#x2F;index.cfm&#x2F;swatchsets&#x2F;62001</p>
<p>It does seem to relate to the slashes. Because I can leave off the URI portion and it will pull content with no error.  Besides, if it were just the slashes being the problem then why does it work in the browser?</p>
<p>I also used URL Rewriting on the server but still get the error.</p>
<p>Titanium does something different with the HTTP request that the server rejects but I can&#39;t figure out what it is.  I&#39;m pulling my hair out.</p>
<p>Back end is IIS7 with Railo 4.0.3 (CFML server) using the Taffy REST framework.</p>
<p>Here are some iis7 log entries:<br>PC Firefox (result 200 OK):<br>2013-03-09 22:37:49 W3SVC1 S15951825 216.250.115.211 GET &#x2F;api&#x2F;index.cfm endpoint=&#x2F;swatchsets&#x2F;62001 80 - 67.174.76.227 HTTP&#x2F;1.1 Mozilla&#x2F;5.0+(Windows+NT+6.1;+WOW64;+rv:19.0)+Gecko&#x2F;20100101+Firefox&#x2F;19.0 CFID=45e2e1d2-098b-47da-945d-085bd9fa8edd;+CFTOKEN=0;+RAILO_ADMIN_LANG=en;+RAILO_ADMIN_LASTPAGE=services.datasource - swatchman.servatus.biz 200 0 0 3589 461 656<br>2013-03-09 22:38:53 W3SVC1 S15951825 216.250.115.211 GET &#x2F;api&#x2F;index.cfm&#x2F;swatchsets&#x2F;62001 - 80 - 216.250.115.211 HTTP&#x2F;1.1 Mozilla&#x2F;5.0+(Windows+NT+6.1;+WOW64)+AppleWebKit&#x2F;537.22+(KHTML,+like+Gecko)+Chrome&#x2F;25.0.1364.152+Safari&#x2F;537.22 RAILO_ADMIN_LANG=en;+RAILO_ADMIN_LASTPAGE=services.datasource;+CFID=e86a500d-5d58-4e7c-8f30-1dc4aa41e33f;+CFTOKEN=0 - swatchman.servatus.biz 200 0 0 3613 540 238<br>iPhone Safari (result 200 OK):<br>2013-03-09 22:38:53 W3SVC1 S15951825 216.250.115.211 GET &#x2F;api&#x2F;index.cfm&#x2F;swatchsets&#x2F;62001 - 80 - 216.250.115.211 HTTP&#x2F;1.1 Mozilla&#x2F;5.0+(Windows+NT+6.1;+WOW64)+AppleWebKit&#x2F;537.22+(KHTML,+like+Gecko)+Chrome&#x2F;25.0.1364.152+Safari&#x2F;537.22 RAILO_ADMIN_LANG=en;+RAILO_ADMIN_LASTPAGE=services.datasource;+CFID=e86a500d-5d58-4e7c-8f30-1dc4aa41e33f;+CFTOKEN=0 - swatchman.servatus.biz 200 0 0 3613 540 238<br>Mobile App (result 400 Bad Request)<br>2013-03-09 22:41:57 W3SVC1 S15951825 216.250.115.211 GET &#x2F;api&#x2F;index.cfm endpoint=&#x2F;swatchsets&#x2F;62001 80 - 67.174.76.227 HTTP&#x2F;1.1 SwatchMan&#x2F;1.1.0+CFNetwork&#x2F;609.1.4+Darwin&#x2F;12.2.0 CFID=1945a41f-9e6a-4ee5-8642-1a80fc5a45bb;+CFTOKEN=0 - swatchman.servatus.biz 400 0 0 257 287 109</p>
<p>The real issue I have is what is Titanium&#39;s HTTPClient doing differently then when I simply key the same URL into a browser?  If there is any difference, what to do I do programmatically to get it to work?</p>
<p>Again, I tried lots of difference headers and GETs and POSTs, all with the same problem.</p>
<p>Thanks for your help in advance,</p>
<p>Tom</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="March 10th 2013, 8:13:55 pm">March 10th 2013</span>
				by <span class='authorname'>Thomas Albanese</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>httpclient</span></li>
					
						<li><span class='tagname'>titanium</span></li>
					
						<li><span class='tagname'>url</span></li>
					
						<li><span class='tagname'>xhr</span></li>
					
				</ul>
			

			<section>
				<h5>4 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>While you have detailed the problem you are observing on the server side of things. If you want people here to have a good understanding of what you are facing, I&#39;m afraid you&#39;ll have to post some code.</p>
<p>Otherwise, all we can do is take your word for it.</p>
</div>
							<div class="author">
								&mdash; commented <span title="March 11th 2013, 8:36:53 am">March 11th 2013</span>
								by <span class='authorname'>Christian Brousseau</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>LOL - Actually, the only reason I didn&#39;t include my code is that I have about 85 different versions from all of the things I have tried.  I will show the simplest version below.  I have left in some remarked out headers that I have tried…</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> win = Titanium.UI.currentWindow;

<span class="hljs-keyword">var</span> vREST_URL = <span class="hljs-string">"http://swatchman.servatus.biz/swatchsets/62001"</span>;

<span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient({
   onload:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
         <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.status == <span class="hljs-string">'200'</span>){
         alert(<span class="hljs-string">'Success!'</span>);
            alert(<span class="hljs-keyword">this</span>.responseText);
         }                     
   },
   onerror:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
       alert(<span class="hljs-keyword">this</span>.responseText);
       alert(<span class="hljs-string">'statusText: '</span>+<span class="hljs-keyword">this</span>.statusText);
        Ti.API.debug(e.error); 
        <span class="hljs-comment">//alert('Error:'+e.error);</span>
   },
   timeout : <span class="hljs-number">5000</span>
});

xhr.open(<span class="hljs-string">"GET"</span>,vREST_URL);

<span class="hljs-comment">//xhr.setRequestHeader("Content-Type", "text/plain");</span>
<span class="hljs-comment">//xhr.setRequestHeader('Content-type',null);</span>
<span class="hljs-comment">//xhr.setRequestHeader("Content-Type","multipart/form-data");</span>
<span class="hljs-comment">//xhr.setRequestHeader('Content-Type', "application/json; charset=utf-8\n");</span>
<span class="hljs-comment">//xhr.setRequestHeader("'User-Agent", "Mozilla/5.0+(Windows+NT+6.1;+WOW64;+rv:19.0)+Gecko/20100101+Firefox/19.0");</span>

xhr.send();
</code></pre></div>
							<div class="author">
								&mdash; commented <span title="March 11th 2013, 10:45:34 am">March 11th 2013</span>
								by <span class='authorname'>Thomas Albanese</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>In the context of the example above, notice if you put either of the following URLs into a browser it returns the JSON payload.  You can use any of these…</p>
<p>http:&#x2F;&#x2F;swatchman.servatus.biz&#x2F;api&#x2F;swatchsets&#x2F;62001<br>http:&#x2F;&#x2F;swatchman.servatus.biz&#x2F;api&#x2F;index.cfm&#x2F;swatchsets&#x2F;62001<br>http:&#x2F;&#x2F;swatchman.servatus.biz&#x2F;swatchsets&#x2F;62001</p>
<p>Thanks</p>
</div>
							<div class="author">
								&mdash; commented <span title="March 11th 2013, 11:04:31 am">March 11th 2013</span>
								by <span class='authorname'>Thomas Albanese</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Also, this URL works in a browser.  This one has a conventional query string …</p>
<p>http:&#x2F;&#x2F;swatchman.servatus.biz&#x2F;api&#x2F;index.cfm?endpoint=&#x2F;swatchsets&#x2F;62001</p>
</div>
							<div class="author">
								&mdash; commented <span title="March 11th 2013, 11:07:46 am">March 11th 2013</span>
								by <span class='authorname'>Thomas Albanese</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-258405">
				
						<section>
							<p>after many months of banging my head against a wall, I realized that Titanium GET calls are often taken as POST calls. Can you check if changing that will make it work? in that case there&#39;s a workaround somewhere here in the Q&amp;A that I&#39;ll post you later.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 11th 2013, 11:46:26 am">March 11th 2013</span>
								by <span class='authorname'>Alberto Marcone</span><br>
								<a class="icon-bg icon-link" href="question/149391/rest-api-url-calls-work-in-browsers-pc--mobile-but-not-in-mobile-app---get-400-bad-request#answer-258405" rel="permalink">permalink</a>
							</div>

							<h5>5 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>I have tried POST, but for the sake of this discussion I just tried the following that still gets the 400 Bad Request:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> win = Titanium.UI.currentWindow;

<span class="hljs-keyword">var</span> vUserID = Ti.App.Properties.getString(<span class="hljs-string">'valUserID'</span>,<span class="hljs-string">''</span>);
<span class="hljs-keyword">var</span> vPwd = Ti.App.Properties.getString(<span class="hljs-string">'valPwd'</span>,<span class="hljs-string">''</span>);
<span class="hljs-keyword">var</span> vCoID = Ti.App.Properties.getString(<span class="hljs-string">'valCoID'</span>,<span class="hljs-string">''</span>);
<span class="hljs-keyword">var</span> vapiKey = <span class="hljs-string">'k87a72z'</span>;
<span class="hljs-keyword">var</span> vREST_URL = <span class="hljs-string">"http://swatchman.servatus.biz/swatchsets/62001"</span>;

<span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient({
   onload:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
         <span class="hljs-keyword">if</span>(<span class="hljs-keyword">this</span>.status == <span class="hljs-string">'200'</span>){
            <span class="hljs-comment">//alert(this.responseText);</span>
            alert(<span class="hljs-string">'Success!'</span>);
         }                     
   },
   onerror:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
       alert(<span class="hljs-keyword">this</span>.responseText);
       alert(<span class="hljs-string">'statusText: '</span>+<span class="hljs-keyword">this</span>.statusText);
        Ti.API.debug(e.error); 
        <span class="hljs-comment">//alert('Error:'+e.error);</span>
   },
   timeout: <span class="hljs-number">5000</span>
});

xhr.open(<span class="hljs-string">"POST"</span>,vREST_URL);
xhr.setRequestHeader(<span class="hljs-string">"Content-Type"</span>,<span class="hljs-string">"multipart/form-data"</span>);

<span class="hljs-keyword">var</span> params = {
    apiKey:vapiKey,
    userID:vUserID,
    pwd:vPwd
};

xhr.send(params);
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 11th 2013, 12:00:12 pm">March 11th 2013</span>
											by <span class='authorname'>Thomas Albanese</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>can&#39;t really see the problem then. Is the header required to be like that? it looks like any other xhr call I make. Beside the url. Have you tried calling a normal php file with the same params?</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 11th 2013, 12:05:18 pm">March 11th 2013</span>
											by <span class='authorname'>Alberto Marcone</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Same result with or without that setRequestHeader statement.  Also, note that if I use the root api folder call (which brings up a &quot;dashboard&quot;)  the HTTPClient works just fine. (link below)</p>
<p>http:&#x2F;&#x2F;swatchman.servatus.biz&#x2F;api&#x2F;</p>
<p>Good gentlemen, I am beginning to think this is a bug in the Taffy framework that handles the json prep.  It seemed to makes sense to also put the question here at Ti because the URL works in a browser but not via Ti.  </p>
<p>Perhaps if someone just knows the underlying difference between HTTPClient and entering a URL in a browser that might help.</p>
<p>Thanks guys.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 11th 2013, 12:17:10 pm">March 11th 2013</span>
											by <span class='authorname'>Thomas Albanese</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Consider this issue closed.  The problem did come from a bug in the framework.  Sorry to bother people here.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 11th 2013, 2:41:08 pm">March 11th 2013</span>
											by <span class='authorname'>Thomas Albanese</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>POST SCRIPT:  I did find another user having a similar problem and was able to get it to work:</p>
<p>If I included the &quot;Accept&quot; header, then it took, unbelievable.  So the following now works on the server without mods or hacks in their software or framework…</p>
<pre><code class="hljs">xhr.open(<span class="hljs-string">"<span class="hljs-keyword">GET</span>"</span>,vREST_URL);
xhr.setRequestHeader(<span class="hljs-string">"Accept"</span>, <span class="hljs-string">"application/json"</span>);
xhr.setRequestHeader(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"application/json"</span>);
xhr.send();
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 11th 2013, 3:57:23 pm">March 11th 2013</span>
											by <span class='authorname'>Thomas Albanese</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
