<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Memory Leaks on Android but not on iOS - Very SIMPLE test Case!!! » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Memory Leaks on Android but not on iOS - Very SIMPLE test Case!!!</h1>
		</header>
		<section>
			<p>Hi Anyone,</p>
<p>Has anyone seen this or experiencing similar behavior. Memory cleans up perfect on iOS and does nothing on Android. Below is very simple code to prove memory issue. I have tested this on windows and mac running titanium studio (1.0.8.1) with a week old version of the SDK 1.9.0.xxxxxx. Copy the following code into app.js in a new project. This code will only execute once but it is enough to prove the test case.</p>
<pre><code class="hljs">
(function mainViews() 
{ 
    <span class="hljs-built_in">var</span> <span class="hljs-built_in">views</span> =[];  
    <span class="hljs-built_in">var</span> <span class="hljs-built_in">view</span> = <span class="hljs-built_in">null</span>;

    for (<span class="hljs-built_in">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {


        <span class="hljs-built_in">view</span> = Titanium.UI.createView(
        {
            <span class="hljs-comment">//backgroundImage: '/images/background2.jpg',</span>
            <span class="hljs-comment">//backgroundColor: 'blue',</span>
            top:<span class="hljs-number">0</span>,
            left:<span class="hljs-number">0</span>,
            width:Ti.Platform.displayCaps.platformWidth,
            height:<span class="hljs-number">200</span>,

        });
        <span class="hljs-built_in">views</span>.push(<span class="hljs-built_in">view</span>);
    }
    <span class="hljs-comment">//alert(views.length);</span>
    <span class="hljs-built_in">views</span> =[];
    <span class="hljs-built_in">views</span> = <span class="hljs-built_in">null</span>;  
    <span class="hljs-built_in">view</span> = <span class="hljs-built_in">null</span>;
    <span class="hljs-comment">//alert(views.length);</span>
}());
</code></pre><p>Test Case 1: Android with blank app.js running DDMS: </p>
<p>Heap Size: 5.758 MB<br>Allocated: 2.898 MB<br>Free: 2.859 MB<br>%Used: 50.34%<br>Objects: 55,438</p>
<p>Test Case 2: Android with sample code in app.js only running DDMS:<br>Heap Size: 7.195 MB<br>Allocated: 4.357 MB<br>Free: 2.838 MB<br>%Used: 60.56%<br>Objects: 97,665</p>
<p>These counts will Never go down</p>
<p>Test Case 3. iPhone on Mac with sample code in app.js running Instruments.</p>
<p>You can see it create the 1,000 view proxies and in about 10 secs it cleans them up and #no of living goes to 0 and #of Transitory is 1000.</p>
<p>I have tested this at least 20 times on each platform. It it replicates the same every time.</p>
<p>I have tried multiple version of 1.9 and 1.8</p>
<p>Is there something that I am doing that is fundamental wrong on Android? I have read about every message post about memory management and even the documentation from Appcelerator about taking the proper steps to clean up resources. </p>
<p>FROM APPCELERATOR Best Practices Guide:</p>
<p>Applications shall take reasonable steps to manage memory<br>In very large applications, it occasionally becomes necessary to force Titanium to clean up resources. To do this, the developer has a few things to track:</p>
<p>the windows can be closed. This should cause Titanium to free up the resources reserved for the view objects added to the window.<br>remove global event handlers when they are no longer needed. References to objects within these closures will be retained otherwise - this is a common memory leak in large JavaScript applications in the browser also. Some common global event handlers include Ti.App.addEventListener (global messaging system), geolocation events, and orientation change events<br>proxy objects can be set to null. This ensures that these objects are garbage collected to release the associated native objects.</p>
<p>Thank You for any advice or solutions.</p>
<p>Sean</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="February 17th 2012, 9:11:56 pm">February 17th 2012</span>
				by <span class='authorname'>sean sean</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android memory</span></li>
					
						<li><span class='tagname'>ios memory</span></li>
					
						<li><span class='tagname'>memory leaks</span></li>
					
						<li><span class='tagname'>memory management</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>what version of android SDK are you running? If i want to try an reproduce condition.</p>
<p>Also I dont know if I would say there is a leak… It just appears that it has not freed  the memory yet.</p>
</div>
							<div class="author">
								&mdash; commented <span title="February 18th 2012, 12:34:24 am">February 18th 2012</span>
								by <span class='authorname'>Aaron Saunders</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>4</span> Votes</div>
			<div class="answers"><span>6</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>6 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-231114">
				
						<section>
							<p>Sean,</p>
<p>This appears to be a platform bug. I&#39;ve logged a <a href="https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TIMOB-7722">ticket</a>. I can reproduce the error using our 1.7.5, 1.8.1, and 1.9x SDKs. I simplified your code to the following and still see the error.</p>
<pre><code class="hljs">(function mainViews() { 
    <span class="hljs-built_in">var</span> <span class="hljs-built_in">views</span> =[];  
    <span class="hljs-built_in">var</span> <span class="hljs-built_in">view</span> = <span class="hljs-built_in">null</span>;
    for (<span class="hljs-built_in">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
        <span class="hljs-built_in">view</span> = Titanium.UI.createView();
        <span class="hljs-built_in">views</span>.push(<span class="hljs-built_in">view</span>);
    }
    <span class="hljs-built_in">views</span> = <span class="hljs-built_in">null</span>;  
    <span class="hljs-built_in">view</span> = <span class="hljs-built_in">null</span>;
}());
</code></pre><p>In general, the information outlined in <a href="https:&#x2F;&#x2F;wiki.appcelerator.org&#x2F;display&#x2F;guides&#x2F;Managing+Memory+and+Finding+Leaks">this wiki guide</a> should cover what you need to do for memory management. It boils down to: </p>
<ul>
<li>keep in mind the memory limits of the mobile environment</li>
<li>null out objects so they can be garbage collected</li>
<li>watch for stray references to objects that would prevent them from being auto-collected</li>
</ul>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 21st 2012, 7:39:00 pm">February 21st 2012</span>
								by <span class='authorname'>Tim Poulsen</span><br>
								<a class="icon-bg icon-link" href="../../question/132357/memory-leaks-on-android-but-not-on-ios---very-simple-test-case.html#answer-231114" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Tim,</p>
<p>Thank you for your prompt response on this issue. I have spending days and nights trying to figure out what was going on with memory on Android and I am glad to hear that it is a bug that can be fixed and resolved.</p>
<p>Is there a time frame for this issue to be fixed and what versions of the SDK&#39;s it will be fixed in?</p>
<p>I will be more than happy to test the fix once it has been completed and post back to the forum once its resolved so others can benefit from it as well.</p>
<p>Just so you are aware - I have changed the createView to createButton and the same thing happens there as well - in case this needs to be fixed elsewhere in the codebase.</p>
<p>Thanks again for your time and response<br>Sean</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 21st 2012, 8:00:45 pm">February 21st 2012</span>
											by <span class='authorname'>sean sean</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Paul,</p>
<p>I respectfully disagree with the idea that this will get cleaned up on the Phone&#x2F;Android. If I run your example or my example with my Android Phone this never gets GC&#39;d and the app will eventually crash (Anroid OS 2.3.4). I got the memory on the Phone up to 70 mb and then it crashes. Yes I agree with you that Garbage collection will eventually kick in when resources are low but that does not happen with this example - I can sit there with the app all day and force GC and memory still keeps growing.</p>
<p>I also noted in one of the previous post that there is a version of Titanium (1.8.0.v220111007101045) that shows in DDMS memory get cleaned when you click the &quot;Cause GC&quot; button. It doenst clean up memory 100 % correctly but it definelty helps release resources. I tested it with the above examples including my sample test case and noticed that this does not clean it up entirely but it only helps reduce the memory footprint of the application.</p>
<p>I have to agree with Tim that this not a documentation issue at all. I have spent months wrapping my head around this issue and tested the most fundamental memory management practices that Appcelerator has provided and memory never gets clean up on Android. I also think that Appcelerator would benefit by having memory clean up examples for Android that people could download and test and see how memory actually gets cleaned up. The reason I say this is if you do a search in the QA section you get over 10,000 hits on memory clean up and the majority of them are Android. I agree with you if you set objects to be removed and null them out that works perfect on iOS.</p>
<p>Sorry for ranting on this - it is just that people have been spending months trying to figure out memory on Android and everyone gets the same reply. Set objects to null &quot;should work&quot;. This doesnt seem like this was ever properly tested on Android because it is so fundamental and it does not work. My friend even attended the Titanium Conference in San Francisco last year and spoke to Kevin W and others about memory management on Android - and everyone just says null it and it should be marked for cleanup and not to worry about it - but as you can see on the forums - people are complaining about their app crashing all the time.</p>
<p>Thanks for all your help with this issue. If you have any version that you think may help, I will be more that happy to test and provide effective feedback and results…</p>
<p>Sean</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 22nd 2012, 2:42:33 pm">February 22nd 2012</span>
											by <span class='authorname'>sean sean</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-231131">
				
						<section>
							<p>Sean</p>
<p>Garbage collection is an expensive process in CPU terms, and thus on Android it will typically only happen when absolutely necessary. Thus, while it is crucial that you clean up resources by removing views from the view hierarchy and set variables containing Titanium objects to null to mark them for collection, ddms often won&#39;t reflect it. </p>
<p>The following test case demonstrates the scenario. Launch the app, click the button, and wait for the 15,000 views to be created. Watch ddms for the heap usage. Click the button again, and note that heap does not exceed the previous value.</p>
<p>Change the number of views created from 15,000 to 30,000. Relaunch the app, click the button and watch ddms as the memory increases, and then the app will crash.</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mainViews</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">var</span> views =[];
  <span class="hljs-keyword">var</span> view = <span class="hljs-literal">null</span>;

  <span class="hljs-comment">// *** change the following to 30000 iterations to watch app fail! ***</span>
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15000</span>; i++){
    view = Ti.UI.createView();
    views.push(view);
  }

  Ti.API.info(<span class="hljs-string">'Titanium views created and added to array'</span>);
  Ti.API.info(<span class="hljs-string">'----------------------------------'</span>);
  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j <span class="hljs-keyword">in</span> views){
    views[j] = <span class="hljs-literal">null</span>;
  }
  Ti.API.info(<span class="hljs-string">'Titanium views removed nulled'</span>);
  views = <span class="hljs-literal">null</span>;
}

<span class="hljs-keyword">var</span> win = Ti.UI.createWindow({
  backgroundColor: <span class="hljs-string">"white"</span>
});

<span class="hljs-keyword">var</span> button = Ti.UI.createButton({
  title: <span class="hljs-string">"create 15k views"</span>
});
button.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
  mainViews();
});

win.add(button);
win.open();
</code></pre><p>Let me know if there is anything that is unclear with this, and I will attempt to clarify it.</p>
<p>Cheers</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 21st 2012, 11:29:43 pm">February 21st 2012</span>
								by <span class='authorname'>Paul Dowsett</span><br>
								<a class="icon-bg icon-link" href="../../question/132357/memory-leaks-on-android-but-not-on-ios---very-simple-test-case.html#answer-231131" rel="permalink">permalink</a>
							</div>

							<h5>33 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Paul,</p>
<p>I respectfully disagree with the idea that this will get cleaned up on the Phone&#x2F;Android. If I run your example or my example with my Android Phone this never gets GC&#39;d and the app will eventually crash (Anroid OS 2.3.4). I got the memory on the Phone up to 70 mb and then it crashes. Yes I agree with you that Garbage collection will eventually kick in when resources are low but that does not happen with this example - I can sit there with the app all day and force GC and memory still keeps growing.</p>
<p>I also noted in one of the previous post that there is a version of Titanium (1.8.0.v220111007101045) that shows in DDMS memory get cleaned when you click the &quot;Cause GC&quot; button. It doenst clean up memory 100 % correctly but it definelty helps release resources. I tested it with the above examples including my sample test case and noticed that this does not clean it up entirely but it only helps reduce the memory footprint of the application.</p>
<p>I have to agree with Tim that this not a documentation issue at all. I have spent months wrapping my head around this issue and tested the most fundamental memory management practices that Appcelerator has provided and memory never gets clean up on Android. I also think that Appcelerator would benefit by having memory clean up examples for Android that people could download and test and see how memory actually gets cleaned up. The reason I say this is if you do a search in the QA section you get over 10,000 hits on memory clean up on Android. I agree with you if you set objects to be removed and null them out that works perfect on iOS.</p>
<p>Sorry for ranting on this - it is just that people have been spending months trying to figure out memory on Android and everyone gets the same reply. Set objects to null &quot;should work&quot;. This doesnt seem like this was ever properly tested on Android because it is so fundamental and it does not work. My friend even attended the Titanium Conference in San Francisco last year and spoke to Kevin W and others about memory management on Android - and everyone just says null it and it should be marked for cleanup and not to worry about it - but as you can see on the forums - people are complaining about their app crashing all the time.</p>
<p>Thanks for all your help with this issue. If you have any version that you think may help, I will be more that happy to test and provide effective feedback and results…</p>
<p>Sean</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 22nd 2012, 2:41:38 pm">February 22nd 2012</span>
											by <span class='authorname'>sean sean</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Note that the above code was tested on <a href="http:&#x2F;&#x2F;wiki.appcelerator.org&#x2F;display&#x2F;guides&#x2F;Installing+Titanium+SDK+Continuous+Builds">Continuous Build</a> version 2.0 (master, in the drop-down list) + Android 2.2.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 22nd 2012, 2:43:44 pm">February 22nd 2012</span>
											by <span class='authorname'>Paul Dowsett</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Paul,</p>
<p>Thanks for the build info. I will test this and let you know what I find.</p>
<p>Thanks for you help</p>
<p>Sean</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 22nd 2012, 2:52:00 pm">February 22nd 2012</span>
											by <span class='authorname'>sean sean</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Sean, I think our posts crossed in the ether. Please try the CI version I referenced in my last comment. I have not had the chance to test other CI versions yet, but I intend to over the next couple of days.</p>
<p>What may not be apparent is that there are two GC processes involved here - one for the OS, which DDMS can accurately report on, and one for the V8 runtime. When you null a variable, it does so in V8, and V8 knows that it can reuse that portion of the address when it has a need. To conserve CPU, and consequently battery, it typically only does this when it needs to create another object.</p>
<p>Thus, clicking &quot;Cause GC&quot; will not reduce the heap memory or number of objects, because this is at the Java layer rather than V8. However, in the above test case, when you click the button a second time, new views will be created but no additional memory will be used (the heap and number of objects will remain pretty much the same). This is the GC process working successfully.</p>
<p>Let me know if this explanation is satisfactory.</p>
<p>Cheers</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 22nd 2012, 3:06:39 pm">February 22nd 2012</span>
											by <span class='authorname'>Paul Dowsett</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Paul,</p>
<p>I have just tested your sample app with the latest Continuous Build version (2.0.0.v20120221190136) on both the emulator and phone multiple times. The memory continues to grow until it hits 60 mb on the phone and about 23 mb on the emulator. On the phone this is about the end of the second click or third click of the button. Eventually the app crashes as it runs out of memory. I monitored both memory and heap size using ddms when running in the emulator and it crashed when it runs out of memory. I tested this on my phone 6 times and got the same result every time. I also tested it by letting the app sit for a few minutes before clicking the button again and it made no difference.</p>
<p>Just to confirm this still works perfectly on the mac with any build.</p>
<p>Hope this information helps.</p>
<p>I am expecting to run this test case to see the memory peaks and then stays the same or goes down as you indicated in your post above.</p>
<p>Thanks<br>Sean</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 22nd 2012, 4:17:34 pm">February 22nd 2012</span>
											by <span class='authorname'>sean sean</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Paul and Sean,</p>
<p>I have be monitoring this post closely for a solution because I am also experiencing the same  memory issues with my app. I am trying to go live with my app but it is still unstable after long use due to memory not getting released.</p>
<p>I have just completed testing Paul and Sean&#39;s test case on both Android and Mac using the latest 2.0 SDK and can confirm that the application crashes on Android phone and emulator. This works fine in my sample mac project.</p>
<p>If you guys need anymore details (build No, version, etc) I will be happy to post this information.</p>
<p>Hope to have a new build that I can test with that will resolve this issue.</p>
<p>Thank You<br>Mathew</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 22nd 2012, 4:34:17 pm">February 22nd 2012</span>
											by <span class='authorname'>Mathew Rain</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hmm, yes, strangely I am unable to reproduce the success I had yesterday with the master branch. Hence, I have created the following ticket:<br><a href="https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TIMOB-7779">TIMOB-7779</a></p>
<p>I have spoken to our lead on Android in depth about the issue, and he has made it a top priority (literally), and is very grateful to you for raising it.</p>
<p>Thank you. I will update this thread with new developments.</p>
<p>In the meantime, if an app needs to ship, I would recommend you ship with rhino rather than v8, as it does not exhibit this issue.</p>
<p>Cheers</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 22nd 2012, 11:19:49 pm">February 22nd 2012</span>
											by <span class='authorname'>Paul Dowsett</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Paul,</p>
<p>Thats good news that you guys can reproduce and confirmed that there is an issue. I have tried running my project with the latest 2.0 build and rhino and it seems to be causing all sort of issues. (example:Cannot find local images used in the project). If I put the project back to V8 all of my images are displayed again. Is Rhino not compatible with SDK 2.0??</p>
<p>Thanks again for your help in the issue.</p>
<p>Mathew</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 23rd 2012, 3:49:25 pm">February 23rd 2012</span>
											by <span class='authorname'>Mathew Rain</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Paul,</p>
<p>I have be monitoring this post closely for a solution because I am also experiencing the same memory issue with my app. </p>
<p>I have tried running my project with the latest (2.0.0.v20120301000143) build using the Rhino Javascript runtime as you suggest and and it seems that the application crashes on Android phone and emulator.</p>
<p>So, I don&#39;t think that your recommendation is valid.</p>
<p>Cheers</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 1st 2012, 12:55:14 pm">March 1st 2012</span>
											by <span class='authorname'>Athanasios Nikolaou</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Mathew - I have certainly seen the issue with my test case on V8 but, as it is quite contrived (I hope a real app would never create 15000 views), this may not be a reliable way to expose a flaw in the garbage collection mechanism. My colleague has actually demonstrated that GC works correctly on her device, whereas I observe the problem in my emulator. Hence, I still need to do some testing on this, to prove a fault.</p>
<p>Athanasios - I have not seen any problem with the GC when using rhino. If you are certain that the problem is not caused by your code, please create a simple test case and raise a ticket, after reading the <a href="https:&#x2F;&#x2F;wiki.appcelerator.org&#x2F;display&#x2F;guides&#x2F;How+to+Submit+a+Bug+Report">How to Submit a Bug Report</a> guide. Thank you in advance for that!</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 1st 2012, 1:07:45 pm">March 1st 2012</span>
											by <span class='authorname'>Paul Dowsett</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Paul,</p>
<p>I hope you do not think that I am crazy enough to use 15,000 views in my app. I was backing up the above test to also provide more feed-back that Garbage collection does not work with the above test cases. Even if you set the number to 10 views this will eventually crash the app due to lack of memory and I can 100% prove this if you need me to. The issue is not only with views, its with buttons, labels, tables, scrollviews.</p>
<p>Garbage collection does not even work in my real app (which is single-context). I create and close views that have alot of labels and few buttons on these views. Over time the app grows to about 70mb and crashes. This I can confirm on a wide range of android devices.  I can also create a smaller test case with one view opening and closing it does not clean up memory and will eventually crash to prove there is a memory issue. </p>
<p>There is obviously a reason why there are over 10,000 posts about memory leaks and android and multiple people are following this post.</p>
<p>I hope that you are you NOT saying that garbage collection is working in V8 ?? With the above test case and using any BUILD of Titanium SDK version 1.8, 1.9 or 2.0 - you can see that on Android memory is never released - I would also like to point out again that on iOS the above test case and even a simple test case with 10 views works perfectly with all version of the Titanium SDK versions 1.8, 1.9 and 2.0. </p>
<p>If this has indeed been resolved in the latest build of Titanium SDK - can provide a build number and a test case to prove this and I am more than willing to test and help in anyway possible but I will not agree that garbage collection is working at all in V8 the way it stands at the moment?</p>
<p>Thank You</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 1st 2012, 1:48:00 pm">March 1st 2012</span>
											by <span class='authorname'>Mathew Rain</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Mathew</p>
<p>To reiterate, I confirmed that I had observed the behavior in v8, but still must (and hope to) prove it beyond reasonable doubt to my colleague who has not observed it.</p>
<p>I had not observed any issues at all on rhino. I was not referring to v8, as I still need to perform more testing to prove&#x2F;disprove this.</p>
<p>I hope this clarifies my previous post.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 1st 2012, 2:14:16 pm">March 1st 2012</span>
											by <span class='authorname'>Paul Dowsett</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Paul,</p>
<p>Thank you for the clarification, sorry if I sounded like I was ranting. This memory issue just has been causing alot of headaches and long nights trying to workaround this memory issue and has caused issues with alot of my customers. I have done multiple test on at least 5 different Android devices 2.3.4 and higher and all have crashed due to lack of memory using V8. </p>
<p>Thanks again for all or you help.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 1st 2012, 7:11:57 pm">March 1st 2012</span>
											by <span class='authorname'>Mathew Rain</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Paul,</p>
<p>please, have a look on the following test case and tell me why every time I open (click the &#39;create tabGroup&#39; button) and then close (using android back button) the tabgroup, the memory continues to grow (GC reduces the allocated memory but not as I would expect - opening and then closing the tabGroup grows the allocated memory for 48kb).</p>
<h1 id="app-js">app.js</h1>
<pre><code class="hljs"><span class="hljs-keyword">var</span> mainwin = Ti.UI.createWindow({
    title:<span class="hljs-string">'TEST WINDOW'</span>,
    backgroundColor:<span class="hljs-string">'#fff'</span>,
    fullscreen:<span class="hljs-literal">true</span>,  
    statusBarHidden: <span class="hljs-literal">true</span>,
    navBarHidden:<span class="hljs-literal">true</span>, 
    exitOnClose:<span class="hljs-literal">true</span>
});

<span class="hljs-keyword">var</span> button = Ti.UI.createButton({
    title: <span class="hljs-string">"create tabGroup"</span>
});

button.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{

    <span class="hljs-keyword">var</span> MY_TABGROUP = <span class="hljs-literal">null</span>;
    MY_TABGROUP = <span class="hljs-built_in">require</span>(<span class="hljs-string">'/myNewTabGroup'</span>).innerTabGroup();

     MY_TABGROUP.open({
        animated: <span class="hljs-literal">true</span>
    });
});

mainwin.add(button);

mainwin.open();
</code></pre><h1 id="mynewtabgroup-js">myNewTabGroup.js</h1>
<pre><code class="hljs">exports.innerTabGroup = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-keyword">var</span> tabGroup = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">var</span> win1 = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> tab1 = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> win2 = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> tab2 = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">var</span> views1 =[];
    <span class="hljs-keyword">var</span> view1 = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> views2 =[];
    <span class="hljs-keyword">var</span> view2 = <span class="hljs-literal">null</span>;

    tabGroup = Titanium.UI.createTabGroup();

    win1 = Titanium.UI.createWindow({  
        title:<span class="hljs-string">'Tab 1'</span>,
        backgroundColor:<span class="hljs-string">'#fff'</span>
    });

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) {
        view1 = Ti.UI.createView();
        views1.push(view1);
        win1.add(view1);
    }

    tab1 = Titanium.UI.createTab({  
        icon:<span class="hljs-string">'KS_nav_views.png'</span>,
        title:<span class="hljs-string">'Tab 1'</span>,
        <span class="hljs-built_in">window</span>:win1
    });

    win2 = Titanium.UI.createWindow({  
        title:<span class="hljs-string">'Tab 2'</span>,
        backgroundColor:<span class="hljs-string">'#fff'</span>
    });

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) {
        view2 = Ti.UI.createView();
        views2.push(view2);
        win2.add(view2);
    }

    tab2 = Titanium.UI.createTab({  
        icon:<span class="hljs-string">'KS_nav_ui.png'</span>,
        title:<span class="hljs-string">'Tab 2'</span>,
        <span class="hljs-built_in">window</span>:win2
    });

    tabGroup.addTab(tab1);  
    tabGroup.addTab(tab2);  

    <span class="hljs-keyword">return</span> tabGroup;

};
</code></pre><p>Thank you in advance,</p>
<p>Thanos</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 7:57:42 am">March 2nd 2012</span>
											by <span class='authorname'>Athanasios Nikolaou</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I can confirm this issue using test case from JIRA ticket on real device (Thinkpad Tablet with Android 3.1, 1.8.2 SDK). I also tried to add views to a window and it seems like that makes a difference. Could someone try that and confirm?</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mainViews</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">var</span> newWin = Ti.UI.createWindow({ navBarHidden: <span class="hljs-literal">true</span> });

    Ti.API.info(<span class="hljs-string">'****** mainViews function has started ******'</span>);
    <span class="hljs-keyword">var</span> views =[];
    <span class="hljs-keyword">var</span> view = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
        view = Ti.UI.createView();
        <span class="hljs-comment">//views.push(view);</span>
        newWin.add(view);
    }

    newWin.open();


    Ti.API.info(<span class="hljs-string">'Titanium views created and added to array'</span>);
    Ti.API.info(<span class="hljs-string">'****** mainViews function has stopped ******'</span>);
}

<span class="hljs-keyword">var</span> win = Ti.UI.createWindow({
    backgroundColor: <span class="hljs-string">"white"</span>
});

<span class="hljs-keyword">var</span> button = Ti.UI.createButton({
    title: <span class="hljs-string">"create 5k views"</span>
});
button.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    mainViews();
    Ti.API.info(<span class="hljs-string">'Available memory: '</span> + Ti.Platform.availableMemory);
});

win.add(button);
win.open();
</code></pre><p>Click button, hit back-button and repeat until you get bored. :)</p>
<p>You should see that memory is being freed.</p>
<p>Also, I need to mention that I am working on an app that has several large UI forms, the largest one has about 1000 elements. I still didn&#39;t managed to crash app due to memory starvation (did for other reasons many times :D ). How could that be possible if memory wasn&#39;t freed over time? :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 8:47:26 am">March 2nd 2012</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I&#39;ve tested the test case code on a device and the GC mechanism is working correctly. It is unfortunate that it&#39;s not working in an emulator, as this is where many developers prefer to test their apps, though. I&#39;m not sure what we can do about this, as the emulator is out of our control, but I will consult with our engineering team, and will report back accordingly. Thanks for your patience.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 10:28:36 am">March 2nd 2012</span>
											by <span class='authorname'>Paul Dowsett</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I confirm Ivan&#39;s test case.</p>
<p>It seems that adding view to a window makes the difference!</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 10:51:47 am">March 2nd 2012</span>
											by <span class='authorname'>Athanasios Nikolaou</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Guys,</p>
<p>Can you confirm what version of the SDK and Studio you are using? I will run this test case and try and reproduce the issue on my Android phones.</p>
<p>Thank You</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 1:13:43 pm">March 2nd 2012</span>
											by <span class='authorname'>Mathew Rain</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>1.8.1</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 1:14:54 pm">March 2nd 2012</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Mathew, please find the update-to-date information in ticket <a href="https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TIMOB-7779">TIMOB-7779</a>. If you have results you&#39;ve gained from running the test case included in the ticket on a device, then please post it as a comment to the ticket. Thank you</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 1:17:32 pm">March 2nd 2012</span>
											by <span class='authorname'>Paul Dowsett</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Ok, thanks I will be trying that now. Hopefully this finally puts this issue to rest, but im still skeptical.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 1:34:13 pm">March 2nd 2012</span>
											by <span class='authorname'>Mathew Rain</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Guys,</p>
<p>I have just completed testing Ivan&#39;s code on my Android phone (2.3.4) and the emulator - the app never releases memory and I can make it crash after about 10 clicks every time. I left the newWin.Open() un-commented and click the 5k button and back button at an easy pace to give the OS time to garbage collect and it crashes.</p>
<p>Pauls Test case: was ROOT Window and add 1000 views to it</p>
<p>Ivan Test case: was ROOT Window with button to create 5000 views add those views to a New window and then close the window to release the memory</p>
<p>I can confirm both test cases still crashes on emulator and phone using SDK 1.8.1 to test using V8. </p>
<p>Ivan&#39;s test case is no different than the Memory Pool&quot; work around that has been floating around on the Q&#x2F;A blog. His test case also breaks Appceraltors own recommendation of using &quot;Single Context&quot; (ie single window for entire application). It also doesnt follow the rule of Nulling variables will mark it for garbage collection to eventually be released.</p>
<p>Thank You</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 2:45:59 pm">March 2nd 2012</span>
											by <span class='authorname'>Mathew Rain</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Ivan and Paul,</p>
<p>I can confirm Mathews test results. My phone also crashes with Ivans above example after about 10 - 15 clicks of the button. I hope this issue can be resolved with out using work arounds.</p>
<p>Once again if you have new builds you would like me to test with, I am happy to give it a try to help get this issue resolved.</p>
<p>Thank You</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 3:39:17 pm">March 2nd 2012</span>
											by <span class='authorname'>sean sean</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Although this issue concerns V8, I can confirm that Ivan&#39;s test case crashes on emulator using both V8 and Rhino (continuous builds - version 2.0.0.v20120301000143).</p>
<p>Mathew, could you please confirm that Ivan&#39;s code crashes on your device using Rhino as well?</p>
<p>Thank you in advance.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 4:17:23 pm">March 2nd 2012</span>
											by <span class='authorname'>Athanasios Nikolaou</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Mathew, Sean - please refer to the ticket and replicate the environment that I have tested and observed to work - ie. Device &amp; Android 2.2+ &amp; Titanium Continuous Build (master branch) &amp; v8.</p>
<p>Athanasios - yes, it&#39;s an emulator issue. Please test on device.</p>
<p>Thanks</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 5:53:08 pm">March 2nd 2012</span>
											by <span class='authorname'>Paul Dowsett</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Paul,</p>
<p>I can confirm that with the latest continuous build (2.0.0.v20120302121644) using V8 still crashes on Android phone 2.3.4. After about 20 -25 clicks of the button the app hanges then crashes I have replicated this 3 times so far. The app got up to 58-60 mb before crashing.</p>
<p>Thanks</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 7:16:38 pm">March 2nd 2012</span>
											by <span class='authorname'>Mathew Rain</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hey Paul,</p>
<p>Which test case, 1 or 2 do you want me to test with on the latest build? I can test both if that helps.</p>
<p>Thank You</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 7:19:20 pm">March 2nd 2012</span>
											by <span class='authorname'>sean sean</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Mathew - please add your findings, including your full environment (device make and model too!), as a comment to the ticket.</p>
<p>Sean - results for test case 1 will be adequate.</p>
<p>Thanks</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 7:24:35 pm">March 2nd 2012</span>
											by <span class='authorname'>Paul Dowsett</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I have tested your test case 1 with the latest continuous build  (2.0.0.v20120302121644) and it still crashes on my Adroid phone also running the same build as Mathew 2.3.4. I will add more details in the ticket.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2012, 7:50:30 pm">March 2nd 2012</span>
											by <span class='authorname'>sean sean</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Mathew, single context does not mean to have only one window (it means not to use &quot;url&quot; property when creating windows). </p>
<p>Anyway, what I wrote has nothing to do with &quot;Memory pool&quot; technique, I was just writing typical use case in the app. Basically, you might have created a problem by using code that you won&#39;t be using anywhere.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 5th 2012, 5:40:05 am">March 5th 2012</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Everyone,</p>
<p>I have created another test case that shows that memory cleanup is not working with V8. This test case is also a little closer to real world. The test case opens up 1 window and 1 button. The button on the main window will then open a view, create 1000 labels and then also add a button to the view. If you click the button it will create a 2nd view then create 1000 labels and add another button to the 2nd view then &quot;clean up&quot; or mark objects for Garbage Collection. The buttons basically toggle between the 2 views. Over time as memory grows the labels and views should get garbage collected. After running this new test case a bunch of times on at least 3 devices the test case crashes every time due to lack of memory. I have let the app sit for a while to see if it ever gets garbage collected and memory to go down and it never does.</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> win = Ti.UI.createWindow({
    backgroundColor: <span class="hljs-string">"white"</span>
});
<span class="hljs-comment">//create View 1 - yellow background</span>
<span class="hljs-keyword">var</span> button = Ti.UI.createButton({
    title: <span class="hljs-string">"Go To View 1"</span>
});
button.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    view1New();
});    
<span class="hljs-comment">//add button to window</span>
win.add(button);
<span class="hljs-comment">//open Main window</span>
win.open();

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">view1New</span><span class="hljs-params">()</span></span>{

    <span class="hljs-comment">//create view 1</span>
    <span class="hljs-keyword">var</span> view1 = Ti.UI.createView({
        backgroundColor: <span class="hljs-string">'yellow'</span>,
    });

    <span class="hljs-comment">//function to create labels on each of the 2 views</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mainLabels</span><span class="hljs-params">()</span> </span>{
        Ti.API.info(<span class="hljs-string">'****** mainLabels function has started ******'</span>);
        <span class="hljs-keyword">var</span> labels =[];
        <span class="hljs-keyword">var</span> label = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2000</span>; i++) {
            label = Ti.UI.createLabel();
            labels.push(labels);
        }
        Ti.API.info(<span class="hljs-string">'Titanium labels created and added to array'</span>);
        Ti.API.info(<span class="hljs-string">'****** mainLabels function has stopped ******'</span>);
    }
    <span class="hljs-comment">//create Labels</span>
    mainLabels();

    <span class="hljs-keyword">var</span> buttonView1 = Ti.UI.createButton({
        title: <span class="hljs-string">"Go To View 2"</span>
    });
    buttonView1.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
        view2New();    
        Ti.API.info(<span class="hljs-string">'****** Clean Up of View 1 ******'</span>);    
        <span class="hljs-comment">//clean up View 1</span>
        <span class="hljs-keyword">var</span> labels =[];
        <span class="hljs-keyword">var</span> label = <span class="hljs-literal">null</span>;        
        view1.remove(buttonView1);
        buttonView1 = <span class="hljs-literal">null</span>;
        win.remove(view1);
        view1 = <span class="hljs-literal">null</span>;
    });    
    view1.add(buttonView1);
    win.add(view1);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">view2New</span><span class="hljs-params">()</span></span>{
    <span class="hljs-comment">//create view 2</span>
    <span class="hljs-keyword">var</span> view2 = Ti.UI.createView({
    backgroundColor: <span class="hljs-string">'red'</span>,
    });

    <span class="hljs-comment">//function to create labels on each of the 2 views</span>
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mainLabels</span><span class="hljs-params">()</span> </span>{
        Ti.API.info(<span class="hljs-string">'****** mainLabels function has started ******'</span>);
        <span class="hljs-keyword">var</span> labels =[];
        <span class="hljs-keyword">var</span> label = <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">2000</span>; i++) {
            label = Ti.UI.createLabel();
            labels.push(labels);
        }
        Ti.API.info(<span class="hljs-string">'Titanium labels created and added to array'</span>);
        Ti.API.info(<span class="hljs-string">'****** mainLabels function has stopped ******'</span>);
    }    
    <span class="hljs-comment">//create the labels on view2</span>
    mainLabels();
    <span class="hljs-keyword">var</span> buttonView2 = Ti.UI.createButton({
        title: <span class="hljs-string">"Go To View 1"</span>
    });
    buttonView2.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{    
        view1New();
        Ti.API.info(<span class="hljs-string">'****** Clean Up of View 2 ******'</span>);    
        <span class="hljs-comment">//clean up View 1</span>
        <span class="hljs-keyword">var</span> labels =[];
        <span class="hljs-keyword">var</span> label = <span class="hljs-literal">null</span>;        
        view2.remove(buttonView2);
        buttonView2 = <span class="hljs-literal">null</span>;
        win.remove(view2);
        view2 = <span class="hljs-literal">null</span>;    
    });    

    view2.add(buttonView2);
    <span class="hljs-comment">//add view to main win</span>
    win.add(view2);    
}
</code></pre><p>I also ran the above sample in iOS and using Instruments the UI objects get properly cleaned up. (No Living Objects hanging around).</p>
<p>Hope this may also prove that there is a memory issue in titainium with V8. Can anyone else run this and confirm my results?</p>
<p>Thank You</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 5th 2012, 7:18:50 pm">March 5th 2012</span>
											by <span class='authorname'>sean sean</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi,</p>
<p>Sean - another great test case to show the memory issue on Android. I have been following this forum closely and I have reproduced the memory leak issue on Android with this test case as well and can confirm Seans findings that memory is never freed on Android - no matter how long you let the app sit there - the Garbage collection does not seem to release resources associated with the labels.</p>
<p>In my real-world application that has memory issues - I have a number of view with a ton of labels and tables with table data containing labels that causes leaks as you go in and out of them.</p>
<p>Back to Ivans post earlier - just want to clarify that the original test case from Sean was not real world example but I think you are missing the point - the idea of that test case was to show how quickly resources can be used up and if memory is not released properly will eventually crash the application - this was done I believe to have a quick reproducible test case not a real-world test case. </p>
<p>Also - I can confirm Seans findings that the iPhone version releases resources correctly.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 5th 2012, 7:51:34 pm">March 5th 2012</span>
											by <span class='authorname'>Mathew Rain</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Sean - posting your findings here and producing further test cases doesn&#39;t really provide any further proof. Although my test case works on an HTC Sensation, Mathew has posted details of another device where the issue is exhibited. Hence, please would you post your environment and findings as a comment to the ticket? Thank you.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 5th 2012, 10:59:28 pm">March 5th 2012</span>
											by <span class='authorname'>Paul Dowsett</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-230969">
				
						<section>
							<p>Hi Aaron or anyone from Appcelerator,</p>
<p>I was wondering if you any any other suggestions to try on this test case you where helping me look at. I have tested this on the that latest builds and the issue is still broken. I found a version of 1.8.0 that if you run it with DDMS you will actually see the memory get cleaned up for the most part (1.8.0.v220111007101045) when you click the &quot;Cause GC&quot; button. This version of the SDK sorta shows that memory is cleaned up without having to loop through the array. This still does not fix the issue because it only slows the memory leak. It grows very slowly still with the 1.8.0 (1045 version) Why would this be broken in new version? I am starting to think this is a bug in Titanium that should be looked at by Appcelerator what do you think?</p>
<p>Thanks for any advice.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 20th 2012, 7:48:55 pm">February 20th 2012</span>
								by <span class='authorname'>sean sean</span><br>
								<a class="icon-bg icon-link" href="../../question/132357/memory-leaks-on-android-but-not-on-ios---very-simple-test-case.html#answer-230969" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>For those that say just give Android time to clean up. I have changed the above code to include a window and a button that will run the function as many times as you want. Eventually the emulator and device will crash.</p>
<p>This code should definitely be cleaning its memory&#x2F;resources up. Can anyone explain why this code eventually would cause the device&#x2F;emulator to run out of resources and crash?? I can not come up with one good reason especially since all over the forums appcelerator stats that setting objects to null and using self-calling functions should clean up memory?</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> win = Titanium.UI.createWindow({
    backgroundColor: <span class="hljs-string">'blue'</span>,
    height:<span class="hljs-number">400</span>,
    width:<span class="hljs-number">300</span>,
    borderRadius:<span class="hljs-number">10</span>,

});

win.open();

<span class="hljs-keyword">var</span> button = Titanium.UI.createButton({
   title: <span class="hljs-string">'create 1000 views'</span>,
   top: <span class="hljs-number">10</span>,
   width: <span class="hljs-number">100</span>,
   height: <span class="hljs-number">50</span>
});
button.addEventListener(<span class="hljs-string">'click'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
</span>{
   test();
});

win.add(button);

(<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> 
</span>{ 
    <span class="hljs-keyword">var</span> views =[];  
    <span class="hljs-keyword">var</span> view = <span class="hljs-keyword">null</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {


        view = Titanium.UI.createButton(
        {
            <span class="hljs-comment">//backgroundImage: '/images/background2.jpg',</span>
            <span class="hljs-comment">//backgroundColor: 'blue',</span>
            top:<span class="hljs-number">0</span>,
            left:<span class="hljs-number">0</span>,
            width:Ti.Platform.displayCaps.platformWidth,
            height:<span class="hljs-number">200</span>,

        });
        views.push(view);
    }
    <span class="hljs-comment">//alert(views.length);</span>
    <span class="hljs-comment">/*
    for(var i=0; i &lt; 1000; i++) {
           views[i] = null;
           //alert(i);
    }
    */</span>

    views =[];
    views = <span class="hljs-keyword">null</span>;  
    <span class="hljs-comment">//view = null;</span>
    <span class="hljs-comment">//alert(views.length);</span>
}());

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">test</span><span class="hljs-params">()</span> 
</span>{ 
    <span class="hljs-keyword">var</span> views =[];  
    <span class="hljs-keyword">var</span> view = <span class="hljs-keyword">null</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {


        view = Titanium.UI.createButton(
        {
            <span class="hljs-comment">//backgroundImage: '/images/background2.jpg',</span>
            <span class="hljs-comment">//backgroundColor: 'blue',</span>
            top:<span class="hljs-number">0</span>,
            left:<span class="hljs-number">0</span>,
            width:Ti.Platform.displayCaps.platformWidth,
            height:<span class="hljs-number">200</span>,

        });
        views.push(view);
    }
    <span class="hljs-comment">//alert(views.length);</span>

    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {
           views[i] = <span class="hljs-keyword">null</span>;
           <span class="hljs-comment">//alert(i);</span>
    }


    views =[];
    views = <span class="hljs-keyword">null</span>;  
    <span class="hljs-comment">//view = null;</span>
    <span class="hljs-comment">//alert(views.length);</span>
};
</code></pre><p>Thank You</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 20th 2012, 8:43:17 pm">February 20th 2012</span>
											by <span class='authorname'>sean sean</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-231082">
				
						<section>
							<p>Hi,</p>
<p>I have also tested the above example on both PC running latest version of Titanium Studio and Titanium SDK 1.9 version as well as on the Mac OSX Lion and can confirm the resullts above by Sean. Memory is definetly being cleaned up on the Mac (as seen in Instruments) but on the PC (using DDMS) the memory just keeps growing and growing and eventually crashes the app. I have even tried to let the app on Android sit there and do a manual Cause GC and it dosent not release the resources. </p>
<p>Why is it that all the examples or samples in the Titanium documentation and guides only show how to create UI and controls but not exactly how to clean up memory. Even the best practice guide on designing Titanium apps - the statement of do not pollute the global name space and make sure to null your objects - does NOT give you a simple example on how to do this so it works on both Android and iOS. The sample apps from Appceleator - Kitchen Sink which is multicontext (everyone says DO NOT USE this other than a example guide) and Tweetanium (it appears this is also not a good sample as it does not clean up correctly).</p>
<p>Is there someone at Appcelerator that can provide a very SIMPLE test case like Sean has above that adds and removes a VIEW and a BUTTON or LABEL to a view and show the correct way to implement it so that it is cleaned up…every forum post about memory manangement either ends up in a philosophical debate on how NOT to do it - but never a working solution on how it should be done.</p>
<p>Thanks for all your advice<br>Matt</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 21st 2012, 3:00:00 pm">February 21st 2012</span>
								by <span class='authorname'>Mathew Rain</span><br>
								<a class="icon-bg icon-link" href="../../question/132357/memory-leaks-on-android-but-not-on-ios---very-simple-test-case.html#answer-231082" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-243759">
				
						<section>
							<p>HI all,<br>         anyone find out solve this memory issue??</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 25th 2012, 10:24:29 am">July 25th 2012</span>
								by <span class='authorname'>vinod varghese</span><br>
								<a class="icon-bg icon-link" href="../../question/132357/memory-leaks-on-android-but-not-on-ios---very-simple-test-case.html#answer-243759" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-1</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-230751">
				
						<section>
							<p>to really clear out the views, you should do  this</p>
<pre><code class="hljs"><span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> views) {
   views[i] = <span class="hljs-literal">null</span>;
}
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 18th 2012, 1:08:22 am">February 18th 2012</span>
								by <span class='authorname'>Aaron Saunders</span><br>
								<a class="icon-bg icon-link" href="../../question/132357/memory-leaks-on-android-but-not-on-ios---very-simple-test-case.html#answer-230751" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Yep, as aaron states, you need to actually clear the references to each view that you create. Destroying its container does not free each individual view.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 18th 2012, 1:46:57 am">February 18th 2012</span>
											by <span class='authorname'>Tony Lukasavage</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Tony &amp; Arron,</p>
<p>I have tried what you suggested by adding the following lines app.js. This did NOT destroy or free up any of the memory. </p>
<pre><code class="hljs">    <span class="hljs-comment">//alert(views.length);</span>
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {
           views[i] = <span class="hljs-literal">null</span>;
           <span class="hljs-comment">//alert(i);</span>
    }
</code></pre><p>I do not understand why my previous code would work on iOS perfect and not even close on Android. This seems way to simple for it not to be working on Android. If you guys want I could provide another sample that I have tested that uses a button on the screen and keeps calling that same function over again every time its clicked. The memory never gets cleaned up. I have also tested this sample app on my phone and eventually the app crashes due to memory usage.</p>
<p>I also found a this issue on Appcelerator Issue Tracker:</p>
<p>Titanium Mobile TIMOB-7409<br>https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TIMOB-7409?page=com.atlassian.jira.plugin.system.issuetabpanels:all-tabpanel#issue-tabs</p>
<p>Where they add views to an array and then null the array. No one at appcelerator says to loop through the array to properly clean up memory. (Which does not seem to work anyways.) They actually say that nulling the array should work and say that its a bug in Android. They also say that is supposed to be fixed in the latest version of 1.9.0 which I have tested and still does not work.</p>
<p>Thank You</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 18th 2012, 1:01:15 pm">February 18th 2012</span>
											by <span class='authorname'>sean sean</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>what version of the Android SDK are you using? Also why are you assuming that the memory is going to be garbage collected immediately?</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 18th 2012, 2:01:27 pm">February 18th 2012</span>
											by <span class='authorname'>Aaron Saunders</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Aaron,</p>
<p>The android SDK version is 16. I dont think it will immediately but is not freeing it up not matter how long it sits. I have let the phone and emulator sit for over an hour and come back the memory level still does not get cleaned up. Do you have any other suggestion? I am wondering if this is a bug in Titanium because this is so fundamental. </p>
<p>Thanks for you feedback</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 18th 2012, 6:34:50 pm">February 18th 2012</span>
											by <span class='authorname'>sean sean</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-2</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
