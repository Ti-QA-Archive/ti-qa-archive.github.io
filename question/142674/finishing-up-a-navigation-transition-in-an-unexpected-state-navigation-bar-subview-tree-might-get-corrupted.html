<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Finishing up a navigation transition in an unexpected state. Navigation Bar subview tree might get corrupted. » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Finishing up a navigation transition in an unexpected state. Navigation Bar subview tree might get corrupted.</h1>
		</header>
		<section>
			<p>I get the following error :</p>
<p>Finishing up a navigation transition in an unexpected state. Navigation Bar subview tree might get corrupted.</p>
<p>when I use navgroups</p>
<p>I basically have multiple windows connected together via nav group using the tutorial below:<br>http:&#x2F;&#x2F;blog.clearlyinnovative.com&#x2F;post&#x2F;1624173028&#x2F;titanium-appcelerator-quickie-navigation-groups</p>
<p>For example to open a new window I use</p>
<pre><code class="hljs"><span class="hljs-component">Ti.App.addEventListener('services', function(event) {



    var cwin = Titanium<span class="hljs-string">.UI.currentWindow</span>;
    var swin = Titanium<span class="hljs-string">.UI.createWindow()</span>;

    swin<span class="hljs-string">.url</span> = 'service<span class="hljs-string">.js'</span>;
    swin<span class="hljs-string">.zipcode</span> = event<span class="hljs-string">.zipcode</span>;
    swin<span class="hljs-string">.user_id</span> = event<span class="hljs-string">.user_id</span>;
    swin<span class="hljs-string">.user_uniqid</span> = event<span class="hljs-string">.user_uniqid</span>;
    swin<span class="hljs-string">.user_name</span> = event<span class="hljs-string">.user_name</span>;
    swin<span class="hljs-string">.user_email</span> = event<span class="hljs-string">.user_email</span>;

    swin<span class="hljs-string">.backgroundColor</span> = '<span class="hljs-comment">#f7f7f7';</span>

    swin<span class="hljs-string">._parent</span> = cwin;
    swin<span class="hljs-string">.navGroup</span> = cwin<span class="hljs-string">.navGroup</span>;
    swin<span class="hljs-string">.rootWindow</span> = cwin<span class="hljs-string">.rootWindow</span>;
    cwin<span class="hljs-string">.navGroup.open(swin)</span>;
}</span>);
</code></pre><p>and that window where the code above is was opened in a similar way.</p>
<p>So I followed the tutorial above to have multiple windows in a navgroup. Window 1 -&gt; Window 2 -&gt; window 3 -&gt; window 1 -&gt; window 2 etc</p>
<p>I get the error when i try to go back to previous windows</p>
<p>what can I do?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="September 25th 2012, 6:34:08 pm">September 25th 2012</span>
				by <span class='authorname'>Weina Scott</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>iphone</span></li>
					
						<li><span class='tagname'>mobile</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>when a user clicks on a button, the services event listener is executed.</p>
<pre><code class="hljs"><span class="hljs-tag">button1</span><span class="hljs-class">.addEventListener</span>(<span class="hljs-string">'click'</span>, <span class="hljs-function">function</span>() {
    <span class="hljs-tag">Ti</span><span class="hljs-class">.App</span><span class="hljs-class">.fireEvent</span>(<span class="hljs-string">'services'</span>, {
        <span class="hljs-attribute">zipcode </span>: win.zipcode,
        <span class="hljs-attribute">user_id </span>: win.user_id,
        <span class="hljs-attribute">user_uniqid </span>: win.user_uniqid,
        <span class="hljs-attribute">user_name </span>: win.user_name,
        <span class="hljs-attribute">user_email </span>: win.user_email
    });
});
</code></pre></div>
							<div class="author">
								&mdash; commented <span title="September 25th 2012, 8:27:34 pm">September 25th 2012</span>
								by <span class='authorname'>Weina Scott</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>if the button is on the same window (is it?) as the event listener, why not create the window directly inside the the &#39;onClick&#39; callback?</p>
</div>
							<div class="author">
								&mdash; commented <span title="September 25th 2012, 9:05:35 pm">September 25th 2012</span>
								by <span class='authorname'>Richard Lustemberg</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-248043">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>I have not looked at the tutorial code, but at first glance I can see that if you open windows in this way, you end up with trouble. Every window you open sets an Ti.App event listener, which stays in the global scope after you close the window.<br>So , when the event fires, all those event listeners will open a window. You see one window opening , but in fact you are opening a growing amount of windows every time.<br>If you are staggering windows this way, you&#39;ll need to use an eventlistener at a different scope (perhaps on the window level). In any case, make sure that you remove the event listener when the window closes. To do that reference the callback with a variable first </p>
<pre><code class="hljs"><span class="hljs-component">function openWindow (event){
 var cwin = Titanium<span class="hljs-string">.UI.currentWindow</span>;
    var swin = Titanium<span class="hljs-string">.UI.createWindow()</span>;

    swin<span class="hljs-string">.url</span> = 'service<span class="hljs-string">.js'</span>;
    swin<span class="hljs-string">.zipcode</span> = event<span class="hljs-string">.zipcode</span>;
    swin<span class="hljs-string">.user_id</span> = event<span class="hljs-string">.user_id</span>;
    swin<span class="hljs-string">.user_uniqid</span> = event<span class="hljs-string">.user_uniqid</span>;
    swin<span class="hljs-string">.user_name</span> = event<span class="hljs-string">.user_name</span>;
    swin<span class="hljs-string">.user_email</span> = event<span class="hljs-string">.user_email</span>;

    swin<span class="hljs-string">.backgroundColor</span> = '<span class="hljs-comment">#f7f7f7';</span>

    swin<span class="hljs-string">._parent</span> = cwin;
    swin<span class="hljs-string">.navGroup</span> = cwin<span class="hljs-string">.navGroup</span>;
    swin<span class="hljs-string">.rootWindow</span> = cwin<span class="hljs-string">.rootWindow</span>;
    cwin<span class="hljs-string">.navGroup.open(swin)</span>;
}</span>
Ti.App.addEventListener('services',openWindow)
<span class="hljs-component">Titanium.UI.currentWindow.addEventListener ('close', function (){
    Ti<span class="hljs-string">.App.removeEventListener('services'</span>,openWindow)
}</span>);
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 25th 2012, 7:36:41 pm">September 25th 2012</span>
								by <span class='authorname'>Richard Lustemberg</span><br>
								<a class="icon-bg icon-link" href="question/142674/finishing-up-a-navigation-transition-in-an-unexpected-state-navigation-bar-subview-tree-might-get-corrupted#answer-248043" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>unfortunately, Titanium.UI.currentWindow.addEventListener (&#39;close&#39;, function (){<br>    alert(1);<br>    Ti.App.removeEventListener(&#39;services&#39;,openWindow)<br>}); is never called because the window never closes…. I put an alert(1) in the function, and that is never called.</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 25th 2012, 8:29:34 pm">September 25th 2012</span>
											by <span class='authorname'>Weina Scott</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I should have used a reference :</p>
<pre><code class="hljs">cwin.addEventListener (<span class="hljs-string">'close'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span></span>{
    Ti.App.removeEventListener(<span class="hljs-string">'services'</span>,openWindow)
});<span class="hljs-comment">// put this inside the openWindow() callback</span>
</code></pre><p>In any case, I&#39;ve noticed that you are using file url&#39;s , and that&#39;s not a good practice, although the original Kitchen Sink was written using that approach. As I have never written Titanium code like this, I don&#39;t  know exactly the scope of the Titanium.UI.currentWindow variable. That reference is only available when using file url&#39;s  and creating multiple execution contexts.  Perhaps you can post more code to see if there&#39;s another reason for the window not closing. Anyway, I would not advise to use that approach to learn Titanium.</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 25th 2012, 8:40:12 pm">September 25th 2012</span>
											by <span class='authorname'>Richard Lustemberg</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>that does not work … still gives me the same problem. Also, how would you pass in the file name for efficiency?</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 26th 2012, 4:31:55 pm">September 26th 2012</span>
											by <span class='authorname'>Weina Scott</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I&#39;ve made a comment about why you are using Ti.App.Event to open new windows. This is not on the tutorial you are pointing to, and creates the problem of all of those windows being opened on top of each other and messes up the navigation controller&#39;s state. I would suggest you to start from scratch, or just post the full code for us to see what&#39;s going on</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 26th 2012, 9:56:25 pm">September 26th 2012</span>
											by <span class='authorname'>Richard Lustemberg</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
