<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Animation delay » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Animation delay</h1>
		</header>
		<section>
			<p>I have an animation which is a clock. I start&#x2F;stop&#x2F;pause the timer on a EventListener (&#39;click&#39;) on the view, but I am noticing that the first run of the animation, there is a pause of about 3-4 seconds after the first &#39;click&#39; event before the animations start. Subsequent clicks happen instantenously.<br>Has anyone else seen this and if so, did they manage to figure out why it was happening. What did they do about it?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="June 6th 2011, 6:17:16 pm">June 6th 2011</span>
				by <span class='authorname'>Gregor Munro</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>animation</span></li>
					
						<li><span class='tagname'>delay</span></li>
					
						<li><span class='tagname'>eventlistener</span></li>
					
						<li><span class='tagname'>start</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>5</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>5 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-209432">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>Yes, the sound object will have a delay at start and I also had the preload issue. So the workaround is the only way (as far as I know).<br>At least u managed to fix it :)</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 7th 2011, 6:19:42 am">June 7th 2011</span>
								by <span class='authorname'>Dan Tamas</span><br>
								<a class="icon-bg icon-link" href="question/120624/animation-delay#answer-209432" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-209404">
				
						<section>
							<p>OK, I was able to work around the problem when I looked up other sound items in the Q&amp;A.<br>I tried </p>
<pre><code class="hljs"> var soundTO = Titanium.Media.createSound({<span class="hljs-string">url:</span><span class="hljs-string">'sounds/beepTO.wav'</span>,<span class="hljs-string">preload:</span><span class="hljs-literal">true</span>});
</code></pre><p>but it did not help, however<br>if I instead called the following code directly after the var statement, it preloaded the sound bite before the animation started which meant that the delay was no longer noticeable…</p>
<pre><code class="hljs"><span class="hljs-tag">soundTO</span><span class="hljs-class">.play</span>();
<span class="hljs-tag">soundTO</span><span class="hljs-class">.pause</span>();
</code></pre><p>This is definitely a workaround and not a real solution. I wonder why the preload doesn&#39;t work as it says it should on the tin (ie the API documentation) ?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 7th 2011, 12:13:06 am">June 7th 2011</span>
								by <span class='authorname'>Gregor Munro</span><br>
								<a class="icon-bg icon-link" href="question/120624/animation-delay#answer-209404" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-209384">
				
						<section>
							<p>Show us some code.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 6th 2011, 6:30:25 pm">June 6th 2011</span>
								by <span class='authorname'>Dan Tamas</span><br>
								<a class="icon-bg icon-link" href="question/120624/animation-delay#answer-209384" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-209393">
				
						<section>
							<p>OK,<br>I was trying to avoid that because it all gets a bit messy; being first cut code… needless to say, this is running on 1.7.0 RC1 on iOS - although I intend extending the code to Android after I get the app running completely. </p>
<p>My basic premise is that of a stopwatch with a single tap to start or pause and a double tap for reset. After 20 repetitions, it asks you ad infinitum if you want to add another 5 mins.</p>
<p>Also 15 seconds or so after the timer hand rotates past 360 degrees, an advertisement or newsbite appears over the top of the stopwatch view.</p>
<p>Based upon my code I have a function for my animation thus:</p>
<pre><code class="hljs">e2tb.ui.create_win_stopwatch = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span>{
 <span class="hljs-keyword">var</span> win = Titanium.UI.createWindow({ className:<span class="hljs-string">'win_stopwatch_style'</span> });
 <span class="hljs-keyword">var</span> imageView = Titanium.UI.createImageView({ className:<span class="hljs-string">'view_stopwatch_style'</span> });
 <span class="hljs-keyword">var</span> imageViewTH = Titanium.UI.createImageView({ className:<span class="hljs-string">'view_stopwatch_hand_style'</span> });
 <span class="hljs-keyword">var</span> winAdvert = Titanium.UI.createWindow({ className:<span class="hljs-string">'win_advert_style'</span> });
 <span class="hljs-keyword">var</span> labelAdvert = Titanium.UI.createLabel({ className:<span class="hljs-string">'win_advert_label_style'</span> });                
 <span class="hljs-keyword">var</span> soundTO   = Titanium.Media.createSound({url:<span class="hljs-string">'sounds/beepTO.wav'</span>});
 <span class="hljs-keyword">var</span> soundRST  = Titanium.Media.createSound({url:<span class="hljs-string">'sounds/beepRST.wav'</span>});
 <span class="hljs-keyword">var</span> soundPSE  = Titanium.Media.createSound({url:<span class="hljs-string">'sounds/beepPSE.wav'</span>});
 <span class="hljs-keyword">var</span> stopped   = <span class="hljs-literal">true</span>;    
 <span class="hljs-keyword">var</span> bearing   = <span class="hljs-number">360</span>;
 <span class="hljs-keyword">var</span> cuescount = <span class="hljs-number">0</span>;
 <span class="hljs-keyword">var</span> cuesmax   = <span class="hljs-number">20</span>;
 <span class="hljs-keyword">var</span> cuesadd   = <span class="hljs-number">5</span>;

 <span class="hljs-keyword">var</span> t=Titanium.UI.create2DMatrix();
 <span class="hljs-keyword">var</span> spin=Titanium.UI.createAnimation();
 t = t.rotate(-<span class="hljs-number">1</span>);
 spin.transform = t;
 spin.duration  = <span class="hljs-number">200</span>;

 <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">tick</span><span class="hljs-params">()</span> </span>{
  bearing--;
  t = t.rotate(-<span class="hljs-number">1</span>);
  spin.transform = t;
  imageViewTH.animate(spin);
  <span class="hljs-keyword">if</span> (bearing===<span class="hljs-number">270</span>){
   showRandomAd();
  } 
 }

 <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">moreTime</span><span class="hljs-params">()</span> </span>{
  <span class="hljs-keyword">var</span> winAlert = Titanium.UI.createWindow({ className:<span class="hljs-string">'win_alert_style'</span> });
  <span class="hljs-keyword">var</span> Alertlabel = Titanium.UI.createLabel({ 
   className:<span class="hljs-string">'win_alert_label_style'</span>,
   text=L(<span class="hljs-string">"alert_more_time"</span>,<span class="hljs-string">"Do you want to add 5 more minutes to the timer?"</span>)
  });
  <span class="hljs-keyword">var</span> button_yes, button_no;

  <span class="hljs-keyword">if</span> (isiOS()){
   button_yes = Titanium.UI.createButton({ className: <span class="hljs-string">'button_yes_iOS'</span> });
   button_no = Titanium.UI.createButton({  className: <span class="hljs-string">'button_no_iOS'</span> });
  } <span class="hljs-keyword">else</span> {
   button_yes = Titanium.UI.createButton({ className: <span class="hljs-string">'button_yes_android'</span>});
   button_no = Titanium.UI.createButton({  className: <span class="hljs-string">'button_no_android'</span>});
  }                

  button_yes.addEventListener(<span class="hljs-string">'click'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
   cuesmax=cuesmax+cuesadd;
   tick();
   winAlert.close();
  });

  button_no.addEventListener(<span class="hljs-string">'click'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
   stopped=<span class="hljs-literal">true</span>;
   cuesmax=<span class="hljs-number">2</span>;
   cuescount=<span class="hljs-number">0</span>;
   winAlert.close();
  });

  winAlert.add(Alertlabel);
  winAlert.add(button_yes);
  winAlert.add(button_no);
  winAlert.open();
 }

 <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showRandomAd</span><span class="hljs-params">()</span></span>{
  <span class="hljs-keyword">var</span> tmptext=e2tb.db.get_infobite_rnd(Titanium.Locale.currentLanguage);
  label.text=tmptext;
  winAdvert.open();
  setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
   winAdvert.close({opacity:<span class="hljs-number">0</span>,duration:<span class="hljs-number">1000</span>});
  },<span class="hljs-number">5000</span>);
 }

 <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">restart</span><span class="hljs-params">()</span> </span>{
  Titanium.Media.vibrate();
  soundTO.play();
  bearing=<span class="hljs-number">360</span>;
  cuescount++;
  <span class="hljs-keyword">if</span> (cuescount&gt;=cuesmax) {
   moretime();
  } <span class="hljs-keyword">else</span> {
   tick();
  }
 }        

 spin.addEventListener(<span class="hljs-string">'complete'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
  <span class="hljs-keyword">if</span> (!stopped) {
   <span class="hljs-keyword">if</span>(bearing===<span class="hljs-number">0</span>){
    restart();
   } <span class="hljs-keyword">else</span> {
    tick();
   }
  }
 });    

 win.addEventListener(<span class="hljs-string">'singletap'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_e)</span></span>{
  <span class="hljs-keyword">if</span> (stopped) {    <span class="hljs-comment">// start</span>
   stopped=<span class="hljs-literal">false</span>;
   tick();
   soundPSE.play();
  } <span class="hljs-keyword">else</span> {        <span class="hljs-comment">// stop</span>
   stopped=<span class="hljs-literal">true</span>;
   soundPSE.play();
  }
 });        

 win.addEventListener(<span class="hljs-string">'doubletap'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(_e)</span></span>{     <span class="hljs-comment">//reset</span>
  stopped=<span class="hljs-literal">true</span>;
  t=t.rotate(-(bearing));
  spin.transform = t;
  imageViewTH.animate(spin);
  soundRST.play();
  bearing=<span class="hljs-number">360</span>;
 });

 winInfobite.add(label);
 win.add(imageView);
 win.add(imageViewTH);
 <span class="hljs-keyword">return</span> win;
};
</code></pre><p>I know its not the best coding in the world, but it (mostly) achieves the desired result.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 6th 2011, 9:52:33 pm">June 6th 2011</span>
								by <span class='authorname'>Gregor Munro</span><br>
								<a class="icon-bg icon-link" href="question/120624/animation-delay#answer-209393" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-209397">
				
						<section>
							<p>I have managed to further pinpoint the issue. It appears that the animation is paused the first time a sound is played. If I remove the </p>
<pre><code class="hljs"><span class="hljs-tag">soundTo</span><span class="hljs-class">.play</span>();
</code></pre><p>The animation starts as expected. Once the sound has played the first time, it does not pause again.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 6th 2011, 10:40:19 pm">June 6th 2011</span>
								by <span class='authorname'>Gregor Munro</span><br>
								<a class="icon-bg icon-link" href="question/120624/animation-delay#answer-209397" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
