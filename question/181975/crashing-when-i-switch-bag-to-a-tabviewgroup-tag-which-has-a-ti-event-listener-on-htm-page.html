<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>crashing when I switch bag to a tabviewgroup tag which has a TI event listener on htm page » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>crashing when I switch bag to a tabviewgroup tag which has a TI event listener on htm page</h1>
		</header>
		<section>
			<p>Please can someone help me. I have no idea why this code is crashing. I run it once and it works exactly as expected however if I click from my graphs tab to another tab and then come back to the graphs tab the whole program crashes giving an NS_ERROR_NOT_AVAILABLE. I have a webview which uses it url attr to load a local htm file, and uses Ti.App event listener to communicate between the htm file and the main application. The code looks like this:</p>
<pre><code class="hljs"><span class="xml">graphs.js

(function() </span><span class="hljs-expression">{  
    <span class="hljs-variable">data</span>  = <span class="hljs-variable">require</span>('<span class="hljs-end-block">/data</span><span class="hljs-end-block">/SQLiteAdapter</span>');

    <span class="hljs-variable">graph</span> = <span class="hljs-variable">Ti.UI.createWebView</span>({
       <span class="hljs-variable">top</span>: '10%',
       <span class="hljs-variable">right</span>: '10%',
       <span class="hljs-variable">width</span>: '80%',
       <span class="hljs-variable">height</span>: '80%',
       <span class="hljs-variable">enableZoomControls</span>:<span class="hljs-variable">false</span>,
       <span class="hljs-variable">touchEnabled</span>:<span class="hljs-variable">true</span>,
       <span class="hljs-variable">url</span>: '<span class="hljs-end-block">/html</span><span class="hljs-end-block">/graph.htm</span>',
    }</span><span class="xml">);

    graph.addEventListener('load', function() </span><span class="hljs-expression">{        
        /<span class="hljs-end-block">/fires the first time no problems but cause crash <span class="hljs-keyword">if</span> I navigate back to tab</span>
        <span class="hljs-variable"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable">Ti.App.fireEvent</span>('<span class="hljs-variable">drawGraph</span>', [10,20,30,40,50,60,70])){}</span><span class="xml"> //getting fired    
   });

    Ti.UI.currentWindow.add(graph);
})();


graph.htm

<span class="hljs-doctype">&lt;!doctype html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>Graphs<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span> 
 <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"width=device-width, initial-scale=1.0"</span>/&gt;</span>  
 <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/raphael/raphael-min.lib"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span> 
 <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/raphael/g.raphael-min.lib"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span> 
 <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"/raphael/g.bar-min.lib"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span> 
<span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-title">body</span> <span class="hljs-attribute">style</span>=<span class="hljs-value">"background-color:#ddd"</span>&gt;</span> 
<span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"chartDiv"</span> <span class="hljs-attribute">style</span>=<span class="hljs-value">"width:100%; height: 100%; margin: 0; background-color:#ddd"</span>&gt;</span> <span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">var</span> Ti = <span class="hljs-built_in">window</span>.parent.Ti;
    Ti.App.addEventListener(<span class="hljs-string">'drawGraph'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span></span></span><span class="hljs-expression">{
        <span class="hljs-variable">alert</span>('<span class="hljs-variable">this</span> <span class="hljs-variable">works</span>');
        /*
        <span class="hljs-variable">var</span> <span class="hljs-variable">r</span> = <span class="hljs-variable">Raphael</span>(<span class="hljs-string">"chartDiv"</span>);               
        <span class="hljs-variable">r.barchart</span>(0, 0, 270, 240, <span class="hljs-variable">data</span>, 0, {<span class="hljs-variable">type</span>: <span class="hljs-string">"sharp"</span>}</span><span class="xml"><span class="undefined">); 
        */
    });
</span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span> 
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span></span>
</code></pre><p>I imagine the issue is caused by the combined behaviour of tabgroup which the graphview is hosted in…  and the combination of it having a webview in it and the way in which it loads is causing the event listener to be odd, but I really don&#39;t know I have been fiddling with the code for days with no positive results</p>
<p>I have tried mobile web preview, and Android device, and emulator with the same behaviour in each.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="April 12th 2015, 2:31:52 pm">April 12th 2015</span>
				by <span class='authorname'>sam redway</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>eventlistener</span></li>
					
						<li><span class='tagname'>html</span></li>
					
						<li><span class='tagname'>tabgroup</span></li>
					
						<li><span class='tagname'>webview</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>I can clarify it is nothing to do with tabgroup as I have tested just using a heavy weight window and adding and removing the webview. It gives me the same error so is something to do with how titanium loads the view i guess…</p>
</div>
							<div class="author">
								&mdash; commented <span title="April 12th 2015, 5:06:25 pm">April 12th 2015</span>
								by <span class='authorname'>sam redway</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>I have tried many things. I have tried destroying the web view and building a new one and using a button press to fire the Ti global even rather than the load listener. Still the same problem so I can rule those things out as a cause. I wonder now if there is actually an instance of the htm file that is somehow held in memory that is trying to respond to the event being fired?This is really weird. Here is what I am playing with now and is much simpler to look at than that which I initially provided. I literally can&#39;t believe that nobody else has come across this bug? Could it be a factor that I am compiling on Linux Ubuntu? Test code to isolate problem: </p>
<pre><code class="hljs">app.js

<span class="hljs-comment">/*
 * Build window and buttons
 */</span>

<span class="hljs-keyword">var</span> win = Ti.UI.createWindow({
    layout: <span class="hljs-string">'vertical'</span>,
});


<span class="hljs-keyword">var</span> but = Ti.UI.createButton({
    top: <span class="hljs-number">20</span>,
    width: <span class="hljs-number">200</span>,
    height: <span class="hljs-number">50</span>,
    title: <span class="hljs-string">'Toggle WV'</span>,
});

<span class="hljs-keyword">var</span> but2 = Ti.UI.createButton({
    top: <span class="hljs-number">20</span>,
    width: <span class="hljs-number">200</span>,
    height: <span class="hljs-number">50</span>,
    title: <span class="hljs-string">'Fire Event'</span>
});

win.add(but);
win.add(but2);

<span class="hljs-comment">/*
 * Main functionality goes here of tests goes here.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newWv</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> wv = Ti.UI.createWebView({
        top:<span class="hljs-number">20</span>,
        height: <span class="hljs-string">'50%'</span>,
        url: <span class="hljs-string">'test.htm'</span>,
    });


    <span class="hljs-keyword">return</span> wv;
}


but.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.wv) {
        win.remove(<span class="hljs-keyword">this</span>.wv);
        <span class="hljs-keyword">this</span>.wv = <span class="hljs-literal">null</span>;          
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">this</span>.wv = newWv();
        win.add(<span class="hljs-keyword">this</span>.wv); 
    }    
});

but2.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    Ti.App.fireEvent(<span class="hljs-string">'go'</span>); 
    <span class="hljs-comment">//if fired before an instance of test.htm is nothing at all happens whereas if I fire even after wv is </span>
    <span class="hljs-comment">//destroyed I get error. So presume that instance of test.htm is attempting to receive? Look up mem</span>
    <span class="hljs-comment">//management, probably need to destroy instance of the htm file in mem.    </span>
});


win.open({modal:<span class="hljs-literal">true</span>});


test.htm

    &lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
    &lt;title&gt;Test&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;p&gt;A Little Test&lt;/p&gt;
    &lt;script&gt;
        <span class="hljs-keyword">var</span> Ti = window.parent.Ti;
        Ti.App.addEventListener(<span class="hljs-string">'go'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
            alert(<span class="hljs-string">'called by Titanium app'</span>);
        });
    &lt;/script&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre></div>
							<div class="author">
								&mdash; commented <span title="April 12th 2015, 7:06:00 pm">April 12th 2015</span>
								by <span class='authorname'>sam redway</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-286989">
				
						<section>
							<p>I solvved the problem in the end. I posted solution on Stack Overflow here: http:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;29593384&#x2F;issue-with-webview-and-ti-app-addeventlistener-causing-crash</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 13th 2015, 12:08:19 pm">April 13th 2015</span>
								by <span class='authorname'>sam redway</span><br>
								<a class="icon-bg icon-link" href="question/181975/crashing-when-i-switch-bag-to-a-tabviewgroup-tag-which-has-a-ti-event-listener-on-htm-page#answer-286989" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
