<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Global variable losing its scope » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Global variable losing its scope</h1>
		</header>
		<section>
			<p>Hi all. I am new to Titanium. I am working on some samples and met with a issue. I am declaring a variable globally and assigning a value to the variable inside a loop. The variable loses its scope when I use it in another loop. The code is below</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> _curLatitude;
<span class="hljs-keyword">var</span> _curLongitude;

Titanium.Geolocation.getCurrentPosition(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
...
<span class="hljs-keyword">var</span> longitude = e.coords.longitude;
<span class="hljs-keyword">var</span> latitude = e.coords.latitude;
_curLatitude = latitude;
_curLongitude = longitude;
Ti.API.info(<span class="hljs-string">"latitude - "</span> + _curLatitude);
Ti.API.info(<span class="hljs-string">"longitude - "</span> + _curLongitude);
...
});
</code></pre><p>The variables _curLatitude and _curLongitude has its scope here. Its prints the current latitude and longitude perfectly.</p>
<pre><code class="hljs"><span class="hljs-tag">Ti</span><span class="hljs-class">.API</span><span class="hljs-class">.info</span>("<span class="hljs-tag">latitude</span> <span class="hljs-tag">-</span> " + _<span class="hljs-tag">curLatitude</span>);
<span class="hljs-tag">Ti</span><span class="hljs-class">.API</span><span class="hljs-class">.info</span>("<span class="hljs-tag">longitude</span> <span class="hljs-tag">-</span> " + _<span class="hljs-tag">curLongitude</span>);
</code></pre><p>But loses its scope outside the loop and prints &quot;undefined&quot;.<br>How can I handle this? Thanks in advance.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="December 6th 2011, 10:12:55 am">December 6th 2011</span>
				by <span class='authorname'>iPhone Developer</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>geolocation</span></li>
					
						<li><span class='tagname'>iphone</span></li>
					
						<li><span class='tagname'>map</span></li>
					
						<li><span class='tagname'>mapview</span></li>
					
				</ul>
			

			<section>
				<h5>4 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>I had scope issues with the Geolocation methods for Titanium too. The only fix I have found is to put all of the things that need to use the coords in the getCurrentPosition method.</p>
</div>
							<div class="author">
								&mdash; commented <span title="December 6th 2011, 11:09:07 am">December 6th 2011</span>
								by <span class='authorname'>Jason Crider</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>if this is a scoping issue to be able to identify it more code examples would be needed. If as you say within the function the values are set, where are the actual globals defined and where are you trying to access them.</p>
</div>
							<div class="author">
								&mdash; commented <span title="December 6th 2011, 11:45:12 am">December 6th 2011</span>
								by <span class='authorname'>Trevor Ward</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Hi Jason. Thank you for the reply. Could you please post the code for me to identify?</p>
</div>
							<div class="author">
								&mdash; commented <span title="December 6th 2011, 11:48:24 am">December 6th 2011</span>
								by <span class='authorname'>iPhone Developer</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Hi Trevor. My code is below.</p>
</div>
							<div class="author">
								&mdash; commented <span title="December 6th 2011, 12:00:07 pm">December 6th 2011</span>
								by <span class='authorname'>iPhone Developer</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-224936">
				
						<section>
							<p>apply some checks on </p>
<pre><code class="hljs"><span class="hljs-tag">e</span><span class="hljs-class">.coords</span><span class="hljs-class">.longitude</span>;
</code></pre><pre><code class="hljs"><span class="hljs-tag">e</span><span class="hljs-class">.coords</span><span class="hljs-class">.latitude</span>;
</code></pre><p>i think the problem is here only , otherwise try to provide some more code .</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 6th 2011, 11:34:42 am">December 6th 2011</span>
								by <span class='authorname'>Gagan Tiwari</span><br>
								<a class="icon-bg icon-link" href="question/129123/global-variable-losing-its-scope#answer-224936" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Gagan. This is my code.</p>
<pre><code class="hljs"><span class="hljs-comment">//Global variables for geolocation data.</span>
<span class="hljs-comment">/*Ti.App.glbGeoData = {
    _curLatitude : "31.578535",
    _curLongitude : "-87.905275"
};*/</span>
<span class="hljs-keyword">var</span> _curLatitude;
<span class="hljs-keyword">var</span> _curLongitude;

<span class="hljs-comment">//GPS settings</span>
Titanium.Geolocation.purpose = <span class="hljs-string">"For GPS Application"</span>;
Titanium.Geolocation.distanceFilter = <span class="hljs-number">10</span>;
<span class="hljs-comment">// set the granularity of the location event</span>

Titanium.Geolocation.getCurrentPosition(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">if</span>(e.error) {
        <span class="hljs-comment">// manage the error</span>
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> longitude = e.coords.longitude;
    <span class="hljs-keyword">var</span> latitude = e.coords.latitude;
    <span class="hljs-keyword">var</span> altitude = e.coords.altitude;
    <span class="hljs-keyword">var</span> heading = e.coords.heading;
    <span class="hljs-keyword">var</span> accuracy = e.coords.accuracy;
    <span class="hljs-keyword">var</span> speed = e.coords.speed;
    <span class="hljs-keyword">var</span> timestamp = e.coords.timestamp;
    <span class="hljs-keyword">var</span> altitudeAccuracy = e.coords.altitudeAccuracy;

    <span class="hljs-comment">//  Ti.API.info("$$$ current positin -- - - - - -- - - -" + latitude);</span>

    <span class="hljs-comment">// we use the above data the way we need it</span>
    <span class="hljs-comment">/*Ti.App.glbGeoData = {
        _curLatitude : latitude,
        _curLongitude : longitude
    };*/</span>
    _curLatitude = latitude;
    _curLongitude = longitude;
    Ti.API.info(<span class="hljs-string">"1st loop latitude - "</span> + _curLatitude);
    Ti.API.info(<span class="hljs-string">"1st loop longitude - "</span> + _curLongitude);
});

Titanium.Geolocation.addEventListener(<span class="hljs-string">'location'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">if</span>(e.error) {
        <span class="hljs-comment">// manage the error</span>
        <span class="hljs-keyword">return</span>;
    }

    <span class="hljs-keyword">var</span> longitude = e.coords.longitude;
    <span class="hljs-keyword">var</span> latitude = e.coords.latitude;
    <span class="hljs-keyword">var</span> altitude = e.coords.altitude;
    <span class="hljs-keyword">var</span> heading = e.coords.heading;
    <span class="hljs-keyword">var</span> accuracy = e.coords.accuracy;
    <span class="hljs-keyword">var</span> speed = e.coords.speed;
    <span class="hljs-keyword">var</span> timestamp = e.coords.timestamp;
    <span class="hljs-keyword">var</span> altitudeAccuracy = e.coords.altitudeAccuracy;

    <span class="hljs-comment">// again we use the gathered data.</span>
    <span class="hljs-comment">/*Ti.App.glbGeoData = {
        _curLatitude : latitude,
        _curLongitude : longitude
    };*/</span>
    _curLatitude = latitude;
    _curLongitude = longitude;
    Ti.API.info(<span class="hljs-string">"2nd loop latitude - "</span> + _curLatitude);
    Ti.API.info(<span class="hljs-string">"2nd loop longitude - "</span> + _curLongitude);
});
<span class="hljs-comment">//var latitude = _curLatitude;</span>
<span class="hljs-comment">//var longitude = _curLongitude;</span>

<span class="hljs-keyword">var</span> uDistance = Titanium.Geolocation.distanceFilter;

Ti.API.info(<span class="hljs-string">"latitude - "</span> + _curLatitude);
Ti.API.info(<span class="hljs-string">"longitude - "</span> + _curLongitude);
Ti.API.info(<span class="hljs-string">"uDistance - "</span> + uDistance);

<span class="hljs-comment">// This window is used for displaying "Map".</span>
<span class="hljs-keyword">var</span> location_win = Ti.UI.createWindow();
location_win.backgroundColor = <span class="hljs-string">'#E9F1D9'</span>;

location_win.open();

<span class="hljs-comment">// This view is used for displaying detail of particular Location.</span>
<span class="hljs-keyword">var</span> location_view = Ti.UI.createView({
    top : <span class="hljs-number">5</span>,
    backgroundColor : <span class="hljs-string">'#95B847'</span>,
    height : <span class="hljs-number">100</span>,
    width : Ti.Platform.displayCaps.platformWidth - <span class="hljs-number">10</span>,
    borderRadius : <span class="hljs-number">8</span>
});
location_win.add(location_view);

<span class="hljs-comment">// Create Annotation for Map.</span>
<span class="hljs-keyword">var</span> mountainView = Titanium.Map.createAnnotation({
    latitude : _curLatitude,
    longitude : _curLongitude,
    title : <span class="hljs-string">"name"</span>,
    subtitle : <span class="hljs-string">'address1'</span> + <span class="hljs-string">' address2'</span> + <span class="hljs-string">', '</span> + <span class="hljs-string">'city'</span> + <span class="hljs-string">', '</span> + <span class="hljs-string">'state'</span> + <span class="hljs-string">' -zip'</span>,
    pincolor : Titanium.Map.ANNOTATION_RED,
    animate : <span class="hljs-literal">true</span>
});

<span class="hljs-comment">// Set Map View For setting user current location.</span>
Titanium.Geolocation.purpose = <span class="hljs-string">"Recieve User Location"</span>;
Titanium.Geolocation.accuracy = Titanium.Geolocation.ACCURACY_BEST;

<span class="hljs-comment">// Set Distance filter. This dictates how often an event fires based on the distance the device moves. This value is in meters.</span>
Titanium.Geolocation.distanceFilter = <span class="hljs-number">10</span>;

<span class="hljs-comment">// This view is used for displaying Map.</span>
<span class="hljs-keyword">var</span> mapview = Titanium.Map.createView({
    mapType : Titanium.Map.STANDARD_TYPE,
    region : {
        latitude : _curLatitude,
        longitude : _curLongitude,
        latitudeDelta : <span class="hljs-number">0.01</span>,
        longitudeDelta : <span class="hljs-number">0.01</span>
    },
    animate : <span class="hljs-literal">true</span>,
    regionFit : <span class="hljs-literal">true</span>,
    userLocation : <span class="hljs-literal">true</span>,
    visible : <span class="hljs-literal">true</span>,
    annotations : [mountainView],
    top : <span class="hljs-number">110</span>,
    height : <span class="hljs-number">250</span>,
    width : Ti.Platform.displayCaps.platformWidth - <span class="hljs-number">10</span>,
    borderColor : <span class="hljs-string">'#A5A89F'</span>,
    borderWidth : <span class="hljs-number">2</span>,
    borderRadius : <span class="hljs-number">8</span>
});
location_win.add(mapview);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getLocation</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-comment">//Get the current position and set it to the mapview</span>
    Titanium.Geolocation.getCurrentPosition(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
        <span class="hljs-keyword">var</span> region = {
            latitude : _curLatitude, <span class="hljs-comment">//e.coords.latitude,</span>
            longitude : _curLongitude, <span class="hljs-comment">//e.coords.longitude,</span>
            animate : <span class="hljs-literal">true</span>,
            latitudeDelta : <span class="hljs-number">0.001</span>,
            longitudeDelta : <span class="hljs-number">0.001</span>
        };
        mapview.setLocation(region);
    });
}

Titanium.Geolocation.addEventListener(<span class="hljs-string">'location'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    getLocation();
});
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="December 6th 2011, 11:50:33 am">December 6th 2011</span>
											by <span class='authorname'>iPhone Developer</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-235338">
				
						<section>
							<p>This is probably too late for you, but in case it helps someone else:</p>
<p>I bet your problem is in understanding the order code executes when callback functions are used. In your code, you write:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> _curLatitude;
<span class="hljs-keyword">var</span> _curLongitude;

Titanium.Geolocation.getCurrentPosition(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    _curLatitude = latitude;
    _curLongitude = longitude;
    Ti.API.info(<span class="hljs-string">"1st loop latitude - "</span> + _curLatitude);
    Ti.API.info(<span class="hljs-string">"1st loop longitude - "</span> + _curLongitude);
});

Ti.API.info(<span class="hljs-string">"latitude - "</span> + _curLatitude);
Ti.API.info(<span class="hljs-string">"longitude - "</span> + _curLongitude);
</code></pre><p>There is no problem with scope here, as _curLatitude will indeed refer to the same variable both inside and outside your function. However, the function may not have executed at the time of your <code>Ti.API.info()</code> calls. When you pass a function as an argument to a method, that function may not be called right away; it depends on the method when that will happen. In this example, I imagine it takes some time for the GPS routine to do its job, and your script continues to execute after the call to <code>.getCurrentPosition()</code>. Once the GPS work is done, then your function gets called, but this may be too late for your purposes.</p>
<p>Your work that needs this value should either take place inside your callback function, or inside another event handler that will be triggered after the geolocation is complete.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 5th 2012, 7:28:02 pm">April 5th 2012</span>
								by <span class='authorname'>Jonathan Chaffer</span><br>
								<a class="icon-bg icon-link" href="question/129123/global-variable-losing-its-scope#answer-235338" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
