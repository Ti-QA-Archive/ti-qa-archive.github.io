<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Annotation.setLatitude() » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Annotation.setLatitude()</h1>
		</header>
		<section>
			<p>Hi,<br>in a map I try to animate annotations:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> updateVessels = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        clearTimeout(cron);
        getVessels(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_vessels</span>) </span>{
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> v = <span class="hljs-number">0</span>; v &lt; _vessels.length; v++) {
                <span class="hljs-keyword">var</span> vessel = _vessels[v];
                <span class="hljs-keyword">for</span> ( a = <span class="hljs-number">0</span>; a &lt; annotations.length; a++) {
                    <span class="hljs-keyword">if</span> (vessel.pk == annotations[a].pk) {
                        annotations[a].setLatitude(<span class="hljs-built_in">parseFloat</span>(vessel.lat,<span class="hljs-number">10</span>));
                        annotations[a].setLongitude(<span class="hljs-built_in">parseFloat</span>(vessel.lon,<span class="hljs-number">10</span>));
                        Ti.API.log(<span class="hljs-string">'Moving of '</span> + vessel.name)
                        <span class="hljs-keyword">break</span>;
                    }
                }
            }
            cron = setTimeout(updateVessels, <span class="hljs-number">5000</span>);
        });
    }
</code></pre><p>Every ca. 5 sec. the function will called, but the annotations are fixed.  Whats going wrong. Everytime comes other coordinates from server …</p>
<p>Rainer</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="August 30th 2012, 6:31:13 pm">August 30th 2012</span>
				by <span class='authorname'>Rainer Schleevoigt</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>setlatitude()</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>-2</span> Votes</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-246394">
				
						<section>
							<p>Try building a new list of annotations and calling removeAllAnnotations() and then addAnnotations() with your new list.  It might be fast enough where the user doesn&#39;t see them disappear.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="August 30th 2012, 6:46:15 pm">August 30th 2012</span>
								by <span class='authorname'>Jason Priebe</span><br>
								<a class="icon-bg icon-link" href="question/141694/annotationsetlatitude#answer-246394" rel="permalink">permalink</a>
							</div>

							<h5>5 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>If you don&#39;t mind me asking, what are you building?  It sounds interesting…</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 30th 2012, 6:46:47 pm">August 30th 2012</span>
											by <span class='authorname'>Jason Priebe</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I think your solution is a rubber solution.<br> It works  – why not? But the annotations are flashing; is ugly …</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 30th 2012, 7:00:42 pm">August 30th 2012</span>
											by <span class='authorname'>Rainer Schleevoigt</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Why exists this method, if setLatitude() doesnt work  really??</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 30th 2012, 7:02:02 pm">August 30th 2012</span>
											by <span class='authorname'>Rainer Schleevoigt</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I wish I knew why so many functions in Ti Mobile don&#39;t work.  :-)  For example, <code>setAnnotations()</code> doesn&#39;t work in android…</p>
<p>I have had difficulty manipulating annotations, so I find workarounds where I can.  </p>
<p>If the flashing is bad, maybe you could iterate through the annotations and call removeAnnotation() and then addAnnotation().  Maybe replacing one at a time would be fast enough to reduce&#x2F;remove the flashing.</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 30th 2012, 7:05:50 pm">August 30th 2012</span>
											by <span class='authorname'>Jason Priebe</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Here <a href="http:&#x2F;&#x2F;pastie.org&#x2F;4618799">full code]</a> of module</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 30th 2012, 7:26:26 pm">August 30th 2012</span>
											by <span class='authorname'>Rainer Schleevoigt</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-246433">
				
						<section>
							<p>Looking over your code gave me an inspiration.  In your original code, you called <code>setLatitude()</code> and <code>setLongitude()</code>.  In your revised code, you&#39;re accessing the <code>latitude</code> and <code>longitude</code> properties directly.  I have seen cases in Titanium where the setter function doesn&#39;t work, but the direct property access does work.</p>
<p>What if you try your new code without the <code>removeAnnotation()</code> and <code>addAnnotation()</code> calls?</p>
<pre><code class="hljs">                <span class="hljs-keyword">if</span> (vessel.pk == annotations[a].pk) {
                    <span class="hljs-keyword">if</span> (!vessel.<span class="hljs-keyword">is</span><span class="hljs-number">_m</span>oored &amp;&amp; vessel.lat != <span class="hljs-annotation">annotation</span>.latitude &amp;&amp; vessel.lon != <span class="hljs-annotation">annotation</span>.longitude) {
                        <span class="hljs-annotation">annotation</span>.latitude = vessel.lat;
                        <span class="hljs-annotation">annotation</span>.longitude = vessel.lon;
                        <span class="hljs-keyword">if</span> (vessel.name == <span class="hljs-string">'HARMONIE'</span>)
                            Ti.API.log(<span class="hljs-string">'Moving of '</span> + vessel.name + <span class="hljs-string">' '</span> + vessel.lat +<span class="hljs-string">','</span> + vessel.lon)
                        <span class="hljs-keyword">break</span>;
                    }
                }
</code></pre><p>Maybe this will work without flashing?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="August 31st 2012, 8:30:48 am">August 31st 2012</span>
								by <span class='authorname'>Jason Priebe</span><br>
								<a class="icon-bg icon-link" href="question/141694/annotationsetlatitude#answer-246433" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>The vessels leaves fixed. Here the new code which moves the vessels every 5 sec. in relation to bearing and speed:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> moveVessels = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> R = <span class="hljs-number">6371000</span>; <span class="hljs-comment">// km</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>; a &lt; annotations.length; a++) {
            <span class="hljs-keyword">var</span> annotation = annotations[a];
            <span class="hljs-keyword">if</span> (annotation.is_moored)
                <span class="hljs-keyword">continue</span>;
            <span class="hljs-keyword">var</span> lat1 = annotation.latitude;
            <span class="hljs-keyword">var</span> lon1 = annotation.longitude;
            <span class="hljs-keyword">var</span> d = <span class="hljs-built_in">parseFloat</span>(annotation.speedoverground) * <span class="hljs-number">0.44</span> / R *<span class="hljs-number">5</span>;
            <span class="hljs-keyword">var</span> brng = <span class="hljs-built_in">parseFloat</span>(annotation.orientation);
            <span class="hljs-keyword">var</span> lat2 = <span class="hljs-built_in">Math</span>.asin(<span class="hljs-built_in">Math</span>.sin(lat1) * <span class="hljs-built_in">Math</span>.cos(d) + <span class="hljs-built_in">Math</span>.cos(lat1) * <span class="hljs-built_in">Math</span>.sin(d) * <span class="hljs-built_in">Math</span>.cos(brng));
            <span class="hljs-keyword">var</span> lon2 = lon1 + <span class="hljs-built_in">Math</span>.atan2(<span class="hljs-built_in">Math</span>.sin(brng) * <span class="hljs-built_in">Math</span>.sin(d) * <span class="hljs-built_in">Math</span>.cos(lat1), <span class="hljs-built_in">Math</span>.cos(d) - <span class="hljs-built_in">Math</span>.sin(lat1) * <span class="hljs-built_in">Math</span>.sin(lat2));
            Ti.API.log(lat2 + <span class="hljs-string">','</span> + lon2);
            <span class="hljs-comment">//    annotation.setLatitude(lat2);</span>
            map.removeAnnotation(annotation);
            annotation.setLongitude(lon2);
            annotation.longitude = lon2;
            map.addAnnotation(annotation);
        }
    };
</code></pre><p>In main thread I call <code>setInterval(moveVessels,5000);</code>.<br>The annotations has properties orientation(bearing) and speedoverground.</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 2nd 2012, 5:42:27 am">September 2nd 2012</span>
											by <span class='authorname'>Rainer Schleevoigt</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-246417">
				
						<section>
							<p>Here my current solution:</p>
<pre><code class="hljs"><span class="hljs-component">var updateVessels = function() {
    clearTimeout(cron);
    getVessels(function(_vessels) {
        for (var v = 0; v &lt; _vessels<span class="hljs-string">.length</span>; v++) {
            var vessel = _vessels[v];
            for ( a = 0; a &lt; annotations<span class="hljs-string">.length</span>; a++) {
                var annotation = annotations[a];
                if (vessel<span class="hljs-string">.pk</span> == annotations[a]<span class="hljs-string">.pk)</span> {
                    if (!vessel<span class="hljs-string">.is_moored</span> &amp;&amp; vessel<span class="hljs-string">.lat</span> != annotation<span class="hljs-string">.latitude</span> &amp;&amp; vessel<span class="hljs-string">.lon</span> != annotation<span class="hljs-string">.longitude)</span> {
                        map<span class="hljs-string">.removeAnnotation(annotation)</span>;
                        annotation<span class="hljs-string">.latitude</span> = vessel<span class="hljs-string">.lat</span>;
                        annotation<span class="hljs-string">.longitude</span> = vessel<span class="hljs-string">.lon</span>;
                        map<span class="hljs-string">.addAnnotation(annotation)</span>;
                        if (vessel<span class="hljs-string">.name</span> == 'HARMONIE')
                            Ti<span class="hljs-string">.API.log('Moving</span> of ' + vessel<span class="hljs-string">.name</span> + ' ' + vessel<span class="hljs-string">.lat</span> +',' + vessel<span class="hljs-string">.lon)</span>
                        break;
                    }</span>
                }
            }
        }
        cron = setTimeout(updateVessels, 10000);
    });
}
</code></pre><p>The annotation is flashing, but not moving. ;-((</p>
<p>Above the log – you can see the position of HARMONIE is changing:</p>
<pre><code class="hljs">
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="August 31st 2012, 4:01:04 am">August 31st 2012</span>
								by <span class='authorname'>Rainer Schleevoigt</span><br>
								<a class="icon-bg icon-link" href="question/141694/annotationsetlatitude#answer-246417" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-2</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
