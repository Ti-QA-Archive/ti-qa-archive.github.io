<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Android crashes app with BlockGuard policy when playing network video (http progressive) in the main window Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Android crashes app with BlockGuard policy when playing network video (http progressive) in the main window</h1>
		</header>
		<section>
			<p>-App type : Mobile App</p>
<p>-Titanium SDK : 1.8.0.1</p>
<p>-Platform : Android ==&gt; The problem happens only if the minSdkVersion of android is 10 or higher. Otherwise, the problem does not appear (I assume if I use 10 or higher it uses  &lt;==</p>
<p>Description of the problem : </p>
<p>I have a window, which has a structure inside (it doesn&#39;t matter - it is a tableview), and when you press on a row, it opens another window with a video player inside. The way I open the window is within the same context (Tweetanium style), without the &#39;url&#39; property. If the stream is rtsp, everything is fine. If, however, the stream is http, i get a popup &quot;Unfortunately, &lt;app&gt; has stopped.&quot; and the app crashes. The log is : </p>
<pre><code class="hljs">E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at android<span class="hljs-class">.os</span><span class="hljs-class">.StrictMode</span><span class="hljs-variable">$AndroidBlockGuardPolicy</span>.<span class="hljs-function"><span class="hljs-title">onNetwork</span><span class="hljs-params">(StrictMode.java:<span class="hljs-number">1117</span>)</span></span>
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at libcore<span class="hljs-class">.io</span><span class="hljs-class">.BlockGuardOs</span><span class="hljs-class">.connect</span>(BlockGuardOs<span class="hljs-class">.java</span>:<span class="hljs-number">84</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at libcore<span class="hljs-class">.io</span><span class="hljs-class">.IoBridge</span><span class="hljs-class">.connectErrno</span>(IoBridge<span class="hljs-class">.java</span>:<span class="hljs-number">127</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at libcore<span class="hljs-class">.io</span><span class="hljs-class">.IoBridge</span><span class="hljs-class">.connect</span>(IoBridge<span class="hljs-class">.java</span>:<span class="hljs-number">112</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at java<span class="hljs-class">.net</span><span class="hljs-class">.PlainSocketImpl</span><span class="hljs-class">.connect</span>(PlainSocketImpl<span class="hljs-class">.java</span>:<span class="hljs-number">192</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at java<span class="hljs-class">.net</span><span class="hljs-class">.PlainSocketImpl</span><span class="hljs-class">.connect</span>(PlainSocketImpl<span class="hljs-class">.java</span>:<span class="hljs-number">459</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at java<span class="hljs-class">.net</span><span class="hljs-class">.Socket</span><span class="hljs-class">.connect</span>(Socket<span class="hljs-class">.java</span>:<span class="hljs-number">842</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at libcore<span class="hljs-class">.net</span><span class="hljs-class">.http</span><span class="hljs-class">.HttpConnection</span>.&lt;init&gt;(HttpConnection<span class="hljs-class">.java</span>:<span class="hljs-number">76</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at libcore<span class="hljs-class">.net</span><span class="hljs-class">.http</span><span class="hljs-class">.HttpConnection</span>.&lt;init&gt;(HttpConnection<span class="hljs-class">.java</span>:<span class="hljs-number">50</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at libcore<span class="hljs-class">.net</span><span class="hljs-class">.http</span><span class="hljs-class">.HttpConnection</span><span class="hljs-variable">$Address</span>.<span class="hljs-function"><span class="hljs-title">connect</span><span class="hljs-params">(HttpConnection.java:<span class="hljs-number">341</span>)</span></span>
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at libcore<span class="hljs-class">.net</span><span class="hljs-class">.http</span><span class="hljs-class">.HttpConnectionPool</span><span class="hljs-class">.get</span>(HttpConnectionPool<span class="hljs-class">.java</span>:<span class="hljs-number">87</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at libcore<span class="hljs-class">.net</span><span class="hljs-class">.http</span><span class="hljs-class">.HttpConnection</span><span class="hljs-class">.connect</span>(HttpConnection<span class="hljs-class">.java</span>:<span class="hljs-number">128</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at libcore<span class="hljs-class">.net</span><span class="hljs-class">.http</span><span class="hljs-class">.HttpEngine</span><span class="hljs-class">.openSocketConnection</span>(HttpEngine<span class="hljs-class">.java</span>:<span class="hljs-number">315</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at libcore<span class="hljs-class">.net</span><span class="hljs-class">.http</span><span class="hljs-class">.HttpEngine</span><span class="hljs-class">.connect</span>(HttpEngine<span class="hljs-class">.java</span>:<span class="hljs-number">310</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at libcore<span class="hljs-class">.net</span><span class="hljs-class">.http</span><span class="hljs-class">.HttpEngine</span><span class="hljs-class">.sendSocketRequest</span>(HttpEngine<span class="hljs-class">.java</span>:<span class="hljs-number">289</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at libcore<span class="hljs-class">.net</span><span class="hljs-class">.http</span><span class="hljs-class">.HttpEngine</span><span class="hljs-class">.sendRequest</span>(HttpEngine<span class="hljs-class">.java</span>:<span class="hljs-number">239</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at libcore<span class="hljs-class">.net</span><span class="hljs-class">.http</span><span class="hljs-class">.HttpURLConnectionImpl</span><span class="hljs-class">.getResponse</span>(HttpURLConnectionImpl<span class="hljs-class">.java</span>:<span class="hljs-number">273</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at libcore<span class="hljs-class">.net</span><span class="hljs-class">.http</span><span class="hljs-class">.HttpURLConnectionImpl</span><span class="hljs-class">.getHeaderField</span>(HttpURLConnectionImpl<span class="hljs-class">.java</span>:<span class="hljs-number">130</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at android<span class="hljs-class">.widget</span><span class="hljs-class">.TiVideoView4</span><span class="hljs-class">.setDataSource</span>(TiVideoView4<span class="hljs-class">.java</span>:<span class="hljs-number">196</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at android<span class="hljs-class">.widget</span><span class="hljs-class">.TiVideoView4</span><span class="hljs-class">.openVideo</span>(TiVideoView4<span class="hljs-class">.java</span>:<span class="hljs-number">273</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at android<span class="hljs-class">.widget</span><span class="hljs-class">.TiVideoView4</span><span class="hljs-class">.setVideoURI</span>(TiVideoView4<span class="hljs-class">.java</span>:<span class="hljs-number">170</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at ti<span class="hljs-class">.modules</span><span class="hljs-class">.titanium</span><span class="hljs-class">.media</span><span class="hljs-class">.TiVideoActivity</span><span class="hljs-class">.handleMessage</span>(TiVideoActivity<span class="hljs-class">.java</span>:<span class="hljs-number">228</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at android<span class="hljs-class">.os</span><span class="hljs-class">.Handler</span><span class="hljs-class">.dispatchMessage</span>(Handler<span class="hljs-class">.java</span>:<span class="hljs-number">95</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at android<span class="hljs-class">.os</span><span class="hljs-class">.Looper</span><span class="hljs-class">.loop</span>(Looper<span class="hljs-class">.java</span>:<span class="hljs-number">137</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at android<span class="hljs-class">.app</span><span class="hljs-class">.ActivityThread</span><span class="hljs-class">.main</span>(ActivityThread<span class="hljs-class">.java</span>:<span class="hljs-number">4940</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at java<span class="hljs-class">.lang</span><span class="hljs-class">.reflect</span><span class="hljs-class">.Method</span><span class="hljs-class">.invokeNative</span>(Native Method)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at java<span class="hljs-class">.lang</span><span class="hljs-class">.reflect</span><span class="hljs-class">.Method</span><span class="hljs-class">.invoke</span>(Method<span class="hljs-class">.java</span>:<span class="hljs-number">511</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at com<span class="hljs-class">.android</span><span class="hljs-class">.internal</span><span class="hljs-class">.os</span><span class="hljs-class">.ZygoteInit</span><span class="hljs-variable">$MethodAndArgsCaller</span>.<span class="hljs-function"><span class="hljs-title">run</span><span class="hljs-params">(ZygoteInit.java:<span class="hljs-number">791</span>)</span></span>
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at com<span class="hljs-class">.android</span><span class="hljs-class">.internal</span><span class="hljs-class">.os</span><span class="hljs-class">.ZygoteInit</span><span class="hljs-class">.main</span>(ZygoteInit<span class="hljs-class">.java</span>:<span class="hljs-number">558</span>)
E/<span class="hljs-function"><span class="hljs-title">AndroidRuntime</span><span class="hljs-params">(<span class="hljs-number">21361</span>)</span></span>:     at dalvik<span class="hljs-class">.system</span><span class="hljs-class">.NativeStart</span><span class="hljs-class">.main</span>(Native Method)
</code></pre><p>After serching for a bit, I found out that on later versions of Android, &#39;blocking&#39; the main thread with a network operation is &#39;forbidden&#39; (and for a good reason). This does not happen with rtsp because it probably is streaming, but with http it throws the exception. The problem is, I cannot find a good way to open a new thread with appcelerator. The only way I found was opening a new window with the &#39;url&#39; property, which opens a new context, thus a new thread. Not to my surprise though, it didn&#39;t work.</p>
<p>code in tableview window :</p>
<pre><code class="hljs">var win3 = <span class="hljs-type">Titanium</span>.<span class="hljs-type">UI</span>.createWindow({
    url:<span class="hljs-symbol">'lib</span>/trailers.js',
    contentURL:cont
});
win3.<span class="hljs-keyword">open</span><span class="hljs-literal">()</span>;
</code></pre><p>and the trailers.js is :</p>
<pre><code class="hljs">var win = Ti.UI.currentWindow<span class="hljs-comment">;</span>

var ctrl = Titanium.Media.VIDEO_CONTROL_DEFAULT<span class="hljs-comment">;</span>
Ti.API.info("Content url : " + Titanium.UI.currentWindow.contentURL)<span class="hljs-comment">;</span>

activeMovie = Titanium.Media.createVideoPlayer({
    contentURL : Titanium.UI.currentWindow.contentURL,
    backgroundColor : '#111',
    movieControlMode : ctrl,
    scalingMode : Titanium.Media.VIDEO_SCALING_ASPECT_FIT
})<span class="hljs-comment">;</span>
activeMovie.play()<span class="hljs-comment">;</span>

win.add(activeMovie)<span class="hljs-comment">;</span>
</code></pre><p>Is there a good solution?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="September 20th 2012, 6:26:27 am">September 20th 2012</span>
				by <span class='authorname'>Ioannis Alexandrakis</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>strict mode</span></li>
					
						<li><span class='tagname'>threads</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-247711">
				
						<section>
							<p>In newer versions of Titanium (2.1.0GA) this is fixed.<br>However, I cannot migrate to the new one, so I just created a new module (with 1.8.x) and ran the following method to disable the thread policy to work as in the earlier versions of android (dirty hack, but it works for my purposes)</p>
<pre><code class="hljs">    @<span class="hljs-type">Kroll</span>.<span class="hljs-keyword">method</span>(runOnUiThread=<span class="hljs-literal">true</span>)
    public <span class="hljs-type">void</span> disablePolicy() {
        <span class="hljs-keyword">if</span> (android.os.<span class="hljs-type">Build</span>.<span class="hljs-type">VERSION</span>.<span class="hljs-type">SDK_INT</span> &gt; <span class="hljs-number">9</span>) {
            <span class="hljs-type">StrictMode</span>.<span class="hljs-type">ThreadPolicy</span> policy = new <span class="hljs-type">StrictMode</span>.<span class="hljs-type">ThreadPolicy</span>.<span class="hljs-type">Builder</span>().permitAll().build();
            <span class="hljs-type">StrictMode</span>.setThreadPolicy(policy);
        }
    }
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 21st 2012, 7:19:58 am">September 21st 2012</span>
								by <span class='authorname'>Ioannis Alexandrakis</span><br>
								<a class="icon-bg icon-link" href="question/142449/android-crashes-app-with-blockguard-policy-when-playing-network-video-http-progressive-in-the-main-window#answer-247711" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-249730">
				
						<section>
							<p>I am using newest sdk version (2.1.3GA) , still has this error , android.os.NetworkOnMainThreadException at android.os.StricMode$AndroidBlockGuardPolicy.onNetwork(StricMode.java:1099)</p>
<p>anyone can help?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="October 22nd 2012, 3:16:28 am">October 22nd 2012</span>
								by <span class='authorname'>Allen Lee</span><br>
								<a class="icon-bg icon-link" href="question/142449/android-crashes-app-with-blockguard-policy-when-playing-network-video-http-progressive-in-the-main-window#answer-249730" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
