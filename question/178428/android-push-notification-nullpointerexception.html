<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Android Push Notification NullPointerException Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Android Push Notification NullPointerException</h1>
		</header>
		<section>
			<p>Hey everyone,</p>
<p>I have already built a small application for a client that has push notification feature, everything was working as expected until recently, push notification messages seems to arrive to the device some of the time and they never arrive if the application is not started and sometimes while debugging the code I see the following in the log and the application force closes</p>
<pre><code class="hljs">[ERROR] :  APSCloudPush: Payload is null!
[WARN] :   dalvikvm: threadid=1: thread exiting with uncaught exception (group=0x4161cba8)
[ERROR] :  TiApplication: (main) [269394,269394] Sending event: exception on thread: main msg:java.lang.RuntimeException: Unable to <span class="hljs-operator"><span class="hljs-keyword">start</span> receiver com.appcelerator.cloudpush.GCMReceiver: <span class="hljs-keyword">java</span>.lang.NullPointerException;</span> Titanium 3.4.0,2014/09/25 16:42,b54c467
[ERROR] :  TiApplication: java.lang.RuntimeException: Unable to <span class="hljs-operator"><span class="hljs-keyword">start</span> receiver com.appcelerator.cloudpush.GCMReceiver: <span class="hljs-keyword">java</span>.lang.NullPointerException
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> android.app.ActivityThread.handleReceiver(ActivityThread.<span class="hljs-keyword">java</span>:<span class="hljs-number">2414</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> android.app.ActivityThread.<span class="hljs-keyword">access</span>$<span class="hljs-number">1700</span>(ActivityThread.<span class="hljs-keyword">java</span>:<span class="hljs-number">135</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> android.app.ActivityThread$H.handleMessage(ActivityThread.<span class="hljs-keyword">java</span>:<span class="hljs-number">1272</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> android.os.<span class="hljs-keyword">Handler</span>.dispatchMessage(<span class="hljs-keyword">Handler</span>.<span class="hljs-keyword">java</span>:<span class="hljs-number">102</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> android.os.Looper.<span class="hljs-keyword">loop</span>(Looper.<span class="hljs-keyword">java</span>:<span class="hljs-number">136</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> android.app.ActivityThread.<span class="hljs-keyword">main</span>(ActivityThread.<span class="hljs-keyword">java</span>:<span class="hljs-number">5001</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> <span class="hljs-keyword">java</span>.lang.reflect.Method.invokeNative(<span class="hljs-keyword">Native</span> Method)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> <span class="hljs-keyword">java</span>.lang.reflect.Method.invoke(Method.<span class="hljs-keyword">java</span>:<span class="hljs-number">515</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.<span class="hljs-keyword">java</span>:<span class="hljs-number">785</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> com.android.internal.os.ZygoteInit.<span class="hljs-keyword">main</span>(ZygoteInit.<span class="hljs-keyword">java</span>:<span class="hljs-number">601</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> dalvik.<span class="hljs-keyword">system</span>.NativeStart.<span class="hljs-keyword">main</span>(<span class="hljs-keyword">Native</span> Method)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication: Caused <span class="hljs-keyword">by</span>: <span class="hljs-keyword">java</span>.lang.NullPointerException
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> org.<span class="hljs-keyword">json</span>.JSONTokener.nextCleanInternal(JSONTokener.<span class="hljs-keyword">java</span>:<span class="hljs-number">116</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> org.<span class="hljs-keyword">json</span>.JSONTokener.nextValue(JSONTokener.<span class="hljs-keyword">java</span>:<span class="hljs-number">94</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> org.<span class="hljs-keyword">json</span>.JSONObject.&lt;init&gt;(JSONObject.<span class="hljs-keyword">java</span>:<span class="hljs-number">155</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> org.<span class="hljs-keyword">json</span>.JSONObject.&lt;init&gt;(JSONObject.<span class="hljs-keyword">java</span>:<span class="hljs-number">172</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> com.appcelerator.cloudpush.APSCloudPush.showTrayNotification(APSCloudPush.<span class="hljs-keyword">java</span>:<span class="hljs-number">334</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> com.appcelerator.cloudpush.APSCloudPush.receivePayload(APSCloudPush.<span class="hljs-keyword">java</span>:<span class="hljs-number">240</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> com.appcelerator.cloudpush.GCMReceiver.onReceive(GCMReceiver.<span class="hljs-keyword">java</span>:<span class="hljs-number">31</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     <span class="hljs-keyword">at</span> android.app.ActivityThread.handleReceiver(ActivityThread.<span class="hljs-keyword">java</span>:<span class="hljs-number">2407</span>)
[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     ... <span class="hljs-number">10</span> more</span>
</code></pre><p>The following is part of my code</p>
<pre><code class="hljs">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">retrieveDeviceToken</span>(<span class="hljs-params">cb</span>) </span>{
        <span class="hljs-comment">// Enable push notifications for this device</span>
        <span class="hljs-comment">// Save the device token for subsequent API calls</span>
        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deviceTokenSuccess</span>(<span class="hljs-params">e</span>) </span>{
            Ti.API.info(<span class="hljs-string">'successfully got device token'</span>);
            Ti.App.Properties.setString(deviceTokenKey, e.deviceToken);
            cb(<span class="hljs-literal">null</span>);
        }

        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">deviceTokenError</span>(<span class="hljs-params">e</span>) </span>{
            Ti.API.error(<span class="hljs-string">'Failed to register for push notifications! '</span> + e.error);
            Ti.App.Properties.setString(deviceTokenKey, <span class="hljs-string">''</span>);
            cb(e.error);
        }

        <span class="hljs-keyword">if</span> (osname === <span class="hljs-string">'android'</span>) {
            <span class="hljs-keyword">var</span> CloudPush = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ti.cloudpush'</span>);

            <span class="hljs-comment">// Initialize the module</span>
            CloudPush.retrieveDeviceToken({
                success : deviceTokenSuccess,
                error : deviceTokenError
            });

            <span class="hljs-comment">// Process incoming push notifications</span>
            CloudPush.addEventListener(<span class="hljs-string">'callback'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                Ti.API.info(<span class="hljs-string">"Notification received: "</span> + evt.payload);
                <span class="hljs-keyword">var</span> payload = <span class="hljs-built_in">JSON</span>.parse(evt.payload);
                handlePushNotificationMessages(payload);
            });
        } 
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">subscribeToChannel</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">// Subscribes the device to the 'news_alerts' channel</span>
        <span class="hljs-comment">// Specify the push type as either 'android' for Android or 'ios' for iOS</span>
        Cloud.PushNotifications.subscribeToken({
            device_token : Ti.App.Properties.getString(deviceTokenKey, <span class="hljs-string">''</span>),
            channel : pnChannel,
            type : Ti.Platform.name == <span class="hljs-string">'android'</span> ? <span class="hljs-string">'android'</span> : <span class="hljs-string">'ios'</span>
        }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
            <span class="hljs-keyword">if</span> (e.success) {
                Ti.API.info(<span class="hljs-string">'Subscribed to channel'</span>);
                Ti.App.Properties.setBool(pnEnabledKey, <span class="hljs-literal">true</span>);
                switchButton.value = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
                Ti.API.error(<span class="hljs-string">'Error: '</span> + ((e.error &amp;&amp; e.message) || <span class="hljs-built_in">JSON</span>.stringify(e)));
                Ti.App.Properties.setBool(pnEnabledKey, <span class="hljs-literal">false</span>);
                switchButton.value = <span class="hljs-literal">false</span>;
            }
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">unsubscribeToChannel</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">// Unsubscribes the device from the 'test' channel</span>
        Cloud.PushNotifications.unsubscribeToken({
            device_token : Ti.App.Properties.getString(deviceTokenKey, <span class="hljs-string">''</span>),
            channel : pnChannel,
        }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
            <span class="hljs-keyword">if</span> (e.success) {
                Ti.API.info(<span class="hljs-string">'Unsubscribed from channel'</span>);
                Ti.App.Properties.setBool(pnEnabledKey, <span class="hljs-literal">false</span>);
                switchButton.value = <span class="hljs-literal">false</span>;
            } <span class="hljs-keyword">else</span> {
                Ti.API.error(<span class="hljs-string">'Error: '</span> + ((e.error &amp;&amp; e.message) || <span class="hljs-built_in">JSON</span>.stringify(e)));
                Ti.App.Properties.setBool(pnEnabledKey, <span class="hljs-literal">true</span>);
                switchButton.value = <span class="hljs-literal">true</span>;
            }
        });
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handlePushNotificationMessages</span>(<span class="hljs-params">payload</span>) </span>{
        <span class="hljs-keyword">var</span> newsObj = {
            title : payload.postTitle,
            link : payload.postUrl,
            date : payload.postDate,
            time : payload.postTime,
            pubDate : <span class="hljs-string">''</span>,
            description : <span class="hljs-string">''</span>,
            image : <span class="hljs-string">''</span>
        };
        newsObj.pushNotificationNews = <span class="hljs-literal">true</span>;

        <span class="hljs-keyword">var</span> DetailView = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ui/common/DetailView'</span>);
        <span class="hljs-keyword">var</span> detailView = <span class="hljs-keyword">new</span> DetailView(newsObj, <span class="hljs-literal">true</span>);
        <span class="hljs-keyword">if</span> (parentWindow) {
<span class="hljs-comment">//something for ios</span>
            <span class="hljs-keyword">var</span> currentBadge = Ti.UI.iPhone.getAppBadge();
            <span class="hljs-keyword">if</span> (currentBadge &gt; <span class="hljs-number">0</span>) {
                currentBadge = currentBadge - <span class="hljs-number">1</span>;
                Ti.UI.iPhone.setAppBadge(currentBadge);
            }
            <span class="hljs-keyword">if</span> (parentWindow.isLeftWindowOpen()) {
                parentWindow.toggleLeftWindow();
            }
            parentWindow.getCenterWindow().openWindow(detailView, {
                <span class="hljs-comment">//this is mainly for ios devices</span>
                animated : <span class="hljs-literal">true</span>
            });
        } <span class="hljs-keyword">else</span> {
<span class="hljs-comment">//android part</span>
            detailView.open();
        }
    };

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleSwitchButtonChanges</span>(<span class="hljs-params">event</span>) </span>{
        <span class="hljs-keyword">if</span> (event.value) {
            <span class="hljs-comment">/**
             * i need to enable push notification
             */</span>
            retrieveDeviceToken(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
                <span class="hljs-keyword">if</span> (!err) {
                    subscribeToChannel();
                }
            });
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">/**
             * i need to disable push notification
             */</span>
            retrieveDeviceToken(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
                <span class="hljs-keyword">if</span> (!err) {
                    unsubscribeToChannel();
                }
            });
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">createSwitchButton</span>(<span class="hljs-params">text</span>) </span>{
            <span class="hljs-keyword">var</span> pnIsEnabled = Ti.App.Properties.getBool(pnEnabledKey, <span class="hljs-literal">false</span>);
            <span class="hljs-keyword">var</span> tokenIsAvailable = Ti.App.Properties.getString(pnEnabledKey, <span class="hljs-string">''</span>);
            <span class="hljs-keyword">if</span> (tokenIsAvailable &amp;&amp; pnIsEnabled) {
                switchButton.value = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
                switchButton.value = <span class="hljs-literal">false</span>;
            }

        switchButton.addEventListener(<span class="hljs-string">'change'</span>, handleSwitchButtonChanges);
    }
</code></pre><p>any help would be highly appreciated.</p>
<p>I need to mention that I am using the appcelerator console to test this and i can confirm that the push notifications arrives most of the times when the app is running but when the app is not running the notifications never make it</p>
<p>Thanks in advance</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="October 14th 2014, 6:27:35 pm">October 14th 2014</span>
				by <span class='authorname'>Fouad Kada</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>notification</span></li>
					
						<li><span class='tagname'>nullpointerexception</span></li>
					
						<li><span class='tagname'>push</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>I have the same problem too. Did you find a solution?</p>
</div>
							<div class="author">
								&mdash; commented <span title="October 31st 2014, 10:04:17 am">October 31st 2014</span>
								by <span class='authorname'>Vittorio Sorbera</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>After too many trial and error, i was able to solve it by using an earlier version of ti.cloudpush, more precisely i used version 3.2.1<br>hope that works for you as it was very frustrating to me for almost a full week</p>
</div>
							<div class="author">
								&mdash; commented <span title="October 31st 2014, 11:52:23 am">October 31st 2014</span>
								by <span class='authorname'>Fouad Kada</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>0</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>0 Answers</h3>

	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
