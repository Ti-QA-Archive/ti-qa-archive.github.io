<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Alloy model saving not persisting Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Alloy model saving not persisting</h1>
		</header>
		<section>
			<p>I am using Alloy and a data model to hold my settings. For now, I am using the properties sync adapter to persist my settings. Here is its definition:</p>
<pre><code class="hljs">exports.definition = {

    config : {
        <span class="hljs-string">"columns"</span> : {
            <span class="hljs-string">"username"</span> : <span class="hljs-string">"text"</span>,
            <span class="hljs-string">"password"</span> : <span class="hljs-string">"text"</span>
        },
        <span class="hljs-string">"defaults"</span> : {
            <span class="hljs-string">"username"</span> : <span class="hljs-string">""</span>,
            <span class="hljs-string">"password"</span> : <span class="hljs-string">""</span>
        },
        <span class="hljs-string">"adapter"</span> : {
            <span class="hljs-string">"type"</span> : <span class="hljs-string">"properties"</span>,
            <span class="hljs-string">"collection_name"</span> : <span class="hljs-string">"mySettings"</span>
        }
    },
};
</code></pre><p>Then I am referencing my model in my view and using its values to pre-populate some textfields. Here is the view:</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">Alloy</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Model</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"mySettings"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Window</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"window"</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Settings"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">TableView</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"table"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">TableViewSection</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"sectionCredentials"</span> <span class="hljs-attribute">headerTitle</span>=<span class="hljs-value">"Credentials"</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">TableViewRow</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">View</span> <span class="hljs-attribute">layout</span>=<span class="hljs-value">"horizontal"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"label"</span> <span class="hljs-attribute">text</span>=<span class="hljs-value">"Username:"</span> /&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">TextField</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"username"</span> <span class="hljs-attribute">hintText</span>=<span class="hljs-value">"Username"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"textfield"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"{mySettings.username}"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">View</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">TableViewRow</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">TableViewRow</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">View</span> <span class="hljs-attribute">layout</span>=<span class="hljs-value">"horizontal"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"view"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"label"</span> <span class="hljs-attribute">text</span>=<span class="hljs-value">"Password:"</span> /&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">TextField</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"password"</span> <span class="hljs-attribute">hintText</span>=<span class="hljs-value">"Password"</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"textfield"</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"{mySettings.password}"</span> <span class="hljs-attribute">passwordMask</span>=<span class="hljs-value">"true"</span> /&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">View</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">TableViewRow</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">TableViewSection</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">TableView</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Button</span> <span class="hljs-attribute">onClick</span>=<span class="hljs-value">"displayModel"</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Log Model"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">Window</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">Alloy</span>&gt;</span>
</code></pre><p>And finally, here is my controller that is responsible for saving the fields:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> mySettings = Alloy.Models.mySettings;
Ti.API.info(<span class="hljs-string">"load mySettings: "</span> + <span class="hljs-built_in">JSON</span>.stringify(mySettings));

<span class="hljs-keyword">var</span> saveSettings = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
    Ti.API.info(<span class="hljs-string">"setting values to model: "</span> + $.username.value + <span class="hljs-string">":"</span> + $.password.value);
    <span class="hljs-comment">/*mySettings.set({
        "username": $.username.value,
        "password": $.password.value
    });*/</span>
    mySettings.save({
        <span class="hljs-string">"username"</span>: $.username.value,
        <span class="hljs-string">"password"</span>: $.password.value
    },
    {
        success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            Ti.API.info(<span class="hljs-string">"success"</span>);
        },
        error: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            Ti.API.info(<span class="hljs-string">"error"</span>);
        }
    });
};

<span class="hljs-keyword">var</span> displayModel = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    Ti.API.info(<span class="hljs-string">"button mySettings: "</span> + <span class="hljs-built_in">JSON</span>.stringify(mySettings));
    <span class="hljs-keyword">var</span> props = Ti.App.Properties.listProperties();

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>, ilen=props.length; i&lt;ilen; i++){
        <span class="hljs-keyword">var</span> value = Ti.App.Properties.getString(props[i]);
        Ti.API.info(props[i] + <span class="hljs-string">' = '</span> + value);
    }
}

<span class="hljs-keyword">if</span> (OS_IOS) {
    <span class="hljs-keyword">var</span> button = Ti.UI.createButton({
        title: <span class="hljs-string">'Save'</span>
    });
    button.addEventListener(<span class="hljs-string">'click'</span>, saveSettings);

    $.<span class="hljs-built_in">window</span>.rightNavButton = button; 
}

mySettings.fetch();
</code></pre><p>So in my controller, the saveSettings function is properly being called, appears to be saving my model, and even the success callback returns and prints &quot;success&quot; in the console. Everything seems like it should be working, except that my data isn&#39;t persisting beyond restarts of the application. I added a simple button to print the Ti.App.Properties to ensure my data isn&#39;t being placed into persistent properties, and it&#39;s not. However, I am seeing my properties when I print the reference to my model. So this makes me think that I need to do something else to actually save the model data.</p>
<p>Can anyone shed some light as to what I&#39;m leaving out of my code?</p>
<p>Thanks for any help.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="December 21st 2012, 11:05:56 pm">December 21st 2012</span>
				by <span class='authorname'>Paul Gullette</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>alloy</span></li>
					
						<li><span class='tagname'>model</span></li>
					
						<li><span class='tagname'>properties</span></li>
					
						<li><span class='tagname'>sync</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>4</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-253418">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>So I&#39;m kind of answering my own question here thanks in part to Tony Lukasavage who has some excellent samples which got me to the answer.</p>
<p>I started debugging through my project and looking at the generated adapter js files specifically properties.js and sql.js to compare the differences. What I figured out is that the sql.js adapter creates an id for the model, and then reuses it automatically. This allows the use of a singleton model that is based on the sql adapter function to work as expected.</p>
<p>The properties adapter on the other hand, gets its model&#39;s id by checking for its existence first, and if it isn&#39;t there, then it generates a new unique model id and sets it as the model id. So in my case, my model was simply two properties, and neither of them were named id. Once I saw that the code was looking in the model for an attribute named id, I added a new property to my model called id and gave it a default value. Then in my code, since I don&#39;t actually set the id attribute, the default is used. This results in each call to my model using the same id each time, and subsequently, my desired singleton approach works.</p>
<p>This approach makes me wonder if this should be documented better, or if the syntax for using a model as a singleton should be more explicit. Perhaps referring to the model in a view without instance=&quot;true&quot; being set could set a flag for the model where a default id is always used. I&#39;m sure there are other factors that would make this too broad of a &quot;solution&quot;, but maybe it&#39;s a start.</p>
<p>I do think it is a little confusing that the sql adapter can be used as a global singleton simply by using it via views and controllers globally. But using the properties adapter requires the explicit use of a defined id attribute for singleton behavior.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 25th 2012, 4:44:59 pm">December 25th 2012</span>
								by <span class='authorname'>Paul Gullette</span><br>
								<a class="icon-bg icon-link" href="question/146052/alloy-model-saving-not-persisting.html#answer-253418" rel="permalink">permalink</a>
							</div>

							<h5>7 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>I agree paul and bringing the builtin sync adapters more into line with each other is pretty high on my list of things to do. Sorry for the confusion.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 25th 2012, 7:17:50 pm">December 25th 2012</span>
											by <span class='authorname'>Tony Lukasavage</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Paul, thanks for the write up.  This helped me figure out the same thing.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 2nd 2013, 2:59:44 am">March 2nd 2013</span>
											by <span class='authorname'>Tony Nuzzi</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>It&#39;s also worth noting, that you need to explicitly state that your id is a primary, or you&#39;ll have a similar issue.</p>
<p>I thought this would work:</p>
<pre><code class="hljs"><span class="hljs-tag">config</span>: <span class="hljs-rules">{
        <span class="hljs-rule"><span class="hljs-attribute">columns</span>:<span class="hljs-value"> {
            <span class="hljs-string">"refNum"</span>: <span class="hljs-string">"int"</span>,
            <span class="hljs-string">"title"</span>: <span class="hljs-string">"string"</span>,
            <span class="hljs-string">"desc"</span>: <span class="hljs-string">"string"</span>
        </span></span></span>},
        <span class="hljs-tag">adapter</span>: <span class="hljs-rules">{
            <span class="hljs-rule"><span class="hljs-attribute">type</span>:<span class="hljs-value"> <span class="hljs-string">"sql"</span>,
            collection_name: <span class="hljs-string">"MyModel"</span>,
            idAttribute: <span class="hljs-string">"refNum"</span>
        </span></span></span>}
    },
</code></pre><p>I could use the refNum to get the model, but I had to specify the refNum as a primary key, or the saves won&#39;t work persistently.</p>
<p>So I changed it to this:</p>
<pre><code class="hljs"><span class="hljs-tag">config</span>: <span class="hljs-rules">{
        <span class="hljs-rule"><span class="hljs-attribute">columns</span>:<span class="hljs-value"> {
            <span class="hljs-string">"refNum"</span>: <span class="hljs-string">"INTEGER PRIMARY KEY"</span>,
            <span class="hljs-string">"title"</span>: <span class="hljs-string">"string"</span>,
            <span class="hljs-string">"desc"</span>: <span class="hljs-string">"string"</span>
        </span></span></span>},
        <span class="hljs-tag">adapter</span>: <span class="hljs-rules">{
            <span class="hljs-rule"><span class="hljs-attribute">type</span>:<span class="hljs-value"> <span class="hljs-string">"sql"</span>,
            collection_name: <span class="hljs-string">"MyModel"</span>,
            idAttribute: <span class="hljs-string">"refNum"</span>
        </span></span></span>}
    },
</code></pre><p>I&#39;d assumed that the use of idAttribute would have implicitly made it a primary key, but it didn&#39;t - silly me.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 26th 2013, 9:16:47 am">April 26th 2013</span>
											by <span class='authorname'>Osian Evans</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Why in the hell this explanation is not explicited in  <a href="http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;latest&#x2F;#!&#x2F;guide&#x2F;Creating_Your_First_Titanium_App">Creating Your First Titanium App</a> ?<br>Appcelerator tells to do this:</p>
<pre><code class="hljs">exports.definition = {
    config: {
        columns: {
            <span class="hljs-string">"title"</span>: <span class="hljs-string">"text"</span>,
            <span class="hljs-string">"author"</span>: <span class="hljs-string">"text"</span>
        },
        adapter: {
            type: <span class="hljs-string">"sql"</span>,
            collection_name: <span class="hljs-string">"books"</span>
        }
    ...
}
</code></pre><p>Do we really have to suffer this much ?</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 19th 2014, 7:01:42 pm">February 19th 2014</span>
											by <span class='authorname'>f fabreti</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I have tried adding refNum to the <a href="http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;3.0&#x2F;attachments_37685675_1_favebooks-complete.zip">sample app</a> provided with the <a href="http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;3.0&#x2F;#!&#x2F;guide&#x2F;Creating_Your_First_Titanium_App">Creating Your First Titanium App</a> tutorial. But it still will not persist the data. Each time I shut down the app, and restart, the data that was previously entered does not show up in the table any longer.</p>
<p>Can someone please explain what needs to be modified in that sample app?</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 26th 2014, 3:43:09 am">February 26th 2014</span>
											by <span class='authorname'>Anthony Tietjen</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>See my Answer to <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;162330&#x2F;titanium-creating-first-app-android-menu">titanium creating first app (android) menu</a></p>
</p>
										<div class="author">
											&mdash; commented <span title="February 26th 2014, 4:15:46 pm">February 26th 2014</span>
											by <span class='authorname'>f fabreti</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Fabreti, I pasted the model from your example into my model books.js file.  I uninstalled the app from the emulator and ran it again. Still, it will not persist the data that I enter before closing the app. (I am using iOS.)</p>
<p>Any thoughts?</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 26th 2014, 10:58:36 pm">February 26th 2014</span>
											by <span class='authorname'>Anthony Tietjen</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>10</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-253267">
				
						<section>
							<p>Try changing the type of your columns from &quot;text&quot; to &quot;String&quot;. If you look at the <a href="http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;latest&#x2F;#!&#x2F;api&#x2F;Titanium.App.Properties">Ti.App.Properties API doc</a> you&#39;ll see a series of get&#x2F;set functions. Those functions represent the supported column types. </p>
<p>In the future Alloy will do a better job of creating an abstracted column type that will work among all, or at least most, adapters. For now, though, using the explicit type for the properties adapter should work.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 21st 2012, 11:53:08 pm">December 21st 2012</span>
								by <span class='authorname'>Tony Lukasavage</span><br>
								<a class="icon-bg icon-link" href="question/146052/alloy-model-saving-not-persisting.html#answer-253267" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Tony, thanks for the suggestion.</p>
<p>Unfortunately, this did not solve the problem. I still get success callback and the appearance of persistence, but subsequent loads of the application lack the properties I&#39;m saving. Do you have any other suggestions or need me to show you some more code?</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 22nd 2012, 1:11:31 pm">December 22nd 2012</span>
											by <span class='authorname'>Paul Gullette</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I have been looking at your properties example at the alloy github. In that project, you refer to your model by calling Alloy.createModel(&quot;modelTab&quot;). You then go on to fetch using the same id. </p>
<p>What makes you use the createModel function to get access to your model in that project? And why wouldn&#39;t you access the model with a global reference via Alloy.Models.modelTab?</p>
<p>I&#39;m trying to better understand how best to use alloy. For my app, using the properties sync adapter in a singleton style made sense as it provides global access to my settings across all of my app.</p>
<p>Thanks again for your help.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 22nd 2012, 8:11:42 pm">December 22nd 2012</span>
											by <span class='authorname'>Paul Gullette</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>So just to clear up my post, the data was being properly persisted. The problem was that it was being persisted using a different id each time since I didn&#39;t explicitly specify one in my model.</p>
<p>And my code that was printing all of my set properties as my way of testing persistence doesn&#39;t work as expected. This code:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> props = Ti.App.Properties.listProperties();

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>, ilen=props.length; i&lt;ilen; i++){
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">value</span> = Ti.App.Properties.getString(props[i]);
    Ti.API.info(props[i] + <span class="hljs-string">' = '</span> + <span class="hljs-keyword">value</span>);
}
</code></pre><p>The getString method of Ti.App.Properties will return undefined if the item being returned is not a String. Or maybe it&#39;s because the object couldn&#39;t be cast to a String type. I&#39;m not exactly sure what is happening, but it does return undefined. I changed the above code to use getObject instead and I saw my properties then.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 25th 2012, 4:50:02 pm">December 25th 2012</span>
											by <span class='authorname'>Paul Gullette</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>@Tony. When I try to set column types to String as you suggested with a slqlite adapter, I get the following warning: <code>[warn] String is not a valid sqlite field, using TEXT instead</code>. When I use TEXT, I don&#39;t get that error. So, which is the correct usage?</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 10th 2013, 9:35:39 pm">December 10th 2013</span>
											by <span class='authorname'>Michael Stelly</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
