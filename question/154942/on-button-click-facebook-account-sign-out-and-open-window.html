<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>On button click, Facebook account sign out and open window Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>On button click, Facebook account sign out and open window</h1>
		</header>
		<section>
			<p>I am trying to assign two events to occur when my logOut button is clicked. The first event is to sign out of the facebook account and the second is to open a window. login.js is the file with the window I want to open and is located in the resources folder with this file. I don&#39;t believe my window call is appropriate, but I am not sure why the facebook.logout event in the click function is not working.</p>
<pre><code class="hljs">var fb = Ti.UI.currentWindow;
fb.barColor=<span class="hljs-string">'#fff'</span>;
fb.titleImage = <span class="hljs-string">'tap.png'</span>;
<span class="hljs-comment">//START Facebook Code</span>

<span class="hljs-comment">//create your facebook sessionf</span>

        Titanium.Facebook.appid = <span class="hljs-string">'00000000'</span>;
        Titanium.Facebook.permissions = [<span class="hljs-string">'read_stream'</span>]; <span class="hljs-comment">//Permissions your app need</span>


var imagem = Ti.UI.createImageView({
    <span class="hljs-built_in">image</span> : <span class="hljs-string">'https://graph.facebook.com/'</span> + Ti.Facebook.uid + <span class="hljs-string">'/picture'</span>,
     top:<span class="hljs-number">10</span>,
 <span class="hljs-variable">width</span>:<span class="hljs-number">50</span>,
 <span class="hljs-variable">height</span>:<span class="hljs-number">50</span>,
 left:<span class="hljs-number">10</span>

});
fb.<span class="hljs-built_in">add</span>(imagem);




var userName = Ti.UI.createLabel({
    <span class="hljs-built_in">text</span>: <span class="hljs-string">'https://graph.facebook.com/'</span> + Ti.Facebook.uid + <span class="hljs-string">'/user.first_name'</span>,
    top: <span class="hljs-number">40</span>
});

fb.<span class="hljs-built_in">add</span>(userName);

<span class="hljs-comment">//Logout</span>


var logOut = Ti.UI.createButton({
    title: <span class="hljs-string">"Log Out"</span>,
    bottom:<span class="hljs-number">20</span>
});

fb.<span class="hljs-built_in">add</span>(logOut);



logOut.addEventListener(<span class="hljs-string">'click'</span>, function(e) {
    <span class="hljs-keyword">if</span> (!Titanium.Facebook.loggedIn) {
        Titanium.Facebook.logout();
    login.<span class="hljs-built_in">open</span>();
    } <span class="hljs-keyword">else</span> {
        Titanium.Facebook.authorize();
    }
});
</code></pre><p>login.js</p>
<pre><code class="hljs">
<span class="hljs-keyword">var</span> Cloud = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ti.cloud'</span>);

Titanium.Facebook.appid = <span class="hljs-string">"000000"</span>;<span class="hljs-comment">//Production</span>
Titanium.Facebook.permissions = [<span class="hljs-string">'read_stream'</span>];


<span class="hljs-keyword">var</span> win = Ti.UI.createWindow({
    modal:<span class="hljs-literal">true</span>,
    navBarHidden:<span class="hljs-literal">true</span>,
    backgroundColor:<span class="hljs-string">'#fff'</span>


win.open();
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="July 16th 2013, 11:51:29 pm">July 16th 2013</span>
				by <span class='authorname'>Connor Phillips</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>button</span></li>
					
						<li><span class='tagname'>click</span></li>
					
						<li><span class='tagname'>eventlistener</span></li>
					
						<li><span class='tagname'>facebook</span></li>
					
						<li><span class='tagname'>logout</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>In your if you are saying &quot;if i&#39;m not logged in, logout&quot;. That should be the other way around. This is: </p>
<pre><code class="hljs"><span class="hljs-keyword">if</span> ( Ti<span class="hljs-class">.Facebook</span><span class="hljs-class">.loggedin</span>)
</code></pre><p>then you do logout.</p>
</div>
							<div class="author">
								&mdash; commented <span title="July 17th 2013, 1:41:07 am">July 17th 2013</span>
								by <span class='authorname'>Mauro Parra</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-266013">
				
						<section>
							<p>you should require login.js before calling the open.</p>
<pre><code class="hljs">logOut.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">if</span> (!Titanium.Facebook.loggedIn) {
        Titanium.Facebook.logout();
       <span class="hljs-keyword">var</span> login = <span class="hljs-built_in">require</span>(<span class="hljs-string">'login.js'</span>);
       login.open();
    } <span class="hljs-keyword">else</span> {
        Titanium.Facebook.authorize();
    }
});
</code></pre><p>and your login.js should like ,</p>
<pre><code class="hljs">exports.login = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

<span class="hljs-keyword">var</span> Cloud = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ti.cloud'</span>);

Titanium.Facebook.appid = <span class="hljs-string">"000000"</span>;<span class="hljs-comment">//Production</span>
Titanium.Facebook.permissions = [<span class="hljs-string">'read_stream'</span>];


<span class="hljs-keyword">var</span> win = Ti.UI.createWindow({
    modal:<span class="hljs-literal">true</span>,
    navBarHidden:<span class="hljs-literal">true</span>,
    backgroundColor:<span class="hljs-string">'#fff'</span>


<span class="hljs-keyword">return</span> win;
}
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 17th 2013, 4:14:50 am">July 17th 2013</span>
								by <span class='authorname'>Prakash M</span><br>
								<a class="icon-bg icon-link" href="question/154942/on-button-click-facebook-account-sign-out-and-open-window.html#answer-266013" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Sorry, before you added your comment, I added more functionality to login.js. Here is the new login.js. I did however try the logOut function you mentioned, but I&#39;m still not getting any actions to fire. </p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> Cloud = require('ti.cloud');

Titanium.Facebook.appid = <span class="hljs-string">"0000000"</span>;<span class="hljs-comment">//Production</span>
Titanium.Facebook.permissions = ['read_stream'];


<span class="hljs-keyword">var</span> <span class="hljs-keyword">win</span> = Ti.UI.createWindow({
    modal:true,
    navBarHidden:true,
    backgroundColor:'#fff'

});

<span class="hljs-keyword">var</span> fbSignupBtn = Ti.Facebook.createLoginButton({
    bottom: 50,
    style : Ti.Facebook.BUTTON_STYLE_WIDE
});
<span class="hljs-keyword">win</span>.add(fbSignupBtn);



 Titanium.Facebook.addEventListener('login', function(<span class="hljs-keyword">e</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.success) {
        Cloud.SocialIntegrations.externalAccountLogin({
            <span class="hljs-keyword">type</span> : 'facebook',
            <span class="hljs-keyword">token</span> : Ti.Facebook.accessToken
        }, function(<span class="hljs-keyword">e</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.success) {
                <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">e</span>.users[0];
                Ti.API.info('User  = ' + JSON.stringify(user));
                Ti.<span class="hljs-keyword">App</span>.Properties.setString('currentUserId', user.id);
                alert('Success: ' + 'id: ' + user.id + '\\<span class="hljs-keyword">n</span>' + 'first name: ' + user.first_name + '\\<span class="hljs-keyword">n</span>' + 'last name: ' + user.last_name);
                <span class="hljs-keyword">win</span>.<span class="hljs-keyword">close</span>();            
            } <span class="hljs-keyword">else</span> {
                alert('<span class="hljs-keyword">Error</span>: ' + ((<span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span> &amp;&amp; <span class="hljs-keyword">e</span>.message) || JSON.stringify(<span class="hljs-keyword">e</span>)));
            }
        });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span>) {
        alert(<span class="hljs-string">"Error = "</span> + <span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.cancelled) {
        alert(<span class="hljs-string">"canceld"</span>);
    }
}); 






<span class="hljs-keyword">win</span>.<span class="hljs-keyword">open</span>();
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="July 18th 2013, 12:24:33 am">July 18th 2013</span>
											by <span class='authorname'>Connor Phillips</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-266074">
				
						<section>
							<p>Hi Connor,<br>  Have you tried Ti.App.fireEventâTi.App.addEventListener ??? </p>
<p>Try it in the following way..</p>
<pre><code class="hljs"> Add <span class="hljs-operator">an</span> Event listener <span class="hljs-operator">in</span> your login.js , make sure that your event listener had <span class="hljs-operator">the</span> code that will <span class="hljs-built_in">open</span> <span class="hljs-operator">the</span> fb login.  Fire <span class="hljs-operator">the</span> event <span class="hljs-operator">in</span> logOut button click event <span class="hljs-keyword">after</span> <span class="hljs-operator">the</span> logout functionality... 
</code></pre><p>Hope this will help you .</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 18th 2013, 8:23:11 am">July 18th 2013</span>
								by <span class='authorname'>MONY desu</span><br>
								<a class="icon-bg icon-link" href="question/154942/on-button-click-facebook-account-sign-out-and-open-window.html#answer-266074" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hey MONY, </p>
<p>I understand the concepts you mean and it seems like a good solution, but I don&#39;t believe I am implementing it right. If I add an Event Listener to login.js, should I replace Titanium.Facebook.addEventListener with Ti.App.addEventListener, or do I implement it by itself? On the .js file with logOut, I tried to fire an event that would open the login.js window. Is this the right approach? Below is my attempt (I only included the code that seems to involve this implementation):</p>
<p>login.js</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> <span class="hljs-keyword">win</span> = Ti.UI.createWindow({
    modal:true,
    navBarHidden:true,
    backgroundColor:'#fff'

});


 Titanium.Facebook.addEventListener('login', function(<span class="hljs-keyword">e</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.success) {
        Cloud.SocialIntegrations.externalAccountLogin({
            <span class="hljs-keyword">type</span> : 'facebook',
            <span class="hljs-keyword">token</span> : Ti.Facebook.accessToken
        }, function(<span class="hljs-keyword">e</span>) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.success) {
                <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">e</span>.users[0];
                Ti.API.info('User  = ' + JSON.stringify(user));
                Ti.<span class="hljs-keyword">App</span>.Properties.setString('currentUserId', user.id);
                alert('Success: ' + 'id: ' + user.id + '\\<span class="hljs-keyword">n</span>' + 'first name: ' + user.first_name + '\\<span class="hljs-keyword">n</span>' + 'last name: ' + user.last_name);
                <span class="hljs-keyword">win</span>.<span class="hljs-keyword">close</span>();            
            } <span class="hljs-keyword">else</span> {
                alert('<span class="hljs-keyword">Error</span>: ' + ((<span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span> &amp;&amp; <span class="hljs-keyword">e</span>.message) || JSON.stringify(<span class="hljs-keyword">e</span>)));
            }
        });
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span>) {
        alert(<span class="hljs-string">"Error = "</span> + <span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span>);
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.cancelled) {
        alert(<span class="hljs-string">"canceld"</span>);
    }
}); 


Ti.<span class="hljs-keyword">App</span>.addEventListener('fbLogin', login);

<span class="hljs-keyword">win</span>.<span class="hljs-keyword">open</span>();
</code></pre><p>facebook.js (logOut button .js file)</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> fb = Ti.UI.currentWindow;

logOut.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">if</span> (!Titanium.Facebook.loggedIn) {
        Titanium.Facebook.logout();

    } <span class="hljs-keyword">else</span> {
        Titanium.Facebook.authorize();
    }
});

Ti.App.fireEvent(<span class="hljs-string">'fbLogin'</span>, {win: win.open()});
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="July 20th 2013, 5:42:30 pm">July 20th 2013</span>
											by <span class='authorname'>Connor Phillips</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
