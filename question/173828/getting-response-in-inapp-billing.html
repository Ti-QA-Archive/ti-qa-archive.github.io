<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Getting response in inapp billing » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Getting response in inapp billing</h1>
		</header>
		<section>
			<p>platform: android<br>sdk :3.12<br>I have implemented in app billing sucessfully and payment is also done but Iam not letting to get the notifyId correctly. I mean notifyId should be productID after purchasing. Iam getting some numbers when notifyId is being called . Please help me. Should I change the e.notify to some thing in changeUI function. This is my code.</p>
<pre><code class="hljs">var InAppBilling = require(<span class="hljs-string">'ti.inappbilling'</span>);
function changeUI(e) {
<span class="hljs-keyword">if</span> (e.notifyId == <span class="hljs-string">'1'</span>) {
            <span class="hljs-keyword">if</span>(view.status==<span class="hljs-string">'paid'</span>){
            view.status=<span class="hljs-string">"free"</span>;
            alert(<span class="hljs-string">'unlcok'</span>);
        }

        }
}
function NotifyMe(text) {
        Ti.API.info(<span class="hljs-string">'&lt; -- &gt; '</span> + text);
        Ti.UI.createNotification({
            <span class="hljs-string">message :</span> text,
            <span class="hljs-string">duration :</span> Ti.UI.NOTIFICATION_DURATION_SHORT
        }).show();
    }

    <span class="hljs-comment">//NotifyMe('Open DDMS to see the logs');</span>
    function ResponseString(responseCode) {
        <span class="hljs-keyword">switch</span> (responseCode) {
            <span class="hljs-keyword">case</span> InAppBilling.<span class="hljs-string">RESULT_OK:</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">'OK'</span>;
            <span class="hljs-keyword">case</span> InAppBilling.<span class="hljs-string">RESULT_USER_CANCELED:</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">'USER CANCELED'</span>;
            <span class="hljs-keyword">case</span> InAppBilling.<span class="hljs-string">RESULT_SERVICE_UNAVAILABLE:</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">'SERVICE UNAVAILABLE'</span>;
            <span class="hljs-keyword">case</span> InAppBilling.<span class="hljs-string">RESULT_BILLING_UNAVAILABLE:</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">'BILLING UNAVAILABLE'</span>;
            <span class="hljs-keyword">case</span> InAppBilling.<span class="hljs-string">RESULT_ITEM_UNAVAILABLE:</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">'ITEM UNAVAILABLE'</span>;
            <span class="hljs-keyword">case</span> InAppBilling.<span class="hljs-string">RESULT_DEVELOPER_ERROR:</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">'DEVELOPER ERROR'</span>;
            <span class="hljs-keyword">case</span> InAppBilling.<span class="hljs-string">RESULT_ERROR:</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">'RESULT ERROR'</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
    }

    function VerificationString(verificationCode) {
        <span class="hljs-keyword">switch</span> (verificationCode) {
            <span class="hljs-keyword">case</span> InAppBilling.<span class="hljs-string">SIGNATURE_VERIFIED:</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">'SIGNATURE VERIFIED'</span>;
            <span class="hljs-keyword">case</span> InAppBilling.<span class="hljs-string">NULL_DATA:</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">'NULL DATA'</span>;
            <span class="hljs-keyword">case</span> InAppBilling.<span class="hljs-string">SIGNATURE_ERROR:</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">'SIGNATURE ERROR'</span>;
            <span class="hljs-keyword">case</span> InAppBilling.<span class="hljs-string">UNKNOWN_NONCE:</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">'UNKNOWN NONCE'</span>;
            <span class="hljs-keyword">case</span> InAppBilling.<span class="hljs-string">PUBLIC_KEY_NULL:</span>
                <span class="hljs-keyword">return</span> <span class="hljs-string">'PUBLIC KEY NULL'</span>;
        }
        <span class="hljs-keyword">return</span> <span class="hljs-string">''</span>;
    }
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="May 4th 2014, 3:43:01 am">May 4th 2014</span>
				by <span class='authorname'>Prashaanth N.G.S</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>3.1.2</span></li>
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>inapp billing</span></li>
					
						<li><span class='tagname'>purchase</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">displaySynchronousResponseCodes</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">var</span> response = ResponseString(e.responseCode);

        <span class="hljs-comment">//NotifyMe('Request Id: ' + e.requestId+ '\n'+'Response code: ' + e.responseCode);</span>

        <span class="hljs-comment">//Ti.API.info('Request Id: ' + e.requestId);</span>
        <span class="hljs-comment">//Ti.API.info('Response code: ' + e.responseCode);</span>
        <span class="hljs-comment">//alert(response);</span>
    }
restoreTransactionsButton.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{
    NotifyMe(<span class="hljs-string">'Restore Transactions'</span>);

    <span class="hljs-keyword">var</span> synchronousResponse = InAppBilling.restoreTransactions();
    displaySynchronousResponseCodes(synchronousResponse);
});

    InAppBilling.addEventListener(InAppBilling.ON_BIND_EVENT, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">if</span> (e.result == InAppBilling.SUCCESS) {
            <span class="hljs-comment">//NotifyMe('Billing Service Bound');</span>
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//NotifyMe('Billing Service Bind Failed');</span>
        }
    });

    InAppBilling.addEventListener(InAppBilling.ON_CONNECT_EVENT, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{

        <span class="hljs-comment">//checkBillingSupportedButton.enabled = true;</span>
        <span class="hljs-comment">//checkSubscriptionsSupportedButton.enabled = true;</span>
        restoreTransactionsButton.enabled = <span class="hljs-literal">true</span>;
        <span class="hljs-comment">//tTypeBtn.enabled = true;</span>
    });
    InAppBilling.addEventListener(InAppBilling.RESPONSE_EVENT, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-comment">// Events with (e.sync == true) are deprecated and will be removed. Use the event object that the methods return.</span>
        <span class="hljs-keyword">if</span> (!e.sync) {
            <span class="hljs-comment">//NotifyMe('RESPONSE CALLED ' + e.requestId + e.responseCode);</span>
            Ti.API.info(<span class="hljs-string">'RESPONSE CALLED \n'</span> + <span class="hljs-string">'Request Id:\n'</span> + e.requestId + <span class="hljs-string">' '</span> + <span class="hljs-string">'\nResponse Code:'</span> + ResponseString(e.responseCode));
        }
        <span class="hljs-comment">//alert('response event'+e.responseCode);</span>
    });

    InAppBilling.addEventListener(InAppBilling.PURCHASE_STATE_CHANGED_EVENT, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{

        <span class="hljs-comment">//NotifyMe('PURCHASE STATE CHANGED CALLED ' + e.signedData + ' ' + e.signature+'\n'+ 'SECURITY RESULT ' + e.result);</span>

        Ti.API.info(<span class="hljs-string">'PURCHASE STATE CHANGED CALLED'</span>);
        Ti.API.info(<span class="hljs-string">'Signature Verification Result:\n'</span> + VerificationString(e.result));
        Ti.API.info(<span class="hljs-string">'Signed Data:\n'</span> + e.signedData);

        <span class="hljs-keyword">if</span> (e.signedData != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">var</span> response = <span class="hljs-built_in">JSON</span>.parse(e.signedData);
            <span class="hljs-keyword">if</span> (response.orders[<span class="hljs-number">0</span>] &amp;&amp; response.orders[<span class="hljs-number">0</span>].notificationId) {
                <span class="hljs-keyword">var</span> synchronousResponse = InAppBilling.confirmNotifications({
                    notificationIds : [response.orders[<span class="hljs-number">0</span>].notificationId]
                });
                displaySynchronousResponseCodes(synchronousResponse);
            }
        }

        <span class="hljs-comment">//alert('purchase staete'+e.result);</span>

    });

    InAppBilling.addEventListener(InAppBilling.NOTIFY_EVENT, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{

        <span class="hljs-comment">//Ti.API.info('NOTIFY CALLED \n' + 'Notify Id:\n' + e.notifyId);</span>
        alert(<span class="hljs-string">'NOTIFY CALLED \n'</span> + <span class="hljs-string">'Notify Id:\n'</span> + e.notifyId);

        <span class="hljs-keyword">var</span> synchronousResponse = InAppBilling.getPurchaseInformation({
            notificationIds : [e.notifyId]
        });
        displaySynchronousResponseCodes(synchronousResponse);
         alert(<span class="hljs-string">'notify event'</span>+ e.notifyId);
        changeUI(e);

    <span class="hljs-comment">//}</span>

    });

    InAppBilling.startBillingService();

    <span class="hljs-comment">//NotifyMe('Starting Billing Service');</span>

    <span class="hljs-keyword">if</span> (Ti.Platform.model === <span class="hljs-string">'Simulator'</span> || Ti.Platform.model.indexOf(<span class="hljs-string">'sdk'</span>) !== -<span class="hljs-number">1</span>) {
        Ti.API.error(<span class="hljs-string">'InAppBilling Module will not work on an Emulator, it must be run on a Device.'</span>);
        alert(<span class="hljs-string">'InAppBilling Module will not work on an Emulator, it must be run on a Device.'</span>);
    }

<span class="hljs-keyword">var</span> rows = db.execute(<span class="hljs-string">'Select * from table where column1=1'</span>);

    <span class="hljs-keyword">var</span> view = Ti.UI.createView({
        top : <span class="hljs-number">50</span>,
        height : (Ti.Platform.osname === <span class="hljs-string">'android'</span> &amp;&amp; (deviceWidth &gt; <span class="hljs-number">899</span> || deviceHeight &gt; <span class="hljs-number">899</span>)) ? <span class="hljs-number">192</span> : <span class="hljs-number">144</span>,
        width : <span class="hljs-string">'100%'</span>,
        status : rows.fieldByName(<span class="hljs-string">'coulmn_Status'</span>),
        left : <span class="hljs-number">0</span>
    });
    win.add(view);

view.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            alert(view.status);
        <span class="hljs-keyword">if</span> (view.status == <span class="hljs-string">"paid"</span>) {
            <span class="hljs-keyword">var</span> synchronousResponse = InAppBilling.requestPurchase({
                productId : <span class="hljs-string">'1'</span>
                <span class="hljs-comment">//productId:'android.test.purchased'</span>
            });
            displaySynchronousResponseCodes(synchronousResponse);

        } 
}
</code></pre></div>
							<div class="author">
								&mdash; commented <span title="May 4th 2014, 3:43:32 am">May 4th 2014</span>
								by <span class='authorname'>Prashaanth N.G.S</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p><a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;173809&#x2F;could-no-the-same-product-id-in-inapp-billing">Duplicate question</a></p>
<p>I cannot believe you have created a new duplicate question in such a short amount of time. Your original question had so little information and no wish to expand until several people told you to. </p>
<p>The subject matter is clearly not something many here have come across which would be partially why you have not gained an answer on the first question, plus the limit info of course. </p>
<p>Whilst I understand you are frustrated and eager to get an answer this is not the right way (see previous question).  You should have been patient - duplicate questions are annoying. </p>
<p>This is not something I come across often so I have no help to give right now, my aim in the previous question was to try and get you to provide sufficent information so that others would have something to work with.</p>
</div>
							<div class="author">
								&mdash; commented <span title="May 4th 2014, 4:12:27 am">May 4th 2014</span>
								by <span class='authorname'>Malcolm Hollingsworth</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>0</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>0 Answers</h3>

	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
