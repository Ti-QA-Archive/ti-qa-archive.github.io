<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Updating a Tableview Data Collection Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Updating a Tableview Data Collection</h1>
		</header>
		<section>
			<p>Ive had a hunt round the forums before answering the question as I cant seem to get the blighter to work as I&#39;d expect.</p>
<p>RIght so I have a players view which populates a table with a Players Collection:</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">Alloy</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Collection</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"players"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Window</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Select Players"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"playersWin"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">RightNavButton</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">Button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"new_player"</span> <span class="hljs-attribute">onClick</span>=<span class="hljs-value">"openNewPlayerWindow"</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Add"</span> <span class="hljs-attribute">systemButton</span>=<span class="hljs-value">"Titanium.UI.iPhone.SystemButton.ADD"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">RightNavButton</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">TableView</span> <span class="hljs-attribute">dataCollection</span>=<span class="hljs-value">"players"</span> <span class="hljs-attribute">filterAttribute</span>=<span class="hljs-value">"title"</span> <span class="hljs-attribute">dataTransform</span>=<span class="hljs-value">"transformFunction"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">SearchBar</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">TableViewRow</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"{name}"</span> <span class="hljs-attribute">playerId</span>=<span class="hljs-value">"{player_id}"</span> <span class="hljs-attribute">hasDetail</span>=<span class="hljs-value">"true"</span> &gt;</span>

            <span class="hljs-tag">&lt;/<span class="hljs-title">TableViewRow</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">TableView</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">Window</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">Alloy</span>&gt;</span>
</code></pre><p>Now in this view there is a button to add a new player (model) which works when submitted and validated. What am I trying to achieve is when this is added that the table view updates (collection) with the latest entry (model) appended. Now im not sure if this is poosible as I&#39;m wiring up the data in the view XML.</p>
<p>Here is my submisson and Model creation logic in the &quot;Add New Player Window #edit_player&quot;.</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> mPlayers = Alloy.createModel(<span class="hljs-string">'players'</span>);
        mPlayers.save({
            <span class="hljs-string">"first_name"</span>: $.name.value,
            <span class="hljs-string">"surname"</span>: $.surname.value,
               <span class="hljs-string">"handicap"</span>: $.handicap.value
        },
        {
            success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                Alloy.Collections.players.reset( );
                $.edit_player.close();
            },
            error: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                Ti.API.info(<span class="hljs-string">"error"</span>);
            }
        });
</code></pre><p>Again I apologize for bombariding the Q&amp;A with my Q&#39;s but this is one of those where I wish to know if this can be achieved or not.</p>
<p>Steve</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="May 19th 2013, 6:49:30 pm">May 19th 2013</span>
				by <span class='authorname'>Steve Clark</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>alloy</span></li>
					
						<li><span class='tagname'>collection</span></li>
					
						<li><span class='tagname'>table</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-263001">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>Yep, just add your newly created model to the dataCollection via the <code>add()</code> function. This will trigger the data binding and update the table UI.</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> mPlayers = Alloy.createModel(<span class="hljs-string">'players'</span>);
        mPlayers.save({
            <span class="hljs-string">"first_name"</span>: $.name.value,
            <span class="hljs-string">"surname"</span>: $.surname.value,
            <span class="hljs-string">"handicap"</span>: $.handicap.value
        },
        {
            success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                Alloy.Collections.players.reset( );
                $.edit_player.close();
            },
            error: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                Ti.API.info(<span class="hljs-string">"error"</span>);
            }
        });

Alloy.Collections.players.add(mPlayers);
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 19th 2013, 11:05:55 pm">May 19th 2013</span>
								by <span class='authorname'>Tony Lukasavage</span><br>
								<a class="icon-bg icon-link" href="question/152582/updating-a-tableview-data-collection#answer-263001" rel="permalink">permalink</a>
							</div>

							<h5>5 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Thanks buddy (again!)</p>
<p>Although it has not solved the problem I have a funny feeling I know why.</p>
<p>The players table is opened from a previous view using:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> <span class="hljs-keyword">win</span>=Alloy.createController('players').getView();
Alloy.Globals.tabGroup.activeTab.<span class="hljs-keyword">open</span>(<span class="hljs-keyword">win</span>);
</code></pre><p>This in turn opens the Add New Player in the same way. Because the view containing the player table opens via this route would this be why it is not updating when I hit that command.</p>
<p>I can give you access to the Repo if you wish. Be kind, this is my first Alloy project :-)</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 20th 2013, 11:15:56 am">May 20th 2013</span>
											by <span class='authorname'>Steve Clark</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>It would be more helpful if you could boil it down to a reproducible test case, rather than trying to go through your whole project. Try to identify the smallest amount code that can reproduce the issue.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 20th 2013, 11:26:46 am">May 20th 2013</span>
											by <span class='authorname'>Tony Lukasavage</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>So I <em>think</em> what you are saying is that the modification of the collection is happening in a different window&#x2F;controller than the window&#x2F;controller that actually needs to show the UI change. I would have thought that if you were using a global collection for this that the events would propagate where ever they need to go, but if they don&#39;t seem to be in your case, you might need to manually trigger the UI update in your original controller with something like the following:</p>
<pre><code class="hljs">Alloy.Collections.players.trigger(<span class="hljs-string">'change'</span>);
</code></pre><p>This really shouldn&#39;t be necessary, though, unless the UI you are attempting to update is not yet open when the <code>add()</code> occurred.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 20th 2013, 12:03:26 pm">May 20th 2013</span>
											by <span class='authorname'>Tony Lukasavage</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Oh dear! I have found the issue. There was a &#39;blur&#39; event with $.destroy() which kind of nuked everything. I have no idea why I event put in there. There&#39;s a lesson learnt.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 20th 2013, 12:23:25 pm">May 20th 2013</span>
											by <span class='authorname'>Steve Clark</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Glad you found it. Can you mark this answer as best so the next dev knows where to look? Thanks.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 20th 2013, 12:38:47 pm">May 20th 2013</span>
											by <span class='authorname'>Tony Lukasavage</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>2</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-263029">
				
						<section>
							<p>Right.</p>
<p>User clicks on Tab Group Item for round configuration which has a button to select a player which has an onClick handler which calls the below script.</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openPlayerSpinner</span><span class="hljs-params">(e)</span> </span>{
     <span class="hljs-keyword">var</span> win=Alloy.createController(<span class="hljs-string">'players'</span>).getView();
     Alloy.Globals.tabGroup.activeTab.open(win);
}
</code></pre><p>This opens a Players List view </p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">Alloy</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Collection</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"players"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Window</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"container"</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Select Players"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"playersWin"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">RightNavButton</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">Button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"new_player"</span> <span class="hljs-attribute">onClick</span>=<span class="hljs-value">"openNewPlayerWindow"</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Add"</span> <span class="hljs-attribute">systemButton</span>=<span class="hljs-value">"Titanium.UI.iPhone.SystemButton.ADD"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">RightNavButton</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">TableView</span> <span class="hljs-attribute">dataCollection</span>=<span class="hljs-value">"players"</span> <span class="hljs-attribute">filterAttribute</span>=<span class="hljs-value">"title"</span> <span class="hljs-attribute">dataTransform</span>=<span class="hljs-value">"transformFunction"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">SearchBar</span> /&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">TableViewRow</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"{name}"</span> <span class="hljs-attribute">playerId</span>=<span class="hljs-value">"{player_id}"</span> <span class="hljs-attribute">hasDetail</span>=<span class="hljs-value">"true"</span> &gt;</span>

            <span class="hljs-tag">&lt;/<span class="hljs-title">TableViewRow</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">TableView</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">Window</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">Alloy</span>&gt;</span>
</code></pre><p>If the user needs to add another player they click the $.new_player button as above which calls this function:</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openNewPlayerWindow</span><span class="hljs-params">()</span> </span>{
     <span class="hljs-keyword">var</span> win=Alloy.createController(<span class="hljs-string">'editPlayer'</span>).getView();
     Alloy.Globals.tabGroup.activeTab.open(win);
}
</code></pre><p>This then opens a view with some input fields and then on submission calls this function</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">handleFormSubmission</span>(<span class="hljs-params"></span>) </span>{

    <span class="hljs-comment">// -- Global</span>
    <span class="hljs-keyword">var</span> errors = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>;

    <span class="hljs-comment">// -- Check If Name Is Not Empty</span>
    <span class="hljs-keyword">if</span>(!$.name.hasText()) {
        errors.push( <span class="hljs-string">'Please Enter The Golfers First name'</span> );
    }
    <span class="hljs-comment">// -- Check If Surname Is Not Empty</span>
    <span class="hljs-keyword">if</span>(!$.surname.hasText()) {
        errors.push( <span class="hljs-string">'Please Enter The Golfers Surname'</span> );
    }
    <span class="hljs-comment">// -- Check If Handicap Is Valid</span>
    <span class="hljs-keyword">if</span>(!$.handicap.hasText() || $.handicap.value &gt; <span class="hljs-number">36</span>) {
        errors.push( <span class="hljs-string">'Please Enter The Golfers Handicap ensuring it is under 36'</span> );
    }

    <span class="hljs-comment">// -- Check Errors Array</span>
    <span class="hljs-keyword">if</span>(errors.length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">var</span> err_string = <span class="hljs-string">''</span>;
        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;errors.length;i++) {
            err_string += errors[i] + <span class="hljs-string">'\n'</span>;
        }
        alert(err_string);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span>(!pid) {
            <span class="hljs-comment">// -- Add To Collection</span>
            <span class="hljs-keyword">var</span> mPlayers = Alloy.createModel(<span class="hljs-string">'players'</span>);
            mPlayers.save({
                <span class="hljs-string">"first_name"</span>: $.name.value,
                <span class="hljs-string">"surname"</span>: $.surname.value,
                   <span class="hljs-string">"handicap"</span>: $.handicap.value
            },
            {
                success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    Alloy.Collections.players.reset();     
                },
                error: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    Ti.API.info(<span class="hljs-string">"error"</span>);
                }
            });

        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">// -- Update Model</span>
            player_model.set({    
                first_name : $.name.value,
                surname : $.surname.value,
                handicap : $.handicap.value
            }).save();
            pid = <span class="hljs-literal">null</span>;
        }
        Alloy.Collections.players.add(mPlayers);
        $.edit_player.close();
    }
}
</code></pre><p>Ill try and concatenate it down to a single app for you this evening. but at present it does not update the players list when you add a new player.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 20th 2013, 11:57:14 am">May 20th 2013</span>
								by <span class='authorname'>Steve Clark</span><br>
								<a class="icon-bg icon-link" href="question/152582/updating-a-tableview-data-collection#answer-263029" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>use the comments to keep the conversation in order</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 20th 2013, 11:59:50 am">May 20th 2013</span>
											by <span class='authorname'>Tony Lukasavage</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-263034">
				
						<section>
							<p>Oh dear! I have found the issue. There was a &#39;blur&#39; event with $.destroy() which kind of nuked everything. I have no idea why I event put in there. There&#39;s a lesson learnt.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 20th 2013, 12:47:54 pm">May 20th 2013</span>
								by <span class='authorname'>Steve Clark</span><br>
								<a class="icon-bg icon-link" href="question/152582/updating-a-tableview-data-collection#answer-263034" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
