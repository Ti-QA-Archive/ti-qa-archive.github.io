<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>How can I get EvalJS to work on Android? » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>How can I get EvalJS to work on Android?</h1>
		</header>
		<section>
			<p>Hi there, </p>
<p>I have tried several different SDK&#39;s and none of them work. the evalJS javascript function simply does not work on android devices or android emulator.</p>
<p>[https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TIMOB-15896]</p>
<p>I have tried to download 3.1.3 but can&#39;t get it to work at all…all kinds of errors.</p>
<p>My app works perfectly on an iphone, but I need to inject javascript in to a remote webview with evalJS.<br>(The proposed workaround is already in 3.4 and other sdk versions and it doesn&#39;t do anything for me).</p>
<p>What can I do? My deadline is within a week to get this functioning on an android.</p>
<p>Kind Regards.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="July 9th 2014, 10:58:23 pm">July 9th 2014</span>
				by <span class='authorname'>Jon Kravetz</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>bug</span></li>
					
						<li><span class='tagname'>evaljs</span></li>
					
						<li><span class='tagname'>javascript</span></li>
					
						<li><span class='tagname'>titanium</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>LOG:</p>
<p><code>[WARN] :   TiWebViewBinding: (KrollRuntimeThread) [1865,51956] Timeout waiting to evaluate JS
[INFO] :   I&amp;#x2F;TiWebChromeClient.console: (main) [22,51978] Uncaught SyntaxError: Unexpected token var (1:http:&amp;#x2F;&amp;#x2F;m.xxx.com&amp;#x2F;)</code></p>
</div>
							<div class="author">
								&mdash; commented <span title="July 10th 2014, 1:45:02 pm">July 10th 2014</span>
								by <span class='authorname'>Jon Kravetz</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Nick seems to think his solution works…can anyone else confirm this??? Literally, I am going to have to scrap titanium if I don&#39;t figure this out.</p>
</div>
							<div class="author">
								&mdash; commented <span title="July 10th 2014, 3:25:11 pm">July 10th 2014</span>
								by <span class='authorname'>Jon Kravetz</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>-1</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-280552">
				
						<section>
							<p>There&#39;s a manual patch you can make to the framework to get this working again. Decribed <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;161916&#x2F;evaljs-makes-trouble-sdk-320ga">here</a></p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 10th 2014, 4:21:11 am">July 10th 2014</span>
								by <span class='authorname'>Nick Milner</span><br>
								<a class="icon-bg icon-link" href="question/176003/how-can-i-get-evaljs-to-work-on-android#answer-280552" rel="permalink">permalink</a>
							</div>

							<h5>25 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Nope. It doesn&#39;t work. If you read down in the thread the OP just sidesteps the question of whether it works or not. The manual patch DOES NOT WORK.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 1:12:19 pm">July 10th 2014</span>
											by <span class='authorname'>Jon Kravetz</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>yes, it does… Tried and currently using myself.  Did compile yourself a custom version of the sdk or did you think just changing the source file would be enough ?</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 1:17:06 pm">July 10th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I downloaded the most recent bleeding edge sdk…opened up the source and it already had </p>
<p>@JavascriptInterface<br>public void setValue(String value) in the source file TiWebViewBinding.java</p>
<p>I didn&#39;t compile a custom version. I just installed that version 4.4xxx from the repo.</p>
<p>In trying to create a custom version I am getting this error:<br>(I have android API 17 installed….)</p>
<p>File &quot;&#x2F;Users&#x2F;xxx&#x2F;.Trash&#x2F;titanium_mobile2.3ga&#x2F;SConstruct&quot;, line 119:<br>    sdk = AndroidSDK(ARGUMENTS.get(&quot;android_sdk&quot;, None), 17)<br>  File &quot;&#x2F;Users&#x2F;xxx&#x2F;.Trash&#x2F;titanium_mobile2.3ga&#x2F;support&#x2F;android&#x2F;androidsdk.py&quot;, line 49:<br>    self.set_api_level(api_level)<br>  File &quot;&#x2F;Users&#x2F;xxx&#x2F;.Trash&#x2F;titanium_mobile2.3ga&#x2F;support&#x2F;android&#x2F;androidsdk.py&quot;, line 53:<br>    self.find_platform_dir()<br>  File &quot;&#x2F;Users&#x2F;xxx.Trash&#x2F;titanium_mobile2.3ga&#x2F;support&#x2F;android&#x2F;androidsdk.py&quot;, line 127:<br>    old_style_dir = os.path.join(self.android_sdk, &#39;platforms&#39;, android_api_levels[api_level])</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 1:31:17 pm">July 10th 2014</span>
											by <span class='authorname'>Jon Kravetz</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Err … no. the &#39;bleeding edge&#39; isnt even guarenteed to run as it just a nightly CI build. You need to download the repo, checkout the 3.2 version, then add the change, then compile your custom sdk.. job done</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 1:45:32 pm">July 10th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Nick, thanks…I will try exactly that. Can you tell me why I am getting an error checking out the 3.2 version?</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 1:51:57 pm">July 10th 2014</span>
											by <span class='authorname'>Jon Kravetz</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Correction– I am able to check it out…I am unable to build it. I have android sdk api 17 installed and i followed the instructions to create environment variables.</p>
<p>bash-3.2# scons android_sdk=$ANDROID_HOME<br>scons: Reading SConscript files …<br>Building MobileSDK version 3.2.0, githash d9182d6<br>KeyError: 17:<br>  File &quot;&#x2F;Users&#x2F;xxx&#x2F;.Trash&#x2F;titanium_mobile2.3ga&#x2F;SConstruct&quot;, line 119:<br>    sdk = AndroidSDK(ARGUMENTS.get(&quot;android_sdk&quot;, None), 17)<br>  File &quot;&#x2F;Users&#x2F;xxx&#x2F;.Trash&#x2F;titanium_mobile2.3ga&#x2F;support&#x2F;android&#x2F;androidsdk.py&quot;, line 49:<br>    self.set_api_level(api_level)<br>  File &quot;&#x2F;Users&#x2F;xxx&#x2F;.Trash&#x2F;titanium_mobile2.3ga&#x2F;support&#x2F;android&#x2F;androidsdk.py&quot;, line 53:<br>    self.find_platform_dir()<br>  File &quot;&#x2F;Users&#x2F;xxx&#x2F;.Trash&#x2F;titanium_mobile2.3ga&#x2F;support&#x2F;android&#x2F;androidsdk.py&quot;, line 127:<br>    old_style_dir = os.path.join(self.android_sdk, &#39;platforms&#39;, android_api_levels[api_level])<br>bash-3.2# titanium<br>Titanium Command-Line Interface, CLI version 3.2.3, Titanium SDK version 3.1.3.GA<br>Copyright (c) 2012-2014, Appcelerator, Inc.  All Rights Reserved.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 1:56:19 pm">July 10th 2014</span>
											by <span class='authorname'>Jon Kravetz</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>nevermind – my environment variables were wrong</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 2:29:56 pm">July 10th 2014</span>
											by <span class='authorname'>Jon Kravetz</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>i just read your latest</p>
<pre><code class="hljs"><span class="hljs-constant">Uncaught SyntaxError:</span> <span class="hljs-constant">Unexpected </span>token var (<span class="hljs-number">1</span><span class="hljs-symbol">:http</span><span class="hljs-symbol">://m</span>.xxx.com/)
</code></pre><p>that looks a bit odd to me . There appears to be a something else failing. Can you provide the html you are trying to interact with and the JS you are evaluating ?</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 3:26:12 pm">July 10th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Just did this:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> w = Ti.UI.createWindow();
<span class="hljs-keyword">var</span> wv = Ti.UI.createWebView({
    url : <span class="hljs-string">'http://www.appcelerator.com/'</span>
});

wv.addEventListener(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
    <span class="hljs-keyword">var</span> docTitle = wv.evalJS(<span class="hljs-string">'document.title'</span>);
    alert(docTitle);
});

w.add(wv);
w.open();
</code></pre><p>and it correctly alerts the web page document title. Tested on Genymotion S5 emulator on 3.2.3 with no modifications.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 3:32:56 pm">July 10th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Does this test case work for you ?</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 3:48:51 pm">July 10th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Are you talking about titanium SDK 3.2.3 or android 3.2.3 API?</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 4:06:58 pm">July 10th 2014</span>
											by <span class='authorname'>Jon Kravetz</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Ok sorry…you are obviously talking about titanium sdk</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 4:07:20 pm">July 10th 2014</span>
											by <span class='authorname'>Jon Kravetz</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>lol, yes the Ti SDK :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 4:10:36 pm">July 10th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>That very simple example works…it grabs the document.title from the page. However what if you want to inject something more substantial.</p>
<p>Thanks for your help. I agree that I need to look in to the Uncaught SyntaxError: Unexpected token var error.</p>
<p>I will give you some code snippets.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 4:39:58 pm">July 10th 2014</span>
											by <span class='authorname'>Jon Kravetz</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>So, at least evalJS() is not actually broken…. :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 4:55:19 pm">July 10th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Yeah…perhaps evalJS() is not completely broken….parts of it?? Let&#39;s find out…there are a ton of<br>unresolved bugs about this…and I have created a lot of javascript and it works perfectly on ios sim and actual device.</p>
<p>Here is something that gives me the error message.</p>
<p>if (barcodebuttonexists == false){<br>        $.mobilewebview.evalJS(&quot;var searchdiv=document.querySelector(&#39;.searchdiv&#39;);&quot;);<br>};</p>
<p>[INFO] :   I&#x2F;TiWebChromeClient.console: (main) [1643,1643] Uncaught SyntaxError: Unexpected token var (1:http:&#x2F;&#x2F;m.xxx.com&#x2F;)</p>
<p>where m.xxx.com is a mobilewebsite.<br>and $.mobilewebview is a webview.</p>
<p>works perfectly on ios.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 5:20:29 pm">July 10th 2014</span>
											by <span class='authorname'>Jon Kravetz</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Mate, i&#39;m going to give up shortly… You give me nothing to work on (no HTML!), no real use-case to debug and loads of attitude… Lets see an actual use case from you with complete HTML that demonstrates the issue and some property formatted code eh ? I&#39;m getting tired..</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 5:51:42 pm">July 10th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I don&#39;t see how I have loads of attitude! I&#39;m frustrated…that&#39;s all. Right now I&#39;m trying to make the adjustment to the mobile framework that you guys suggested. Let me put together some code for you.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 6:01:44 pm">July 10th 2014</span>
											by <span class='authorname'>Jon Kravetz</span>
										</div>
									</li>
								
									<li class="comment">
										<p><pre><code class="hljs">var applib = require(<span class="hljs-string">"applib"</span>);

<span class="hljs-transposed_variable">Alloy.</span><span class="hljs-transposed_variable">Globals.</span>mobilewebview = $.mobilewebview;


var loadMobileListener2 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

    checkSessionStore();
};

var loadMobileListener1 = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> {</span>

    injectScriptToInternal();
    $.<span class="hljs-transposed_variable">mobilewebview.</span>addEventListener(<span class="hljs-string">'load'</span>, loadMobileListener2);
};

<span class="hljs-comment">//SECTION-----FUNCTIONS-----SECTION</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">injectScriptToInternal</span><span class="hljs-params">()</span>{</span>
    var barcodebuttonexists = false;<span class="hljs-comment">//$.mobilewebview.evalJS("document.contains(barcodebutton);");</span>
     <span class="hljs-transposed_variable">Ti.</span><span class="hljs-transposed_variable">API.</span>info(<span class="hljs-string">"LOG--barcodebuttonexists?--"</span> + barcodebuttonexists);

    <span class="hljs-keyword">if</span> (barcodebuttonexists == false){
        $.<span class="hljs-transposed_variable">mobilewebview.</span>evalJS(
            <span class="hljs-string">"var searchdiv=document.querySelector('</span>.<span class="hljs-transposed_variable">searchdiv'</span>);var searchtable = <span class="hljs-transposed_variable">searchdiv.</span>getElementsByTagName(<span class="hljs-string">'table'</span>)<span class="hljs-matrix">[<span class="hljs-number">0</span>]</span>; var searchtablebody = <span class="hljs-transposed_variable">searchtable.</span>getElementsByTagName(<span class="hljs-string">'tbody'</span>)<span class="hljs-matrix">[<span class="hljs-number">0</span>]</span>; var searchrow = <span class="hljs-transposed_variable">searchtablebody.</span>getElementsByTagName(<span class="hljs-string">'tr'</span>)<span class="hljs-matrix">[<span class="hljs-number">0</span>]</span>; var barcodetd = <span class="hljs-transposed_variable">searchrow.</span>insertCell(<span class="hljs-number">3</span>); <span class="hljs-transposed_variable">barcodetd.</span>id = <span class="hljs-string">'barcodebutton'</span>; <span class="hljs-transposed_variable">barcodetd.</span><span class="hljs-transposed_variable">style.</span>width = <span class="hljs-string">'30px'</span>; <span class="hljs-transposed_variable">barcodetd.</span><span class="hljs-transposed_variable">style.</span>paddingRight = <span class="hljs-string">'4px'</span>; <span class="hljs-transposed_variable">searchrow.</span>cells<span class="hljs-matrix">[<span class="hljs-number">3</span>].</span>innerHTML=<span class="hljs-string">'&lt;img&gt;'</span>;<span class="hljs-string">"
        );
        $.mobilewebview.evalJS(
            "</span>var barcodetd=<span class="hljs-transposed_variable">document.</span>querySelector(<span class="hljs-string">'#barcodebutton'</span>); var barcodeimg = <span class="hljs-transposed_variable">barcodetd.</span>getElementsByTagName(<span class="hljs-string">'img'</span>)<span class="hljs-matrix">[<span class="hljs-number">0</span>]</span>; <span class="hljs-transposed_variable">barcodeimg.</span>id = <span class="hljs-string">'barcodeimg'</span>; <span class="hljs-transposed_variable">barcodeimg.</span>src = <span class="hljs-string">'app://assets/images/barcode.png'</span>;<span class="hljs-string">"
        );
        $.mobilewebview.evalJS(
            "</span>var barcodetd=<span class="hljs-transposed_variable">document.</span>querySelector(<span class="hljs-string">'#barcodebutton'</span>);<span class="hljs-transposed_variable">barcodetd.</span>addEventListener(<span class="hljs-string">'click'</span>, refreshpage, false); <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">refreshpage</span><span class="hljs-params">()</span>{ <span class="hljs-title">var</span> <span class="hljs-title">newLocation</span> = <span class="hljs-title">location</span>.<span class="hljs-title">href</span>; <span class="hljs-title">var</span> <span class="hljs-title">randomStr</span> = <span class="hljs-title">Math</span>.<span class="hljs-title">random</span><span class="hljs-params">()</span>.<span class="hljs-title">toString</span><span class="hljs-params">(36)</span>.<span class="hljs-title">substring</span><span class="hljs-params">(7)</span>; <span class="hljs-title">location</span>.<span class="hljs-title">href</span> = <span class="hljs-title">newLocation</span> + '&amp;<span class="hljs-title">scan</span>={' + <span class="hljs-title">randomStr</span> + '}'; <span class="hljs-title">sessionStorage</span>.<span class="hljs-title">setItem</span><span class="hljs-params">( 'cordovafunction', 'SCAN' )</span>; }; "</span>
        );
        $.<span class="hljs-transposed_variable">mobilewebview.</span>evalJS(    
            <span class="hljs-string">"var mobilestring = '</span><span class="hljs-transposed_variable">m.</span><span class="hljs-transposed_variable">rexelusa.</span><span class="hljs-transposed_variable">com'</span>; var links = <span class="hljs-transposed_variable">document.</span>getElementsByTagName(<span class="hljs-string">'a'</span>); <span class="hljs-keyword">for</span>(var i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-transposed_variable">links.</span><span class="hljs-built_in">length</span>; ++i){ <span class="hljs-keyword">if</span>((links<span class="hljs-matrix">[i].</span>href).indexOf(mobilestring)===-<span class="hljs-number">1</span> &amp;&amp; (links<span class="hljs-matrix">[i].</span>href).indexOf(<span class="hljs-string">'javascript'</span>)===-<span class="hljs-number">1</span> &amp;&amp; (links<span class="hljs-matrix">[i].</span>href).indexOf(<span class="hljs-string">'tel:'</span>)===-<span class="hljs-number">1</span> &amp;&amp; (links<span class="hljs-matrix">[i].</span>href).indexOf(<span class="hljs-string">'mailto:'</span>)===-<span class="hljs-number">1</span>){ links<span class="hljs-matrix">[i].</span>addEventListener(<span class="hljs-string">'click'</span>, setExternalLink, false ); } <span class="hljs-keyword">else</span>{ links<span class="hljs-matrix">[i].</span>addEventListener(<span class="hljs-string">'click'</span>, setInternalLink, false ); }}; <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setExternalLink</span><span class="hljs-params">(event)</span>{ <span class="hljs-title">event</span>.<span class="hljs-title">preventDefault</span><span class="hljs-params">()</span>; <span class="hljs-title">var</span> <span class="hljs-title">newLocation</span> = <span class="hljs-title">location</span>.<span class="hljs-title">href</span>; <span class="hljs-title">var</span> <span class="hljs-title">randomStr</span> = <span class="hljs-title">Math</span>.<span class="hljs-title">random</span><span class="hljs-params">()</span>.<span class="hljs-title">toString</span><span class="hljs-params">(36)</span>.<span class="hljs-title">substring</span><span class="hljs-params">(7)</span>; <span class="hljs-title">location</span>.<span class="hljs-title">href</span> = <span class="hljs-title">newLocation</span> + '&amp;<span class="hljs-title">external</span>={' + <span class="hljs-title">randomStr</span> + '}'; <span class="hljs-title">sessionStorage</span>.<span class="hljs-title">setItem</span><span class="hljs-params">( 'cordovafunction', ['EXT' , event.target] )</span>; }; <span class="hljs-title">function</span> <span class="hljs-title">setInternalLink</span><span class="hljs-params">(event)</span>{ <span class="hljs-title">sessionStorage</span>.<span class="hljs-title">setItem</span><span class="hljs-params">( 'cordovafunction', ['INT' , event.target] )</span>; };"</span>
        );

    };


};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resetSessionStore</span><span class="hljs-params">()</span>{</span>
        <span class="hljs-comment">// Clear out the name in sessionStorage for subsequent opens.</span>
        $.<span class="hljs-transposed_variable">mobilewebview.</span>evalJS(<span class="hljs-string">"sessionStorage.setItem( '</span><span class="hljs-transposed_variable">cordovafunction'</span>, <span class="hljs-string">''</span> );<span class="hljs-string">");
        Ti.API.info("</span>LOG--resetfunctions<span class="hljs-string">");
};

function checkSessionStore(){
    var doctitle = $.mobilewebview.evalJS('</span><span class="hljs-transposed_variable">document.</span><span class="hljs-transposed_variable">title'</span>);
    var sessionStorageVal = $.<span class="hljs-transposed_variable">mobilewebview.</span>evalJS(<span class="hljs-string">"sessionStorage.getItem('</span><span class="hljs-transposed_variable">cordovafunction'</span>)<span class="hljs-string">");
    //Ti.API.info( "</span>doctitle -&gt; <span class="hljs-string">" + doctitle );
    Ti.API.info( "</span>LOG--sessionStorageVal -&gt; <span class="hljs-string">" + sessionStorageVal );

    var returnarray = sessionStorageVal.split("</span>,<span class="hljs-string">");

    switch(returnarray[0]) {
        case "</span>SCAN<span class="hljs-string">":
            resetSessionStore();
            startScan();
            break;
        case "</span>INT<span class="hljs-string">":

            resetSessionStore();
            Ti.API.info("</span>LOG--internal-url=<span class="hljs-string">" + returnarray[1]);
            continueInternalLink(returnarray[1]);
            break;
        case "</span>EXT<span class="hljs-string">":
            resetSessionStore();
            Ti.API.info("</span>LOG--external-url=<span class="hljs-string">" + returnarray[1]);
            continueExternalLink(returnarray[1]);
            break;
        default:
    }
};

function continueInternalLink(url){
        // Continue Opening Internal Link, following clicking on INTERNAL link in mobile website.
        Ti.API.info('</span>LOG--Opening Internal Link: <span class="hljs-string">' + url);
        loadMobileListener1();
        $.mobilewebview.addEventListener('</span><span class="hljs-transposed_variable">load'</span>, loadMobileListener1 );
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">continueExternalLink</span><span class="hljs-params">(exturl)</span>{</span>
        <span class="hljs-comment">// Continue Opening External Link, following clicking on EXTERNAL link in mobile website.</span>
        <span class="hljs-transposed_variable">Ti.</span><span class="hljs-transposed_variable">API.</span>info(<span class="hljs-string">'LOG--Opening External Link: '</span> + exturl);
        <span class="hljs-transposed_variable">Ti.</span><span class="hljs-transposed_variable">API.</span>info(<span class="hljs-string">'LOG--Opening Childbrowser1: '</span> + exturl);
        <span class="hljs-comment">// Create an instance of the controller</span>
        $.<span class="hljs-transposed_variable">mobilewebview.</span>goBack();
        $.<span class="hljs-transposed_variable">mobilewebview.</span>hide();
        <span class="hljs-transposed_variable">applib.</span>addChildBrowser(exturl);

}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startScan</span><span class="hljs-params">()</span> {</span>
        <span class="hljs-comment">//Launched Barcode Scanner Plugin</span>
        <span class="hljs-transposed_variable">Ti.</span><span class="hljs-transposed_variable">API.</span>info(<span class="hljs-string">"LOG--startScan"</span>);

        $.<span class="hljs-transposed_variable">mobilewebview.</span>goBack();
        $.<span class="hljs-transposed_variable">mobilewebview.</span>hide();
        <span class="hljs-transposed_variable">applib.</span>addBarCodeScanner();
}





<span class="hljs-comment">//SECTION-----CODE TO BE EXECUTED UPON CONTROLLER INSTANTIATION-----SECTION</span>

$.<span class="hljs-transposed_variable">mobilewebview.</span>addEventListener(<span class="hljs-string">'load'</span>, loadMobileListener1 );
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="July 10th 2014, 6:04:51 pm">July 10th 2014</span>
											by <span class='authorname'>Jon Kravetz</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>As we&#39;ve proved, there is no need to adjust the framework at all. EvalJS <em>is</em> working in Android, contrary to your assumptions. So the issue is in the code. Also, if all you are doing is wrapping an existing website into a webView then Apple is likely to reject your app for not utilising the features of the device enough.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 11th 2014, 4:32:35 am">July 11th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Nick - Things should work on android if they are working on ios. There is no issue with the code.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 11th 2014, 9:58:05 pm">July 11th 2014</span>
											by <span class='authorname'>Jon Kravetz</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Nick - I just wanted to correct your logic for everybody reading this thread.</p>
<p>We have not proved that EvalJS functions correctly in Android. You showed a very simple example worked. </p>
<p>-I can not declare variables in my javascript with &#39;var&#39;. </p>
<ul>
<li>I can also not execute a &#39;for loop&#39; because Titanium&#39;s dev team employed a &#39;hacky&#39; solution that tries to wrap the entire script in to a function. It&#39;s not working correctly.</li>
</ul>
<p>Please either continue this thread, or attach someone on this thread who is capable of helping the Titanium community.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 11th 2014, 10:05:22 pm">July 11th 2014</span>
											by <span class='authorname'>Jon Kravetz</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I seriously doubt anyone else wants to help else they would have added to the thread by now…. Bye Bye!</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 12th 2014, 6:04:43 am">July 12th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Haha! You are such a pseudo intellect. Sorry you aren&#39;t bright enough to help me solve my problem, nerd. Go play worlds of warcraft.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 14th 2014, 1:26:09 pm">July 14th 2014</span>
											by <span class='authorname'>Jon Kravetz</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Nothing to see here… move along…</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 14th 2014, 2:57:12 pm">July 14th 2014</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-280621">
				
						<section>
							<p>I&#39;m not just wrapping the website in an app. I am injecting links to titanium modules within the webview. Apple won&#39;t reject our app. I am also creating a child browser with navigation for external links. It works great on an iphone.</p>
<p>Fix - What I had to do was remove &#39;var&#39; from all of my strings. No matter what version of Titanium SDK I use, this doesn&#39;t work. Please let us know whether or not this has been resolved in 3.3, because<br>this is a serious bug.</p>
<p>[Android: webView throws on evalJS when string starts with var]<br>(https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TIMOB-10837)</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 11th 2014, 9:01:27 pm">July 11th 2014</span>
								by <span class='authorname'>Jon Kravetz</span><br>
								<a class="icon-bg icon-link" href="question/176003/how-can-i-get-evaljs-to-work-on-android#answer-280621" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
