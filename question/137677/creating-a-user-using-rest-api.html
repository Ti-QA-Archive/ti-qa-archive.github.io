<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Creating a user using Rest API » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Creating a user using Rest API</h1>
		</header>
		<section>
			<p>Hello,</p>
<p>I&#39;m trying to create a user on my Drupal Site using Services Module and the Rest API..</p>
<p>i&#39;m using the following code:</p>
<pre><code class="hljs">Ti.<span class="hljs-keyword">include</span>(<span class="hljs-string">"lib/tiajax.js"</span>);
Ti.<span class="hljs-keyword">include</span>(<span class="hljs-string">"version.js"</span>);

        <span class="hljs-keyword">var</span> newUser = {
            <span class="hljs-string">"name"</span>: name.value,
            <span class="hljs-string">"pass"</span>: password,
            <span class="hljs-string">"mail"</span>: makeEmail(),
            <span class="hljs-string">"field_fullname"</span>: {
                <span class="hljs-string">"und"</span>: [{<span class="hljs-string">"value"</span>: name.value}]
            },
            <span class="hljs-string">"field_adress"</span>: {
                <span class="hljs-string">"und"</span>: [{<span class="hljs-string">"value"</span>: address1.value}]
            },
            <span class="hljs-string">"field_mobile_number"</span>: {
                <span class="hljs-string">"und"</span>: [{<span class="hljs-string">"value"</span>: mobile.value}]
            },
            <span class="hljs-string">"field_geo_location"</span>: {
                <span class="hljs-string">"und"</span>: [{<span class="hljs-string">"lat"</span>: lat, <span class="hljs-string">"lng"</span>: lng},]
            }
        };


        <span class="hljs-comment">// Define the URL to register this user</span>
        <span class="hljs-keyword">var</span> url = REST_PATH + <span class="hljs-string">"user/register.json"</span>;
        <span class="hljs-keyword">var</span> user;

        <span class="hljs-comment">// Use $.ajax to POST the new user</span>
        $.ajax({
            <span class="hljs-keyword">type</span>: <span class="hljs-string">"POST"</span>,
            url: url,
            dataType: <span class="hljs-string">"json"</span>,
            data: JSON.stringify(newUser),
            contentType: <span class="hljs-string">"application/json"</span>,
            <span class="hljs-comment">// On success we pass the response as res</span>
            success: function(res) {

                <span class="hljs-comment">// res will be an object including the uid and the uri to the new user</span>
                <span class="hljs-comment">// Alert the user the new account has been created</span>
                alert(<span class="hljs-string">"Account created for "</span> + res.uid);

                Titanium.<span class="hljs-keyword">App</span>.Properties.setInt(<span class="hljs-string">"userUid"</span>, res.uid);
                Titanium.<span class="hljs-keyword">App</span>.Properties.setInt(<span class="hljs-string">"userName"</span>, newUser.name);
                user = {
                    uid: Titanium.<span class="hljs-keyword">App</span>.Properties.getInt(<span class="hljs-string">"userUid"</span>),
                }    
            }
        });
</code></pre><p>i can&#39;t get the alert <code>alert(&amp;quot;Account created for &amp;quot; + res.uid);</code> also there&#39;s no <code>user</code> variable</p>
<p>but the user is create online…</p>
<p>i need those to be fixed as i will use them in other part</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="May 31st 2012, 11:11:33 am">May 31st 2012</span>
				by <span class='authorname'>Wassim Ghannoum</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>ajax</span></li>
					
						<li><span class='tagname'>drupal</span></li>
					
				</ul>
			

			<section>
				<h5>4 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>You are running this code on Titanium Desktop right?</p>
</div>
							<div class="author">
								&mdash; commented <span title="May 31st 2012, 11:21:24 am">May 31st 2012</span>
								by <span class='authorname'>Christian Brousseau</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>yes on Titanium in iPhone Simulator</p>
</div>
							<div class="author">
								&mdash; commented <span title="May 31st 2012, 11:23:03 am">May 31st 2012</span>
								by <span class='authorname'>Wassim Ghannoum</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>My guess is that you are using <strong>Titanium Mobile</strong> (since you mention the iPhone simulator)</p>
</div>
							<div class="author">
								&mdash; commented <span title="May 31st 2012, 11:39:31 am">May 31st 2012</span>
								by <span class='authorname'>Christian Brousseau</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Sorry for understanding.. i thinked that you mean on desktop and not on device..</p>
</div>
							<div class="author">
								&mdash; commented <span title="May 31st 2012, 11:44:28 am">May 31st 2012</span>
								by <span class='authorname'>Wassim Ghannoum</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-239813">
				
						<section>
							<p>From what I read, it appears that your JSON string is not entirely valid. This could cause an error on the server side. </p>
<p>It seems the problem lies with the <code>field_geo_location</code> field. In your code, there is an <strong>extra coma</strong> at the end of your array. Making the whole JSON expression invalid.</p>
<h4 id="here-is-the-correction-">Here is the correction:</h4>
<pre><code class="hljs">...
<span class="hljs-string">"field_geo_location"</span>: {
    <span class="hljs-string">"und"</span>: [{<span class="hljs-string">"lat"</span>: lat, <span class="hljs-string">"lng"</span>: lng}]  &lt;<span class="hljs-comment">-- Removed the coma after the bracket</span>
}
...
</code></pre><p>You should add en error handler function for you ajax request. That way, you can <em>catch</em> any errors coming from the server in case of errors.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 31st 2012, 11:54:50 am">May 31st 2012</span>
								by <span class='authorname'>Christian Brousseau</span><br>
								<a class="icon-bg icon-link" href="../../question/137677/creating-a-user-using-rest-api.html#answer-239813" rel="permalink">permalink</a>
							</div>

							<h5>6 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>i Removed the Comma, but the problem still exist</p>
<p>plz help how can i add an error handler? i&#39;m new to Titanium..</p>
<p>the user is created online but i can&#39;t get the uid !</p>
<p>this is the code of <code>tiajax.js</code> i&#39;m including in top of my code:</p>
<pre><code class="hljs"><span class="hljs-list">(<span class="hljs-keyword">function</span><span class="hljs-list">()</span> {
  /*
   Titanium $.ajax port from jQuery JavaScript Library v1.4.2
   Original code at http://jquery.com/, Copyright <span class="hljs-number">2010</span>, John Resig
   Dual licensed under the MIT or GPL Version <span class="hljs-number">2</span> licenses.
   http://jquery.org/license
  */  var ajaxHandlerBindings, jsre, r20, rquery, rts, rurl, utils, _fn, _i, _len, _ref<span class="hljs-comment">;</span>
  var __hasProp = Object.prototype.hasOwnProperty<span class="hljs-comment">;</span>
  jsre = /=\?<span class="hljs-list">(<span class="hljs-keyword">&amp;</span>|$)</span>/<span class="hljs-comment">;</span>
  rquery = /\?/<span class="hljs-comment">;</span>
  rts = /<span class="hljs-list">(\?|&amp;)</span>_=.*?<span class="hljs-list">(<span class="hljs-keyword">&amp;</span>|$)</span>/<span class="hljs-comment">;</span>
  rurl = /^<span class="hljs-list">(\w+:)</span>?\/\/<span class="hljs-list">(<span class="hljs-list">[<span class="hljs-keyword">^</span>\/?#]+)/<span class="hljs-comment">;</span>
  r20 = /%20/g<span class="hljs-comment">;</span>
  if <span class="hljs-list">(<span class="hljs-keyword">typeof</span> utils == <span class="hljs-string">"undefined"</span> || utils === null)</span> {
    utils = {
      extend: function<span class="hljs-list">(<span class="hljs-keyword">obj</span>)</span> {
        var key, source, val, _i, _len, _ref<span class="hljs-comment">;</span>
        _ref = Array.prototype.slice.call<span class="hljs-list">(<span class="hljs-keyword">arguments</span>, <span class="hljs-number">1</span>)</span><span class="hljs-comment">;</span>
        for <span class="hljs-list">(<span class="hljs-keyword">_i</span> = <span class="hljs-number">0</span>, _len = _ref.length<span class="hljs-comment">; _i &lt; _len; _i++) {</span>
          source = _ref<span class="hljs-list">[<span class="hljs-keyword">_i</span>]<span class="hljs-comment">;</span>
          for <span class="hljs-list">(<span class="hljs-keyword">key</span> in source)</span> {
            if <span class="hljs-list">(<span class="hljs-keyword">!__hasProp.call</span><span class="hljs-list">(<span class="hljs-keyword">source</span>, key)</span>)</span> continue<span class="hljs-comment">;</span>
            val = source<span class="hljs-list">[<span class="hljs-keyword">key</span>]<span class="hljs-comment">;</span>
            obj<span class="hljs-list">[<span class="hljs-keyword">key</span>] = val<span class="hljs-comment">;</span>
          }
        }
        return obj<span class="hljs-comment">;</span>
      }
    }<span class="hljs-comment">;</span>
  }
  ajaxHandlerBindings = {}<span class="hljs-comment">;</span>
  _ref = <span class="hljs-string">"ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend"</span>.split<span class="hljs-list">(<span class="hljs-string">" "</span>)</span><span class="hljs-comment">;</span>
  _fn = function<span class="hljs-list">(<span class="hljs-keyword">name</span>)</span> {
    return ajaxHandlerBindings<span class="hljs-list">[<span class="hljs-keyword">name</span>] = function<span class="hljs-list">(<span class="hljs-keyword">f</span>)</span> {
      return Titanium.Network.addEventListener<span class="hljs-list">(<span class="hljs-keyword">name</span>, function<span class="hljs-list">(<span class="hljs-keyword">e</span>)</span> {
        return f.call<span class="hljs-list">(<span class="hljs-keyword">e</span>, e.xhr, e.s, e.e)</span><span class="hljs-comment">;</span>
      })</span><span class="hljs-comment">;</span>
    }<span class="hljs-comment">;</span>
  }<span class="hljs-comment">;</span>
  for <span class="hljs-list">(<span class="hljs-keyword">_i</span> = <span class="hljs-number">0</span>, _len = _ref.length<span class="hljs-comment">; _i &lt; _len; _i++) {</span>
    name = _ref<span class="hljs-list">[<span class="hljs-keyword">_i</span>]<span class="hljs-comment">;</span>
    _fn<span class="hljs-list">(<span class="hljs-keyword">name</span>)</span><span class="hljs-comment">;</span>
  }
  utils.extend<span class="hljs-list">(<span class="hljs-keyword">Titanium.Network</span>, ajaxHandlerBindings, {
    ajaxSetup: function<span class="hljs-list">(<span class="hljs-keyword">settings</span>)</span> {
      return utils.extend<span class="hljs-list">(<span class="hljs-keyword">Titanium.Network.ajaxSettings</span>, settings)</span><span class="hljs-comment">;</span>
    },
    ajaxSettings: {
      global: true,
      type: <span class="hljs-string">"GET"</span>,
      contentType: <span class="hljs-string">"application/x-www-form-urlencoded"</span>,
      processData: true,
      async: true,
      timeout: <span class="hljs-number">300000</span>,
      traditional: false,
      xhr: function<span class="hljs-list">()</span> {
        return Ti.Network.createHTTPClient<span class="hljs-list">()</span><span class="hljs-comment">;</span>
      },
      accepts: {
        xml: <span class="hljs-string">"application/xml, text/xml"</span>,
        html: <span class="hljs-string">"text/html"</span>,
        script: <span class="hljs-string">"text/javascript, application/javascript"</span>,
        json: <span class="hljs-string">"application/json, text/javascript"</span>,
        text: <span class="hljs-string">"text/plain"</span>,
        _default: <span class="hljs-string">"*/*"</span>
      }
    },
    param: function<span class="hljs-list">(<span class="hljs-keyword">a</span>)</span> {
      var add, buildParams, obj, prefix, s, traditional<span class="hljs-comment">;</span>
      s = <span class="hljs-list">[]<span class="hljs-comment">;</span>
      traditional = false<span class="hljs-comment">;</span>
      buildParams = function<span class="hljs-list">(<span class="hljs-keyword">prefix</span>, obj)</span> {
        if <span class="hljs-list">(<span class="hljs-keyword">_.isArray</span><span class="hljs-list">(<span class="hljs-keyword">obj</span>)</span>)</span> {
          return _.each<span class="hljs-list">(<span class="hljs-keyword">obj</span>, function<span class="hljs-list">(<span class="hljs-keyword">i</span>, v)</span> {
            var p, x<span class="hljs-comment">;</span>
            if <span class="hljs-list">(<span class="hljs-keyword">traditional</span> || /\<span class="hljs-list">[\]$/.test<span class="hljs-list">(<span class="hljs-keyword">prefix</span>)</span>) {
              return add<span class="hljs-list">(<span class="hljs-keyword">prefix</span>, v)</span><span class="hljs-comment">;</span>
            } else {
              x = _.isObject<span class="hljs-list">(<span class="hljs-keyword">v</span>)</span> || _.isArray<span class="hljs-list">(<span class="hljs-keyword">v</span>)</span> ? i : <span class="hljs-string">""</span><span class="hljs-comment">;</span>
              p = prefix + <span class="hljs-string">"["</span> + x + <span class="hljs-string">"]"</span><span class="hljs-comment">;</span>
              return buildParams<span class="hljs-list">(<span class="hljs-keyword">p</span>, v)</span><span class="hljs-comment">;</span>
            }
          })<span class="hljs-comment">;</span>
        } else if <span class="hljs-list">(<span class="hljs-keyword">!traditional</span> &amp;&amp; !_.isNull<span class="hljs-list">(<span class="hljs-keyword">obj</span>)</span> &amp;&amp; typeof obj === <span class="hljs-string">"object"</span>)</span> {
          return _.each<span class="hljs-list">(<span class="hljs-keyword">obj</span>, function<span class="hljs-list">(<span class="hljs-keyword">k</span>, v)</span> {
            return buildParams<span class="hljs-list">(<span class="hljs-keyword">prefix</span> + <span class="hljs-string">"["</span> + k + <span class="hljs-string">"]"</span>, v)</span><span class="hljs-comment">;</span>
          })</span><span class="hljs-comment">;</span>
        } else {
          return add<span class="hljs-list">(<span class="hljs-keyword">prefix</span>, obj)</span><span class="hljs-comment">;</span>
        }
      }<span class="hljs-comment">;</span>
      add = function<span class="hljs-list">(<span class="hljs-keyword">key</span>, value)</span> {
        value = _.isFunction<span class="hljs-list">(<span class="hljs-keyword">value</span>)</span> ? value<span class="hljs-list">()</span> : value<span class="hljs-comment">;</span>
        return s<span class="hljs-list">[<span class="hljs-keyword">s.length</span>] = encodeURIComponent<span class="hljs-list">(<span class="hljs-keyword">key</span>)</span> + <span class="hljs-string">"="</span> + encodeURIComponent<span class="hljs-list">(<span class="hljs-keyword">value</span>)</span><span class="hljs-comment">;</span>
      }<span class="hljs-comment">;</span>
      if <span class="hljs-list">(<span class="hljs-keyword">_.isArray</span><span class="hljs-list">(<span class="hljs-keyword">a</span>)</span>)</span> {
        _.each<span class="hljs-list">(<span class="hljs-keyword">a</span>, function<span class="hljs-list">()</span> {
          return add<span class="hljs-list">(<span class="hljs-keyword">this.name</span>, this.value)</span><span class="hljs-comment">;</span>
        })</span><span class="hljs-comment">;</span>
      } else {
        for <span class="hljs-list">(<span class="hljs-keyword">prefix</span> in a)</span> {
          if <span class="hljs-list">(<span class="hljs-keyword">!__hasProp.call</span><span class="hljs-list">(<span class="hljs-keyword">a</span>, prefix)</span>)</span> continue<span class="hljs-comment">;</span>
          obj = a<span class="hljs-list">[<span class="hljs-keyword">prefix</span>]<span class="hljs-comment">;</span>
          buildParams<span class="hljs-list">(<span class="hljs-keyword">prefix</span>, obj)</span><span class="hljs-comment">;</span>
        }
      }
      return s.join<span class="hljs-list">(<span class="hljs-string">"&amp;"</span>)</span>.replace<span class="hljs-list">(<span class="hljs-keyword">r20</span>, <span class="hljs-string">"+"</span>)</span><span class="hljs-comment">;</span>
    },
    lastModified: {},
    etag: {},
    httpSuccess: function<span class="hljs-list">(<span class="hljs-keyword">xhr</span>)</span> {
      try {
        return <span class="hljs-list">(<span class="hljs-keyword">xhr.status</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; xhr.status &lt; <span class="hljs-number">300</span>)</span> || xhr.status === <span class="hljs-number">304</span><span class="hljs-comment">;</span>
      } catch <span class="hljs-list">(<span class="hljs-keyword">e</span>)</span> {

      }
      return false<span class="hljs-comment">;</span>
    },
    httpNotModified: function<span class="hljs-list">(<span class="hljs-keyword">xhr</span>, url)</span> {
      var etag, lastModified<span class="hljs-comment">;</span>
      lastModified = xhr.getResponseHeader<span class="hljs-list">(<span class="hljs-string">"Last-Modified"</span>)</span><span class="hljs-comment">;</span>
      etag = xhr.getResponseHeader<span class="hljs-list">(<span class="hljs-string">"Etag"</span>)</span><span class="hljs-comment">;</span>
      if <span class="hljs-list">(<span class="hljs-keyword">lastModified</span>)</span> {
        Titanium.Network.lastModified<span class="hljs-list">[<span class="hljs-keyword">url</span>] = lastModified<span class="hljs-comment">;</span>
      }
      if <span class="hljs-list">(<span class="hljs-keyword">etag</span>)</span> {
        Titanium.Network.etag<span class="hljs-list">[<span class="hljs-keyword">url</span>] = etag<span class="hljs-comment">;</span>
      }
      return xhr.status === <span class="hljs-number">304</span> || xhr.status === <span class="hljs-number">0</span><span class="hljs-comment">;</span>
    },
    httpData: function<span class="hljs-list">(<span class="hljs-keyword">xhr</span>, type, s)</span> {
      var ct, data, xml<span class="hljs-comment">;</span>
      ct = xhr.getResponseHeader<span class="hljs-list">(<span class="hljs-string">"content-type"</span>)</span> || <span class="hljs-string">""</span><span class="hljs-comment">;</span>
      xml = type === <span class="hljs-string">"xml"</span> || !type &amp;&amp; ct.indexOf<span class="hljs-list">(<span class="hljs-string">"xml"</span>)</span> &gt;= <span class="hljs-number">0</span><span class="hljs-comment">;</span>
      data = xml ? xhr.responseXML : xhr.responseText<span class="hljs-comment">;</span>
      if <span class="hljs-list">(<span class="hljs-keyword">xml</span> &amp;&amp; data.documentElement.nodeName === <span class="hljs-string">"parsererror"</span>)</span> {
        Titanium.Network.error<span class="hljs-list">(<span class="hljs-string">"parsererror"</span>)</span><span class="hljs-comment">;</span>
      }
      if <span class="hljs-list">(<span class="hljs-list">(<span class="hljs-keyword">s</span> != null)</span> &amp;&amp; s.dataFilter)</span> {
        data = s.dataFilter<span class="hljs-list">(<span class="hljs-keyword">data</span>, type)</span><span class="hljs-comment">;</span>
      }
      if <span class="hljs-list">(<span class="hljs-keyword">typeof</span> data === <span class="hljs-string">"string"</span>)</span> {
        if <span class="hljs-list">(<span class="hljs-keyword">type</span> === <span class="hljs-string">"json"</span> || !type &amp;&amp; ct.indexOf<span class="hljs-list">(<span class="hljs-string">"json"</span>)</span> &gt;= <span class="hljs-number">0</span>)</span> {
          data = JSON.parse<span class="hljs-list">(<span class="hljs-keyword">data</span>)</span><span class="hljs-comment">;</span>
        }
      }
      return data<span class="hljs-comment">;</span>
    },
    error: function<span class="hljs-list">(<span class="hljs-keyword">msg</span>)</span> {
      throw msg<span class="hljs-comment">;</span>
    },
    handleError: function<span class="hljs-list">(<span class="hljs-keyword">s</span>, xhr, status, e)</span> {
      if <span class="hljs-list">(<span class="hljs-keyword">s.error</span>)</span> {
        s.error.call<span class="hljs-list">(<span class="hljs-keyword">s.context</span> || s, xhr, status, e)</span><span class="hljs-comment">;</span>
      }
      if <span class="hljs-list">(<span class="hljs-keyword">s.global</span>)</span> {
        return Titanium.Network.fireEvent<span class="hljs-list">(<span class="hljs-string">"ajaxError"</span>, {
          xhr: xhr,
          s: s,
          e: e
        })</span><span class="hljs-comment">;</span>
      }
    },
    ajax: function<span class="hljs-list">(<span class="hljs-keyword">origSettings</span>)</span> {
      var callbackContext, complete, data, oldAbort, onreadystatechange, parts, remote, requestDone, ret, s, status, success, trigger, ts, type, xhr, _ref<span class="hljs-comment">;</span>
      s = utils.extend<span class="hljs-list">({}, Titanium.Network.ajaxSettings, origSettings)</span><span class="hljs-comment">;</span>
      status = <span class="hljs-string">""</span><span class="hljs-comment">;</span>
      data = {}<span class="hljs-comment">;</span>
      callbackContext = origSettings &amp;&amp; origSettings.context || s<span class="hljs-comment">;</span>
      type = s.type.toUpperCase<span class="hljs-list">()</span><span class="hljs-comment">;</span>
      if <span class="hljs-list">(<span class="hljs-keyword">s.data</span> &amp;&amp; s.processData &amp;&amp; typeof s.data !== <span class="hljs-string">"string"</span>)</span> {
        s.data = Titanium.Network.param<span class="hljs-list">(<span class="hljs-keyword">s.data</span>, s.traditional)</span><span class="hljs-comment">;</span>
      }
      if <span class="hljs-list">(<span class="hljs-keyword">s.cache</span> === false &amp;&amp; type === <span class="hljs-string">"GET"</span>)</span> {
        ts = <span class="hljs-list">(<span class="hljs-keyword">new</span> Date)</span>.getTime<span class="hljs-list">()</span><span class="hljs-comment">;</span>
        ret = s.url.replace<span class="hljs-list">(<span class="hljs-keyword">rts</span>, <span class="hljs-string">"$1_="</span> + ts + <span class="hljs-string">"$2"</span>)</span><span class="hljs-comment">;</span>
        s.url = ret + <span class="hljs-list">(<span class="hljs-keyword">ret</span> === s.url ? <span class="hljs-list">(<span class="hljs-keyword">rquery.test</span><span class="hljs-list">(<span class="hljs-keyword">s.url</span>)</span> ? <span class="hljs-string">"&amp;"</span> : <span class="hljs-string">"?"</span>)</span> + <span class="hljs-string">"_="</span> + ts : <span class="hljs-string">""</span>)</span><span class="hljs-comment">;</span>
      }
      if <span class="hljs-list">(<span class="hljs-keyword">s.data</span> &amp;&amp; type === <span class="hljs-string">"GET"</span>)</span> {
        s.url += <span class="hljs-list">(<span class="hljs-list">(<span class="hljs-keyword">_ref</span> = rquery.test<span class="hljs-list">(<span class="hljs-keyword">s.url</span>)</span>)</span> != null ? _ref : {
          <span class="hljs-string">"&amp;"</span>: <span class="hljs-string">"?"</span>
        })</span> + s.data<span class="hljs-comment">;</span>
      }
      parts = rurl.exec<span class="hljs-list">(<span class="hljs-keyword">s.url</span>)</span><span class="hljs-comment">;</span>
      remote = true<span class="hljs-comment">;</span>
      requestDone = false<span class="hljs-comment">;</span>
      xhr = s.xhr<span class="hljs-list">()</span><span class="hljs-comment">;</span>
      if <span class="hljs-list">(<span class="hljs-keyword">!xhr</span>)</span> {
        return<span class="hljs-comment">;</span>
      }
      Ti.API.debug<span class="hljs-list">(<span class="hljs-string">"Sending "</span> + type + <span class="hljs-string">" request to "</span> + s.url)</span><span class="hljs-comment">;</span>
      if <span class="hljs-list">(<span class="hljs-keyword">type</span> === <span class="hljs-string">"POST"</span>)</span> {
        Ti.API.debug<span class="hljs-list">(<span class="hljs-string">"POSTing data:"</span>)</span><span class="hljs-comment">;</span>
        Ti.API.debug<span class="hljs-list">(<span class="hljs-keyword">s.data</span>)</span><span class="hljs-comment">;</span>
      }
      if <span class="hljs-list">(<span class="hljs-keyword">s.username</span> != null)</span> {
        xhr.open<span class="hljs-list">(<span class="hljs-keyword">type</span>, s.url, s.async, s.username, s.password)</span><span class="hljs-comment">;</span>
      } else {
        xhr.open<span class="hljs-list">(<span class="hljs-keyword">type</span>, s.url, s.async)</span><span class="hljs-comment">;</span>
      }
      if <span class="hljs-list">(<span class="hljs-keyword">s.data</span> || origSettings &amp;&amp; origSettings.contentType)</span> {
        xhr.setRequestHeader<span class="hljs-list">(<span class="hljs-string">"Content-Type"</span>, s.contentType)</span><span class="hljs-comment">;</span>
      }
      if <span class="hljs-list">(<span class="hljs-keyword">s.ifModified</span>)</span> {
        if <span class="hljs-list">(<span class="hljs-keyword">Titanium.Network.lastModified</span><span class="hljs-list">[<span class="hljs-keyword">s.url</span>]) {
          xhr.setRequestHeader<span class="hljs-list">(<span class="hljs-string">"If-Modified-Since"</span>, Titanium.Network.lastModified<span class="hljs-list">[<span class="hljs-keyword">s.url</span>])<span class="hljs-comment">;</span>
        }
        if <span class="hljs-list">(<span class="hljs-keyword">Titanium.Network.etag</span><span class="hljs-list">[<span class="hljs-keyword">s.url</span>]) {
          xhr.setRequestHeader<span class="hljs-list">(<span class="hljs-string">"If-None-Match"</span>, Titanium.Network.etag<span class="hljs-list">[<span class="hljs-keyword">s.url</span>])<span class="hljs-comment">;</span>
        }
      }
      xhr.setRequestHeader<span class="hljs-list">(<span class="hljs-string">"X-Requested-With"</span>, <span class="hljs-string">"XMLHttpRequest"</span>)</span><span class="hljs-comment">;</span>
      xhr.setRequestHeader<span class="hljs-list">(<span class="hljs-string">"Accept"</span>, s.dataType &amp;&amp; s.accepts<span class="hljs-list">[<span class="hljs-keyword">s.dataType</span>] ? s.accepts<span class="hljs-list">[<span class="hljs-keyword">s.dataType</span>] + <span class="hljs-string">", */*"</span> : s.accepts._default)<span class="hljs-comment">;</span>
      if <span class="hljs-list">(<span class="hljs-keyword">s.beforeSend</span> &amp;&amp; s.beforeSend.call<span class="hljs-list">(<span class="hljs-keyword">callbackContext</span>, xhr, s)</span> === false)</span> {
        xhr.abort<span class="hljs-list">()</span><span class="hljs-comment">;</span>
        return false<span class="hljs-comment">;</span>
      }
      onreadystatechange = xhr.onreadystatechange = function<span class="hljs-list">(<span class="hljs-keyword">isTimeout</span>)</span> {
        var errMsg<span class="hljs-comment">;</span>
        if <span class="hljs-list">(<span class="hljs-keyword">!xhr</span> || xhr.readyState === <span class="hljs-number">0</span> || isTimeout === <span class="hljs-string">"abort"</span>)</span> {
          if <span class="hljs-list">(<span class="hljs-keyword">!requestDone</span>)</span> {
            complete<span class="hljs-list">()</span><span class="hljs-comment">;</span>
          }
          requestDone = true<span class="hljs-comment">;</span>
          if <span class="hljs-list">(<span class="hljs-keyword">xhr</span>)</span> {
            return xhr.onreadystatechange = function<span class="hljs-list">()</span> {}<span class="hljs-comment">;</span>
          }
        } else if <span class="hljs-list">(<span class="hljs-keyword">!requestDone</span> &amp;&amp; xhr &amp;&amp; <span class="hljs-list">(<span class="hljs-keyword">xhr.readyState</span> === <span class="hljs-number">4</span> || isTimeout === <span class="hljs-string">"timeout"</span>)</span>)</span> {
          requestDone = true<span class="hljs-comment">;</span>
          xhr.onreadystatechange = function<span class="hljs-list">()</span> {}<span class="hljs-comment">;</span>
          status = isTimeout === <span class="hljs-string">"timeout"</span> ? <span class="hljs-string">"timeout"</span> : !Titanium.Network.httpSuccess<span class="hljs-list">(<span class="hljs-keyword">xhr</span>)</span> ? <span class="hljs-string">"error"</span> : s.ifModified &amp;&amp; Titanium.Network.httpNotModified<span class="hljs-list">(<span class="hljs-keyword">xhr</span>, s.url)</span> ? <span class="hljs-string">"notmodified"</span> : <span class="hljs-string">"success"</span><span class="hljs-comment">;</span>
          errMsg = <span class="hljs-string">""</span><span class="hljs-comment">;</span>
          if <span class="hljs-list">(<span class="hljs-keyword">status</span> === <span class="hljs-string">"success"</span>)</span> {
            try {
              data = Titanium.Network.httpData<span class="hljs-list">(<span class="hljs-keyword">xhr</span>, s.dataType, s)</span><span class="hljs-comment">;</span>
            } catch <span class="hljs-list">(<span class="hljs-keyword">err</span>)</span> {
              status = <span class="hljs-string">"parsererror"</span><span class="hljs-comment">;</span>
              errMsg = err<span class="hljs-comment">;</span>
            }
          }
          if <span class="hljs-list">(<span class="hljs-keyword">status</span> === <span class="hljs-string">"success"</span> || status === <span class="hljs-string">"notmodified"</span>)</span> {
            success<span class="hljs-list">()</span><span class="hljs-comment">;</span>
          } else {
            Titanium.Network.handleError<span class="hljs-list">(<span class="hljs-keyword">s</span>, xhr, status, errMsg)</span><span class="hljs-comment">;</span>
          }
          complete<span class="hljs-list">()</span><span class="hljs-comment">;</span>
          if <span class="hljs-list">(<span class="hljs-keyword">isTimeout</span> === <span class="hljs-string">"timeout"</span>)</span> {
            xhr.abort<span class="hljs-list">()</span><span class="hljs-comment">;</span>
          }
          if <span class="hljs-list">(<span class="hljs-keyword">s.async</span>)</span> {
            return xhr = null<span class="hljs-comment">;</span>
          }
        }
      }<span class="hljs-comment">;</span>
      try {
        oldAbort = xhr.abort<span class="hljs-comment">;</span>
        xhr.abort = function<span class="hljs-list">()</span> {
          if <span class="hljs-list">(<span class="hljs-keyword">xhr</span>)</span> {
            oldAbort.call<span class="hljs-list">(<span class="hljs-keyword">xhr</span>)</span><span class="hljs-comment">;</span>
          }
          return onreadystatechange<span class="hljs-list">(<span class="hljs-string">"abort"</span>)</span><span class="hljs-comment">;</span>
        }<span class="hljs-comment">;</span>
      } catch <span class="hljs-list">(<span class="hljs-keyword">e</span>)</span> {

      }
      if <span class="hljs-list">(<span class="hljs-keyword">s.async</span> &amp;&amp; s.timeout &gt; <span class="hljs-number">0</span>)</span> {
        setTimeout<span class="hljs-list">(<span class="hljs-keyword">function</span><span class="hljs-list">()</span> {
          if <span class="hljs-list">(<span class="hljs-keyword">xhr</span> &amp;&amp; !requestDone)</span> {
            return onreadystatechange<span class="hljs-list">(<span class="hljs-string">"timeout"</span>)</span><span class="hljs-comment">;</span>
          }
        }, s.timeout)</span><span class="hljs-comment">;</span>
      }
      try {
        xhr.send<span class="hljs-list">(<span class="hljs-keyword">type</span> === <span class="hljs-string">"POST"</span> || type === <span class="hljs-string">"PUT"</span> || type === <span class="hljs-string">"DELETE"</span> ? s.data : null)</span><span class="hljs-comment">;</span>
      } catch <span class="hljs-list">(<span class="hljs-keyword">e</span>)</span> {
        Titanium.Network.handleError<span class="hljs-list">(<span class="hljs-keyword">s</span>, xhr, null, e)</span><span class="hljs-comment">;</span>
        complete<span class="hljs-list">()</span><span class="hljs-comment">;</span>
      }
      trigger = function<span class="hljs-list">(<span class="hljs-keyword">type</span>, arg)</span> {
        var obj<span class="hljs-comment">;</span>
        obj = s.context ? s.context : Titanium.Network<span class="hljs-comment">;</span>
        if <span class="hljs-list">(<span class="hljs-list">(<span class="hljs-keyword">obj</span> != null ? obj.fireEvent : void <span class="hljs-number">0</span>)</span> != null)</span> {
          return obj.fireEvent<span class="hljs-list">(<span class="hljs-keyword">type</span>, arg)</span><span class="hljs-comment">;</span>
        }
      }<span class="hljs-comment">;</span>
      success = function<span class="hljs-list">()</span> {
        if <span class="hljs-list">(<span class="hljs-keyword">s.success</span>)</span> {
          s.success.call<span class="hljs-list">(<span class="hljs-keyword">callbackContext</span>, data, status, xhr)</span><span class="hljs-comment">;</span>
        }
        if <span class="hljs-list">(<span class="hljs-keyword">s.global</span>)</span> {
          return trigger<span class="hljs-list">(<span class="hljs-string">"ajaxSuccess"</span>, {
            xhr: xhr,
            s: s
          })</span><span class="hljs-comment">;</span>
        }
      }<span class="hljs-comment">;</span>
      complete = function<span class="hljs-list">()</span> {
        if <span class="hljs-list">(<span class="hljs-keyword">s.complete</span>)</span> {
          s.complete.call<span class="hljs-list">(<span class="hljs-keyword">callbackContext</span>, xhr, status)</span><span class="hljs-comment">;</span>
        }
        if <span class="hljs-list">(<span class="hljs-keyword">s.global</span>)</span> {
          trigger<span class="hljs-list">(<span class="hljs-string">"ajaxComplete"</span>, {
            xhr: xhr,
            s: s
          })</span><span class="hljs-comment">;</span>
        }
        if <span class="hljs-list">(<span class="hljs-keyword">s.global</span> &amp;&amp; !--jQuery.active)</span> {
          return Titanium.Network.fireEvent<span class="hljs-list">(<span class="hljs-string">"ajaxStop"</span>)</span><span class="hljs-comment">;</span>
        }
      }<span class="hljs-comment">;</span>
      return xhr<span class="hljs-comment">;</span>
    }
  })<span class="hljs-comment">;</span>
  Titanium.ajax = Titanium.Network.ajax<span class="hljs-comment">;</span>
}).call<span class="hljs-list">(<span class="hljs-keyword">this</span>)</span><span class="hljs-comment">;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="May 31st 2012, 12:12:50 pm">May 31st 2012</span>
											by <span class='authorname'>Wassim Ghannoum</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>(function() {<br>  &#x2F;<em><br>   Titanium $.ajax port from jQuery JavaScript Library v1.4.2<br>   Original code at http:&#x2F;&#x2F;jquery.com&#x2F;, Copyright 2010, John Resig<br>   Dual licensed under the MIT or GPL Version 2 licenses.<br>   http:&#x2F;&#x2F;jquery.org&#x2F;license
  </em>&#x2F;  var ajaxHandlerBindings, jsre, r20, rquery, rts, rurl, utils, _fn, _i, _len, <em>ref;<br>  var __hasProp = Object.prototype.hasOwnProperty;<br>  jsre = &#x2F;=\?(&amp;|$)&#x2F;;<br>  rquery = &#x2F;\?&#x2F;;<br>  rts = &#x2F;(\?|&amp;)</em>=.<em>?(&amp;|$)&#x2F;;<br>  rurl = &#x2F;^(\w+:)?\&#x2F;\&#x2F;([^\&#x2F;?#]+)&#x2F;;<br>  r20 = &#x2F;%20&#x2F;g;<br>  if (typeof utils == &quot;undefined&quot; || utils === null) {<br>    utils = {<br>      extend: function(obj) {<br>        var key, source, val, _i, _len, _ref;<br>        _ref = Array.prototype.slice.call(arguments, 1);<br>        for (_i = 0, _len = _ref.length; _i &lt; _len; _i++) {<br>          source = _ref[_i];<br>          for (key in source) {<br>            if (!__hasProp.call(source, key)) continue;<br>            val = source[key];<br>            obj[key] = val;<br>          }<br>        }<br>        return obj;<br>      }<br>    };<br>  }<br>  ajaxHandlerBindings = {};<br>  _ref = &quot;ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend&quot;.split(&quot; &quot;);<br>  _fn = function(name) {<br>    return ajaxHandlerBindings[name] = function(f) {<br>      return Titanium.Network.addEventListener(name, function(e) {<br>        return f.call(e, e.xhr, e.s, e.e);<br>      });<br>    };<br>  };<br>  for (_i = 0, _len = _ref.length; _i &lt; _len; _i++) {<br>    name = _ref[_i];<br>    _fn(name);<br>  }<br>  utils.extend(Titanium.Network, ajaxHandlerBindings, {<br>    ajaxSetup: function(settings) {<br>      return utils.extend(Titanium.Network.ajaxSettings, settings);<br>    },<br>    ajaxSettings: {<br>      global: true,<br>      type: &quot;GET&quot;,<br>      contentType: &quot;application&#x2F;x-www-form-urlencoded&quot;,<br>      processData: true,<br>      async: true,<br>      timeout: 300000,<br>      traditional: false,<br>      xhr: function() {<br>        return Ti.Network.createHTTPClient();<br>      },<br>      accepts: {<br>        xml: &quot;application&#x2F;xml, text&#x2F;xml&quot;,<br>        html: &quot;text&#x2F;html&quot;,<br>        script: &quot;text&#x2F;javascript, application&#x2F;javascript&quot;,<br>        json: &quot;application&#x2F;json, text&#x2F;javascript&quot;,<br>        text: &quot;text&#x2F;plain&quot;,<br>        _default: &quot;</em>&#x2F;*&quot;<br>      }<br>    },<br>    param: function(a) {<br>      var add, buildParams, obj, prefix, s, traditional;<br>      s = [];<br>      traditional = false;<br>      buildParams = function(prefix, obj) {<br>        if (<em>.isArray(obj)) {<br>          return </em>.each(obj, function(i, v) {<br>            var p, x;<br>            if (traditional || &#x2F;[]$&#x2F;.test(prefix)) {<br>              return add(prefix, v);<br>            } else {<br>              x = <em>.isObject(v) || </em>.isArray(v) ? i : &quot;&quot;;<br>              p = prefix + &quot;[&quot; + x + &quot;]&quot;;<br>              return buildParams(p, v);<br>            }<br>          });<br>        } else if (!traditional &amp;&amp; !<em>.isNull(obj) &amp;&amp; typeof obj === &quot;object&quot;) {<br>          return </em>.each(obj, function(k, v) {<br>            return buildParams(prefix + &quot;[&quot; + k + &quot;]&quot;, v);<br>          });<br>        } else {<br>          return add(prefix, obj);<br>        }<br>      };<br>      add = function(key, value) {<br>        value = <em>.isFunction(value) ? value() : value;<br>        return s[s.length] = encodeURIComponent(key) + &quot;=&quot; + encodeURIComponent(value);<br>      };<br>      if (</em>.isArray(a)) {<br>        _.each(a, function() {<br>          return add(this.name, this.value);<br>        });<br>      } else {<br>        for (prefix in a) {<br>          if (!__hasProp.call(a, prefix)) continue;<br>          obj = a[prefix];<br>          buildParams(prefix, obj);<br>        }<br>      }<br>      return s.join(&quot;&amp;&quot;).replace(r20, &quot;+&quot;);<br>    },<br>    lastModified: {},<br>    etag: {},<br>    httpSuccess: function(xhr) {<br>      try {<br>        return (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) || xhr.status === 304;<br>      } catch (e) {</p>
<pre><code class="hljs">  }
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
},
httpNotModified: <span class="hljs-keyword">function</span>(xhr, url) {
  var etag, lastModified;
  lastModified = xhr.getResponseHeader(<span class="hljs-string">"Last-Modified"</span>);
  etag = xhr.getResponseHeader(<span class="hljs-string">"Etag"</span>);
  <span class="hljs-keyword">if</span> (lastModified) {
    Titanium.Network.lastModified[url] = lastModified;
  }
  <span class="hljs-keyword">if</span> (etag) {
    Titanium.Network.etag[url] = etag;
  }
  <span class="hljs-keyword">return</span> xhr.status === <span class="hljs-number">304</span> || xhr.status === <span class="hljs-number">0</span>;
},
httpData: <span class="hljs-keyword">function</span>(xhr, <span class="hljs-class"><span class="hljs-keyword">type</span>, <span class="hljs-title">s</span>) {</span>
  var ct, data, xml;
  ct = xhr.getResponseHeader(<span class="hljs-string">"content-type"</span>) || <span class="hljs-string">""</span>;
  xml = <span class="hljs-class"><span class="hljs-keyword">type</span> </span>=== <span class="hljs-string">"xml"</span> || !<span class="hljs-class"><span class="hljs-keyword">type</span> &amp;&amp; <span class="hljs-title">ct</span>.<span class="hljs-title">indexOf</span></span>(<span class="hljs-string">"xml"</span>) &gt;= <span class="hljs-number">0</span>;
  data = xml ? xhr.responseXML : xhr.responseText;
  <span class="hljs-keyword">if</span> (xml &amp;&amp; data.documentElement.nodeName === <span class="hljs-string">"parsererror"</span>) {
    Titanium.Network.error(<span class="hljs-string">"parsererror"</span>);
  }
  <span class="hljs-keyword">if</span> ((s != <span class="hljs-keyword">null</span>) &amp;&amp; s.dataFilter) {
    data = s.dataFilter(data, <span class="hljs-class"><span class="hljs-keyword">type</span>);</span>
  }
  <span class="hljs-keyword">if</span> (typeof data === <span class="hljs-string">"string"</span>) {
    <span class="hljs-keyword">if</span> (<span class="hljs-class"><span class="hljs-keyword">type</span> </span>=== <span class="hljs-string">"json"</span> || !<span class="hljs-class"><span class="hljs-keyword">type</span> &amp;&amp; <span class="hljs-title">ct</span>.<span class="hljs-title">indexOf</span></span>(<span class="hljs-string">"json"</span>) &gt;= <span class="hljs-number">0</span>) {
      data = JSON.parse(data);
    }
  }
  <span class="hljs-keyword">return</span> data;
},
error: <span class="hljs-keyword">function</span>(msg) {
  throw msg;
},
handleError: <span class="hljs-keyword">function</span>(s, xhr, status, e) {
  <span class="hljs-keyword">if</span> (s.error) {
    s.error.call(s.context || s, xhr, status, e);
  }
  <span class="hljs-keyword">if</span> (s.<span class="hljs-keyword">global</span>) {
    <span class="hljs-keyword">return</span> Titanium.Network.fireEvent(<span class="hljs-string">"ajaxError"</span>, {
      xhr: xhr,
      s: s,
      e: e
    });
  }
},
ajax: <span class="hljs-keyword">function</span>(origSettings) {
  var callbackContext, complete, data, oldAbort, onreadystatechange, parts, remote, requestDone, ret, s, status, success, trigger, ts, <span class="hljs-class"><span class="hljs-keyword">type</span>, <span class="hljs-title">xhr</span>, <span class="hljs-title">_ref</span>;</span>
  s = utils.extend({}, Titanium.Network.ajaxSettings, origSettings);
  status = <span class="hljs-string">""</span>;
  data = {};
  callbackContext = origSettings &amp;&amp; origSettings.context || s;
  <span class="hljs-class"><span class="hljs-keyword">type</span> </span>= s.<span class="hljs-keyword">type</span>.toUpperCase();
  <span class="hljs-keyword">if</span> (s.data &amp;&amp; s.processData &amp;&amp; typeof s.data !== <span class="hljs-string">"string"</span>) {
    s.data = Titanium.Network.param(s.data, s.traditional);
  }
  <span class="hljs-keyword">if</span> (s.cache === <span class="hljs-keyword">false</span> &amp;&amp; <span class="hljs-class"><span class="hljs-keyword">type</span> </span>=== <span class="hljs-string">"GET"</span>) {
    ts = (<span class="hljs-keyword">new</span> Date).getTime();
    ret = s.url.replace(rts, <span class="hljs-string">"$1_="</span> + ts + <span class="hljs-string">"$2"</span>);
    s.url = ret + (ret === s.url ? (rquery.test(s.url) ? <span class="hljs-string">"&amp;"</span> : <span class="hljs-string">"?"</span>) + <span class="hljs-string">"_="</span> + ts : <span class="hljs-string">""</span>);
  }
  <span class="hljs-keyword">if</span> (s.data &amp;&amp; <span class="hljs-class"><span class="hljs-keyword">type</span> </span>=== <span class="hljs-string">"GET"</span>) {
    s.url += ((_ref = rquery.test(s.url)) != <span class="hljs-keyword">null</span> ? _ref : {
      <span class="hljs-string">"&amp;"</span>: <span class="hljs-string">"?"</span>
    }) + s.data;
  }
  parts = rurl.exec(s.url);
  remote = <span class="hljs-keyword">true</span>;
  requestDone = <span class="hljs-keyword">false</span>;
  xhr = s.xhr();
  <span class="hljs-keyword">if</span> (!xhr) {
    <span class="hljs-keyword">return</span>;
  }
  Ti.API.debug(<span class="hljs-string">"Sending "</span> + <span class="hljs-class"><span class="hljs-keyword">type</span> + " <span class="hljs-title">request</span> <span class="hljs-title">to</span> " + <span class="hljs-title">s</span>.<span class="hljs-title">url</span>);</span>
  <span class="hljs-keyword">if</span> (<span class="hljs-class"><span class="hljs-keyword">type</span> </span>=== <span class="hljs-string">"POST"</span>) {
    Ti.API.debug(<span class="hljs-string">"POSTing data:"</span>);
    Ti.API.debug(s.data);
  }
  <span class="hljs-keyword">if</span> (s.username != <span class="hljs-keyword">null</span>) {
    xhr.<span class="hljs-keyword">open</span>(<span class="hljs-class"><span class="hljs-keyword">type</span>, <span class="hljs-title">s</span>.<span class="hljs-title">url</span>, <span class="hljs-title">s</span>.<span class="hljs-title">async</span>, <span class="hljs-title">s</span>.<span class="hljs-title">username</span>, <span class="hljs-title">s</span>.<span class="hljs-title">password</span>);</span>
  } <span class="hljs-keyword">else</span> {
    xhr.<span class="hljs-keyword">open</span>(<span class="hljs-class"><span class="hljs-keyword">type</span>, <span class="hljs-title">s</span>.<span class="hljs-title">url</span>, <span class="hljs-title">s</span>.<span class="hljs-title">async</span>);</span>
  }
  <span class="hljs-keyword">if</span> (s.data || origSettings &amp;&amp; origSettings.contentType) {
    xhr.setRequestHeader(<span class="hljs-string">"Content-Type"</span>, s.contentType);
  }
  <span class="hljs-keyword">if</span> (s.ifModified) {
    <span class="hljs-keyword">if</span> (Titanium.Network.lastModified[s.url]) {
      xhr.setRequestHeader(<span class="hljs-string">"If-Modified-Since"</span>, Titanium.Network.lastModified[s.url]);
    }
    <span class="hljs-keyword">if</span> (Titanium.Network.etag[s.url]) {
      xhr.setRequestHeader(<span class="hljs-string">"If-None-Match"</span>, Titanium.Network.etag[s.url]);
    }
  }
  xhr.setRequestHeader(<span class="hljs-string">"X-Requested-With"</span>, <span class="hljs-string">"XMLHttpRequest"</span>);
  xhr.setRequestHeader(<span class="hljs-string">"Accept"</span>, s.dataType &amp;&amp; s.accepts[s.dataType] ? s.accepts[s.dataType] + <span class="hljs-string">", */*"</span> : s.accepts._default);
  <span class="hljs-keyword">if</span> (s.beforeSend &amp;&amp; s.beforeSend.call(callbackContext, xhr, s) === <span class="hljs-keyword">false</span>) {
    xhr.abort();
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">false</span>;
  }
  onreadystatechange = xhr.onreadystatechange = <span class="hljs-keyword">function</span>(isTimeout) {
    var errMsg;
    <span class="hljs-keyword">if</span> (!xhr || xhr.readyState === <span class="hljs-number">0</span> || isTimeout === <span class="hljs-string">"abort"</span>) {
      <span class="hljs-keyword">if</span> (!requestDone) {
        complete();
      }
      requestDone = <span class="hljs-keyword">true</span>;
      <span class="hljs-keyword">if</span> (xhr) {
        <span class="hljs-keyword">return</span> xhr.onreadystatechange = <span class="hljs-keyword">function</span>() {};
      }
    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!requestDone &amp;&amp; xhr &amp;&amp; (xhr.readyState === <span class="hljs-number">4</span> || isTimeout === <span class="hljs-string">"timeout"</span>)) {
      requestDone = <span class="hljs-keyword">true</span>;
      xhr.onreadystatechange = <span class="hljs-keyword">function</span>() {};
      status = isTimeout === <span class="hljs-string">"timeout"</span> ? <span class="hljs-string">"timeout"</span> : !Titanium.Network.httpSuccess(xhr) ? <span class="hljs-string">"error"</span> : s.ifModified &amp;&amp; Titanium.Network.httpNotModified(xhr, s.url) ? <span class="hljs-string">"notmodified"</span> : <span class="hljs-string">"success"</span>;
      errMsg = <span class="hljs-string">""</span>;
      <span class="hljs-keyword">if</span> (status === <span class="hljs-string">"success"</span>) {
        <span class="hljs-keyword">try</span> {
          data = Titanium.Network.httpData(xhr, s.dataType, s);
        } catch (err) {
          status = <span class="hljs-string">"parsererror"</span>;
          errMsg = err;
        }
      }
      <span class="hljs-keyword">if</span> (status === <span class="hljs-string">"success"</span> || status === <span class="hljs-string">"notmodified"</span>) {
        success();
      } <span class="hljs-keyword">else</span> {
        Titanium.Network.handleError(s, xhr, status, errMsg);
      }
      complete();
      <span class="hljs-keyword">if</span> (isTimeout === <span class="hljs-string">"timeout"</span>) {
        xhr.abort();
      }
      <span class="hljs-keyword">if</span> (s.async) {
        <span class="hljs-keyword">return</span> xhr = <span class="hljs-keyword">null</span>;
      }
    }
  };
  <span class="hljs-keyword">try</span> {
    oldAbort = xhr.abort;
    xhr.abort = <span class="hljs-keyword">function</span>() {
      <span class="hljs-keyword">if</span> (xhr) {
        oldAbort.call(xhr);
      }
      <span class="hljs-keyword">return</span> onreadystatechange(<span class="hljs-string">"abort"</span>);
    };
  } catch (e) {

  }
  <span class="hljs-keyword">if</span> (s.async &amp;&amp; s.timeout &gt; <span class="hljs-number">0</span>) {
    setTimeout(<span class="hljs-keyword">function</span>() {
      <span class="hljs-keyword">if</span> (xhr &amp;&amp; !requestDone) {
        <span class="hljs-keyword">return</span> onreadystatechange(<span class="hljs-string">"timeout"</span>);
      }
    }, s.timeout);
  }
  <span class="hljs-keyword">try</span> {
    xhr.send(<span class="hljs-class"><span class="hljs-keyword">type</span> </span>=== <span class="hljs-string">"POST"</span> || <span class="hljs-class"><span class="hljs-keyword">type</span> </span>=== <span class="hljs-string">"PUT"</span> || <span class="hljs-class"><span class="hljs-keyword">type</span> </span>=== <span class="hljs-string">"DELETE"</span> ? s.data : <span class="hljs-keyword">null</span>);
  } catch (e) {
    Titanium.Network.handleError(s, xhr, <span class="hljs-keyword">null</span>, e);
    complete();
  }
  trigger = <span class="hljs-keyword">function</span>(<span class="hljs-class"><span class="hljs-keyword">type</span>, <span class="hljs-title">arg</span>) {</span>
    var obj;
    obj = s.context ? s.context : Titanium.Network;
    <span class="hljs-keyword">if</span> ((obj != <span class="hljs-keyword">null</span> ? obj.fireEvent : <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>) != <span class="hljs-keyword">null</span>) {
      <span class="hljs-keyword">return</span> obj.fireEvent(<span class="hljs-class"><span class="hljs-keyword">type</span>, <span class="hljs-title">arg</span>);</span>
    }
  };
  success = <span class="hljs-keyword">function</span>() {
    <span class="hljs-keyword">if</span> (s.success) {
      s.success.call(callbackContext, data, status, xhr);
    }
    <span class="hljs-keyword">if</span> (s.<span class="hljs-keyword">global</span>) {
      <span class="hljs-keyword">return</span> trigger(<span class="hljs-string">"ajaxSuccess"</span>, {
        xhr: xhr,
        s: s
      });
    }
  };
  complete = <span class="hljs-keyword">function</span>() {
    <span class="hljs-keyword">if</span> (s.complete) {
      s.complete.call(callbackContext, xhr, status);
    }
    <span class="hljs-keyword">if</span> (s.<span class="hljs-keyword">global</span>) {
      trigger(<span class="hljs-string">"ajaxComplete"</span>, {
        xhr: xhr,
        s: s
      });
    }
    <span class="hljs-keyword">if</span> (s.<span class="hljs-keyword">global</span> &amp;&amp; !--jQuery.active) {
      <span class="hljs-keyword">return</span> Titanium.Network.fireEvent(<span class="hljs-string">"ajaxStop"</span>);
    }
  };
  <span class="hljs-keyword">return</span> xhr;
}
</code></pre><p>  });<br>  Titanium.ajax = Titanium.Network.ajax;<br>}).call(this);</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 31st 2012, 12:14:09 pm">May 31st 2012</span>
											by <span class='authorname'>Wassim Ghannoum</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Please don&#39;t include such long sections of code in your posts. If you really need to post big chunks of code, I recommend that you use a dedicated service like <a href="http:&#x2F;&#x2F;pastie.org&#x2F;">pastie.org</a>.</p>
<p>Secondly, why are you using Tiajax and not the native functions provided by Titanium??</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 31st 2012, 12:21:57 pm">May 31st 2012</span>
											by <span class='authorname'>Christian Brousseau</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>sorry for the long code: <a href="http:&#x2F;&#x2F;pastie.org&#x2F;4001970">this is a link for it </a> </p>
<p>I&#39;m using Tiajax in Titanium, because the Back-End of My Mobile App is built on Drupal and i started from drupanium.org</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 31st 2012, 12:28:16 pm">May 31st 2012</span>
											by <span class='authorname'>Wassim Ghannoum</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Any Solutions?</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 2nd 2012, 9:32:55 am">June 2nd 2012</span>
											by <span class='authorname'>Wassim Ghannoum</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>This is the exception that i&#39;m getting:</p>
<pre><code class="hljs">[WARN] Exception in event callback. {
    expressionBeginOffset = 8893<span class="hljs-comment">;</span>
    expressionCaretOffset = 8897<span class="hljs-comment">;</span>
    expressionEndOffset = 8901<span class="hljs-comment">;</span>
    line = 339<span class="hljs-comment">;</span>
    message = "Result of expression 'user' [undefined] is not an object."<span class="hljs-comment">;</span>
    name = TypeError<span class="hljs-comment">;</span>
    sourceId = <span class="hljs-number">225648264</span><span class="hljs-comment">;</span>
    sourceURL = "file://localhost/Users/wassimghannoum/Library/Application%20Support/iPhone%20Simulator/4.3/Applications/F<span class="hljs-number">2F9A5D2</span>-<span class="hljs-number">3445-4D27</span>-A495-E2CF<span class="hljs-number">4499A6C3</span>/com.theevision.Edelivery.app/order.js"<span class="hljs-comment">;</span>
}
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="June 2nd 2012, 9:45:58 am">June 2nd 2012</span>
											by <span class='authorname'>Wassim Ghannoum</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
