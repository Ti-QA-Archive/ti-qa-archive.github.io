<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>open window when receive push notifications » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>open window when receive push notifications</h1>
		</header>
		<section>
			<p>Hi,</p>
<p>i have this code : </p>
<pre><code class="hljs">Titanium.Network.registerForPushNotifications(
            {
                types : [Titanium.Network.NOTIFICATION_TYPE_SOUND, Titanium.Network.NOTIFICATION_TYPE_ALERT],
                success : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
                    Ti.API.info(<span class="hljs-string">"deviceToken = "</span> + e.deviceToken);
                    registerForPush(e.deviceToken);
                },
                error : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
                    Ti.API.info(<span class="hljs-string">"Error: "</span> + e.message);
                },
                <span class="hljs-keyword">callback</span> : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
                    alert(e.data.alert);
                    <span class="hljs-keyword">var</span> winOffre = require(<span class="hljs-string">'ui/winOffre'</span>).createWindow([{titre: <span class="hljs-string">'titre'</span>, nom_entreprise: <span class="hljs-string">''</span>, url: <span class="hljs-string">''</span>}], <span class="hljs-number">0</span>);
                    winOffre.open();
                }
            }
        );
</code></pre><p>as you see, in the callback, when i receive notifications push, i open a specific window but it doesn&#39;t work…is it the good method ?</p>
<p>i have the same problem on android..</p>
<p>thanks</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="April 21st 2013, 9:06:24 am">April 21st 2013</span>
				by <span class='authorname'>Djamel ZAHAL</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>iphone</span></li>
					
						<li><span class='tagname'>push</span></li>
					
						<li><span class='tagname'>window</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>it works when app is running or when app is in the background but when app is not in the background. it doesn&#39; work..</p>
<p>thanks for help</p>
</div>
							<div class="author">
								&mdash; commented <span title="April 21st 2013, 11:37:30 am">April 21st 2013</span>
								by <span class='authorname'>Djamel ZAHAL</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-261202">
				
						<section>
							<p>Hi</p>
<p>That is how push notifications work, the callback is ONLY fired;</p>
<ul>
<li>if - the app is currently running and in focus</li>
<li>if - the app is not running or not in focus then only if<ul>
<li>the user selects the push notification when it first comes in</li>
<li>the user selects the push notification later from the notification panel</li>
</ul>
</li>
</ul>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 21st 2013, 12:16:35 pm">April 21st 2013</span>
								by <span class='authorname'>Malcolm Hollingsworth</span><br>
								<a class="icon-bg icon-link" href="question/151306/open-window-when-receive-push-notifications.html#answer-261202" rel="permalink">permalink</a>
							</div>

							<h5>10 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>and for android, it is the same ?</p>
<p>where should i open the window ?</p>
<p>my code :</p>
<pre><code class="hljs">    //Callback and errors.
    <span class="hljs-filename">CloudPush.addEventListener('callback', function (evt) {
        //What to do when get notified
        //alert('push received');
        var json = JSON.parse(evt.payload);
        alert(json.android.alert);
        var winOffre = require('ui/winOffre').createWindow(
            [
                {
                    id </span>: <span class="hljs-filename">json.android.offre.id, 
                    titre </span>: <span class="hljs-filename">json.android.offre.titre, 
                    nombre_poste </span>: <span class="hljs-filename">json.android.offre.nombre_poste, 
                    nom_entreprise </span>: <span class="hljs-filename">json.android.offre.nom_entreprise, 
                    description </span>: <span class="hljs-filename">json.android.offre.description, 
                    url </span>: <span class="hljs-filename">json.android.offre.url, 
                    secteur</span>: <span class="hljs-filename">json.android.offre.secteur, 
                    fonction</span>: <span class="hljs-filename">json.android.offre.fonction, 
                    ville</span>: <span class="hljs-filename">json.android.offre.ville, 
                    is_favoris</span>: <span class="hljs-number">0</span>, 
                    region: <span class="hljs-filename">json.android.offre.region
                }
            ]
            , 0);

        winOffre.open();
    });

    CloudPush.addEventListener('trayClickLaunchedApp', function (evt) {
        //alert('Tray Click Launched App (app was not running)'); // to change
        var winOffre = require('ui/winOffre').createWindow(
            [
                {
                    id </span>: <span class="hljs-filename">json.offre.id, 
                    titre </span>: <span class="hljs-filename">json.offre.titre, 
                    nombre_poste </span>: <span class="hljs-filename">json.offre.nombre_poste, 
                    nom_entreprise </span>: <span class="hljs-filename">json.offre.nom_entreprise, 
                    description </span>: <span class="hljs-filename">json.offre.description, 
                    url </span>: <span class="hljs-filename">json.offre.url, 
                    secteur</span>: <span class="hljs-filename">json.offre.secteur, 
                    fonction</span>: <span class="hljs-filename">json.offre.fonction, 
                    ville</span>: <span class="hljs-filename">json.offre.ville, 
                    is_favoris</span>: <span class="hljs-number">0</span>, 
                    region: <span class="hljs-filename">json.offre.region
                }
            ]
            , 0);

        winOffre.open();
    });

    CloudPush.addEventListener('trayClickFocusedApp', function (evt) {
        //alert('Tray Click Focused App (app was already running)'); // to change
        var winOffre = require('ui/winOffre').createWindow(
            [
                {
                    id </span>: <span class="hljs-filename">json.offre.id, 
                    titre </span>: <span class="hljs-filename">json.offre.titre, 
                    nombre_poste </span>: <span class="hljs-filename">json.offre.nombre_poste, 
                    nom_entreprise </span>: <span class="hljs-filename">json.offre.nom_entreprise, 
                    description </span>: <span class="hljs-filename">json.offre.description, 
                    url </span>: <span class="hljs-filename">json.offre.url, 
                    secteur</span>: <span class="hljs-filename">json.offre.secteur, 
                    fonction</span>: <span class="hljs-filename">json.offre.fonction, 
                    ville</span>: <span class="hljs-filename">json.offre.ville, 
                    is_favoris</span>: <span class="hljs-number">0</span>, 
                    region: <span class="hljs-filename">json.offre.region
                }
            ]
            , 0);

        winOffre.open();
    });</span>
</code></pre><p>i send push from php file, here is the payload :</p>
<pre><code class="hljs"><span class="hljs-variable">$payload</span> = <span class="hljs-string">"{
        sound: default,
        alert : <span class="hljs-variable">$titre_offre</span>, 
        offre : 
            {
                id : <span class="hljs-variable">$id_offre</span>,
                titre: <span class="hljs-variable">$titre_offre</span>,
                nombre_poste: <span class="hljs-variable">$nombre_poste</span>,
                nom_enreprise: <span class="hljs-variable">$entreprise_offre</span>,
                description: <span class="hljs-variable">$description_offre</span>,
                url: <span class="hljs-variable">$url_offre</span>,
                secteur: <span class="hljs-variable">$secteur_offre</span>,
                fonction: <span class="hljs-variable">$fonction_offre</span>,
                ville: <span class="hljs-variable">$lieu_offre</span>,
                region: <span class="hljs-variable">$region_offre</span>
            }
    }"</span>;
</code></pre><p>as you see, i have custom data.</p>
<p>i get the message and displayed (json.android.alert) but for offre, i have &quot;cannot read property &#39;id&#39; of undefined..</p>
<p>what is the problem ?</p>
<p>in the json, offre is at the same level like alert.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 22nd 2013, 7:50:21 pm">April 22nd 2013</span>
											by <span class='authorname'>Djamel ZAHAL</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Malcom is right, you can&#39;t send a push notification to an application that isn&#39;t running.  It&#39;s like, you download an app, never open it, but since it was downloaded&#x2F;installed, the app should be able to receive push notifications?  That will not work, and quite frankly if I was the user, I wouldn&#39;t want that to work.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 22nd 2013, 8:36:43 pm">April 22nd 2013</span>
											by <span class='authorname'>Paul Nelson</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>No, the app was lunched and subscribed to push.<br>I receive push, my question is about custom data as you see above and the possibility to open window. In many apps, it opens a specific window.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 22nd 2013, 9:09:59 pm">April 22nd 2013</span>
											by <span class='authorname'>Djamel ZAHAL</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>The callback fired but i dont get offre value and doesnt open window..</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 22nd 2013, 9:21:04 pm">April 22nd 2013</span>
											by <span class='authorname'>Djamel ZAHAL</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi, any news ?</p>
<p>Here my code :</p>
<pre><code class="hljs"><span class="hljs-type">Titanium</span>.<span class="hljs-type">Network</span>.registerForPushNotifications(
            {
                types : [<span class="hljs-type">Titanium</span>.<span class="hljs-type">Network</span>.<span class="hljs-type">NOTIFICATION_TYPE_SOUND</span>, <span class="hljs-type">Titanium</span>.<span class="hljs-type">Network</span>.<span class="hljs-type">NOTIFICATION_TYPE_ALERT</span>],
                success : function(e) {
                    <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info(<span class="hljs-string">"deviceToken = "</span> + e.deviceToken);
                    registerForPush(e.deviceToken);
                },
                error : function(e) {
                    <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info(<span class="hljs-string">"Error: "</span> + e.message);
                },
                callback : function(e) {
                    alert(e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.alert);</span>
                    try{    

                        var winOffre = require('ui/winOffre').createWindow(
                                {
                                    id : e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.offre.id, </span>
                                    titre : e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.offre.titre, </span>
                                    nombre_poste : e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.offre.nombre_poste, </span>
                                    nom_entreprise : e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.offre.nom_entreprise, </span>
                                    description : e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.offre.description, </span>
                                    url : e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.offre.url, </span>
                                    secteur: e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.offre.secteur, </span>
                                    fonction: e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.offre.fonction, </span>
                                    ville: e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.offre.ville, </span>
                                    is_favoris: <span class="hljs-number">0</span>, 
                                    region: e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.offre.region</span>
                                }
                        );

                        winOffre.open();
                    }
                    catch(e){}
                }
            }
        );
</code></pre><p>as you see,  i open a window after receiving a notification push.<br>the mystery is that somtimes it works and open the window (the first times) and now, it doesn&#39;t work. but i still and always executes the alert message.</p>
<p>my offre window take an object as parameter and display all infos for job offer.</p>
<p>please help.<br>thanks</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 23rd 2013, 10:21:52 pm">April 23rd 2013</span>
											by <span class='authorname'>Djamel ZAHAL</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Can you provide the PHP file used to submit the push notification for reference.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 27th 2013, 12:24:22 pm">April 27th 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>here it is :</p>
<pre><code class="hljs">&lt;?php

    <span class="hljs-variable">$key</span> = <span class="hljs-string">'ELK2M9mTYo8iPAD8KOCezPz3e4o2dn3t'</span>;
    <span class="hljs-variable">$usersToPush</span> = <span class="hljs-keyword">array</span>();
    <span class="hljs-variable">$id</span>_offre = <span class="hljs-string">""</span>;
    <span class="hljs-variable">$secteur</span>_offre = <span class="hljs-string">""</span>;
    <span class="hljs-variable">$fonction</span>_offre = <span class="hljs-string">""</span>;
    <span class="hljs-variable">$titre</span>_offre = <span class="hljs-string">"Développeur mobile"</span>;
    <span class="hljs-variable">$lieu</span>_offre = <span class="hljs-string">"paris"</span>;
    <span class="hljs-variable">$region</span>_offre = <span class="hljs-string">""</span>;
    <span class="hljs-variable">$niveau</span>_offre = <span class="hljs-string">""</span>;
    <span class="hljs-variable">$experience</span>_offre = <span class="hljs-string">""</span>;
    <span class="hljs-variable">$entreprise</span>_offre = <span class="hljs-string">""</span>;
    <span class="hljs-variable">$nombre</span>_poste = <span class="hljs-string">""</span>;
    <span class="hljs-variable">$description</span>_offre = <span class="hljs-string">""</span>;
    <span class="hljs-variable">$url</span>_offre = <span class="hljs-string">""</span>;

    <span class="hljs-variable">$payload</span> = <span class="hljs-string">"{
        \"</span>sound\<span class="hljs-string">": default,
        \"</span>alert\<span class="hljs-string">" : $titre_offre, 
        \"</span>offre\<span class="hljs-string">" : 
            {
                \"</span>id\<span class="hljs-string">" : \"</span><span class="hljs-variable">$id</span>_offre\<span class="hljs-string">",
                \"</span>titre\<span class="hljs-string">": \"</span><span class="hljs-variable">$titre</span>_offre\<span class="hljs-string">",
                \"</span>nombre_poste\<span class="hljs-string">": \"</span><span class="hljs-variable">$nombre</span>_poste\<span class="hljs-string">",
                \"</span>nom_enreprise\<span class="hljs-string">": \"</span><span class="hljs-variable">$entreprise</span>_offre\<span class="hljs-string">",
                \"</span>description\<span class="hljs-string">": \"</span><span class="hljs-variable">$description</span>_offre\<span class="hljs-string">",
                \"</span>url\<span class="hljs-string">": \"</span><span class="hljs-variable">$url</span>_offre\<span class="hljs-string">",
                \"</span>secteur\<span class="hljs-string">": \"</span><span class="hljs-variable">$secteur</span>_offre\<span class="hljs-string">",
                \"</span>fonction\<span class="hljs-string">": \"</span><span class="hljs-variable">$fonction</span>_offre\<span class="hljs-string">",
                \"</span>ville\<span class="hljs-string">": \"</span><span class="hljs-variable">$lieu</span>_offre\<span class="hljs-string">",
                \"</span>region\<span class="hljs-string">": \"</span><span class="hljs-variable">$region</span>_offre\<span class="hljs-string">"
            }
    }"</span>;

    //<span class="hljs-variable">$payload</span> = <span class="hljs-string">"{'sound': 'default','alert' : "</span> . <span class="hljs-variable">$titre</span>_offre . <span class="hljs-string">"}"</span>;

    <span class="hljs-variable">$tmp</span>_fname = <span class="hljs-string">"cookies.txt"</span>;

    //se loguer sur ACS pour pouvoir faire des requetes REST.
    <span class="hljs-variable">$Curl</span>_Session = curl_init(<span class="hljs-string">"https://api.cloud.appcelerator.com/v1/users/login.json?key=$key"</span>);
    curl_setopt(<span class="hljs-variable">$Curl</span>_Session, CURLOPT_COOKIEJAR, <span class="hljs-variable">$tmp</span>_fname);
    curl_setopt(<span class="hljs-variable">$Curl</span>_Session, CURLOPT_RETURNTRANSFER, <span class="hljs-literal">true</span>);
    curl_setopt(<span class="hljs-variable">$Curl</span>_Session, CURLOPT_COOKIEFILE, <span class="hljs-variable">$tmp</span>_fname);
    curl_setopt(<span class="hljs-variable">$Curl</span>_Session, CURLOPT_POST, <span class="hljs-number">1</span>);
    curl_setopt(<span class="hljs-variable">$Curl</span>_Session, CURLOPT_POSTFIELDS, <span class="hljs-string">"login=emploitic&amp;password=emploitic"</span>);
    curl_setopt(<span class="hljs-variable">$Curl</span>_Session, CURLOPT_FOLLOWLOCATION, TRUE);
    <span class="hljs-variable">$res</span> = curl_exec(<span class="hljs-variable">$Curl</span>_Session);

    //Faire une requete et récuperer tous les objets recherche
    <span class="hljs-variable">$Curl</span>_Session2 = curl_init(<span class="hljs-string">"https://api.cloud.appcelerator.com/v1/objects/search_data/query.json?key=$key"</span>);
    curl_setopt(<span class="hljs-variable">$Curl</span>_Session2, CURLOPT_COOKIEFILE, <span class="hljs-variable">$tmp</span>_fname);
    curl_setopt(<span class="hljs-variable">$Curl</span>_Session2, CURLOPT_COOKIEJAR, <span class="hljs-variable">$tmp</span>_fname);
    curl_setopt(<span class="hljs-variable">$Curl</span>_Session2, CURLOPT_RETURNTRANSFER, <span class="hljs-number">1</span>);
    curl_setopt(<span class="hljs-variable">$Curl</span>_Session2, CURLOPT_FOLLOWLOCATION, TRUE);
    <span class="hljs-variable">$data</span> = curl_exec(<span class="hljs-variable">$Curl</span>_Session2);
    <span class="hljs-variable">$json</span> = json_decode(<span class="hljs-variable">$data</span>, TRUE);

    <span class="hljs-variable">$objects</span> = <span class="hljs-variable">$json</span>[<span class="hljs-string">'response'</span>][<span class="hljs-string">'search_data'</span>];

    //filtrer les objets recherche selon l<span class="hljs-string">'offre d'</span>emploi publiée et récuperer les id des users
    foreach (<span class="hljs-variable">$objects</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">$object</span>) {
        if (<span class="hljs-variable">$object</span>[<span class="hljs-string">'searchType'</span>] == <span class="hljs-string">'recherche'</span>) {
            if (<span class="hljs-variable">$object</span>[<span class="hljs-string">'ville'</span>] != <span class="hljs-string">''</span> &amp;&amp; <span class="hljs-variable">$object</span>[<span class="hljs-string">'keyword'</span>] != <span class="hljs-string">''</span>) {
                if (<span class="hljs-variable">$object</span>[<span class="hljs-string">'ville'</span>] == <span class="hljs-variable">$lieu</span>_offre &amp;&amp; strstr(<span class="hljs-variable">$titre</span>_offre, <span class="hljs-variable">$object</span>[<span class="hljs-string">'keyword'</span>]) != false) {
                    if(<span class="hljs-variable">$object</span>[<span class="hljs-string">'state'</span>] == <span class="hljs-string">'1'</span>) array_push(<span class="hljs-variable">$usersToPush</span>, <span class="hljs-variable">$object</span>[<span class="hljs-string">'user'</span>][<span class="hljs-string">'id'</span>]);
                }
            } else if (<span class="hljs-variable">$object</span>[<span class="hljs-string">'ville'</span>] != <span class="hljs-string">''</span>) {
                if (<span class="hljs-variable">$object</span>[<span class="hljs-string">'ville'</span>] == <span class="hljs-variable">$lieu</span>_offre) {
                    if(<span class="hljs-variable">$object</span>[<span class="hljs-string">'state'</span>] == <span class="hljs-string">'1'</span>) array_push(<span class="hljs-variable">$usersToPush</span>, <span class="hljs-variable">$object</span>[<span class="hljs-string">'user'</span>][<span class="hljs-string">'id'</span>]);
                }
            } else if (<span class="hljs-variable">$object</span>[<span class="hljs-string">'keyword'</span>] != <span class="hljs-string">''</span>) {
                if(strstr(<span class="hljs-variable">$titre</span>_offre, <span class="hljs-variable">$object</span>[<span class="hljs-string">'keyword'</span>]) != false){
                    if(<span class="hljs-variable">$object</span>[<span class="hljs-string">'state'</span>] == <span class="hljs-string">'1'</span>) array_push(<span class="hljs-variable">$usersToPush</span>, <span class="hljs-variable">$object</span>[<span class="hljs-string">'user'</span>][<span class="hljs-string">'id'</span>]);
                }
            }
        } else if (<span class="hljs-variable">$object</span>[<span class="hljs-string">'searchType'</span>] == <span class="hljs-string">'searchAdv'</span>) {
            filterSearchAdvance(<span class="hljs-variable">$object</span>[<span class="hljs-string">'ville'</span>], <span class="hljs-variable">$object</span>[<span class="hljs-string">'fonction'</span>], <span class="hljs-variable">$object</span>[<span class="hljs-string">'experience'</span>], <span class="hljs-variable">$object</span>[<span class="hljs-string">'secteur'</span>], <span class="hljs-variable">$object</span>[<span class="hljs-string">'niveau'</span>], <span class="hljs-variable">$object</span>[<span class="hljs-string">'user'</span>][<span class="hljs-string">'id'</span>]);
        } else if (<span class="hljs-variable">$object</span>[<span class="hljs-string">'searchType'</span>] == <span class="hljs-string">'fonction'</span>) {
            if (<span class="hljs-variable">$object</span>[<span class="hljs-string">'fonction'</span>] == <span class="hljs-variable">$fonction</span>_offre) {
                if(<span class="hljs-variable">$object</span>[<span class="hljs-string">'state'</span>] == <span class="hljs-string">'1'</span>) array_push(<span class="hljs-variable">$usersToPush</span>, <span class="hljs-variable">$object</span>[<span class="hljs-string">'user'</span>][<span class="hljs-string">'id'</span>]);
            }
        } else if (<span class="hljs-variable">$object</span>[<span class="hljs-string">'searchType'</span>] == <span class="hljs-string">'region'</span>) {
            if (<span class="hljs-variable">$object</span>[<span class="hljs-string">'region'</span>] == <span class="hljs-variable">$region</span>_offre) {
                if(<span class="hljs-variable">$object</span>[<span class="hljs-string">'state'</span>] == <span class="hljs-string">'1'</span>) array_push(<span class="hljs-variable">$usersToPush</span>, <span class="hljs-variable">$object</span>[<span class="hljs-string">'user'</span>][<span class="hljs-string">'id'</span>]);
            }
        } else if (<span class="hljs-variable">$object</span>[<span class="hljs-string">'searchType'</span>] == <span class="hljs-string">'entreprise'</span>) {
            if (<span class="hljs-variable">$object</span>[<span class="hljs-string">'entreprise'</span>] == <span class="hljs-variable">$entreprise</span>_offre) {
                if(<span class="hljs-variable">$object</span>[<span class="hljs-string">'state'</span>] == <span class="hljs-string">'1'</span>) array_push(<span class="hljs-variable">$usersToPush</span>, <span class="hljs-variable">$object</span>[<span class="hljs-string">'user'</span>][<span class="hljs-string">'id'</span>]);
            }
        }
    }

    //supprimer les doublons dans usersToPush
    <span class="hljs-variable">$usersToPush</span> = array_unique(<span class="hljs-variable">$usersToPush</span>);
    //var_dump(<span class="hljs-variable">$usersToPush</span>);

    //notification push aux users filtrés
    <span class="hljs-keyword">if</span> (count(<span class="hljs-variable">$usersToPush</span>) != <span class="hljs-number">0</span>) {
        <span class="hljs-variable">$ids</span> = implode(<span class="hljs-string">","</span>, <span class="hljs-variable">$usersToPush</span>);
        echo <span class="hljs-string">'ids : '</span> . <span class="hljs-variable">$ids</span>;
        <span class="hljs-variable">$Curl</span>_Session = curl_init(<span class="hljs-string">"https://api.cloud.appcelerator.com/v1/push_notification/notify.json?key=$key"</span>);
        curl_setopt(<span class="hljs-variable">$Curl</span>_Session, CURLOPT_COOKIEFILE, <span class="hljs-variable">$tmp</span>_fname);
        curl_setopt(<span class="hljs-variable">$Curl</span>_Session, CURLOPT_COOKIEJAR, <span class="hljs-variable">$tmp</span>_fname);
        curl_setopt(<span class="hljs-variable">$Curl</span>_Session, CURLOPT_POST, <span class="hljs-number">1</span>);
        curl_setopt(<span class="hljs-variable">$Curl</span>_Session, CURLOPT_POSTFIELDS, <span class="hljs-string">"channel=emploitic_channel&amp;to_ids=$ids&amp;payload=$payload"</span>);
        curl_setopt(<span class="hljs-variable">$Curl</span>_Session, CURLOPT_FOLLOWLOCATION, <span class="hljs-number">1</span>);
        <span class="hljs-variable">$res2</span> = curl_exec(<span class="hljs-variable">$Curl</span>_Session);
        curl_close(<span class="hljs-variable">$Curl</span>_Session);
    }
?&gt;
</code></pre><p>i have a complicated php because i dont send the push to all users. but the problem is not from the php file…because i always receive the push in the phone but sometimes opens the window &quot;winOffre&quot; and sometimes no..</p>
<p>my push.js file :</p>
<pre><code class="hljs">exports.managePush = function(queryData) {
    <span class="hljs-keyword">var</span> Cloud = require('ti.cloud');

    <span class="hljs-keyword">var</span> userCreated = Ti.<span class="hljs-keyword">App</span>.Properties.hasProperty('userCreated');
    <span class="hljs-keyword">var</span> registredForPush = Ti.<span class="hljs-keyword">App</span>.Properties.hasProperty('registredForPush');

    <span class="hljs-keyword">var</span> searchIdCloud;
    <span class="hljs-keyword">var</span> searchIdDb = queryData.searchId;
    <span class="hljs-keyword">var</span> userName = Titanium.Platform.getId();

    <span class="hljs-keyword">if</span>(!userCreated){
        createUser();
    }
    <span class="hljs-keyword">else</span>{
        loginUser();
    }
    <span class="hljs-comment">//user registeration on cloud</span>
    function createUser() {
        Cloud.Users.create(
            {
                username: userName,
                password: <span class="hljs-string">"pass"</span>,
                password_confirmation: <span class="hljs-string">"pass"</span>
            }, 
            function (<span class="hljs-keyword">e</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.success) {
                    Ti.<span class="hljs-keyword">App</span>.Properties.setString('userCreated', true);
                    <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">e</span>.users[0].id;
                    queryData.userId = user;
                    Ti.API.info('Created! You are now logged <span class="hljs-keyword">in</span> <span class="hljs-keyword">as</span> ' + user);
                    loginUser();
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span> &amp;&amp; <span class="hljs-keyword">e</span>.message) {
                        Ti.API.info('<span class="hljs-keyword">Error</span> :' + <span class="hljs-keyword">e</span>.message);   
                    }
                }
            }
        );
    }

    <span class="hljs-comment">//user login on cloud using default credential</span>
    function loginUser() {
        Cloud.Users.login(
            {
                login : userName,
                password : 'pass'
            }, 
            function(<span class="hljs-keyword">e</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.success) {
                    <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">e</span>.users[0].id;
                    queryData.userId = user;
                    Ti.API.info(<span class="hljs-string">"Loggin successfully"</span>);
                    Cloud.Objects.create(
                        {
                              classname : 'search_data',
                              fields: {
                                  searchType: queryData.searchType,
                                ville: queryData.ville,
                                region: queryData.region,
                                keyword: queryData.keyword,
                                fonction: queryData.fonctions,
                                secteur: queryData.secteurs,
                                experience: queryData.experiences,
                                niveau: queryData.niveau,
                                entreprise: queryData.entreprise,
                                state: 1
                              }
                            }, 
                            function(<span class="hljs-keyword">e</span>) {
                              <span class="hljs-keyword">if</span>(<span class="hljs-keyword">e</span>.success) {
                                Ti.API.info(<span class="hljs-string">"created"</span>);
                                searchIdCloud = <span class="hljs-keyword">e</span>.search_data[0].id;
                                require('BusinessLogic/updateDb').updateFavoris(searchIdDb, searchIdCloud);
                                setTimeout(
                                    function(<span class="hljs-keyword">e</span>) {
                                        Ti.<span class="hljs-keyword">App</span>.fireEvent('<span class="hljs-keyword">update</span>', {changed : true});            
                                    }, 
                                    900
                                );
                              } 
                              <span class="hljs-keyword">else</span> {
                                Ti.API.info('Create <span class="hljs-keyword">Error</span>:' + ((<span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span> &amp;&amp; <span class="hljs-keyword">e</span>.message) || JSON.stringify(<span class="hljs-keyword">e</span>)));
                              }
                        }
                    );

                    <span class="hljs-keyword">if</span>(!Ti.<span class="hljs-keyword">App</span>.Properties.hasProperty('registredForPush'))
                        getDeviceToken();
                }
                <span class="hljs-keyword">else</span> {
                    Ti.API.info(<span class="hljs-string">"Error :"</span> + <span class="hljs-keyword">e</span>.message);
                }
            }
        );
    }

    <span class="hljs-comment">// getting device token</span>
    function getDeviceToken() {
        Titanium.Network.registerForPushNotifications(
            {
                types : [Titanium.Network.NOTIFICATION_TYPE_SOUND, Titanium.Network.NOTIFICATION_TYPE_ALERT],
                success : function(<span class="hljs-keyword">e</span>) {
                    Ti.API.info(<span class="hljs-string">"deviceToken = "</span> + <span class="hljs-keyword">e</span>.deviceToken);
                    registerForPush(<span class="hljs-keyword">e</span>.deviceToken);
                },
                <span class="hljs-keyword">error</span> : function(<span class="hljs-keyword">e</span>) {
                    Ti.API.info(<span class="hljs-string">"Error: "</span> + <span class="hljs-keyword">e</span>.message);
                },
                callback : function(<span class="hljs-keyword">e</span>) {
                    require('ui/util').alertDialog(<span class="hljs-keyword">e</span>.data.alert);
                    try{
                        require('BusinessLogic/insertInDb').insertOffre(
                            <span class="hljs-keyword">e</span>.data.offre.id, 
                            <span class="hljs-keyword">e</span>.data.offre.titre,
                            <span class="hljs-keyword">e</span>.data.offre.nombre_poste, 
                            <span class="hljs-keyword">e</span>.data.offre.nom_entreprise, 
                            <span class="hljs-keyword">e</span>.data.offre.description, 
                            <span class="hljs-keyword">e</span>.data.offre.url, 
                            <span class="hljs-keyword">e</span>.data.offre.id_entreprise, 
                            <span class="hljs-keyword">e</span>.data.offre.secteur, 
                            <span class="hljs-keyword">e</span>.data.offre.fonction, 
                            <span class="hljs-keyword">e</span>.data.offre.ville, 
                            <span class="hljs-keyword">e</span>.data.offre.niveau_poste, 
                            <span class="hljs-keyword">e</span>.data.offre.experience, 
                            <span class="hljs-keyword">e</span>.data.offre.niveau_etude, 
                            <span class="hljs-keyword">e</span>.data.offre.region, 
                            <span class="hljs-keyword">e</span>.data.offre.pays, 
                            <span class="hljs-keyword">e</span>.data.offre.commune
                        );        

                        <span class="hljs-keyword">var</span> winOffre = require('ui/winOffre').createWindow(
                            [
                                {
                                    id : <span class="hljs-keyword">e</span>.data.offre.id, 
                                    titre : <span class="hljs-keyword">e</span>.data.offre.titre, 
                                    nombre_poste : <span class="hljs-keyword">e</span>.data.offre.nombre_poste, 
                                    nom_entreprise : <span class="hljs-keyword">e</span>.data.offre.nom_entreprise, 
                                    description : <span class="hljs-keyword">e</span>.data.offre.description, 
                                    url : <span class="hljs-keyword">e</span>.data.offre.url, 
                                    secteur: <span class="hljs-keyword">e</span>.data.offre.secteur, 
                                    fonction: <span class="hljs-keyword">e</span>.data.offre.fonction, 
                                    ville: <span class="hljs-keyword">e</span>.data.offre.ville, 
                                    is_favoris: 0, 
                                    region: <span class="hljs-keyword">e</span>.data.offre.region
                                }
                            ]
                            , 0);

                        winOffre.<span class="hljs-keyword">open</span>();
                    }
                    catch(<span class="hljs-keyword">e</span>){}
                }
            }
        );
    }

    <span class="hljs-comment">// register for push notification on cloud server</span>
    function registerForPush(deviceToken) {
        <span class="hljs-comment">//alert('token : ' + deviceToken);</span>
        Cloud.PushNotifications.subscribe(
            {
                channel : 'emploitic_channel',
                device_token : deviceToken,
                <span class="hljs-keyword">type</span>: 'ios'
            }, 
            function(<span class="hljs-keyword">e</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.success) {
                    Ti.<span class="hljs-keyword">App</span>.Properties.setString('registredForPush', true);
                    Ti.API.info('Success :' + ((<span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span> &amp;&amp; <span class="hljs-keyword">e</span>.message) || JSON.stringify(<span class="hljs-keyword">e</span>)));
                }
                <span class="hljs-keyword">else</span> {
                    Ti.API.info('<span class="hljs-keyword">Error</span>:' + ((<span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span> &amp;&amp; <span class="hljs-keyword">e</span>.message) || JSON.stringify(<span class="hljs-keyword">e</span>)));
                }
            }
        );
    }
};
</code></pre><p>thanks</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 27th 2013, 5:03:51 pm">April 27th 2013</span>
											by <span class='authorname'>Djamel ZAHAL</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>my push.js file :</p>
<pre><code class="hljs">    <span class="hljs-keyword">var</span> Cloud = require('ti.cloud');

    <span class="hljs-keyword">var</span> userCreated = Ti.<span class="hljs-keyword">App</span>.Properties.hasProperty('userCreated');
    <span class="hljs-keyword">var</span> registredForPush = Ti.<span class="hljs-keyword">App</span>.Properties.hasProperty('registredForPush');

    <span class="hljs-keyword">var</span> searchIdCloud;
    <span class="hljs-keyword">var</span> searchIdDb = queryData.searchId;
    <span class="hljs-keyword">var</span> userName = Titanium.Platform.getId();

    <span class="hljs-keyword">if</span>(!userCreated){
        createUser();
    }
    <span class="hljs-keyword">else</span>{
        loginUser();
    }
    <span class="hljs-comment">//user registeration on cloud</span>
    function createUser() {
        Cloud.Users.create(
            {
                username: userName,
                password: <span class="hljs-string">"pass"</span>,
                password_confirmation: <span class="hljs-string">"pass"</span>
            }, 
            function (<span class="hljs-keyword">e</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.success) {
                    Ti.<span class="hljs-keyword">App</span>.Properties.setString('userCreated', true);
                    <span class="hljs-keyword">var</span> user = <span class="hljs-keyword">e</span>.users[0].id;
                    queryData.userId = user;
                    Ti.API.info('Created! You are now logged <span class="hljs-keyword">in</span> <span class="hljs-keyword">as</span> ' + user);
                    loginUser();
                }
                <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span> &amp;&amp; <span class="hljs-keyword">e</span>.message) {
                        Ti.API.info('<span class="hljs-keyword">Error</span> :' + <span class="hljs-keyword">e</span>.message);   
                    }
                }
            }
        );
    }

    <span class="hljs-comment">//user login on cloud using default credential</span>
    function loginUser() {
        Cloud.Users.login(
            {
                login : userName,
                password : 'pass'
            }, 
            function(<span class="hljs-keyword">e</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.success) {

                        <span class="hljs-keyword">if</span>(!Ti.<span class="hljs-keyword">App</span>.Properties.hasProperty('registredForPush'))
                        getDeviceToken();
                    }
                    <span class="hljs-keyword">else</span> {
                        Ti.API.info(<span class="hljs-string">"Error :"</span> + <span class="hljs-keyword">e</span>.message);
                    }
                }
            }
        )
    };

    <span class="hljs-comment">// getting device token</span>
    function getDeviceToken() {
        Titanium.Network.registerForPushNotifications(
            {
                types : [Titanium.Network.NOTIFICATION_TYPE_SOUND, Titanium.Network.NOTIFICATION_TYPE_ALERT],
                success : function(<span class="hljs-keyword">e</span>) {
                    Ti.API.info(<span class="hljs-string">"deviceToken = "</span> + <span class="hljs-keyword">e</span>.deviceToken);
                    registerForPush(<span class="hljs-keyword">e</span>.deviceToken);
                },
                <span class="hljs-keyword">error</span> : function(<span class="hljs-keyword">e</span>) {
                    Ti.API.info(<span class="hljs-string">"Error: "</span> + <span class="hljs-keyword">e</span>.message);
                },
                callback : function(<span class="hljs-keyword">e</span>) {
                    require('ui/util').alertDialog(<span class="hljs-keyword">e</span>.data.alert);
                    try{
                        require('BusinessLogic/insertInDb').insertOffre(
                            <span class="hljs-keyword">e</span>.data.offre.id, 
                            <span class="hljs-keyword">e</span>.data.offre.titre,
                            <span class="hljs-keyword">e</span>.data.offre.nombre_poste, 
                            <span class="hljs-keyword">e</span>.data.offre.nom_entreprise, 
                            <span class="hljs-keyword">e</span>.data.offre.description, 
                            <span class="hljs-keyword">e</span>.data.offre.url, 
                            <span class="hljs-keyword">e</span>.data.offre.id_entreprise, 
                            <span class="hljs-keyword">e</span>.data.offre.secteur, 
                            <span class="hljs-keyword">e</span>.data.offre.fonction, 
                            <span class="hljs-keyword">e</span>.data.offre.ville, 
                            <span class="hljs-keyword">e</span>.data.offre.niveau_poste, 
                            <span class="hljs-keyword">e</span>.data.offre.experience, 
                            <span class="hljs-keyword">e</span>.data.offre.niveau_etude, 
                            <span class="hljs-keyword">e</span>.data.offre.region, 
                            <span class="hljs-keyword">e</span>.data.offre.pays, 
                            <span class="hljs-keyword">e</span>.data.offre.commune
                        );        

                        <span class="hljs-keyword">var</span> winOffre = require('ui/winOffre').createWindow(
                            [
                                {
                                    id : <span class="hljs-keyword">e</span>.data.offre.id, 
                                    titre : <span class="hljs-keyword">e</span>.data.offre.titre, 
                                    nombre_poste : <span class="hljs-keyword">e</span>.data.offre.nombre_poste, 
                                    nom_entreprise : <span class="hljs-keyword">e</span>.data.offre.nom_entreprise, 
                                    description : <span class="hljs-keyword">e</span>.data.offre.description, 
                                    url : <span class="hljs-keyword">e</span>.data.offre.url, 
                                    secteur: <span class="hljs-keyword">e</span>.data.offre.secteur, 
                                    fonction: <span class="hljs-keyword">e</span>.data.offre.fonction, 
                                    ville: <span class="hljs-keyword">e</span>.data.offre.ville, 
                                    is_favoris: 0, 
                                    region: <span class="hljs-keyword">e</span>.data.offre.region
                                }
                            ]
                            , 0);

                        winOffre.<span class="hljs-keyword">open</span>();
                    }
                    catch(<span class="hljs-keyword">e</span>){}
                }
            }
        );
    }

    <span class="hljs-comment">// register for push notification on cloud server</span>
    function registerForPush(deviceToken) {
        <span class="hljs-comment">//alert('token : ' + deviceToken);</span>
        Cloud.PushNotifications.subscribe(
            {
                channel : 'emploitic_channel',
                device_token : deviceToken,
                <span class="hljs-keyword">type</span>: 'ios'
            }, 
            function(<span class="hljs-keyword">e</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.success) {
                    Ti.<span class="hljs-keyword">App</span>.Properties.setString('registredForPush', true);
                    Ti.API.info('Success :' + ((<span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span> &amp;&amp; <span class="hljs-keyword">e</span>.message) || JSON.stringify(<span class="hljs-keyword">e</span>)));
                }
                <span class="hljs-keyword">else</span> {
                    Ti.API.info('<span class="hljs-keyword">Error</span>:' + ((<span class="hljs-keyword">e</span>.<span class="hljs-keyword">error</span> &amp;&amp; <span class="hljs-keyword">e</span>.message) || JSON.stringify(<span class="hljs-keyword">e</span>)));
                }
            }
        );
    }
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="April 27th 2013, 5:08:23 pm">April 27th 2013</span>
											by <span class='authorname'>Djamel ZAHAL</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I have the same problem where the alert doesn&#39;t fire on android when receiving a push notice</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 7th 2013, 1:52:12 am">August 7th 2013</span>
											by <span class='authorname'>Bastien Koert</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>baddies</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 5th 2014, 12:38:50 pm">May 5th 2014</span>
											by <span class='authorname'>Steffen Brem</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>2</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
