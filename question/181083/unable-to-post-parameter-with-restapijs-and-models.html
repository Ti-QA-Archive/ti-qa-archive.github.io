<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Unable to post parameter with restapi.js and models Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Unable to post parameter with restapi.js and models</h1>
		</header>
		<section>
			<p>I am trying to fetch states where i have to post my countryId to the web service</p>
<pre><code class="hljs"><span class="hljs-comment">// My controller file</span>
<span class="hljs-keyword">var</span> state = Alloy.createCollection(<span class="hljs-string">'states'</span>);
<span class="hljs-comment">// set up some attributes to send for the create</span>
<span class="hljs-keyword">var</span> atts = {
    countryId : <span class="hljs-string">"95"</span>
};

<span class="hljs-comment">// success and error callbacks</span>
<span class="hljs-keyword">var</span> opts = {
    success : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">responseJSON, responseText</span>) </span>{
        Ti.API.info(<span class="hljs-built_in">JSON</span>.stringify(responseJSON));
        <span class="hljs-comment">//    Ti.API.info('_id (server generated): ' + responseJSON.id);</span>

    },
    error : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">responseJSON, responseText</span>) </span>{
        <span class="hljs-comment">// already taken care of in restapi</span>
        alert(responseText);
    }
};

<span class="hljs-comment">// POST the new user</span>
state.create(atts, opts);
</code></pre><pre><code class="hljs"><span class="hljs-comment">//My model file</span>
exports.definition = {
    config : {
        <span class="hljs-string">"URL"</span> : Alloy.Globals.api_states,
        <span class="hljs-string">"debug"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-string">"adapter"</span> : {
            <span class="hljs-string">"type"</span> : <span class="hljs-string">"restapi"</span>,
            <span class="hljs-string">"collection_name"</span> : <span class="hljs-string">"states"</span>,
            <span class="hljs-string">"idAttribute"</span> : <span class="hljs-string">"id"</span>
        },
        <span class="hljs-string">"headers"</span> : {
            <span class="hljs-string">"api_key"</span>: <span class="hljs-string">"Alloy.Globals.api_key"</span>
        }
        <span class="hljs-comment">//"parentNode": "news.domestic" //your root node</span>
    },
    extendModel : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Model)</span> </span>{
        _.extend(Model.prototype, {});
        <span class="hljs-keyword">return</span> Model;
    },
    extendCollection : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(Collection)</span> </span>{
        _.extend(Collection.prototype, {});
        <span class="hljs-keyword">return</span> Collection;
    }
};
</code></pre><pre><code class="hljs">// <span class="hljs-operator">the</span> response which i am getting <span class="hljs-built_in">from</span> server <span class="hljs-keyword">if</span> <span class="hljs-operator">the</span> parameter are <span class="hljs-operator">not</span> received <span class="hljs-command"><span class="hljs-keyword">on</span> <span class="hljs-title">server</span> <span class="hljs-title">side</span></span>
{<span class="hljs-string">"countryId"</span>:<span class="hljs-string">"95"</span>,<span class="hljs-string">"status"</span>:[{<span class="hljs-string">"response"</span>:<span class="hljs-string">"error"</span>,<span class="hljs-string">"message"</span>:<span class="hljs-string">"States Access Denied."</span>}],<span class="hljs-string">"id"</span>:<span class="hljs-string">"5742981e-8db2-8354-5d1f-0213cef13986"</span>}
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="February 25th 2015, 5:35:38 am">February 25th 2015</span>
				by <span class='authorname'>Hardik Amal</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>alloy</span></li>
					
						<li><span class='tagname'>collection</span></li>
					
						<li><span class='tagname'>model</span></li>
					
						<li><span class='tagname'>restapi.js</span></li>
					
						<li><span class='tagname'>titanium</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-286107">
				
						<section>
							<p>I think this line</p>
<pre><code class="hljs"><span class="hljs-string">"api_key"</span>: <span class="hljs-string">"Alloy.Globals.api_key"</span>
</code></pre><p>is your problem.  The backbone model will not know how to deal with the api key in your Alloy globals.  It is most likely sending that string of characters and NOT the actual key.    </p>
<p>If you look at the restapi.js source it tries to resolve the headers like this</p>
<pre><code class="hljs">for (var header in _options.headers) {
// use value or function to return value
xhr.setRequestHeader(header, <span class="hljs-emphasis">_.isFunction(_</span>options.headers[<span class="hljs-link_label">header</span>]) ? <span class="hljs-emphasis">_options.headers[header]() : _</span>options.headers[header]);
}
</code></pre><p>Which is basically saying, is the vaue of your header a function (No, in this case, because its not a function), else it send the exact STRING</p>
<p>So, try this</p>
<pre><code class="hljs"><span class="hljs-string">"api_key"</span>:  <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">return</span> Alloy.Globals.api_key;
}
</code></pre><p>I&#39;m not totally sure if this will work either, unless the Alloy namespace is accessible from the model file</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 25th 2015, 6:48:24 am">February 25th 2015</span>
								by <span class='authorname'>Nick Milner</span><br>
								<a class="icon-bg icon-link" href="../../question/181083/unable-to-post-parameter-with-restapijs-and-models.html#answer-286107" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
