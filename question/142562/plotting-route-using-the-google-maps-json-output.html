<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Plotting route using the google maps JSON output » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Plotting route using the google maps JSON output</h1>
		</header>
		<section>
			<p>I&#39;m using the google maps JSON output:</p>
<pre><code class="hljs"><span class="hljs-symbol">http:</span>/<span class="hljs-regexp">/maps.googleapis.com/maps</span><span class="hljs-regexp">/api/directions</span><span class="hljs-regexp">/json?origin=Sheffield&amp;waypoints=london&amp;sensor=false</span>
</code></pre><p>I have managed to plot a route but the problem is that the route is very rough and doesn&#39;t follow the road like I want it to.</p>
<pre><code class="hljs">self.createRoute = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

        <span class="hljs-keyword">var</span> url = <span class="hljs-string">'http://maps.googleapis.com/maps/api/directions/json?origin=Sheffield&amp;waypoints=london&amp;sensor=false'</span>, 
                    xhr = Titanium.Network.createHTTPClient();


        xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{
            <span class="hljs-keyword">var</span> mapObj = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.responseText),
                points = [],
                steps = mapObj.routes[<span class="hljs-number">0</span>].legs[<span class="hljs-number">0</span>].steps;

            <span class="hljs-keyword">for</span> (x <span class="hljs-keyword">in</span> steps) 
            {
                <span class="hljs-keyword">if</span> (steps.length &gt; <span class="hljs-number">1</span>)
                {
                    <span class="hljs-keyword">var</span> lat = steps[x].start_location.lat,
                        lon = steps[x].start_location.lng,
                        lat2 = steps[x].end_location.lat,
                        lon2 = steps[x].end_location.lng;

                    <span class="hljs-keyword">var</span> startObj = {latitude:lat,longitude:lon},
                        endObj = {latitude:lat2,longitude:lon2};

                    points.push(startObj, endObj);
                }    
            }

            <span class="hljs-keyword">var</span> route = {
                name:<span class="hljs-string">"bonVoyage"</span>,
                points:points,
                color:<span class="hljs-string">"blue"</span>,
                width:<span class="hljs-number">6</span>
            };

            self.mapView.addRoute(route);

        };

        xhr.open(<span class="hljs-string">'GET'</span>,url);
        xhr.send();  

    }
</code></pre><p>How can I get a more detailed route? Is this all I will ever get? The json that is output from google doesn&#39;t seem to have that many points in it so could this be it? </p>
<p>Thanks, James</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="September 22nd 2012, 5:08:37 pm">September 22nd 2012</span>
				by <span class='authorname'>james thompson</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>googlemaps</span></li>
					
						<li><span class='tagname'>iphone</span></li>
					
						<li><span class='tagname'>maps</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>James, </p>
<p>Indeed, the larger the sample, the better the accuracy.<br>Geocoding used to have an accuracy value, and elevation has resolution.<br>But in the v3, I&#39;m not seeing a setting for the directions.</p>
</div>
							<div class="author">
								&mdash; commented <span title="September 22nd 2012, 7:35:13 pm">September 22nd 2012</span>
								by <span class='authorname'>Stephen Feather</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-247857">
				
						<section>
							<p>You can Download a Module from the market for Free which will do it for you.</p>
<p>Search for <code>google directions</code></p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 23rd 2012, 5:46:09 am">September 23rd 2012</span>
								by <span class='authorname'>Alexander Bauer</span><br>
								<a class="icon-bg icon-link" href="question/142562/plotting-route-using-the-google-maps-json-output#answer-247857" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-247859">
				
						<section>
							<p>The directions returned from Google includes what looks like a meaningless string called points, this contains the complete path in a very compressed format, some googling will tell you how its done and it is quite clever.</p>
<p>To decode it I use the following code:</p>
<pre><code class="hljs">polyline = <span class="hljs-type">JSON</span>.parse(xhr.responseText).routes[<span class="hljs-number">0</span>].overview_polyline.points;

polyPoints = decodeLine(polyline);

polyLineOverlayDef = {
    name: <span class="hljs-string">"Directions"</span>,
    points : polyPoints,
    color : <span class="hljs-string">"red"</span>,
    width:<span class="hljs-number">2</span> * scale,
};

mapView.addRoute(polyLineOverlayDef);

function decodeLine (encoded) {
    <span class="hljs-keyword">var</span> len = encoded.length;
    <span class="hljs-keyword">var</span> index = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> <span class="hljs-type">array</span> = [];
    <span class="hljs-keyword">var</span> lat = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">var</span> lng = <span class="hljs-number">0</span>;

    <span class="hljs-keyword">while</span> (index &lt; len) {
        <span class="hljs-keyword">var</span> b;
        <span class="hljs-keyword">var</span> shift = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">var</span> <span class="hljs-literal">result</span> = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">do</span> {
            b = encoded.charCodeAt(index++) - <span class="hljs-number">63</span>;
            <span class="hljs-literal">result</span> |= (b &amp; <span class="hljs-number">0x1f</span>) &lt;&lt; shift;
            shift += <span class="hljs-number">5</span>;
        } <span class="hljs-keyword">while</span> (b &gt;= <span class="hljs-number">0x20</span>);
        <span class="hljs-keyword">var</span> dlat = ((<span class="hljs-literal">result</span> &amp; <span class="hljs-number">1</span>) ? ~(<span class="hljs-literal">result</span> &gt;&gt; <span class="hljs-number">1</span>) : (<span class="hljs-literal">result</span> &gt;&gt; <span class="hljs-number">1</span>));
        lat += dlat;

        shift = <span class="hljs-number">0</span>;
        <span class="hljs-literal">result</span> = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">do</span> {
            b = encoded.charCodeAt(index++) - <span class="hljs-number">63</span>;
            <span class="hljs-literal">result</span> |= (b &amp; <span class="hljs-number">0x1f</span>) &lt;&lt; shift;
            shift += <span class="hljs-number">5</span>;
        } <span class="hljs-keyword">while</span> (b &gt;= <span class="hljs-number">0x20</span>);
        <span class="hljs-keyword">var</span> dlng = ((<span class="hljs-literal">result</span> &amp; <span class="hljs-number">1</span>) ? ~(<span class="hljs-literal">result</span> &gt;&gt; <span class="hljs-number">1</span>) : (<span class="hljs-literal">result</span> &gt;&gt; <span class="hljs-number">1</span>));
        lng += dlng;

        <span class="hljs-type">array</span>.push({longitude:lng * <span class="hljs-number">1</span>e-<span class="hljs-number">5</span>, latitude:lat * <span class="hljs-number">1</span>e-<span class="hljs-number">5</span>});
    }

    <span class="hljs-keyword">return</span> <span class="hljs-type">array</span>;
}
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 23rd 2012, 8:52:54 am">September 23rd 2012</span>
								by <span class='authorname'>Derrick Huth</span><br>
								<a class="icon-bg icon-link" href="question/142562/plotting-route-using-the-google-maps-json-output#answer-247859" rel="permalink">permalink</a>
							</div>

							<h5>5 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Excellent! This works very well. Is there no way I can improve the resolution of the polyline somehow its a lot better but it could still be a little smoother?</p>
<p>Thanks for this though, highly appreciated!</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 23rd 2012, 9:20:16 pm">September 23rd 2012</span>
											by <span class='authorname'>james thompson</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>You&#39;re very welcome, no unfortunately that is all the detail that Google returns.</p>
<p>The steps array that you referenced is the points that have a navigational instruction attached to them, the points string is the line that should follow the map.  The only thing you could try (I have not tried this, so no gaurantee!) is for each consecutive pair of steps send them back to Google asking for a route, you will get a one step direction, but you might get a more detaild points string..</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 23rd 2012, 9:33:29 pm">September 23rd 2012</span>
											by <span class='authorname'>Derrick Huth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I might have to go down this &#39;route&#39; (lol) as large routes don&#39;t seem to plot :&#x2F; . When I run the query in the browser I do get a huge polyline &#39;code&#39; but it just doesn&#39;t seem to plot it.</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 24th 2012, 8:41:11 pm">September 24th 2012</span>
											by <span class='authorname'>james thompson</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Right actually, got it to work. I think I was just looking at the wrong part of the map :&#x2F; stupid. But the route is very very low res… Google has a limit in place 100 elements per query… 100 elements per 10 seconds… So doubts getting pairs of points and routing them will work :&#x2F;</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 24th 2012, 9:00:51 pm">September 24th 2012</span>
											by <span class='authorname'>james thompson</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Oh well, sorry that didn&#39;t work out.  In that case you probably are limited to the route as provided in the initial query.</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 24th 2012, 9:23:31 pm">September 24th 2012</span>
											by <span class='authorname'>Derrick Huth</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
