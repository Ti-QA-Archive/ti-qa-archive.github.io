<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>How do I pass result from xhr.onload function to variable? » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>How do I pass result from xhr.onload function to variable?</h1>
		</header>
		<section>
			<p>This is a module in my iPhone app. It&#39;s purpose is to return an array&lt;Ti.UI.TableViewRow&gt; from a JSON responeText, which can then be added to the data property of an TableView in another module.</p>
<p>Being relatively new to JavaScript I can&#39;t find the right syntax to pass my array to the variable self.</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Events</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> self = [];

    <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();
    xhr.open(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'http://localhost/ngparser/events.php'</span>);

    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> events = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.responseText),
            rows = [];

        Ti.API.info(<span class="hljs-string">'JSON responseText: '</span>);
        Ti.API.info(events);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> events) {
            <span class="hljs-keyword">var</span> id = events[i].id,
                title = events[i].title;            

            <span class="hljs-keyword">var</span> amp = title.search(<span class="hljs-string">'&amp;amp;'</span>);
            <span class="hljs-keyword">if</span> (amp != -<span class="hljs-number">1</span>) {
                title = title.replace(<span class="hljs-string">'&amp;amp;'</span>, <span class="hljs-string">'&amp;'</span>);
            }

            <span class="hljs-keyword">var</span> row = Ti.UI.createTableViewRow({
                title: title,
                hasChild: <span class="hljs-literal">true</span>
            });
            rows.push(row);            
        }

        <span class="hljs-comment">// I want this...</span>
        <span class="hljs-keyword">return</span> rows;        
    };

    xhr.send();
    self = <span class="hljs-comment">//... to end up here!</span>
    self = xhr.send(); <span class="hljs-comment">//Does not work</span>
    <span class="hljs-keyword">return</span> self;
}

<span class="hljs-built_in">module</span>.exports = Events;
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="March 16th 2012, 12:25:00 pm">March 16th 2012</span>
				by <span class='authorname'>Gabriel Smoljar</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>httpclient</span></li>
					
						<li><span class='tagname'>ios</span></li>
					
						<li><span class='tagname'>iphone</span></li>
					
						<li><span class='tagname'>json</span></li>
					
						<li><span class='tagname'>xhr</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>A solution was eventually found in the bottom of this thread.</p>
</div>
							<div class="author">
								&mdash; commented <span title="March 16th 2012, 8:27:29 pm">March 16th 2012</span>
								by <span class='authorname'>Gabriel Smoljar</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>4</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>4 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-233555">
				
						<section>
							<p>you need to add a callback function to the module and execute the function on the onload event. Something like this would work</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Network</span>(<span class="hljs-params">_args, callback</span>)</span>{

    <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient({
        timeout: <span class="hljs-number">20000</span>
    });

    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
        <span class="hljs-keyword">var</span> json = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.responseText);
        callback.call(<span class="hljs-keyword">this</span>, json);
    };
    xhr.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{ 
    };

           xhr.open(_args.requestType, Ti.App.Properties.getString(<span class="hljs-string">'URL'</span>) + _args.URI);
        xhr.send(_args.functionValues);
    }

};

<span class="hljs-built_in">module</span>.exports = Network;
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 16th 2012, 12:38:37 pm">March 16th 2012</span>
								by <span class='authorname'>Arian Caraballo</span><br>
								<a class="icon-bg icon-link" href="../../question/133913/how-do-i-pass-result-from-xhronload-function-to-variable.html#answer-233555" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>callback can be any function you want on to execute onload event. </p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> net   = <span class="hljs-built_in">require</span>(<span class="hljs-string">'/library/services/network'</span>);

<span class="hljs-keyword">new</span> net(netParams, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">_data</span>)</span>{
    parseData(_data);<span class="hljs-comment">//&lt;&lt;&lt;--- callback function</span>
});
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseData</span>(<span class="hljs-params">events</span>)</span>{

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> events) {
            <span class="hljs-keyword">var</span> id = events[i].id,
                title = events[i].title;            

            <span class="hljs-keyword">var</span> amp = title.search(<span class="hljs-string">'&amp;'</span>);
            <span class="hljs-keyword">if</span> (amp != -<span class="hljs-number">1</span>) {
                title = title.replace(<span class="hljs-string">'&amp;'</span>, <span class="hljs-string">'&amp;'</span>);
            }

            <span class="hljs-keyword">var</span> row = Ti.UI.createTableViewRow({
                title: title,
                hasChild: <span class="hljs-literal">true</span>
            });
            rows.push(row);         
        }
}
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 12:44:52 pm">March 16th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233569">
				
						<section>
							<p>Ok do this for testing </p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eventsCallback</span><span class="hljs-params">(rows)</span> </span>{
    Ti.API.info(rows)
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">EventsWindow</span><span class="hljs-params">(title)</span> </span>{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = Ti.UI.createWindow({
        title:title,
        backgroundColor:<span class="hljs-string">'white'</span>
    });

    <span class="hljs-keyword">var</span> Events = <span class="hljs-keyword">require</span>(<span class="hljs-string">'Events'</span>),
        events = <span class="hljs-keyword">new</span> Events(eventsCallback);


    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;<span class="hljs-comment">//&lt;&lt;-- I wasnt talking about this return</span>
};

module.exports = EventsWindow;
</code></pre><pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Events</span><span class="hljs-params">(callback)</span> </span>{ 
    <span class="hljs-keyword">var</span> self = [];

    <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();
    xhr.open(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'www.google.com'</span>);

    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{    
        <span class="hljs-keyword">callback</span>(<span class="hljs-keyword">this</span>.responseText);
    }
}

module.exports = Events;
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 16th 2012, 3:08:54 pm">March 16th 2012</span>
								by <span class='authorname'>Arian Caraballo</span><br>
								<a class="icon-bg icon-link" href="../../question/133913/how-do-i-pass-result-from-xhronload-function-to-variable.html#answer-233569" rel="permalink">permalink</a>
							</div>

							<h5>10 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>this should print google&#39;s html markup</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 3:09:42 pm">March 16th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>nope, still no output</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 3:16:45 pm">March 16th 2012</span>
											by <span class='authorname'>Gabriel Smoljar</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>duh… forgot the send function</p>
<p><code>xhr.send();</code></p>
<p>my bad</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Events</span><span class="hljs-params">(callback)</span> </span>{ 
    <span class="hljs-keyword">var</span> self = [];

    <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();
    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{    
        <span class="hljs-keyword">callback</span>(<span class="hljs-keyword">this</span>.responseText);
    }
    xhr.open(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'www.google.com'</span>);
    xhr.send();
}

module.exports = Events;
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 3:19:12 pm">March 16th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>same with the other. There is no send function</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 3:20:06 pm">March 16th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Great now your test work, and I get console output from my own function. Still no TableView though. http:&#x2F;&#x2F;pastebin.com&#x2F;1kdga075 http:&#x2F;&#x2F;pastebin.com&#x2F;bQVi55Pn</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 3:31:56 pm">March 16th 2012</span>
											by <span class='authorname'>Gabriel Smoljar</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>oh wait no, no output from the callback, just onload</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 3:34:37 pm">March 16th 2012</span>
											by <span class='authorname'>Gabriel Smoljar</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>tried hello world from the callback, didn&#39;t work</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 3:35:49 pm">March 16th 2012</span>
											by <span class='authorname'>Gabriel Smoljar</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>put your current class and your current call here</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 3:37:30 pm">March 16th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>by the way, the output from google was error 404 (with markup and all)</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 3:37:32 pm">March 16th 2012</span>
											by <span class='authorname'>Gabriel Smoljar</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>here this works i made a test app and it works fine you get the markup for this page</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> net = <span class="hljs-built_in">require</span>(<span class="hljs-string">'/ui/network'</span>);

<span class="hljs-keyword">var</span> win = ti.Window();


{<span class="hljs-comment">//NET TEST</span>

            <span class="hljs-keyword">var</span> netParams = {
                <span class="hljs-string">'requestType'</span>: <span class="hljs-string">'GET'</span>,
                <span class="hljs-string">'URL'</span>: <span class="hljs-string">'http://developer.appcelerator.com/question/133913/how-do-i-pass-result-from-xhronload-function-to-variable#comment-118978'</span>
            };
            <span class="hljs-keyword">new</span> net(netParams, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">response</span>)</span>{
                Ti.API.info(response)
            });

}
</code></pre><p>your net module:</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Network</span><span class="hljs-params">(_args, callback)</span></span>{

    <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient({
        timeout: <span class="hljs-number">15000</span>
    });

    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{

        <span class="hljs-keyword">callback</span>(<span class="hljs-keyword">this</span>.responseText)

    };

    xhr.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{ 
        Ti.API.info(<span class="hljs-string">'Error'</span>);

    };

    xhr.open(_args.requestType, _args.URL);
    xhr.send();

};

module.exports = Network;
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 3:51:52 pm">March 16th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233554">
				
						<section>
							<pre><code class="hljs">functon Events(<span class="hljs-keyword">callback</span>) {
    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> events = JSON.parse(<span class="hljs-keyword">this</span>.responseText),
            rows = [];

        Ti.API.info(<span class="hljs-string">'JSON responseText: '</span>);
        Ti.API.info(events);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> events) {
            <span class="hljs-keyword">var</span> id = events[i].id,
                title = events[i].title;            

            <span class="hljs-keyword">var</span> amp = title.search(<span class="hljs-string">'&amp;'</span>);
            <span class="hljs-keyword">if</span> (amp != -<span class="hljs-number">1</span>) {
                title = title.replace(<span class="hljs-string">'&amp;'</span>, <span class="hljs-string">'&amp;'</span>);
            }

            <span class="hljs-keyword">var</span> row = Ti.UI.createTableViewRow({
                title: title,
                hasChild: <span class="hljs-literal">true</span>
            });
            rows.push(row);         
        }

        <span class="hljs-comment">// I want this...</span>
        <span class="hljs-keyword">callback</span>(rows);
}
</code></pre><p>You need a callback function. The callback function is a function which will look like this:</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doSomethingWithData</span><span class="hljs-params">(data)</span> </span>{
    <span class="hljs-comment">// code to handle data here</span>
}

<span class="hljs-comment">// and this is how you call the Events function</span>
Events(doSomethingWithData);
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 16th 2012, 12:36:46 pm">March 16th 2012</span>
								by <span class='authorname'>Lucian Pacurar</span><br>
								<a class="icon-bg icon-link" href="../../question/133913/how-do-i-pass-result-from-xhronload-function-to-variable.html#answer-233554" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>I get this error:</p>
<pre><code class="hljs">[ERROR] Invalid <span class="hljs-keyword">type</span> passed <span class="hljs-keyword">to</span> <span class="hljs-function"><span class="hljs-keyword">function</span>. <span class="hljs-title">expected</span>:</span> NSArray <span class="hljs-keyword">or</span> <span class="hljs-keyword">nil</span>, was: __NSCFDictionary  <span class="hljs-keyword">in</span> -[TiUITableViewProxy setData:withObject:immediate:] (TiUITableViewProxy.m:<span class="hljs-number">652</span>)
[ERROR] Script Error = Invalid <span class="hljs-keyword">type</span> passed <span class="hljs-keyword">to</span> <span class="hljs-function"><span class="hljs-keyword">function</span>. <span class="hljs-title">expected</span>:</span> NSArray <span class="hljs-keyword">or</span> <span class="hljs-keyword">nil</span>, was: __NSCFDictionary  <span class="hljs-keyword">in</span> -[TiUITableViewProxy setData:withObject:immediate:] (TiUITableViewProxy.m:<span class="hljs-number">652</span>) at  (line <span class="hljs-number">14</span>).
</code></pre><p>This is the data module</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Events</span>(<span class="hljs-params">callback</span>) </span>{    
    <span class="hljs-keyword">var</span> self = [];

    <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();
    xhr.open(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'http://localhost/ngparser/events.php'</span>);

    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{        
        <span class="hljs-keyword">var</span> events = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.responseText);

        <span class="hljs-keyword">var</span> rows = [];

        Ti.API.info(<span class="hljs-string">'JSON responseText: '</span>);
        Ti.API.info(events);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> events) {
            <span class="hljs-keyword">var</span> id = events[i].id,
                title = events[i].title;            

            <span class="hljs-keyword">var</span> amp = title.search(<span class="hljs-string">'&amp;amp;'</span>);
            <span class="hljs-keyword">if</span> (amp != -<span class="hljs-number">1</span>) {
                title = title.replace(<span class="hljs-string">'&amp;amp;'</span>, <span class="hljs-string">'&amp;'</span>);
            }

            <span class="hljs-keyword">var</span> row = Ti.UI.createTableViewRow({
                title: title,
                hasChild: <span class="hljs-literal">true</span>
            });
            rows.push(row);
        }

        callback(rows);
    }

    <span class="hljs-comment">//return self;</span>
}

<span class="hljs-built_in">module</span>.exports = Events;
</code></pre><p>and this is my Window Module</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eventsCallback</span><span class="hljs-params">(rows)</span> </span>{
    <span class="hljs-keyword">return</span> rows;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">EventsWindow</span><span class="hljs-params">(title)</span> </span>{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = Ti.UI.createWindow({
        title:title,
        backgroundColor:<span class="hljs-string">'white'</span>
    });

    <span class="hljs-keyword">var</span> Events = <span class="hljs-keyword">require</span>(<span class="hljs-string">'Events'</span>),
        events = <span class="hljs-keyword">new</span> Events(eventsCallback);

    <span class="hljs-keyword">var</span> table = Ti.UI.createTableView({data: events});
    <span class="hljs-keyword">self</span>.add(table);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
};

module.exports = EventsWindow;
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 2:43:13 pm">March 16th 2012</span>
											by <span class='authorname'>Gabriel Smoljar</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>thas cause the events variable is not an array of rows. move your table variable to the eventsCallback and do <code>data: rows</code></p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 2:48:14 pm">March 16th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>and dont return since is a callback function return is not going to work the way you are usedto</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 2:50:05 pm">March 16th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>The modules again. No crashes or errors but xhr.onload don&#39;t seem to run since there&#39;s no output from the Ti.API.info calls . The server is working fine though.</p>
<p>Removing the return statement from EventsWindow crashes the application.</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eventsCallback</span><span class="hljs-params">(rows)</span> </span>{
    <span class="hljs-keyword">var</span> table = Ti.UI.createTableView({data: rows});
    <span class="hljs-keyword">self</span>.add(table);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">EventsWindow</span><span class="hljs-params">(title)</span> </span>{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = Ti.UI.createWindow({
        title:title,
        backgroundColor:<span class="hljs-string">'white'</span>
    });

    <span class="hljs-keyword">var</span> Events = <span class="hljs-keyword">require</span>(<span class="hljs-string">'Events'</span>),
        events = <span class="hljs-keyword">new</span> Events(eventsCallback);


    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
};

module.exports = EventsWindow;
</code></pre><pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Events</span>(<span class="hljs-params">callback</span>) </span>{    
    <span class="hljs-keyword">var</span> self = [];

    <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();
    xhr.open(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'http://localhost/ngparser/events.php'</span>);

    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{        
        <span class="hljs-keyword">var</span> events = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.responseText);

        <span class="hljs-keyword">var</span> rows = [];

        Ti.API.info(<span class="hljs-string">'JSON responseText: '</span>);
        Ti.API.info(events);

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> events) {
            <span class="hljs-keyword">var</span> id = events[i].id,
                title = events[i].title;            

            <span class="hljs-keyword">var</span> amp = title.search(<span class="hljs-string">'&amp;amp;'</span>);
            <span class="hljs-keyword">if</span> (amp != -<span class="hljs-number">1</span>) {
                title = title.replace(<span class="hljs-string">'&amp;amp;'</span>, <span class="hljs-string">'&amp;'</span>);
            }

            <span class="hljs-keyword">var</span> row = Ti.UI.createTableViewRow({
                title: title,
                hasChild: <span class="hljs-literal">true</span>
            });
            rows.push(row);            
        }

        callback(rows);
    }
    <span class="hljs-comment">//return self;</span>
}

<span class="hljs-built_in">module</span>.exports = Events;
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 3:03:08 pm">March 16th 2012</span>
											by <span class='authorname'>Gabriel Smoljar</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233580">
				
						<section>
							<p>I&#39;m making som progress. I&#39;ve added a info(rows.length) after rows is filled in Events and one in eventsCallback() in EventsWindow. Both output a valid number. The issue seems to be that the TableView is not added to the window and&#x2F;or not filled with the rows in variable rows.</p>
<p>I understand if you think this is now a new topic and I should create a new question, if so, please tell.</p>
<p>Thank you for your patience Arian and Lucian!</p>
<p>Events():</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">Events</span>(<span class="hljs-params">callback</span>) </span>{    
    <span class="hljs-keyword">var</span> self = [];

    <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient({
        onload: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> events = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.responseText);

            Ti.API.info(<span class="hljs-string">'JSON responseText: '</span>);
            Ti.API.info(events);

            <span class="hljs-keyword">var</span> rows = [];

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i <span class="hljs-keyword">in</span> events) {
                <span class="hljs-keyword">var</span> id = events[i].id,
                    title = events[i].title;            

                <span class="hljs-keyword">var</span> amp = title.search(<span class="hljs-string">'&amp;amp;'</span>);
                <span class="hljs-keyword">if</span> (amp != -<span class="hljs-number">1</span>) {
                    title = title.replace(<span class="hljs-string">'&amp;amp;'</span>, <span class="hljs-string">'&amp;'</span>);
                }

                <span class="hljs-keyword">var</span> row = Ti.UI.createTableViewRow({
                    title: title,
                    hasChild: <span class="hljs-literal">true</span>
                });
                rows.push(row);            
            }
            Ti.API.info(rows.length); <span class="hljs-comment">//Output: 6</span>
            callback(rows);
        }
    });

    xhr.open(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'http://localhost/ngparser/events.php'</span>);    
    xhr.send();
}

<span class="hljs-built_in">module</span>.exports = Events;
</code></pre><p>EventsWindow():</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eventsCallback</span><span class="hljs-params">(rows)</span> </span>{
    Ti.API.info(rows.length); <span class="hljs-comment">//Output: 6</span>
    <span class="hljs-keyword">var</span> table = Ti.UI.createTableView({data: rows}); <span class="hljs-comment">//But no table is to be seen</span>
    <span class="hljs-keyword">self</span>.add(table);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">EventsWindow</span><span class="hljs-params">(title)</span> </span>{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = Ti.UI.createWindow({
        title:title,
        backgroundColor:<span class="hljs-string">'white'</span>
    });    

    <span class="hljs-keyword">var</span> Events = <span class="hljs-keyword">require</span>(<span class="hljs-string">'Events'</span>),
        events = <span class="hljs-keyword">new</span> Events(eventsCallback);        

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
};

module.exports = EventsWindow;
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 16th 2012, 5:16:32 pm">March 16th 2012</span>
								by <span class='authorname'>Gabriel Smoljar</span><br>
								<a class="icon-bg icon-link" href="../../question/133913/how-do-i-pass-result-from-xhronload-function-to-variable.html#answer-233580" rel="permalink">permalink</a>
							</div>

							<h5>10 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>make sure you are opening the window</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 5:24:20 pm">March 16th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>did you tyr my last post why dont you build the entire table on the call back method instead of on the Events Class?. that way you can use your event Class for other calls.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 5:26:39 pm">March 16th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>look at the first sample that I posted is right under your initial post. just use the Events module to return the response via the callback function</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 5:30:19 pm">March 16th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>The window is returned to a TabGroup which is opened in the bootstrap. The app is based on the Tabbed Application template.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 5:33:03 pm">March 16th 2012</span>
											by <span class='authorname'>Gabriel Smoljar</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>one more thing can you see the response from your &#39;http:&#x2F;&#x2F;localhost&#x2F;ngparser&#x2F;events.php&#39;, cause I dont remember if is the IOS sim or the android Emu the one that doesnt work with local host.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 5:36:32 pm">March 16th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Finally got my table. As you can see I moved the window out of EventsWindow() and filled it&#39;s properties in eventsCallback().</p>
<p>Being new to Ti, I have som doubts on whether this is a &quot;valid&quot; solution.</p>
<pre><code class="hljs">
<span class="hljs-keyword">var</span> win = Ti.UI.createWindow();

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eventsCallback</span><span class="hljs-params">(rows)</span> </span>{
    Ti.API.info(rows.length);
    <span class="hljs-keyword">var</span> table = Ti.UI.createTableView({data: rows});
    win.add(table);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">EventsWindow</span><span class="hljs-params">(title)</span> </span>{

    win.setTitle(title);
    win.setBackgroundColor(<span class="hljs-string">'white'</span>);

    <span class="hljs-keyword">var</span> Events = <span class="hljs-keyword">require</span>(<span class="hljs-string">'Events'</span>),
        events = <span class="hljs-keyword">new</span> Events(eventsCallback);        

    <span class="hljs-keyword">self</span> = win;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
};

module.exports = EventsWindow;
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 5:43:03 pm">March 16th 2012</span>
											by <span class='authorname'>Gabriel Smoljar</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>yes thats fine sry didnt see that. What you need to do is move the callback inside the EventsWindow function </p>
<pre><code class="hljs">

<span class="php"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">EventsWindow</span><span class="hljs-params">(title)</span> </span>{
    <span class="hljs-keyword">var</span> win = Ti.UI.createWindow({
        title:title,
        backgroundColor: <span class="hljs-string">'#fff'</span>
    });

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">eventsCallback</span><span class="hljs-params">(rows)</span> </span>{
        Ti.API.info(rows.length);
        <span class="hljs-keyword">var</span> table = Ti.UI.createTableView({data: rows});
        win.add(table);
    }

    <span class="hljs-keyword">var</span> Events = <span class="hljs-keyword">require</span>(<span class="hljs-string">'Events'</span>),
        events = <span class="hljs-keyword">new</span> Events(eventsCallback);        

    <span class="hljs-keyword">self</span> = win;
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
};

module.exports = EventsWindow;</span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 6:08:35 pm">March 16th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>this way the callback function is part of the EventsWindow instance</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 6:13:01 pm">March 16th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Works great now, thanks again Arian!</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 16th 2012, 8:26:58 pm">March 16th 2012</span>
											by <span class='authorname'>Gabriel Smoljar</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>No problem. When you get a chance can you check the question as answer. Good luck with ur app</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 17th 2012, 3:12:12 am">March 17th 2012</span>
											by <span class='authorname'>Arian Caraballo</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
