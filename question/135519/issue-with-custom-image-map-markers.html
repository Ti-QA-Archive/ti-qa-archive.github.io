<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Issue with Custom Image Map Markers » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Issue with Custom Image Map Markers</h1>
		</header>
		<section>
			<p>Hope I can make this easy to understand. Basically I am using the latest version of titanium and placing multiple pin markers onto a google map using a custom image for the marker. I load the pin locations into an array (from a JSON file) to display them on the map. I have different pin images displayed to represent different location categories ie. attraction, historic building etc.</p>
<p>All seems to work well except for one strange issue. Initially all the map markers and images are displayed correctly. However, after scrolling around the map and clicking on different map pins, the custom map marker images randomly shuffle around( i.e. an attraction pin image changes to a historic building pin image). The pin coordinates, title, subtitle etc all stay correct but with a different pin image… really strange… </p>
<p>Here&#39;s a snippet from the loop that creates the annotation:</p>
<p>note that the variables (map.lat, map.longt, map.name. street, map.catPin etc are all loaded from the JSON file) - seems pretty straight forward right??? </p>
<pre><code class="hljs"><span class="hljs-tag">mapview</span><span class="hljs-class">.addAnnotation</span>({
                 <span class="hljs-attribute">latitude</span>: map.lat,
                 <span class="hljs-attribute">longitude</span>: map.longt,
                 <span class="hljs-attribute">title</span>: map.name,
                 <span class="hljs-attribute">subtitle</span>: street,
                 <span class="hljs-attribute">animate</span>: true,
                 <span class="hljs-attribute">image</span>: <span class="hljs-string">'images/'</span>+map.catPin,
                 <span class="hljs-attribute">latID</span>: map.lat,
                 <span class="hljs-attribute">longID</span>: map.longt,
                 <span class="hljs-attribute">rightButton</span>: <span class="hljs-string">'images/exploreBut.png'</span>,
                 <span class="hljs-attribute">leftButton</span>: <span class="hljs-string">'images/smallCloseBut.png'</span>,
                 <span class="hljs-attribute">pID</span>: map.id
             });
</code></pre><p>has anyone seen any similar issues before??</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="April 17th 2012, 2:13:03 pm">April 17th 2012</span>
				by <span class='authorname'>Josh Cowdrey</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>annotation</span></li>
					
						<li><span class='tagname'>custom image</span></li>
					
						<li><span class='tagname'>mapview</span></li>
					
						<li><span class='tagname'>titanium</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>sorry, should mention I&#39;m building this for an IOS iPad application</p>
</div>
							<div class="author">
								&mdash; commented <span title="April 17th 2012, 2:14:30 pm">April 17th 2012</span>
								by <span class='authorname'>Josh Cowdrey</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-236348">
				
						<section>
							<p>Maybe is a bug, try to set all the annotations at once, and not to add one by one how you are doing now.<br>if that works you should fill a bug to Appcelerator.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 17th 2012, 2:23:41 pm">April 17th 2012</span>
								by <span class='authorname'>Dan Tamas</span><br>
								<a class="icon-bg icon-link" href="question/135519/issue-with-custom-image-map-markers#answer-236348" rel="permalink">permalink</a>
							</div>

							<h5>8 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Thanks Dan for the suggestion. I changed the code to add all annotations into an array and then load the array into the map view… still no change in the result… all loads ok the first time… then any repeat of the function has strange results… like I said, all the annotations have the correct lat&#x2F;long, titles, subtitles etc etc, but are assigned a random pin image…. very strange… I guess I&#39;ll have to log it as a bug… as a side note, I tested using the 3 built in pin colours (not a custom image) and it seemed to work fine… seemed to keep consistent pin colours… strange that it won&#39;t do the same with an image… I&#39;ve also noticed that the animations don&#39;t seem to work when using an image instead of pincolor… that&#39;s strange also.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 17th 2012, 3:34:45 pm">April 17th 2012</span>
											by <span class='authorname'>Josh Cowdrey</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Wait a second, you repeat the function? In this case try first to remove all the previous annotation from the map before you re-add the new ones.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 17th 2012, 3:37:21 pm">April 17th 2012</span>
											by <span class='authorname'>Dan Tamas</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Yeah I tried that too…. here&#39;s the code for the first half of my function… pls excuse all the commented out lines where I&#39;ve been playing around :)</p>
<pre><code class="hljs">function showAnnotations(appID, <span class="hljs-variable">key</span>, mapLeft, l1, l2, l1a, l2a, catID, poiID,ant,antTitle) {

    var annotations, myAnt, xhr, json, <span class="hljs-built_in">map</span>, markers, name, street, catPin, id, city, i, row, lat, longt, id, pinImg, exploreBut, latID, longID, pID, url_map, state;

    <span class="hljs-comment">//mapview.removeAllAnnotations();</span>

    <span class="hljs-comment">//mapview.left = mapLeft;</span>
    <span class="hljs-comment">//mapview.region = {latitude: l1, longitude: l2, latitudeDelta: l1a, longitudeDelta: l2a};</span>
    <span class="hljs-comment">//mapview.animate = true;</span>
    <span class="hljs-comment">//mapview.regionFit = false;</span>
    <span class="hljs-comment">//mapview.mapType = Titanium.Map.HYBRID_TYPE;</span>
    <span class="hljs-comment">//mapview.annotations = annotations;</span>
    annotations = [];

    function removeAnnotations() {
        <span class="hljs-keyword">for</span> (i=annotations.length-<span class="hljs-number">1</span>; i&gt;=<span class="hljs-number">0</span>;i--) {
            mapview.removeAnnotation(annotations[i]);
        }
        annotations = [];
    }

    removeAnnotations();

    url_map = <span class="hljs-string">"http://data.seeitmyway.com.au/json-map.php?appID="</span>+appID+<span class="hljs-string">"&amp;catID="</span>+catID+<span class="hljs-string">"&amp;pID="</span>+poiID+<span class="hljs-string">"&amp;key="</span>+<span class="hljs-variable">key</span>;

    xhr = Ti.Network.createHTTPClient({
        onload: function() {
        <span class="hljs-comment">// Ti.API.debug(this.responseText);</span>
         i=<span class="hljs-number">0</span>;

        json = JSON.parse(<span class="hljs-keyword">this</span>.responseText);
        <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; json.markers.length; i++) {

            <span class="hljs-built_in">map</span> = json.markers[i];

            exploreBut = Ti.UI.createButton ({
                backgroundImage: <span class="hljs-string">'images/exploreBut.png'</span>,
                <span class="hljs-variable">width</span>: <span class="hljs-number">100</span>,
                <span class="hljs-variable">height</span>: <span class="hljs-number">40</span>,
                animate: <span class="hljs-keyword">true</span>
            });

            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">map</span>.street == <span class="hljs-string">''</span>) {
                var street = <span class="hljs-built_in">map</span>.city + <span class="hljs-string">', '</span> + <span class="hljs-built_in">map</span>.state;
            } <span class="hljs-keyword">else</span> {
                var street = <span class="hljs-built_in">map</span>.street + <span class="hljs-string">', '</span> + <span class="hljs-built_in">map</span>.city + <span class="hljs-string">', '</span> + <span class="hljs-built_in">map</span>.state;
            }

            <span class="hljs-comment">//if (map.catName == 1) {</span>
           <span class="hljs-comment">//     var pin = Titanium.Map.ANNOTATION_GREEN;</span>
           <span class="hljs-comment">// } else {</span>
            <span class="hljs-comment">//    if (map.catName == 4) {</span>
            <span class="hljs-comment">//    var pin = Titanium.Map.ANNOTATION_RED;</span>
            <span class="hljs-comment">//    } else {</span>
            <span class="hljs-comment">//    var pin = Titanium.Map.ANNOTATION_PURPLE;    </span>

            <span class="hljs-comment">//    }</span>
          <span class="hljs-comment">//  }</span>

            var pinImg = <span class="hljs-string">''</span>; 
            pinImg = <span class="hljs-built_in">map</span>.catPin;

             var myAnt = Ti.Map.createAnnotation ({
                 latitude: <span class="hljs-built_in">map</span>.lat,
                 longitude: <span class="hljs-built_in">map</span>.longt,
                 title: <span class="hljs-built_in">map</span>.name,
                 subtitle: street,
                 animate: <span class="hljs-keyword">true</span>,
                 <span class="hljs-comment">//pincolor: pin,</span>
                 <span class="hljs-comment">//image: 'images/'+map.catPin,</span>
                 latID: <span class="hljs-built_in">map</span>.lat,
                 longID: <span class="hljs-built_in">map</span>.longt,
                 rightButton: <span class="hljs-string">'images/exploreBut.png'</span>,
                 leftButton: <span class="hljs-string">'images/smallCloseBut.png'</span>,
                 pID: <span class="hljs-built_in">map</span>.id
             });    

             Ti.API.info(<span class="hljs-string">"pin image = "</span>+pinImg);

             myAnt.<span class="hljs-built_in">image</span> = <span class="hljs-string">'images/'</span>+pinImg;


             mapview.addAnnotation(myAnt);
             annotations.push(myAnt);

             } <span class="hljs-comment">//end for</span>

            <span class="hljs-comment">//mapview.addAnnotations(allAnts);</span>

            <span class="hljs-comment">//mapview.addAnnotation</span>
            <span class="hljs-comment">// CHECK TO SEE IF ANNOTATION SHOULD BE SELECTED </span>
            <span class="hljs-keyword">if</span> (ant == <span class="hljs-string">"Y"</span>) {
                 Ti.API.info(<span class="hljs-string">"ant = "</span>+ant+<span class="hljs-string">" "</span>+antTitle);
                mapview.selectAnnotation (antTitle);
            }

        } <span class="hljs-comment">// end function</span>
    }); <span class="hljs-comment">// end chr</span>

    xhr.<span class="hljs-built_in">open</span>(<span class="hljs-string">"GET"</span>, url_map);
    xhr.send();
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="April 17th 2012, 3:40:23 pm">April 17th 2012</span>
											by <span class='authorname'>Josh Cowdrey</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>as a side note, this issue also occurs when changing the map region. I have a tableview which lists all the annotations and when you click on a row it passes the following info to the map view:</p>
<pre><code class="hljs">mapview.region = {<span class="hljs-string">latitude:</span> e.rowData.lat, <span class="hljs-string">longitude:</span> e.rowData.longt, <span class="hljs-string">latitudeDelta:</span> <span class="hljs-number">0.0001</span>, <span class="hljs-string">longitudeDelta:</span> <span class="hljs-number">0.0001</span>};
</code></pre><p>when this happens, the pin images also shuffle around… and at that point I&#39;m not even adding or removing any annotations, just changing the map region parameter….</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 17th 2012, 3:44:01 pm">April 17th 2012</span>
											by <span class='authorname'>Josh Cowdrey</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Does <strong>map.catPin</strong> has an extension? I mean the file  is named <strong>pin_one</strong> or <strong>pin_one.png</strong> ?<br>I had an issue with the pins when the images had no extensions.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 17th 2012, 3:44:13 pm">April 17th 2012</span>
											by <span class='authorname'>Dan Tamas</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>yeah .png extension… here&#39;s and example of the JSON code produced by my php file…</p>
<pre><code class="hljs">{
   "<span class="hljs-attribute">markers</span>":<span class="hljs-value">[
      {
         "<span class="hljs-attribute">id</span>":<span class="hljs-value"><span class="hljs-string">"56"</span></span>,
         "<span class="hljs-attribute">name</span>":<span class="hljs-value"><span class="hljs-string">"'Little Willy' Roberts"</span></span>,
         "<span class="hljs-attribute">catID</span>":<span class="hljs-value"><span class="hljs-string">"9"</span></span>,
         "<span class="hljs-attribute">catName</span>":<span class="hljs-value"><span class="hljs-string">"9"</span></span>,
         "<span class="hljs-attribute">category</span>":<span class="hljs-value"><span class="hljs-string">"HISTORICAL IDENTITIES"</span></span>,
         "<span class="hljs-attribute">catIcon</span>":<span class="hljs-value"><span class="hljs-string">"icon6.png"</span></span>,
         "<span class="hljs-attribute">catIcon2</span>":<span class="hljs-value"><span class="hljs-string">"icon6a.png"</span></span>,
         "<span class="hljs-attribute">catPin</span>":<span class="hljs-value"><span class="hljs-string">"pin6.png"</span></span>,
         "<span class="hljs-attribute">pinImg</span>":<span class="hljs-value"><span class="hljs-string">""</span></span>,
         "<span class="hljs-attribute">street</span>":<span class="hljs-value"><span class="hljs-string">""</span></span>,
         "<span class="hljs-attribute">city</span>":<span class="hljs-value"><span class="hljs-string">"Broken Hill"</span></span>,
         "<span class="hljs-attribute">state</span>":<span class="hljs-value"><span class="hljs-string">"NSW"</span></span>,
         "<span class="hljs-attribute">lat</span>":<span class="hljs-value"><span class="hljs-string">""</span></span>,
         "<span class="hljs-attribute">longt</span>":<span class="hljs-value"><span class="hljs-string">""</span>
      </span>},
      {
         "<span class="hljs-attribute">id</span>":<span class="hljs-value"><span class="hljs-string">"9"</span></span>,
         "<span class="hljs-attribute">name</span>":<span class="hljs-value"><span class="hljs-string">"AMA Band Hall"</span></span>,
         "<span class="hljs-attribute">catID</span>":<span class="hljs-value"><span class="hljs-string">"4"</span></span>,
         "<span class="hljs-attribute">catName</span>":<span class="hljs-value"><span class="hljs-string">"4"</span></span>,
         "<span class="hljs-attribute">category</span>":<span class="hljs-value"><span class="hljs-string">"HISTORIC BUILDINGS"</span></span>,
         "<span class="hljs-attribute">catIcon</span>":<span class="hljs-value"><span class="hljs-string">"icon4.png"</span></span>,
         "<span class="hljs-attribute">catIcon2</span>":<span class="hljs-value"><span class="hljs-string">"icon4a.png"</span></span>,
         "<span class="hljs-attribute">catPin</span>":<span class="hljs-value"><span class="hljs-string">"pin4.png"</span></span>,
         "<span class="hljs-attribute">pinImg</span>":<span class="hljs-value"><span class="hljs-string">""</span></span>,
         "<span class="hljs-attribute">street</span>":<span class="hljs-value"><span class="hljs-string">"123 Argent St"</span></span>,
         "<span class="hljs-attribute">city</span>":<span class="hljs-value"><span class="hljs-string">"Broken Hill"</span></span>,
         "<span class="hljs-attribute">state</span>":<span class="hljs-value"><span class="hljs-string">"NSW"</span></span>,
         "<span class="hljs-attribute">lat</span>":<span class="hljs-value"><span class="hljs-string">"-31.957777"</span></span>,
         "<span class="hljs-attribute">longt</span>":<span class="hljs-value"><span class="hljs-string">"141.463726"</span>
      </span>},

etc etc</span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="April 17th 2012, 3:50:43 pm">April 17th 2012</span>
											by <span class='authorname'>Josh Cowdrey</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Try  a newer SDK because looks like a bug to me :(</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 17th 2012, 3:57:33 pm">April 17th 2012</span>
											by <span class='authorname'>Dan Tamas</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>hmmm… thanks for your help anyway Dan… really appreciated it :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 17th 2012, 3:59:01 pm">April 17th 2012</span>
											by <span class='authorname'>Josh Cowdrey</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-236362">
				
						<section>
							<p>Updated to latest SDK released today and seems to have fixed the issue…. :)</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 17th 2012, 4:07:39 pm">April 17th 2012</span>
								by <span class='authorname'>Josh Cowdrey</span><br>
								<a class="icon-bg icon-link" href="question/135519/issue-with-custom-image-map-markers#answer-236362" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-236364">
				
						<section>
							<p>SOLVED ? &quot;Updated to latest SDK released today and seems to have fixed the issue…. :)&quot;</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 17th 2012, 4:15:40 pm">April 17th 2012</span>
								by <span class='authorname'>Dan Tamas</span><br>
								<a class="icon-bg icon-link" href="question/135519/issue-with-custom-image-map-markers#answer-236364" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
