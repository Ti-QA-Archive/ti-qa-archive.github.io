<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Android Back Button &#39;androidback&#39; event implementation » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Android Back Button &#39;androidback&#39; event implementation</h1>
		</header>
		<section>
			<p>Hi,</p>
<p>I am facing problem to implement the Android &#39;androidback&#39; back button event. I want the &#39;androidback&#39; event to close current window and its activities, then go back to previous window.</p>
<p>The problem is i can&#39;t properly &#39;close&#39; current window and all its activities before going back to previous window. It is because I can&#39;t know when user will press the back button. If current window is still active and running some processes, it will cause errors when &#39;androidback&#39; event is triggered. So sometimes my event execute properly and sometime not.</p>
<p>Is anyone can advice me the proper methods to implement the &#39;androidback&#39; event?</p>
<p>Thank you so much.</p>
<p>I am using Ti.SDK 3.2.2 and running on Android SDK 4.4.2 device.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="May 5th 2014, 6:07:03 am">May 5th 2014</span>
				by <span class='authorname'>Goh Ten Fatt</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>androidback</span></li>
					
						<li><span class='tagname'>eventlistener</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-278399">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>hi, </p>
<p>i think you don&#39;t need the android:back event, just listen for the close event of the window to release your times.</p>
<pre><code class="hljs"><span class="hljs-comment">// assuming your window is called self</span>
<span class="hljs-keyword">self</span>.addEventListener(<span class="hljs-string">'close'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> <span class="hljs-comment">{
    clearInterval(yourTimer);
}</span>);</span>
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 5th 2014, 7:03:18 am">May 5th 2014</span>
								by <span class='authorname'>Moritz Knecht</span><br>
								<a class="icon-bg icon-link" href="../../question/173855/android-back-button-androidback-event-implementation.html#answer-278399" rel="permalink">permalink</a>
							</div>

							<h5>14 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Moritz,</p>
<p>Thanks for your reply. </p>
<p>Your solution solve part of my problem because &#39;animation&#39; is just part of the &#39;activities&#39; i need to clear and null before i go back to previous window using &#39;back button&#39;. Each window is basically an &#39;indepedent&#39; features in my App. So my App consists of few windows that i need to switch back using &#39;androidback&#39; event for back button.</p>
<p>Thanks.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 5th 2014, 7:14:21 am">May 5th 2014</span>
											by <span class='authorname'>Goh Ten Fatt</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>i don&#39;t get why you listen for the androidback event, you can also close your activities from the window close event.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 5th 2014, 7:29:32 am">May 5th 2014</span>
											by <span class='authorname'>Moritz Knecht</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi,</p>
<p>My purpose is to take care of back button pressed by user with &#39;androidback&#39;  event to return to previous window. So i need to implement code to take care of this event to 1). closing current window and its activities and 2). go back to previous window.</p>
<p>I can close current window and its activities but then if user pressed back button while it is still closing current activities, then error will happen. In other words, I need to wait and make sure current activities is stopped, closed and nulled, then only i can go back to previous page&#x2F;window. But i can&#39;t predict when user will trigger the back button and fire the event. This is the problem i am facing.</p>
<p>I may going into wrong direction. Maybe someone can correct me, what is the proper concept of implementing &#39;androidback&#39; event to go back previous window?</p>
<p>Thanks.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 5th 2014, 12:24:05 pm">May 5th 2014</span>
											by <span class='authorname'>Goh Ten Fatt</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>per default windows are automatically closed when the backbutton from android is pressed. </p>
<p>from the documentation</p>
<pre><code class="hljs">This <span class="hljs-keyword">event</span> <span class="hljs-keyword">is</span> fired when the current windows activity detects a back button press <span class="hljs-keyword">by</span> the user <span class="hljs-keyword">to</span> navigate back.

<span class="hljs-keyword">By</span> <span class="hljs-keyword">default</span> this <span class="hljs-keyword">event</span> would trigger the current activity <span class="hljs-keyword">to</span> be finished <span class="hljs-keyword">and</span> removed <span class="hljs-keyword">from</span> the task stack. Subscribing <span class="hljs-keyword">to</span> this <span class="hljs-keyword">event</span> <span class="hljs-keyword">with</span> a listener will prevent the <span class="hljs-keyword">default</span> behavior. <span class="hljs-keyword">To</span> finish the activity <span class="hljs-keyword">from</span> your listener just call the close <span class="hljs-function"><span class="hljs-keyword">method</span> <span class="hljs-title">of</span> <span class="hljs-title">the</span> <span class="hljs-title">window</span>.</span>
</code></pre><p>what happens if you remove the listener for &#39;androidback&#39; and just use the default mechanism and release you timers and other stuff in the &#39;close&#39; event does it also crash?</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 5th 2014, 1:11:53 pm">May 5th 2014</span>
											by <span class='authorname'>Moritz Knecht</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>yeah…your suggestion could be another way for me to explore. i will let you know whether it works for my case. thanks :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 5th 2014, 1:22:58 pm">May 5th 2014</span>
											by <span class='authorname'>Goh Ten Fatt</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi,</p>
<p>I had try with the default setting of &#39;androidback&#39; event, but the moment i pressed the back button, it exit the app directly instead. So this does not work for my case.</p>
<p>I am trying with:</p>
<pre><code class="hljs">
<span class="hljs-comment">//== self is the current window</span>
<span class="hljs-keyword">self</span>.addEventListener(<span class="hljs-string">'androidback'</span> ,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{

    execute some <span class="hljs-string">'return back'</span> <span class="hljs-function"><span class="hljs-keyword">function</span>.
})</span>;
</code></pre><p>so on each window, I had the above code that executing a different &#39;return back&#39; function and this function will &#39;stop&#39;, &#39;close&#39; and &#39;null&#39; the current activities before go back to previous window.  But this way is not very stable.</p>
<p>Worst case, I am thinking of &#39;disable&#39; the &#39;back button&#39; if no stable solution found.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 6th 2014, 2:16:52 pm">May 6th 2014</span>
											by <span class='authorname'>Goh Ten Fatt</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>&quot;I had try with the default setting of &#39;androidback&#39; event&quot;</p>
<p>did you mean you removed this event from your code? because the default setting of the androidback event is to not to use it.</p>
<p>&quot;but the moment i pressed the back button, it exit the app directly instead. So this does not work for my case.&quot;</p>
<p>this happens when the &#39;exitOnClose&#39; property of window is set to true.</p>
<p>&quot;this function will &#39;stop&#39;, &#39;close&#39; and &#39;null&#39; the current activities &quot;</p>
<p>that point is a little bit unclear to me. but it is probably the source of the instabilities and crashes </p>
<p>simple test case </p>
<p>app.js</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> rootWin = Ti.UI.createWindow({
    exitOnClose:<span class="hljs-literal">true</span>, <span class="hljs-comment">// the application will be closed when you press the backbutton in this window</span>
    backgroundColor:<span class="hljs-string">'white'</span>
});

rootWin.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> NextWindow = <span class="hljs-built_in">require</span>(<span class="hljs-string">'nextWindow'</span>);
     <span class="hljs-keyword">var</span> nextWindow = <span class="hljs-keyword">new</span> NextWindow();
    nextWindow.open();
});

rootWin.open();
</code></pre><p>NextWindow.js</p>
<pre><code class="hljs"><span class="hljs-comment">// we setup a new window</span>

module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{

    <span class="hljs-keyword">var</span> colors = [<span class="hljs-string">"red"</span>, <span class="hljs-string">"blue"</span>, <span class="hljs-string">"green"</span>, <span class="hljs-string">"yellow"</span>, <span class="hljs-string">"black"</span>, <span class="hljs-string">"white"</span>, <span class="hljs-string">"orange"</span>, <span class="hljs-string">"brown"</span>, <span class="hljs-string">"purple"</span>, <span class="hljs-string">"gray"</span>];

    <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = Ti.UI.createWindow({
        exitOnClose:<span class="hljs-keyword">true</span>, <span class="hljs-comment">// when you press the back button you return to the last window</span>
        backgroundColor:colors[Math.floor(Math.random() * colors.length)]; <span class="hljs-comment">// different colors</span>
    }); 

    <span class="hljs-comment">// Open a new Window on click</span>
    <span class="hljs-keyword">self</span>.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> NextWindow = <span class="hljs-keyword">require</span>(<span class="hljs-string">'NextWindow'</span>);
         <span class="hljs-keyword">var</span> nextWindow = <span class="hljs-keyword">new</span> NextWindow();
        nextWindow.open();
    });

    <span class="hljs-keyword">self</span>.addEventListener(<span class="hljs-string">'close'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{ 
            <span class="hljs-comment">/*  The 'close' event will fire BEFORE the window is closed, so this event catches both the android system back button and the homeAsUp Button from the actionbar. Here is the place to release leaking objects. BUT only do this when you know there is really a memory leak, titanium's garbage collection normally removes everything from the stack automatically, when a window closes. Timers are a problem, they must be cleared with clearInterval() or clearTimeout() here */</span>
    });

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
};
</code></pre><p>you see, i didn&#39;t used the &#39;androidback&#39; event listener at all to get a properly working navigation. Or am I missing your point?</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 6th 2014, 3:28:46 pm">May 6th 2014</span>
											by <span class='authorname'>Moritz Knecht</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Moritz,</p>
<p>Thanks you so much for your response. You are right I am setting &#39;exitOnClose: true&#39;. </p>
<p>I believe I get what you mean. Your explanation do help me to understand further on Ti. </p>
<p>I am using window URL to open another new window instead of using commonJS. Is that the problem in my case?</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 6th 2014, 3:49:28 pm">May 6th 2014</span>
											by <span class='authorname'>Goh Ten Fatt</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>yes the url syntax is very bad, because it produces different javascript contexts. It is a nightmare to debug and fix memory leaks. </p>
<p>try to refactor your app with commonjs or alloy, it is very easy to use and provides you much more control and flexibility how to structure you app. </p>
<p>simple migration example from url  to commonjs syntax: </p>
<p>###URL SYNTAX</p>
<p>app.js </p>
<pre><code class="hljs"><span class="hljs-variable"><span class="hljs-keyword">var</span> nextWindow</span> = Ti.UI.createWindow({
    url:<span class="hljs-string">"NextWindow.js"</span>,
    args:{<span class="hljs-string">"text"</span>:<span class="hljs-string">"hello world"</span>}
});
nextWin.<span class="hljs-keyword">open</span>();
</code></pre><p>NextWindow.js </p>
<pre><code class="hljs"><span class="hljs-built_in">var</span> <span class="hljs-built_in">self</span> = Ti<span class="hljs-built_in">.</span>UI<span class="hljs-built_in">.</span>currentWindow;

<span class="hljs-built_in">var</span> label = Ti<span class="hljs-built_in">.</span>UI<span class="hljs-built_in">.</span>createLabel({text:<span class="hljs-built_in">self</span><span class="hljs-built_in">.</span>args<span class="hljs-built_in">.</span>text});
<span class="hljs-built_in">self</span><span class="hljs-built_in">.</span>add(label);
</code></pre><p>###COMMONJS SYNTAX</p>
<p>app.js </p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> NextWindow = <span class="hljs-built_in">require</span>(<span class="hljs-string">'NextWindow'</span>); <span class="hljs-comment">// require a module</span>
<span class="hljs-keyword">var</span> nextWindow = <span class="hljs-keyword">new</span> NextWindow({<span class="hljs-string">"text"</span>:<span class="hljs-string">"hello world"</span>}); <span class="hljs-comment">// create a instance of the module</span>
nextWindow.open();
</code></pre><p>NextWindow.js</p>
<pre><code class="hljs">module.exports = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(args)</span> </span>{
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">self</span> = Ti.UI.createWindow();

    <span class="hljs-keyword">var</span> label = Ti.UI.createLabel({text:args.text});
    <span class="hljs-keyword">self</span>.add(label);

    <span class="hljs-keyword">return</span> <span class="hljs-keyword">self</span>;
};
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="May 6th 2014, 4:16:16 pm">May 6th 2014</span>
											by <span class='authorname'>Moritz Knecht</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>see <a href="http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;3.0&#x2F;#!&#x2F;guide&#x2F;CommonJS_Modules_in_Titanium">the docs</a></p>
</p>
										<div class="author">
											&mdash; commented <span title="May 6th 2014, 4:17:22 pm">May 6th 2014</span>
											by <span class='authorname'>Moritz Knecht</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Thanks again. I will migrate to commonJS and test out my App with this method. Will let you know if it works :)</p>
<p>BTW, in commonJS, is it possible to for &#39;previous window&#39; to know the &#39;current window&#39; is close ? I need this status so that I can animate &#39;previous window&#39; once &#39;current&#39; is closed.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 6th 2014, 4:31:43 pm">May 6th 2014</span>
											by <span class='authorname'>Goh Ten Fatt</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>you have to add the &quot;focus&quot; eventlistener to the previous window, it will fire when the window is visible again, then you can restart your animations</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 6th 2014, 5:45:16 pm">May 6th 2014</span>
											by <span class='authorname'>Moritz Knecht</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>for the sake of correctness and later readers, in the example code concerning  with exitOnClose( NextWindow.js 6 commetns above), there is an obvious mistake   &quot;exitOnClose&quot; should be set to false. </p>
<p>Goh, good luck with the migration, before you start you should consider switching to Alloy, which also uses commonjs, which helps you to separate ui and logic in a beautiful way.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 6th 2014, 6:10:17 pm">May 6th 2014</span>
											by <span class='authorname'>Moritz Knecht</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Moritz,</p>
<p>I would like to thank you again for your &#39;great&#39; advice and explanation on this matter. I had successful convert my code to commonJS and it works great. Android &#39;back button&#39; matter is closed and my code now do not need to detect &#39;androidback&#39; event anymore :).</p>
<p>Thank you so much !!!</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 21st 2014, 3:55:00 am">May 21st 2014</span>
											by <span class='authorname'>Goh Ten Fatt</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-278393">
				
						<section>
							<p>Do like this,Suppose self is name of windows</p>
<pre><code class="hljs"><span class="hljs-keyword">self</span>.addEventListener(<span class="hljs-string">'android:back'</span> ,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
     <span class="hljs-keyword">self</span>.close();
});
</code></pre><p>Thanks</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 5th 2014, 6:09:53 am">May 5th 2014</span>
								by <span class='authorname'>Muhammad Wahhab Mirza</span><br>
								<a class="icon-bg icon-link" href="../../question/173855/android-back-button-androidback-event-implementation.html#answer-278393" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Muhammad,</p>
<p>Thanks for your reply. I used the method as your mentioned to &#39;close&#39; current window, it works to close the window. But if i have others activities that are still active, for example an interval animation, it will caused error if i did not close the animation properly before close the window.</p>
<p>How should I close and null others activities before &#39;closing&#39; current window properly?</p>
<p>I hope my explanation can give you better idea of my problem.</p>
<p>Thanks.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 5th 2014, 6:23:53 am">May 5th 2014</span>
											by <span class='authorname'>Goh Ten Fatt</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-278471">
				
						<section>
							<p>Hi Moritz,</p>
<p>Many thanks for the in-depth explanation and it really help me. I believe using commonJS and Alloy is the way to improve my efficiency in app development.</p>
<p>I will take your advice and refactor my app.</p>
<p>Thank you. :)</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 6th 2014, 9:31:31 pm">May 6th 2014</span>
								by <span class='authorname'>Goh Ten Fatt</span><br>
								<a class="icon-bg icon-link" href="../../question/173855/android-back-button-androidback-event-implementation.html#answer-278471" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
