<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>More Woes with Android: TableView and Search Bar » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>More Woes with Android: TableView and Search Bar</h1>
		</header>
		<section>
			<p>This is starting to get ridiculous.  I run into null pointer exceptions every which way I turn with trying to get my app to run properly on Android.</p>
<p>This time, I&#39;m trying to implement a user directory search function, using a web service, with the results placed into a table view, where selecting a table view row displays the details of the person in the search results.</p>
<p>Yet, I am getting a null pointer exception, either when I scroll down through the results and select a row in the table, or when I select back from the detail window.</p>
<p>I also see the odd behaviour of when I have one single row in my search result (or two as I have a summary row at the end), I click on the row to view to display the details but when I go back, the row is gone!</p>
<p>The app works perfectly and all but ready to release on iOS, but on Android, it&#39;s dodgy and amateur-looking at best with all the crashes.</p>
<p>Please tell me I&#39;m doing something really simply wrong here… It shouldn&#39;t take me 4 weeks (and still counting) to take code that works perfectly in iOS to get working in Android.</p>
<p>Error output:</p>
<pre><code class="hljs"><span class="hljs-list">(<span class="hljs-keyword">main</span>)</span> <span class="hljs-list">[<span class="hljs-keyword">66983</span>,<span class="hljs-number">306885</span>] Sending event: exception on thread: main msg:java.lang.NullPointerException<span class="hljs-comment">; Titanium 2.1.0,2012/06/28 12:16,6e3cab6</span>
java.lang.NullPointerException
    at ti.modules.titanium.ui.widget.tableview.TiTableViewRowProxyItem.refreshControls<span class="hljs-list">(<span class="hljs-keyword">TiTableViewRowProxyItem.java:141</span>)</span>
    at ti.modules.titanium.ui.widget.tableview.TiTableViewRowProxyItem.setRowData<span class="hljs-list">(<span class="hljs-keyword">TiTableViewRowProxyItem.java:280</span>)</span>
    at ti.modules.titanium.ui.widget.tableview.TiTableViewRowProxyItem.setRowData<span class="hljs-list">(<span class="hljs-keyword">TiTableViewRowProxyItem.java:83</span>)</span>
    at ti.modules.titanium.ui.widget.tableview.TiTableView$TTVListAdapter.getView<span class="hljs-list">(<span class="hljs-keyword">TiTableView.java:216</span>)</span>
    at android.widget.AbsListView.obtainView<span class="hljs-list">(<span class="hljs-keyword">AbsListView.java:1294</span>)</span>
    at android.widget.ListView.makeAndAddView<span class="hljs-list">(<span class="hljs-keyword">ListView.java:1727</span>)</span>
    at android.widget.ListView.fillDown<span class="hljs-list">(<span class="hljs-keyword">ListView.java:652</span>)</span>
    at android.widget.ListView.fillSpecific<span class="hljs-list">(<span class="hljs-keyword">ListView.java:1284</span>)</span>
    at android.widget.ListView.layoutChildren<span class="hljs-list">(<span class="hljs-keyword">ListView.java:1558</span>)</span>
    at android.widget.AbsListView.onLayout<span class="hljs-list">(<span class="hljs-keyword">AbsListView.java:1147</span>)</span>
    at android.view.View.layout<span class="hljs-list">(<span class="hljs-keyword">View.java:7035</span>)</span>
    at android.widget.FrameLayout.onLayout<span class="hljs-list">(<span class="hljs-keyword">FrameLayout.java:333</span>)</span>
    at ti.modules.titanium.ui.widget.tableview.TiTableView.onLayout<span class="hljs-list">(<span class="hljs-keyword">TiTableView.java:532</span>)</span>
    at android.view.View.layout<span class="hljs-list">(<span class="hljs-keyword">View.java:7035</span>)</span>
    at org.appcelerator.titanium.view.TiCompositeLayout.onLayout<span class="hljs-list">(<span class="hljs-keyword">TiCompositeLayout.java:548</span>)</span>
    at android.view.View.layout<span class="hljs-list">(<span class="hljs-keyword">View.java:7035</span>)</span>
    at android.widget.FrameLayout.onLayout<span class="hljs-list">(<span class="hljs-keyword">FrameLayout.java:333</span>)</span>
    at android.view.View.layout<span class="hljs-list">(<span class="hljs-keyword">View.java:7035</span>)</span>
    at android.widget.FrameLayout.onLayout<span class="hljs-list">(<span class="hljs-keyword">FrameLayout.java:333</span>)</span>
    at android.view.View.layout<span class="hljs-list">(<span class="hljs-keyword">View.java:7035</span>)</span>
    at android.view.ViewRoot.performTraversals<span class="hljs-list">(<span class="hljs-keyword">ViewRoot.java:1045</span>)</span>
    at android.view.ViewRoot.handleMessage<span class="hljs-list">(<span class="hljs-keyword">ViewRoot.java:1727</span>)</span>
    at android.os.Handler.dispatchMessage<span class="hljs-list">(<span class="hljs-keyword">Handler.java:99</span>)</span>
    at android.os.Looper.loop<span class="hljs-list">(<span class="hljs-keyword">Looper.java:123</span>)</span>
    at android.app.ActivityThread.main<span class="hljs-list">(<span class="hljs-keyword">ActivityThread.java:4627</span>)</span>
    at java.lang.reflect.Method.invokeNative<span class="hljs-list">(<span class="hljs-keyword">Native</span> Method)</span>
    at java.lang.reflect.Method.invoke<span class="hljs-list">(<span class="hljs-keyword">Method.java:521</span>)</span>
    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run<span class="hljs-list">(<span class="hljs-keyword">ZygoteInit.java:868</span>)</span>
    at com.android.internal.os.ZygoteInit.main<span class="hljs-list">(<span class="hljs-keyword">ZygoteInit.java:626</span>)</span>
    at dalvik.system.NativeStart.main<span class="hljs-list">(<span class="hljs-keyword">Native</span> Method)</span>

FATAL EXCEPTION: main
java.lang.NullPointerException
    at ti.modules.titanium.ui.widget.tableview.TiTableViewRowProxyItem.refreshControls<span class="hljs-list">(<span class="hljs-keyword">TiTableViewRowProxyItem.java:141</span>)</span>
    at ti.modules.titanium.ui.widget.tableview.TiTableViewRowProxyItem.setRowData<span class="hljs-list">(<span class="hljs-keyword">TiTableViewRowProxyItem.java:280</span>)</span>
    at ti.modules.titanium.ui.widget.tableview.TiTableViewRowProxyItem.setRowData<span class="hljs-list">(<span class="hljs-keyword">TiTableViewRowProxyItem.java:83</span>)</span>
    at ti.modules.titanium.ui.widget.tableview.TiTableView$TTVListAdapter.getView<span class="hljs-list">(<span class="hljs-keyword">TiTableView.java:216</span>)</span>
    at android.widget.AbsListView.obtainView<span class="hljs-list">(<span class="hljs-keyword">AbsListView.java:1294</span>)</span>
    at android.widget.ListView.makeAndAddView<span class="hljs-list">(<span class="hljs-keyword">ListView.java:1727</span>)</span>
    at android.widget.ListView.fillDown<span class="hljs-list">(<span class="hljs-keyword">ListView.java:652</span>)</span>
    at android.widget.ListView.fillSpecific<span class="hljs-list">(<span class="hljs-keyword">ListView.java:1284</span>)</span>
    at android.widget.ListView.layoutChildren<span class="hljs-list">(<span class="hljs-keyword">ListView.java:1558</span>)</span>
    at android.widget.AbsListView.onLayout<span class="hljs-list">(<span class="hljs-keyword">AbsListView.java:1147</span>)</span>
    at android.view.View.layout<span class="hljs-list">(<span class="hljs-keyword">View.java:7035</span>)</span>
    at android.widget.FrameLayout.onLayout<span class="hljs-list">(<span class="hljs-keyword">FrameLayout.java:333</span>)</span>
    at ti.modules.titanium.ui.widget.tableview.TiTableView.onLayout<span class="hljs-list">(<span class="hljs-keyword">TiTableView.java:532</span>)</span>
    at android.view.View.layout<span class="hljs-list">(<span class="hljs-keyword">View.java:7035</span>)</span>
    at org.appcelerator.titanium.view.TiCompositeLayout.onLayout<span class="hljs-list">(<span class="hljs-keyword">TiCompositeLayout.java:548</span>)</span>
    at android.view.View.layout<span class="hljs-list">(<span class="hljs-keyword">View.java:7035</span>)</span>
    at android.widget.FrameLayout.onLayout<span class="hljs-list">(<span class="hljs-keyword">FrameLayout.java:333</span>)</span>
    at android.view.View.layout<span class="hljs-list">(<span class="hljs-keyword">View.java:7035</span>)</span>
    at android.widget.FrameLayout.onLayout<span class="hljs-list">(<span class="hljs-keyword">FrameLayout.java:333</span>)</span>
    at android.view.View.layout<span class="hljs-list">(<span class="hljs-keyword">View.java:7035</span>)</span>
    at android.view.ViewRoot.performTraversals<span class="hljs-list">(<span class="hljs-keyword">ViewRoot.java:1045</span>)</span>
    at android.view.ViewRoot.handleMessage<span class="hljs-list">(<span class="hljs-keyword">ViewRoot.java:1727</span>)</span>
    at android.os.Handler.dispatchMessage<span class="hljs-list">(<span class="hljs-keyword">Handler.java:99</span>)</span>
    at android.os.Looper.loop<span class="hljs-list">(<span class="hljs-keyword">Looper.java:123</span>)</span>
    at android.app.ActivityThread.main<span class="hljs-list">(<span class="hljs-keyword">ActivityThread.java:4627</span>)</span>
    at java.lang.reflect.Method.invokeNative<span class="hljs-list">(<span class="hljs-keyword">Native</span> Method)</span>
    at java.lang.reflect.Method.invoke<span class="hljs-list">(<span class="hljs-keyword">Method.java:521</span>)</span>
    at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run<span class="hljs-list">(<span class="hljs-keyword">ZygoteInit.java:868</span>)</span>
    at com.android.internal.os.ZygoteInit.main<span class="hljs-list">(<span class="hljs-keyword">ZygoteInit.java:626</span>)</span>
    at dalvik.system.NativeStart.main<span class="hljs-list">(<span class="hljs-keyword">Native</span> Method)</span></span>
</code></pre><p><a href="http:&#x2F;&#x2F;pastebin.com&#x2F;MhQu59Yi">Code can be found here</a></p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="August 13th 2012, 5:29:59 am">August 13th 2012</span>
				by <span class='authorname'>Chris Dunstall</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>nullpointerexception</span></li>
					
						<li><span class='tagname'>searchbar</span></li>
					
						<li><span class='tagname'>tableview</span></li>
					
						<li><span class='tagname'>tableviewrow</span></li>
					
				</ul>
			

			<section>
				<h5>6 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Sorry for the snippy attitude… wrote it in a bit of a huff… no disrespect intended.</p>
</div>
							<div class="author">
								&mdash; commented <span title="August 13th 2012, 5:31:05 am">August 13th 2012</span>
								by <span class='authorname'>Chris Dunstall</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Bah… using Ti 2.1.0 GA, v8 runtime, testing on Android emulator with 2.2 Google APIs.</p>
</div>
							<div class="author">
								&mdash; commented <span title="August 13th 2012, 5:33:18 am">August 13th 2012</span>
								by <span class='authorname'>Chris Dunstall</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>That&#39;s quite a lot of code to grok on a glance, so I won&#39;t.</p>
<p>Quick comments&#x2F;Qs:</p>
<ol>
<li><p>It seems you are adding a &#39;cancel&#39; event to the iOS version of the searchBar. It needs to go on the Android version which has had the same dummy button since TiSDK 0.8!</p>
</li>
<li><p>You are not adding the searchBar to the main tableview? In order to couple them you need to create your main table view with a property: search : searchBar - oh, you commented that out …</p>
</li>
</ol>
<p>General:</p>
<p>Crashes are most often due to &#39;manhandling&#39; TiViews. Either by treating them like normal javascript objects, or by doing stuff with them you can&#39;t do and Ti won&#39;t catch before the crash. </p>
<p>I&#39;m not able to glance if that is what is wrong in your case, but I&#39;d put a breakpoint in the first line of mainTableView.addEventListener(&#39;click&#39;, function(e) and then step my way through to the crash … if you do that, what line causes the crash?</p>
</div>
							<div class="author">
								&mdash; commented <span title="August 13th 2012, 10:29:17 am">August 13th 2012</span>
								by <span class='authorname'>Esben Maaløe</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>BTW: &quot;Snippy attitude&quot;</p>
<p>I feel your pain, and have had decidedly &#39;WTF&#39; tirades on this forum that was banned.</p>
<p>However the better I get at Ti and the more I work with it - the more I discover how to deal with what seems like catastrophic glitches.</p>
<p>In my worst moments I dream of rounding up all TiSDK and TiStudio execs and forcing them to make loads of Ti Android apps on a tight deadline, of course a script deletes all prefs each time they close TiStudio, forcing them to deal with the &#39;why do I only get a splashscreen&#39; issue. BTW - the script is already written, it&#39;s called: Titanium Studio :)</p>
</div>
							<div class="author">
								&mdash; commented <span title="August 13th 2012, 10:36:42 am">August 13th 2012</span>
								by <span class='authorname'>Esben Maaløe</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Do you have some code somewhere that we could review that might provide some insights?</p>
</div>
							<div class="author">
								&mdash; commented <span title="August 13th 2012, 11:13:44 am">August 13th 2012</span>
								by <span class='authorname'>Aaron Saunders</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>@Aaron, yep, it&#39;s linked under the stack trace at pastebin.</p>
<p>@Esben, thanks for your thoughts.</p>
<ul>
<li>&quot;It seems you are adding a &#39;cancel&#39; event to the iOS version of the searchBar. It needs to go on the Android version which has had the same dummy button since TiSDK 0.8!&quot;</li>
</ul>
<p>Fair point about the &#39;cancel&#39; event. My code has evolved a little bit today… it started out as a tableview search bar, in which I did have the cancel event for Android as well. I needed to change the search bar to an independant search bar because it was filtering out non-exact results from the search (functional requirement of the app).  I had done some research on the Android search bar and opted to make it a textfield to hopefully bypass some of the &#39;blur&#x2F;focus&#39; issues but it looks like I haven&#39;t avoided them at all.</p>
<ul>
<li>&quot;You are not adding the searchBar to the main tableview? In order to couple them you need to create your main table view with a property: search : searchBar - oh, you commented that out …&quot;</li>
</ul>
<p>Yep, see above re: the functional requirement. The search bar in the tableview filters out anything not matching exactly the value of the search bar. Our directory search service (not stored in the app) returns non-exact matches (not my decision! ;)) which are being filtered out by said search bar function.</p>
<ul>
<li>&quot;Crashes are most often due to &#39;manhandling&#39; TiViews. Either by treating them like normal javascript objects, or by doing stuff with them you can&#39;t do and Ti won&#39;t catch before the crash.&quot;</li>
</ul>
<p>Thanks, I&#39;ll keep that in mind.</p>
<ul>
<li>&quot;I&#39;m not able to glance if that is what is wrong in your case, but I&#39;d put a breakpoint in the first line of mainTableView.addEventListener(&#39;click&#39;, function(e) and then step my way through to the crash … if you do that, what line causes the crash?&quot;</li>
</ul>
<p>I&#39;ll give that a shot. My previous attempts at using the debugger with Android were less than helpful but I was after variable values and TiStudio didn&#39;t want to display them (when it does for iOS).  </p>
<p>I&#39;m glad I&#39;m not alone here… I feel like it&#39;s a steep uphill battle getting this thing running (especially with management breathing down my neck), I&#39;m very appreciative of your assistance.</p>
</div>
							<div class="author">
								&mdash; commented <span title="August 13th 2012, 12:14:59 pm">August 13th 2012</span>
								by <span class='authorname'>Chris Dunstall</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-245234">
				
						<section>
							<p>SOLVED!</p>
<p>The problem? I didn&#39;t have a className property in my summary rows:</p>
<pre><code class="hljs"><span class="hljs-keyword">if</span> (searchResults != null) {                   
            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; i &lt; len; i++) {
                <span class="hljs-keyword">var</span> <span class="hljs-literal">result</span> = searchResults[i];
                //<span class="hljs-keyword">var</span> name = <span class="hljs-literal">result</span>.fname + ' ' + <span class="hljs-literal">result</span>.lname;
                <span class="hljs-keyword">var</span> name = <span class="hljs-literal">result</span>.lname + ', ' + <span class="hljs-literal">result</span>.fname;
                <span class="hljs-keyword">var</span> resultRow = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createTableViewRow({
                    className: csu.module.contacts.<span class="hljs-type">ROWTYPE_SEARCH</span>,
                    height: $dimensions.tableViewRowHeight,
                    title: name,
                    name: name,
                    hasChild: <span class="hljs-literal">true</span>,
                    selectable: <span class="hljs-literal">true</span>,
                    details: <span class="hljs-literal">result</span>
                });
                tableData.push(resultRow);
            }

            <span class="hljs-keyword">var</span> label = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createLabel(csu.combine(csu.module.contacts.styles.summaryTableRowLabel, {
                text: len &gt; <span class="hljs-number">1</span> ? '<span class="hljs-type">Found</span> ' + len + ' <span class="hljs-type">Results</span>.' : '<span class="hljs-type">Found</span> ' + len + ' <span class="hljs-type">Result</span>.'
            }));

            <span class="hljs-keyword">if</span> (data.recordCount &gt;= csu.module.contacts.config.maxDisplayResults) {
                label.text = label.text + ' <span class="hljs-type">Please</span> refine your search.';
            }

            <span class="hljs-keyword">var</span> summaryRow = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createTableViewRow(csu.combine(csu.module.contacts.styles.summaryTableRow, {
                name: data.inputString,
                className: 'summary' // &lt;-- <span class="hljs-type">THIS</span> <span class="hljs-type">FIXES</span> <span class="hljs-type">IT</span>
            }));
            summaryRow.add(label);

            tableData.push(summaryRow);

        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> label = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createLabel(csu.combine(csu.module.contacts.styles.summaryTableRowLabel, {
                text: '<span class="hljs-type">No</span> <span class="hljs-type">Results</span> <span class="hljs-type">Returned</span> <span class="hljs-keyword">for</span>: ' + data.inputString
            }));
            <span class="hljs-keyword">var</span> summaryRow = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createTableViewRow(csu.combine(csu.module.contacts.styles.summaryTableRow, {
                name: data.inputString,
                className: 'summary' // &lt;-- <span class="hljs-type">AND</span> <span class="hljs-type">HERE</span> <span class="hljs-type">TOO</span>
            }));
            summaryRow.add(label);

            tableData.push(summaryRow);
        }
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="August 14th 2012, 1:32:48 am">August 14th 2012</span>
								by <span class='authorname'>Chris Dunstall</span><br>
								<a class="icon-bg icon-link" href="question/140937/more-woes-with-android-tableview-and-search-bar.html#answer-245234" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
