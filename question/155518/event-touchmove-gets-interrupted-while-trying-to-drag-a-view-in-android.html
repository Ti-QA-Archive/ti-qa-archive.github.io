<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Event touchmove gets interrupted while trying to drag a view in Android. Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Event touchmove gets interrupted while trying to drag a view in Android.</h1>
		</header>
		<section>
			<p>I&#39;m working in Titanium SDK 3.1.1 and deploying to Android 4.0. I&#39;m trying to drag a View, but while the touchmove event is being fired, something goes wrong and the event is interrupted. The application doesn&#39;t crash nor the touchend event is fired. While looking at logcat I get the following:</p>
<pre><code class="hljs">D/InputEventConsistencyVerifier(<span class="hljs-number">11897</span>): TouchEvent: ACTION_MOVE contained <span class="hljs-number">1</span> pointers but there are currently <span class="hljs-number">0</span> pointers down.
D/InputEventConsistencyVerifier(<span class="hljs-number">11897</span>):   in android.view.ScaleGestureDetector@<span class="hljs-number">41223570</span>
D/InputEventConsistencyVerifier(<span class="hljs-number">11897</span>):   <span class="hljs-number">0</span>: sent at <span class="hljs-number">199051208557000</span>, MotionEvent { action=ACTION_MOVE, id[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>, x[<span class="hljs-number">0</span>]=<span class="hljs-number">214.55301</span>, y[<span class="hljs-number">0</span>]=<span class="hljs-number">163.79526</span>, toolType[<span class="hljs-number">0</span>]=TOOL_TYPE_FINGER, buttonState=<span class="hljs-number">0</span>, metaState=<span class="hljs-number">0</span>, flags=<span class="hljs-number">0x0</span>, edgeFlags=<span class="hljs-number">0x0</span>, pointerCount=<span class="hljs-number">1</span>, historySize=<span class="hljs-number">1</span>, eventTime=<span class="hljs-number">199051208</span>, downTime=<span class="hljs-number">199051042</span>, deviceId=<span class="hljs-number">2</span>, source=<span class="hljs-number">0x1002</span> }
D/InputEventConsistencyVerifier(<span class="hljs-number">11897</span>):   -- recent events --
D/InputEventConsistencyVerifier(<span class="hljs-number">11897</span>):   <span class="hljs-number">1</span>: sent at <span class="hljs-number">199050732492000</span>, MotionEvent { action=ACTION_UP, id[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>, x[<span class="hljs-number">0</span>]=<span class="hljs-number">186.61124</span>, y[<span class="hljs-number">0</span>]=<span class="hljs-number">73.907616</span>, toolType[<span class="hljs-number">0</span>]=TOOL_TYPE_FINGER, buttonState=<span class="hljs-number">0</span>, metaState=<span class="hljs-number">0</span>, flags=<span class="hljs-number">0x80000000</span>, edgeFlags=<span class="hljs-number">0x0</span>, pointerCount=<span class="hljs-number">1</span>, historySize=<span class="hljs-number">0</span>, eventTime=<span class="hljs-number">199050732</span>, downTime=<span class="hljs-number">199049818</span>, deviceId=<span class="hljs-number">2</span>, source=<span class="hljs-number">0x1002</span> }
D/InputEventConsistencyVerifier(<span class="hljs-number">11897</span>):   <span class="hljs-number">2</span>: sent at <span class="hljs-number">199050713565000</span>, MotionEvent { action=ACTION_MOVE, id[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>, x[<span class="hljs-number">0</span>]=<span class="hljs-number">186.61124</span>, y[<span class="hljs-number">0</span>]=<span class="hljs-number">73.907616</span>, toolType[<span class="hljs-number">0</span>]=TOOL_TYPE_FINGER, buttonState=<span class="hljs-number">0</span>, metaState=<span class="hljs-number">0</span>, flags=<span class="hljs-number">0x80000000</span>, edgeFlags=<span class="hljs-number">0x0</span>, pointerCount=<span class="hljs-number">1</span>, historySize=<span class="hljs-number">0</span>, eventTime=<span class="hljs-number">199050713</span>, downTime=<span class="hljs-number">199049818</span>, deviceId=<span class="hljs-number">2</span>, source=<span class="hljs-number">0x1002</span> }
D/InputEventConsistencyVerifier(<span class="hljs-number">11897</span>):   <span class="hljs-number">3</span>: sent at <span class="hljs-number">199050693173000</span>, MotionEvent { action=ACTION_MOVE, id[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>, x[<span class="hljs-number">0</span>]=<span class="hljs-number">205.57172</span>, y[<span class="hljs-number">0</span>]=<span class="hljs-number">81.89763</span>, toolType[<span class="hljs-number">0</span>]=TOOL_TYPE_FINGER, buttonState=<span class="hljs-number">0</span>, metaState=<span class="hljs-number">0</span>, flags=<span class="hljs-number">0x80000000</span>, edgeFlags=<span class="hljs-number">0x0</span>, pointerCount=<span class="hljs-number">1</span>, historySize=<span class="hljs-number">0</span>, eventTime=<span class="hljs-number">199050693</span>, downTime=<span class="hljs-number">199049818</span>, deviceId=<span class="hljs-number">2</span>, source=<span class="hljs-number">0x1002</span> }
D/InputEventConsistencyVerifier(<span class="hljs-number">11897</span>):   <span class="hljs-number">4</span>: sent at <span class="hljs-number">199050683204000</span>, MotionEvent { action=ACTION_MOVE, id[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>, x[<span class="hljs-number">0</span>]=<span class="hljs-number">233.51352</span>, y[<span class="hljs-number">0</span>]=<span class="hljs-number">96.87891</span>, toolType[<span class="hljs-number">0</span>]=TOOL_TYPE_FINGER, buttonState=<span class="hljs-number">0</span>, metaState=<span class="hljs-number">0</span>, flags=<span class="hljs-number">0x80000000</span>, edgeFlags=<span class="hljs-number">0x0</span>, pointerCount=<span class="hljs-number">1</span>, historySize=<span class="hljs-number">0</span>, eventTime=<span class="hljs-number">199050683</span>, downTime=<span class="hljs-number">199049818</span>, deviceId=<span class="hljs-number">2</span>, source=<span class="hljs-number">0x1002</span> }
D/InputEventConsistencyVerifier(<span class="hljs-number">11897</span>):   <span class="hljs-number">5</span>: sent at <span class="hljs-number">199050669151000</span>, MotionEvent { action=ACTION_MOVE, id[<span class="hljs-number">0</span>]=<span class="hljs-number">0</span>, x[<span class="hljs-number">0</span>]=<span class="hljs-number">264.44907</span>, y[<span class="hljs-number">0</span>]=<span class="hljs-number">115.85519</span>, toolType[<span class="hljs-number">0</span>]=TOOL_TYPE_FINGER, buttonState=<span class="hljs-number">0</span>, metaState=<span class="hljs-number">0</span>, flags=<span class="hljs-number">0x80000000</span>, edgeFlags=<span class="hljs-number">0x0</span>, pointerCount=<span class="hljs-number">1</span>, historySize=<span class="hljs-number">0</span>, eventTime=<span class="hljs-number">199050669</span>, downTime=<span class="hljs-number">199049818</span>, deviceId=<span class="hljs-number">2</span>, source=<span class="hljs-number">0x1002</span> }
</code></pre><p>I don&#39;t understand why is this happening, I&#39;ve done drag &amp; drops behaviors before in Android using Titanium and had not encountered this problem.</p>
<p>This is the code for the touchstart, touchmove and touchend events:</p>
<pre><code class="hljs">    var draggedView = Titanium.UI.createView({
        <span class="hljs-string">backgroundColor :</span> <span class="hljs-string">'transparent'</span>,
        <span class="hljs-string">width :</span> circleWidth + <span class="hljs-string">'dp'</span>,
        <span class="hljs-string">widthNumber :</span> circleWidth,
        <span class="hljs-string">height :</span> circleWidth + <span class="hljs-string">'dp'</span>,
        <span class="hljs-string">heightNumber :</span> circleWidth,
        <span class="hljs-string">left :</span> <span class="hljs-string">'10dp'</span>,
        <span class="hljs-string">top :</span> <span class="hljs-string">'10dp'</span>,
        <span class="hljs-string">leftNumber :</span> <span class="hljs-number">10</span>,
        <span class="hljs-string">topNumber :</span> <span class="hljs-number">10</span>,
        <span class="hljs-string">zIndex :</span> <span class="hljs-number">4</span>,
    });
    var dragView = Titanium.UI.createView({
        <span class="hljs-string">backgroundColor :</span> <span class="hljs-string">'transparent'</span>,
        <span class="hljs-string">opacity :</span> <span class="hljs-number">1</span>,
        <span class="hljs-string">width :</span> circleWidth + <span class="hljs-string">'dp'</span>,
        <span class="hljs-string">height :</span> circleWidth + <span class="hljs-string">'dp'</span>,
        <span class="hljs-string">widthNumber :</span> circleWidth,
        <span class="hljs-string">heightNumber :</span> circleWidth,
        <span class="hljs-string">left :</span> <span class="hljs-string">'10dp'</span>,
        <span class="hljs-string">top :</span> <span class="hljs-string">'20dp'</span>,
        <span class="hljs-string">leftNumber :</span> <span class="hljs-number">10</span>,
        <span class="hljs-string">topNumber :</span> <span class="hljs-number">20</span>,
        <span class="hljs-string">zIndex :</span> <span class="hljs-number">4</span>
    });
    var targetView = Ti.UI.createImageView({
        <span class="hljs-string">image :</span> imagesPath + <span class="hljs-string">"KineduPaperPlane.png"</span>,
        <span class="hljs-string">width :</span> <span class="hljs-string">'100dp'</span>,
        <span class="hljs-string">widthNumber :</span> <span class="hljs-number">100</span>,
        <span class="hljs-string">height :</span> <span class="hljs-string">'100dp'</span>,
        <span class="hljs-string">heightNumber :</span> <span class="hljs-number">100</span>,
        <span class="hljs-string">bottom :</span> <span class="hljs-string">'-120dp'</span>,
        <span class="hljs-string">bottomNumber :</span> -<span class="hljs-number">120</span>
    });
    dragView.addEventListener(<span class="hljs-string">'touchstart'</span>, function(e) {
        <span class="hljs-keyword">if</span> (dragEnabled == <span class="hljs-literal">true</span>) {
            curX = e.x;
            curY = e.y;
        }
    });

    dragView.addEventListener(<span class="hljs-string">'touchmove'</span>, function(e) {
        <span class="hljs-keyword">if</span> (dragEnabled == <span class="hljs-literal">true</span>) {
            <span class="hljs-keyword">if</span> (targetViewDisplayed == <span class="hljs-literal">false</span>) {
                targetView.animate({
                    <span class="hljs-string">bottom :</span> <span class="hljs-string">'20dp'</span>,
                    <span class="hljs-string">duration :</span> <span class="hljs-number">200</span>
                });
                targetView.bottomNumber = <span class="hljs-number">20</span>;
                targetViewDisplayed = <span class="hljs-literal">true</span>;
            }

            deltaX = e.x - curX;
            deltaY = e.y - curY;
            currentPositionX = initialViewX + deltaX;
            currentPositionY = initialViewY + deltaY;

            draggedView.setLeft(currentPositionX + <span class="hljs-string">'dp'</span>);
            draggedView.leftNumber = currentPositionX;
            draggedView.setTop(currentPositionY + <span class="hljs-string">'dp'</span>);
            draggedView.topNumber = currentPositionY;

        }
    });

    function recallControl() {
        var animateControlToOrigin = Ti.UI.createAnimation({
            <span class="hljs-string">left :</span> initialViewX,
            <span class="hljs-string">top :</span> initialViewY,
            <span class="hljs-string">duration :</span> <span class="hljs-number">300</span>,
        });
        animateControlToOrigin.addEventListener(<span class="hljs-string">"complete"</span>, function(e) {

            draggedView.setLeft(initialViewX + <span class="hljs-string">'dp'</span>);
            draggedView.leftNumber = initialViewX;
            draggedView.setTop(initialViewY + <span class="hljs-string">'dp'</span>);
            draggedView.topNumber = initialViewY;

            dragView.setLeft(initialViewX + <span class="hljs-string">'dp'</span>);
            dragView.leftNumber = initialViewX;
            dragView.setTop(initialViewY + <span class="hljs-string">'dp'</span>);
            dragView.topNumber = initialViewY;

        });

        draggedView.animate(animateControlToOrigin);
    }

    dragView.addEventListener(<span class="hljs-string">"touchend"</span>, function(e) {
        <span class="hljs-keyword">if</span> (dragEnabled == <span class="hljs-literal">true</span>) {

            <span class="hljs-keyword">if</span> (targetViewDisplayed == <span class="hljs-literal">true</span>) {
                var leftLimit = <span class="hljs-literal">true</span>;
                var rightLimit = <span class="hljs-literal">true</span>;
                var topLimit = <span class="hljs-literal">false</span>;
                var lowerLimit = <span class="hljs-literal">false</span>;

                <span class="hljs-keyword">if</span> (currentPositionY &gt; (Ti.Platform.displayCaps.platformHeight - circleWidth - <span class="hljs-number">100</span>)) {
                    topLimit = <span class="hljs-literal">true</span>;
                }

                <span class="hljs-keyword">if</span> (currentPositionY &lt; Ti.Platform.displayCaps.platformHeight) {
                    lowerLimit = <span class="hljs-literal">true</span>;
                }

                <span class="hljs-keyword">if</span> (leftLimit &amp;&amp; rightLimit &amp;&amp; topLimit &amp;&amp; lowerLimit) {
                    var circleWidthAnimated = <span class="hljs-number">20</span>;

                    var animationLeft = (Ti.Platform.displayCaps.platformWidth <span class="hljs-regexp">/ 2) - (circleWidth /</span> <span class="hljs-number">2</span>);
                    var draggedViewAwayAnimation = Ti.UI.createAnimation({
                        <span class="hljs-string">left :</span> animationLeft + <span class="hljs-string">'dp'</span>,
                        <span class="hljs-string">height :</span> circleWidthAnimated + <span class="hljs-string">'dp'</span>,
                        <span class="hljs-string">width :</span> circleWidthAnimated + <span class="hljs-string">'dp'</span>,
                        <span class="hljs-string">borderRadius :</span> circleWidthAnimated / <span class="hljs-number">2</span>,
                        <span class="hljs-string">opacity :</span> <span class="hljs-number">0</span>,
                        <span class="hljs-string">duration :</span> <span class="hljs-number">400</span>
                    })
                    draggedView.animate(draggedViewAwayAnimation);

                    var targetViewAwayAnimationPart2 = Ti.UI.createAnimation({
                        <span class="hljs-string">top :</span> <span class="hljs-string">'10dp'</span>,
                        <span class="hljs-string">left :</span> <span class="hljs-string">'-150dp'</span>,
                        <span class="hljs-string">duration :</span> <span class="hljs-number">1200</span>,
                        <span class="hljs-string">opacity :</span> <span class="hljs-number">0</span>,
                    });
                    draggedViewAwayAnimation.addEventListener(<span class="hljs-string">"complete"</span>, function(e) {
                        targetView.animate(targetViewAwayAnimationPart1);
                        targetView.leftNumber = animationLeft;
                        targetView.heightNumber = circleWidthAnimated;
                        targetView.widthNumber = circleWidthAnimated;
                    });

                    var animationLeftPart1 = (Ti.Platform.displayCaps.platformWidth / <span class="hljs-number">2</span>) - circleWidthAnimated - (<span class="hljs-number">2</span>) + <span class="hljs-number">30</span>;
                    var targetViewAwayAnimationPart1 = Ti.UI.createAnimation({
                        <span class="hljs-string">bottom :</span> <span class="hljs-number">0</span>,
                        <span class="hljs-string">left :</span> animationLeftPart1 + <span class="hljs-string">'dp'</span>,
                        <span class="hljs-string">duration :</span> <span class="hljs-number">600</span>,
                    });

                    targetViewAwayAnimationPart1.addEventListener(<span class="hljs-string">"complete"</span>, function(e) {
                        targetView.animate(targetViewAwayAnimationPart2);
                        targetView.bottomNumber = <span class="hljs-number">0</span>;
                        targetView.leftNumber = animationLeftPart1;
                    });

                    targetViewAwayAnimationPart2.addEventListener(<span class="hljs-string">"complete"</span>, function(e) {
                        dragEnabled = <span class="hljs-literal">false</span>;
                        targetView.leftNumber = -<span class="hljs-number">150</span>;
                        targetView.top = <span class="hljs-number">10</span>;
                    });

                } <span class="hljs-keyword">else</span> {

                    targetView.animate({
                        <span class="hljs-string">bottom :</span> <span class="hljs-string">'-20dp'</span>,
                        <span class="hljs-string">duration :</span> <span class="hljs-number">200</span>
                    });
                    targetView.bottomNumber = -<span class="hljs-number">20</span>;
                    targetViewDisplayed = <span class="hljs-literal">false</span>;

                    recallControl();
                }
            }
        }
    });
</code></pre><p>The dragView is a transparent view I use to detect the touch events and the draggedView is the one being moved by the changes detected on those events. </p>
<p>Since I display views using dpi, I added some properties that contains the numerical values for properties like top, left, width, etc. If there&#39;s a way to work with dpi and arithmetical operations, I would be glad to be told how to do it. </p>
<p>Returning to my problem, I don&#39;t understand the reason for the touchmove event to stop. The message I&#39;m getting, gives me the impression that the numbers of fingers (in this case only one finger) isn&#39;t being registered.</p>
<p>Can someone direct in the issue at hand? Thanks for any help in advance.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="July 31st 2013, 9:35:42 pm">July 31st 2013</span>
				by <span class='authorname'>Sergio Trevino</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>animation</span></li>
					
						<li><span class='tagname'>drag &amp; drop</span></li>
					
						<li><span class='tagname'>titanium</span></li>
					
						<li><span class='tagname'>view</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>0</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>0 Answers</h3>

	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
