<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>twitter share Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>twitter share</h1>
		</header>
		<section>
			<p>hi i have a problem in my project. that i&#39;m not to share the tweet in twitter. i&#39;m getting the error like ,&quot;please migrate to api v 1.1. code:68&quot; is coming.i have edited in social.js like this &quot;https:&#x2F;&#x2F;api.twitter.com&#x2F;1.1&#x2F;statuses&#x2F;update.json&quot;. even though it&#39;s showing the same error.cany one help me please</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> social = <span class="hljs-built_in">require</span>(<span class="hljs-string">'alloy/social'</span>);

<span class="hljs-keyword">var</span> twitter = social.create({
    site: <span class="hljs-string">'Twitter'</span>,
    consumerKey: <span class="hljs-string">'SXwOT1Sibs2cYvDQsNXbgw'</span>, 
    consumerSecret: <span class="hljs-string">'gc5fVZ66ETaLXCe0IJlI7KEY00TLdSoCrR2YFQgIWtE'</span> 
});

 twitter.share({

        message: <span class="hljs-string">"event_image"</span>,
        success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            alert(<span class="hljs-string">'Tweeted!'</span>);
        },
        error: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
            alert(<span class="hljs-string">'Oh no! '</span> + error);
        }
   }); 

    });
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="November 13th 2013, 12:46:45 pm">November 13th 2013</span>
				by <span class='authorname'>narasimha reddy</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>twitter</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Any one help me please</p>
</div>
							<div class="author">
								&mdash; commented <span title="November 15th 2013, 3:35:24 am">November 15th 2013</span>
								by <span class='authorname'>narasimha reddy</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-271336">
				
						<section>
							<p>I&#39;ve just sorted this doing the same thing as you mentioned and it works fine.</p>
<p>Where are you editing the file? If you are editing under the &#39;Resources&#39; folder your changes will get lost whenever you recompile your app.</p>
<p>You need to copy social.js from the resources folder and paste it into the: Assets&#x2F;Alloy folder (create if it doesn&#39;t exist). This will then override the built in file.</p>
<p>Remember that any future updates to social.js will be overridden by your custom file so you may want to remove the file and repeat the above process after significant updates.</p>
<p>Hope that helps</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 15th 2013, 7:46:23 am">November 15th 2013</span>
								by <span class='authorname'>Martyn Joyce</span><br>
								<a class="icon-bg icon-link" href="question/159446/twitter-share.html#answer-271336" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>yes i have created social.js in  Assets&#x2F;alloy folder ,in social.js like this will be there</p>
<pre><code class="hljs"><span class="hljs-comment">/**
 * This is a JavaScript module for Titanium Mobile made by Dawson Toth. I adapted the majority of this code from other
 * authors to make it easy to share content on social sites through a single interface.
 *
 * Example usage: http://appc.me/social.sample.js
 *
 */</span>


<span class="hljs-comment">//</span>
<span class="hljs-comment">// We'll start off by defining what's normally included in external files "sha1.js" and "oauth.js".</span>
<span class="hljs-comment">// To keep things simple, I'm going to define them inline. (If this violates some licenses and someone</span>
<span class="hljs-comment">// cares enough to sue me, I'll move them to their own files. Sound good?</span>
<span class="hljs-comment">//</span>
<span class="hljs-comment">/*
 * A JavaScript implementation of the Secure Hash Algorithm, SHA-1, as defined
 * in FIPS PUB 180-1
 * Version 2.1a Copyright Paul Johnston 2000 - 2002.
 * Other contributors: Greg Holt, Andrew Kepert, Ydnar, Lostinet
 * Distributed under the BSD License
 * See http://pajhome.org.uk/crypt/md5 for details.
 */</span>

<span class="hljs-comment">/*
 * Configurable variables. You may need to tweak these to be compatible with
 * the server-side, but the defaults work in most cases.
 */</span>
<span class="hljs-keyword">var</span> hexcase = <span class="hljs-number">0</span>;
<span class="hljs-comment">/* hex output format. 0 - lowercase; 1 - uppercase */</span>
<span class="hljs-keyword">var</span> b64pad = <span class="hljs-string">""</span>;
<span class="hljs-comment">/* base-64 pad character. "=" for strict RFC compliance */</span>
<span class="hljs-keyword">var</span> chrsz = <span class="hljs-number">8</span>;
<span class="hljs-comment">/* bits per input character. 8 - ASCII; 16 - Unicode */</span>

<span class="hljs-comment">/*
 * These are the functions you'll usually want to call
 * They take string arguments and return either hex or base-64 encoded strings
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hex_sha1</span>(<span class="hljs-params">s</span>) </span>{
    <span class="hljs-keyword">return</span> binb2hex(core_sha1(str2binb(s), s.length * chrsz));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">b64_sha1</span>(<span class="hljs-params">s</span>) </span>{
    <span class="hljs-keyword">return</span> binb2b64(core_sha1(str2binb(s), s.length * chrsz));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str_sha1</span>(<span class="hljs-params">s</span>) </span>{
    <span class="hljs-keyword">return</span> binb2str(core_sha1(str2binb(s), s.length * chrsz));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hex_hmac_sha1</span>(<span class="hljs-params">key, data</span>) </span>{
    <span class="hljs-keyword">return</span> binb2hex(core_hmac_sha1(key, data));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">b64_hmac_sha1</span>(<span class="hljs-params">key, data</span>) </span>{
    <span class="hljs-keyword">return</span> binb2b64(core_hmac_sha1(key, data));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str_hmac_sha1</span>(<span class="hljs-params">key, data</span>) </span>{
    <span class="hljs-keyword">return</span> binb2str(core_hmac_sha1(key, data));
}

<span class="hljs-comment">/*
 * Perform a simple self-test to see if the VM is working
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sha1_vm_test</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> hex_sha1(<span class="hljs-string">"abc"</span>) == <span class="hljs-string">"a9993e364706816aba3e25717850c26c9cd0d89d"</span>;
}

<span class="hljs-comment">/*
 * Calculate the SHA-1 of an array of big-endian words, and a bit length
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">core_sha1</span>(<span class="hljs-params">x, len</span>) </span>{ <span class="hljs-comment">/* append padding */</span>
    x[len &gt;&gt; <span class="hljs-number">5</span>] |= <span class="hljs-number">0x80</span> &lt;&lt; (<span class="hljs-number">24</span> - len % <span class="hljs-number">32</span>);
    x[((len + <span class="hljs-number">64</span> &gt;&gt; <span class="hljs-number">9</span>) &lt;&lt; <span class="hljs-number">4</span>) + <span class="hljs-number">15</span>] = len;

    <span class="hljs-keyword">var</span> w = <span class="hljs-built_in">Array</span>(<span class="hljs-number">80</span>);
    <span class="hljs-keyword">var</span> a = <span class="hljs-number">1732584193</span>;
    <span class="hljs-keyword">var</span> b = -<span class="hljs-number">271733879</span>;
    <span class="hljs-keyword">var</span> c = -<span class="hljs-number">1732584194</span>;
    <span class="hljs-keyword">var</span> d = <span class="hljs-number">271733878</span>;
    <span class="hljs-keyword">var</span> e = -<span class="hljs-number">1009589776</span>;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; x.length; i += <span class="hljs-number">16</span>) {
        <span class="hljs-keyword">var</span> olda = a;
        <span class="hljs-keyword">var</span> oldb = b;
        <span class="hljs-keyword">var</span> oldc = c;
        <span class="hljs-keyword">var</span> oldd = d;
        <span class="hljs-keyword">var</span> olde = e;

        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">80</span>; j++) {
            <span class="hljs-keyword">if</span> (j &lt; <span class="hljs-number">16</span>) w[j] = x[i + j];
            <span class="hljs-keyword">else</span> w[j] = rol(w[j - <span class="hljs-number">3</span>] ^ w[j - <span class="hljs-number">8</span>] ^ w[j - <span class="hljs-number">14</span>] ^ w[j - <span class="hljs-number">16</span>], <span class="hljs-number">1</span>);
            <span class="hljs-keyword">var</span> t = safe_add(safe_add(rol(a, <span class="hljs-number">5</span>), sha1_ft(j, b, c, d)), safe_add(safe_add(e, w[j]), sha1_kt(j)));
            e = d;
            d = c;
            c = rol(b, <span class="hljs-number">30</span>);
            b = a;
            a = t;
        }

        a = safe_add(a, olda);
        b = safe_add(b, oldb);
        c = safe_add(c, oldc);
        d = safe_add(d, oldd);
        e = safe_add(e, olde);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>(a, b, c, d, e);

}

<span class="hljs-comment">/*
 * Perform the appropriate triplet combination function for the current
 * iteration
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sha1_ft</span>(<span class="hljs-params">t, b, c, d</span>) </span>{
    <span class="hljs-keyword">if</span> (t &lt; <span class="hljs-number">20</span>) <span class="hljs-keyword">return</span> (b &amp; c) | ((~b) &amp; d);
    <span class="hljs-keyword">if</span> (t &lt; <span class="hljs-number">40</span>) <span class="hljs-keyword">return</span> b ^ c ^ d;
    <span class="hljs-keyword">if</span> (t &lt; <span class="hljs-number">60</span>) <span class="hljs-keyword">return</span> (b &amp; c) | (b &amp; d) | (c &amp; d);
    <span class="hljs-keyword">return</span> b ^ c ^ d;
}

<span class="hljs-comment">/*
 * Determine the appropriate additive constant for the current iteration
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sha1_kt</span>(<span class="hljs-params">t</span>) </span>{
    <span class="hljs-keyword">return</span> (t &lt; <span class="hljs-number">20</span>) ? <span class="hljs-number">1518500249</span> : (t &lt; <span class="hljs-number">40</span>) ? <span class="hljs-number">1859775393</span> : (t &lt; <span class="hljs-number">60</span>) ? -<span class="hljs-number">1894007588</span> : -<span class="hljs-number">899497514</span>;
}

<span class="hljs-comment">/*
 * Calculate the HMAC-SHA1 of a key and some data
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">core_hmac_sha1</span>(<span class="hljs-params">key, data</span>) </span>{
    <span class="hljs-keyword">var</span> bkey = str2binb(key);
    <span class="hljs-keyword">if</span> (bkey.length &gt; <span class="hljs-number">16</span>) bkey = core_sha1(bkey, key.length * chrsz);

    <span class="hljs-keyword">var</span> ipad = <span class="hljs-built_in">Array</span>(<span class="hljs-number">16</span>),
        opad = <span class="hljs-built_in">Array</span>(<span class="hljs-number">16</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++) {
        ipad[i] = bkey[i] ^ <span class="hljs-number">0x36363636</span>;
        opad[i] = bkey[i] ^ <span class="hljs-number">0x5C5C5C5C</span>;
    }

    <span class="hljs-keyword">var</span> hash = core_sha1(ipad.concat(str2binb(data)), <span class="hljs-number">512</span> + data.length * chrsz);
    <span class="hljs-keyword">return</span> core_sha1(opad.concat(hash), <span class="hljs-number">512</span> + <span class="hljs-number">160</span>);
}

<span class="hljs-comment">/*
 * Add integers, wrapping at 2^32. This uses 16-bit operations internally
 * to work around bugs in some JS interpreters.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">safe_add</span>(<span class="hljs-params">x, y</span>) </span>{
    <span class="hljs-keyword">var</span> lsw = (x &amp; <span class="hljs-number">0xFFFF</span>) + (y &amp; <span class="hljs-number">0xFFFF</span>);
    <span class="hljs-keyword">var</span> msw = (x &gt;&gt; <span class="hljs-number">16</span>) + (y &gt;&gt; <span class="hljs-number">16</span>) + (lsw &gt;&gt; <span class="hljs-number">16</span>);
    <span class="hljs-keyword">return</span> (msw &lt;&lt; <span class="hljs-number">16</span>) | (lsw &amp; <span class="hljs-number">0xFFFF</span>);
}

<span class="hljs-comment">/*
 * Bitwise rotate a 32-bit number to the left.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rol</span>(<span class="hljs-params">num, cnt</span>) </span>{
    <span class="hljs-keyword">return</span> (num &lt;&lt; cnt) | (num &gt;&gt;&gt; (<span class="hljs-number">32</span> - cnt));
}

<span class="hljs-comment">/*
 * Convert an 8-bit or 16-bit string to an array of big-endian words
 * In 8-bit function, characters &gt;255 have their hi-byte silently ignored.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str2binb</span>(<span class="hljs-params">str</span>) </span>{
    <span class="hljs-keyword">var</span> bin = <span class="hljs-built_in">Array</span>();
    <span class="hljs-keyword">var</span> mask = (<span class="hljs-number">1</span> &lt;&lt; chrsz) - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; str.length * chrsz; i += chrsz)
        bin[i &gt;&gt; <span class="hljs-number">5</span>] |= (str.charCodeAt(i / chrsz) &amp; mask) &lt;&lt; (<span class="hljs-number">32</span> - chrsz - i % <span class="hljs-number">32</span>);
    <span class="hljs-keyword">return</span> bin;
}

<span class="hljs-comment">/*
 * Convert an array of big-endian words to a string
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">binb2str</span>(<span class="hljs-params">bin</span>) </span>{
    <span class="hljs-keyword">var</span> str = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">var</span> mask = (<span class="hljs-number">1</span> &lt;&lt; chrsz) - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; bin.length * <span class="hljs-number">32</span>; i += chrsz)
        str += <span class="hljs-built_in">String</span>.fromCharCode((bin[i &gt;&gt; <span class="hljs-number">5</span>] &gt;&gt;&gt; (<span class="hljs-number">32</span> - chrsz - i % <span class="hljs-number">32</span>)) &amp; mask);
    <span class="hljs-keyword">return</span> str;
}

<span class="hljs-comment">/*
 * Convert an array of big-endian words to a hex string.
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">binb2hex</span>(<span class="hljs-params">binarray</span>) </span>{
    <span class="hljs-keyword">var</span> hex_tab = hexcase ? <span class="hljs-string">"0123456789ABCDEF"</span> : <span class="hljs-string">"0123456789abcdef"</span>;
    <span class="hljs-keyword">var</span> str = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; binarray.length * <span class="hljs-number">4</span>; i++) {
        str += hex_tab.charAt((binarray[i &gt;&gt; <span class="hljs-number">2</span>] &gt;&gt; ((<span class="hljs-number">3</span> - i % <span class="hljs-number">4</span>) * <span class="hljs-number">8</span> + <span class="hljs-number">4</span>)) &amp; <span class="hljs-number">0xF</span>) + hex_tab.charAt((binarray[i &gt;&gt; <span class="hljs-number">2</span>] &gt;&gt; ((<span class="hljs-number">3</span> - i % <span class="hljs-number">4</span>) * <span class="hljs-number">8</span>)) &amp; <span class="hljs-number">0xF</span>);
    }
    <span class="hljs-keyword">return</span> str;
}

<span class="hljs-comment">/*
 * Convert an array of big-endian words to a base-64 string
 */</span>

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">binb2b64</span>(<span class="hljs-params">binarray</span>) </span>{
    <span class="hljs-keyword">var</span> tab = <span class="hljs-string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>;
    <span class="hljs-keyword">var</span> str = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; binarray.length * <span class="hljs-number">4</span>; i += <span class="hljs-number">3</span>) {
        <span class="hljs-keyword">var</span> triplet = (((binarray[i &gt;&gt; <span class="hljs-number">2</span>] &gt;&gt; <span class="hljs-number">8</span> * (<span class="hljs-number">3</span> - i % <span class="hljs-number">4</span>)) &amp; <span class="hljs-number">0xFF</span>) &lt;&lt; <span class="hljs-number">16</span>) | (((binarray[i + <span class="hljs-number">1</span> &gt;&gt; <span class="hljs-number">2</span>] &gt;&gt; <span class="hljs-number">8</span> * (<span class="hljs-number">3</span> - (i + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>)) &amp; <span class="hljs-number">0xFF</span>) &lt;&lt; <span class="hljs-number">8</span>) | ((binarray[i + <span class="hljs-number">2</span> &gt;&gt; <span class="hljs-number">2</span>] &gt;&gt; <span class="hljs-number">8</span> * (<span class="hljs-number">3</span> - (i + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>)) &amp; <span class="hljs-number">0xFF</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++) {
            <span class="hljs-keyword">if</span> (i * <span class="hljs-number">8</span> + j * <span class="hljs-number">6</span> &gt; binarray.length * <span class="hljs-number">32</span>) str += b64pad;
            <span class="hljs-keyword">else</span> str += tab.charAt((triplet &gt;&gt; <span class="hljs-number">6</span> * (<span class="hljs-number">3</span> - j)) &amp; <span class="hljs-number">0x3F</span>);
        }
    }
    <span class="hljs-keyword">return</span> str;
}

<span class="hljs-comment">/*
 * Copyright 2008 Netflix, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>

<span class="hljs-comment">/* Here's some JavaScript software for implementing OAuth.

 This isn't as useful as you might hope. OAuth is based around
 allowing tools and websites to talk to each other. However,
 JavaScript running in web browsers is hampered by security
 restrictions that prevent code running on one website from
 accessing data stored or served on another.

 Before you start hacking, make sure you understand the limitations
 posed by cross-domain XMLHttpRequest.

 On the bright side, some platforms use JavaScript as their
 language, but enable the programmer to access other web sites.
 Examples include Google Gadgets, and Microsoft Vista Sidebar.
 For those platforms, this library should come in handy.
 */</span>

<span class="hljs-comment">// The HMAC-SHA1 signature method calls b64_hmac_sha1, defined by</span>
<span class="hljs-comment">// http://pajhome.org.uk/crypt/md5/sha1.js</span>
<span class="hljs-comment">/* An OAuth message is represented as an object like this:
 {method: "GET", action: "http://server.com/path", parameters: ...}

 The parameters may be either a map {name: value, name2: value2}
 or an Array of name-value pairs [[name, value], [name2, value2]].
 The latter representation is more powerful: it supports parameters
 in a specific sequence, or several parameters with the same name;
 for example [["a", 1], ["b", 2], ["a", 3]].

 Parameter names and values are NOT percent-encoded in an object.
 They must be encoded before transmission and decoded after reception.
 For example, this message object:
 {method: "GET", action: "http://server/path", parameters: {p: "x y"}}
 ... can be transmitted as an HTTP request that begins:
 GET /path?p=x%20y HTTP/1.0
 (This isn't a valid OAuth request, since it lacks a signature etc.)
 Note that the object "x y" is transmitted as x%20y. To encode
 parameters, you can call OAuth.addToURL, OAuth.formEncode or
 OAuth.getAuthorization.

 This message object model harmonizes with the browser object model for
 input elements of an form, whose value property isn't percent encoded.
 The browser encodes each value before transmitting it. For example,
 see consumer.setInputs in example/consumer.js.
 */</span>

<span class="hljs-comment">/* This script needs to know what time it is. By default, it uses the local
 clock (new Date), which is apt to be inaccurate in browsers. To do
 better, you can load this script from a URL whose query string contains
 an oauth_timestamp parameter, whose value is a current Unix timestamp.
 For example, when generating the enclosing document using PHP:

 &lt;script src="oauth.js?oauth_timestamp=&lt;?=time()?&gt;" ...

 Another option is to call OAuth.correctTimestamp with a Unix timestamp.
 */</span>

<span class="hljs-keyword">var</span> OAuth;
<span class="hljs-keyword">if</span> (OAuth == <span class="hljs-literal">null</span>) OAuth = {};

OAuth.setProperties = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setProperties</span>(<span class="hljs-params">into, from</span>) </span>{
    <span class="hljs-keyword">if</span> (into != <span class="hljs-literal">null</span> &amp;&amp; from != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> from) {
            into[key] = from[key];
        }
    }
    <span class="hljs-keyword">return</span> into;
}

OAuth.setProperties(OAuth, <span class="hljs-comment">// utility functions</span>
    {
        percentEncode: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">percentEncode</span>(<span class="hljs-params">s</span>) </span>{
            <span class="hljs-keyword">if</span> (s == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
            }
            <span class="hljs-keyword">if</span> (s <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
                <span class="hljs-keyword">var</span> e = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; s.length; ++s) {
                    <span class="hljs-keyword">if</span> (e != <span class="hljs-string">""</span>) e += <span class="hljs-string">'&amp;'</span>;
                    e += OAuth.percentEncode(s[i]);
                }
                <span class="hljs-keyword">return</span> e;
            }
            s = <span class="hljs-built_in">encodeURIComponent</span>(s);
            <span class="hljs-comment">// Now replace the values which encodeURIComponent doesn't do</span>
            <span class="hljs-comment">// encodeURIComponent ignores: - _ . ! ~ * ' ( )</span>
            <span class="hljs-comment">// OAuth dictates the only ones you can ignore are: - _ . ~</span>
            <span class="hljs-comment">// Source: http://developer.mozilla.org/en/docs/Core_JavaScript_1.5_Reference:Global_Functions:encodeURIComponent</span>
            s = s.replace(<span class="hljs-regexp">/\!/g</span>, <span class="hljs-string">"%21"</span>);
            s = s.replace(<span class="hljs-regexp">/\*/g</span>, <span class="hljs-string">"%2A"</span>);
            s = s.replace(<span class="hljs-regexp">/\'/g</span>, <span class="hljs-string">"%27"</span>);
            s = s.replace(<span class="hljs-regexp">/\(/g</span>, <span class="hljs-string">"%28"</span>);
            s = s.replace(<span class="hljs-regexp">/\)/g</span>, <span class="hljs-string">"%29"</span>);
            <span class="hljs-keyword">return</span> s;
        },
        decodePercent: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decodePercent</span>(<span class="hljs-params">s</span>) </span>{
            <span class="hljs-keyword">if</span> (s != <span class="hljs-literal">null</span>) {
                <span class="hljs-comment">// Handle application/x-www-form-urlencoded, which is defined by</span>
                <span class="hljs-comment">// http://www.w3.org/TR/html4/interact/forms.html#h-17.13.4.1</span>
                s = s.replace(<span class="hljs-regexp">/\+/g</span>, <span class="hljs-string">" "</span>);
            }
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">decodeURIComponent</span>(s);
        },
        <span class="hljs-comment">/** Convert the given parameters to an Array of name-value pairs. */</span>
        getParameterList: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getParameterList</span>(<span class="hljs-params">parameters</span>) </span>{
            <span class="hljs-keyword">if</span> (parameters == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> [];
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> parameters != <span class="hljs-string">"object"</span>) {
                <span class="hljs-keyword">return</span> OAuth.decodeForm(parameters + <span class="hljs-string">""</span>);
            }
            <span class="hljs-keyword">if</span> (parameters <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
                <span class="hljs-keyword">return</span> parameters;
            }
            <span class="hljs-keyword">var</span> list = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p <span class="hljs-keyword">in</span> parameters) {
                list.push([p, parameters[p]]);
            }
            <span class="hljs-keyword">return</span> list;
        },
        <span class="hljs-comment">/** Convert the given parameters to a map from name to value. */</span>
        getParameterMap: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getParameterMap</span>(<span class="hljs-params">parameters</span>) </span>{
            <span class="hljs-keyword">if</span> (parameters == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> {};
            }
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> parameters != <span class="hljs-string">"object"</span>) {
                <span class="hljs-keyword">return</span> OAuth.getParameterMap(OAuth.decodeForm(parameters + <span class="hljs-string">""</span>));
            }
            <span class="hljs-keyword">if</span> (parameters <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
                <span class="hljs-keyword">var</span> map = {};
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p = <span class="hljs-number">0</span>; p &lt; parameters.length; ++p) {
                    <span class="hljs-keyword">var</span> key = parameters[p][<span class="hljs-number">0</span>];
                    <span class="hljs-keyword">if</span> (map[key] === <span class="hljs-literal">undefined</span>) { <span class="hljs-comment">// first value wins</span>
                        map[key] = parameters[p][<span class="hljs-number">1</span>];
                    }
                }
                <span class="hljs-keyword">return</span> map;
            }
            <span class="hljs-keyword">return</span> parameters;
        },
        getParameter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getParameter</span>(<span class="hljs-params">parameters, name</span>) </span>{
            <span class="hljs-keyword">if</span> (parameters <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p = <span class="hljs-number">0</span>; p &lt; parameters.length; ++p) {
                    <span class="hljs-keyword">if</span> (parameters[p][<span class="hljs-number">0</span>] == name) {
                        <span class="hljs-keyword">return</span> parameters[p][<span class="hljs-number">1</span>]; <span class="hljs-comment">// first value wins</span>
                    }
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> OAuth.getParameterMap(parameters)[name];
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        },
        formEncode: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">formEncode</span>(<span class="hljs-params">parameters</span>) </span>{
            <span class="hljs-keyword">var</span> form = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">var</span> list = OAuth.getParameterList(parameters);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p = <span class="hljs-number">0</span>; p &lt; list.length; ++p) {
                <span class="hljs-keyword">var</span> value = list[p][<span class="hljs-number">1</span>];
                <span class="hljs-keyword">if</span> (value == <span class="hljs-literal">null</span>) value = <span class="hljs-string">""</span>;
                <span class="hljs-keyword">if</span> (form != <span class="hljs-string">""</span>) form += <span class="hljs-string">'&amp;'</span>;
                form += OAuth.percentEncode(list[p][<span class="hljs-number">0</span>]) + <span class="hljs-string">'='</span> + OAuth.percentEncode(value);
            }
            <span class="hljs-keyword">return</span> form;
        },
        decodeForm: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decodeForm</span>(<span class="hljs-params">form</span>) </span>{
            <span class="hljs-keyword">var</span> list = [];
            <span class="hljs-keyword">var</span> nvps = form.split(<span class="hljs-string">'&amp;'</span>);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; nvps.length; ++n) {
                <span class="hljs-keyword">var</span> nvp = nvps[n];
                <span class="hljs-keyword">if</span> (nvp == <span class="hljs-string">""</span>) {
                    <span class="hljs-keyword">continue</span>;
                }
                <span class="hljs-keyword">var</span> equals = nvp.indexOf(<span class="hljs-string">'='</span>);
                <span class="hljs-keyword">var</span> name;
                <span class="hljs-keyword">var</span> value;
                <span class="hljs-keyword">if</span> (equals &lt; <span class="hljs-number">0</span>) {
                    name = OAuth.decodePercent(nvp);
                    value = <span class="hljs-literal">null</span>;
                } <span class="hljs-keyword">else</span> {
                    name = OAuth.decodePercent(nvp.substring(<span class="hljs-number">0</span>, equals));
                    value = OAuth.decodePercent(nvp.substring(equals + <span class="hljs-number">1</span>));
                }
                list.push([name, value]);
            }
            <span class="hljs-keyword">return</span> list;
        },
        setParameter: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setParameter</span>(<span class="hljs-params">message, name, value</span>) </span>{
            <span class="hljs-keyword">var</span> parameters = message.parameters;
            <span class="hljs-keyword">if</span> (parameters <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p = <span class="hljs-number">0</span>; p &lt; parameters.length; ++p) {
                    <span class="hljs-keyword">if</span> (parameters[p][<span class="hljs-number">0</span>] == name) {
                        <span class="hljs-keyword">if</span> (value === <span class="hljs-literal">undefined</span>) {
                            parameters.splice(p, <span class="hljs-number">1</span>);
                        } <span class="hljs-keyword">else</span> {
                            parameters[p][<span class="hljs-number">1</span>] = value;
                            value = <span class="hljs-literal">undefined</span>;
                        }
                    }
                }
                <span class="hljs-keyword">if</span> (value !== <span class="hljs-literal">undefined</span>) {
                    parameters.push([name, value]);
                }
            } <span class="hljs-keyword">else</span> {
                parameters = OAuth.getParameterMap(parameters);
                parameters[name] = value;
                message.parameters = parameters;
            }
        },
        setParameters: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setParameters</span>(<span class="hljs-params">message, parameters</span>) </span>{
            <span class="hljs-keyword">var</span> list = OAuth.getParameterList(parameters);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; list.length; ++i) {
                OAuth.setParameter(message, list[i][<span class="hljs-number">0</span>], list[i][<span class="hljs-number">1</span>]);
            }
        },
        <span class="hljs-comment">/** Fill in parameters to help construct a request message.
         This function doesn't fill in every parameter.
         The accessor object should be like:
         {consumerKey:'foo', consumerSecret:'bar', accessorSecret:'nurn', token:'krelm', tokenSecret:'blah'}
         The accessorSecret property is optional.
         */</span>
        completeRequest: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">completeRequest</span>(<span class="hljs-params">message, accessor</span>) </span>{
            <span class="hljs-keyword">if</span> (message.method == <span class="hljs-literal">null</span>) {
                message.method = <span class="hljs-string">"GET"</span>;
            }
            <span class="hljs-keyword">var</span> map = OAuth.getParameterMap(message.parameters);
            <span class="hljs-keyword">if</span> (map.oauth_consumer_key == <span class="hljs-literal">null</span>) {
                OAuth.setParameter(message, <span class="hljs-string">"oauth_consumer_key"</span>, accessor.consumerKey || <span class="hljs-string">""</span>);
            }
            <span class="hljs-keyword">if</span> (map.oauth_token == <span class="hljs-literal">null</span> &amp;&amp; accessor.token != <span class="hljs-literal">null</span>) {
                OAuth.setParameter(message, <span class="hljs-string">"oauth_token"</span>, accessor.token);
            }
            <span class="hljs-keyword">if</span> (map.oauth_version == <span class="hljs-literal">null</span>) {
                OAuth.setParameter(message, <span class="hljs-string">"oauth_version"</span>, <span class="hljs-string">"1.0"</span>);
            }
            <span class="hljs-keyword">if</span> (map.oauth_timestamp == <span class="hljs-literal">null</span>) {
                OAuth.setParameter(message, <span class="hljs-string">"oauth_timestamp"</span>, OAuth.timestamp());
            }
            <span class="hljs-keyword">if</span> (map.oauth_nonce == <span class="hljs-literal">null</span>) {
                OAuth.setParameter(message, <span class="hljs-string">"oauth_nonce"</span>, OAuth.nonce(<span class="hljs-number">6</span>));
            }
            OAuth.SignatureMethod.sign(message, accessor);
        },
        setTimestampAndNonce: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">setTimestampAndNonce</span>(<span class="hljs-params">message</span>) </span>{
            OAuth.setParameter(message, <span class="hljs-string">"oauth_timestamp"</span>, OAuth.timestamp());
            OAuth.setParameter(message, <span class="hljs-string">"oauth_nonce"</span>, OAuth.nonce(<span class="hljs-number">6</span>));
        },
        addToURL: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">addToURL</span>(<span class="hljs-params">url, parameters</span>) </span>{
            newURL = url;
            <span class="hljs-keyword">if</span> (parameters != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">var</span> toAdd = OAuth.formEncode(parameters);
                <span class="hljs-keyword">if</span> (toAdd.length &gt; <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">var</span> q = url.indexOf(<span class="hljs-string">'?'</span>);
                    <span class="hljs-keyword">if</span> (q &lt; <span class="hljs-number">0</span>) newURL += <span class="hljs-string">'?'</span>;
                    <span class="hljs-keyword">else</span> newURL += <span class="hljs-string">'&amp;'</span>;
                    newURL += toAdd;
                }
            }
            <span class="hljs-keyword">return</span> newURL;
        },
        <span class="hljs-comment">/** Construct the value of the Authorization header for an HTTP request. */</span>
        getAuthorizationHeader: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getAuthorizationHeader</span>(<span class="hljs-params">realm, parameters</span>) </span>{
            <span class="hljs-keyword">var</span> header = <span class="hljs-string">'OAuth realm="'</span> + OAuth.percentEncode(realm) + <span class="hljs-string">'"'</span>;
            <span class="hljs-keyword">var</span> list = OAuth.getParameterList(parameters);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p = <span class="hljs-number">0</span>; p &lt; list.length; ++p) {
                <span class="hljs-keyword">var</span> parameter = list[p];
                <span class="hljs-keyword">var</span> name = parameter[<span class="hljs-number">0</span>];
                <span class="hljs-keyword">if</span> (name.indexOf(<span class="hljs-string">"oauth_"</span>) == <span class="hljs-number">0</span>) {
                    header += <span class="hljs-string">','</span> + OAuth.percentEncode(name) + <span class="hljs-string">'="'</span> + OAuth.percentEncode(parameter[<span class="hljs-number">1</span>]) + <span class="hljs-string">'"'</span>;
                }
            }
            <span class="hljs-keyword">return</span> header;
        },
        <span class="hljs-comment">/** Correct the time using a parameter from the URL from which the last script was loaded. */</span>
        correctTimestampFromSrc: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">correctTimestampFromSrc</span>(<span class="hljs-params">parameterName</span>) </span>{
            parameterName = parameterName || <span class="hljs-string">"oauth_timestamp"</span>;
            <span class="hljs-keyword">var</span> scripts = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">'script'</span>);
            <span class="hljs-keyword">if</span> (scripts == <span class="hljs-literal">null</span> || !scripts.length) <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">var</span> src = scripts[scripts.length - <span class="hljs-number">1</span>].src;
            <span class="hljs-keyword">if</span> (!src) <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">var</span> q = src.indexOf(<span class="hljs-string">"?"</span>);
            <span class="hljs-keyword">if</span> (q &lt; <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span>;
            parameters = OAuth.getParameterMap(OAuth.decodeForm(src.substring(q + <span class="hljs-number">1</span>)));
            <span class="hljs-keyword">var</span> t = parameters[parameterName];
            <span class="hljs-keyword">if</span> (t == <span class="hljs-literal">null</span>) <span class="hljs-keyword">return</span>;
            OAuth.correctTimestamp(t);
        },
        <span class="hljs-comment">/** Generate timestamps starting with the given value. */</span>
        correctTimestamp: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">correctTimestamp</span>(<span class="hljs-params">timestamp</span>) </span>{
            OAuth.timeCorrectionMsec = (timestamp * <span class="hljs-number">1000</span>) - (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime();
        },
        <span class="hljs-comment">/** The difference between the correct time and my clock. */</span>
        timeCorrectionMsec: <span class="hljs-number">0</span>,
        timestamp: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">timestamp</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">var</span> t = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime() + OAuth.timeCorrectionMsec;
            <span class="hljs-keyword">return</span> <span class="hljs-string">''</span> + <span class="hljs-built_in">Math</span>.floor(t / <span class="hljs-number">1000</span>);
        },
        nonce: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">nonce</span>(<span class="hljs-params">length</span>) </span>{
            <span class="hljs-keyword">var</span> chars = OAuth.nonce.CHARS;
            <span class="hljs-keyword">var</span> result = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; length; ++i) {
                <span class="hljs-keyword">var</span> rnum = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * chars.length);
                result += chars.substring(rnum, rnum + <span class="hljs-number">1</span>);
            }
            <span class="hljs-keyword">return</span> result;
        }
    });

OAuth.nonce.CHARS = <span class="hljs-string">"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz"</span>;

<span class="hljs-comment">/** Define a constructor function,
 without causing trouble to anyone who was using it as a namespace.
 That is, if parent[name] already existed and had properties,
 copy those properties into the new constructor.
 */</span>
OAuth.declareClass = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">declareClass</span>(<span class="hljs-params">parent, name, newConstructor</span>) </span>{
    <span class="hljs-keyword">var</span> previous = parent[name];
    parent[name] = newConstructor;
    <span class="hljs-keyword">if</span> (newConstructor != <span class="hljs-literal">null</span> &amp;&amp; previous != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> previous) {
            <span class="hljs-keyword">if</span> (key != <span class="hljs-string">"prototype"</span>) {
                newConstructor[key] = previous[key];
            }
        }
    }
    <span class="hljs-keyword">return</span> newConstructor;
}

<span class="hljs-comment">/** An abstract algorithm for signing messages. */</span>
OAuth.declareClass(OAuth, <span class="hljs-string">"SignatureMethod"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">OAuthSignatureMethod</span>(<span class="hljs-params"></span>) </span>{
});

OAuth.setProperties(OAuth.SignatureMethod.prototype, <span class="hljs-comment">// instance members</span>
    { <span class="hljs-comment">/** Add a signature to the message. */</span>
    sign: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sign</span>(<span class="hljs-params">message</span>) </span>{
        <span class="hljs-keyword">var</span> baseString = OAuth.SignatureMethod.getBaseString(message);
        <span class="hljs-keyword">var</span> signature = <span class="hljs-keyword">this</span>.getSignature(baseString);
        OAuth.setParameter(message, <span class="hljs-string">"oauth_signature"</span>, signature);
        <span class="hljs-keyword">return</span> signature; <span class="hljs-comment">// just in case someone's interested</span>
    },
        <span class="hljs-comment">/** Set the key string for signing. */</span>
        initialize: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initialize</span>(<span class="hljs-params">name, accessor</span>) </span>{
            <span class="hljs-keyword">var</span> consumerSecret;
            <span class="hljs-keyword">if</span> (accessor.accessorSecret != <span class="hljs-literal">null</span> &amp;&amp; name.length &gt; <span class="hljs-number">9</span> &amp;&amp; name.substring(name.length - <span class="hljs-number">9</span>) == <span class="hljs-string">"-Accessor"</span>) {
                consumerSecret = accessor.accessorSecret;
            } <span class="hljs-keyword">else</span> {
                consumerSecret = accessor.consumerSecret;
            }
            <span class="hljs-keyword">this</span>.key = OAuth.percentEncode(consumerSecret) + <span class="hljs-string">"&amp;"</span> + OAuth.percentEncode(accessor.tokenSecret);
        }
    });

<span class="hljs-comment">/* SignatureMethod expects an accessor object to be like this:
 {tokenSecret: "lakjsdflkj...", consumerSecret: "QOUEWRI..", accessorSecret: "xcmvzc..."}
 The accessorSecret property is optional.
 */</span>
<span class="hljs-comment">// Class members:</span>
OAuth.setProperties(OAuth.SignatureMethod, <span class="hljs-comment">// class members</span>
    {
        sign: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sign</span>(<span class="hljs-params">message, accessor</span>) </span>{
            <span class="hljs-keyword">var</span> name = OAuth.getParameterMap(message.parameters).oauth_signature_method;
            <span class="hljs-keyword">if</span> (name == <span class="hljs-literal">null</span> || name == <span class="hljs-string">""</span>) {
                name = <span class="hljs-string">"HMAC-SHA1"</span>;
                OAuth.setParameter(message, <span class="hljs-string">"oauth_signature_method"</span>, name);
            }
            OAuth.SignatureMethod.newMethod(name, accessor).sign(message);
        },
        <span class="hljs-comment">/** Instantiate a SignatureMethod for the given method name. */</span>
        newMethod: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">newMethod</span>(<span class="hljs-params">name, accessor</span>) </span>{
            <span class="hljs-keyword">var</span> impl = OAuth.SignatureMethod.REGISTERED[name];
            <span class="hljs-keyword">if</span> (impl != <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">var</span> method = <span class="hljs-keyword">new</span> impl();
                method.initialize(name, accessor);
                <span class="hljs-keyword">return</span> method;
            }
            <span class="hljs-keyword">var</span> err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"signature_method_rejected"</span>);
            <span class="hljs-keyword">var</span> acceptable = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> r <span class="hljs-keyword">in</span> OAuth.SignatureMethod.REGISTERED) {
                <span class="hljs-keyword">if</span> (acceptable != <span class="hljs-string">""</span>) acceptable += <span class="hljs-string">'&amp;'</span>;
                acceptable += OAuth.percentEncode(r);
            }
            err.oauth_acceptable_signature_methods = acceptable;
            <span class="hljs-keyword">throw</span> err;
        },
        <span class="hljs-comment">/** A map from signature method name to constructor. */</span>
        REGISTERED: {},
        <span class="hljs-comment">/** Subsequently, the given constructor will be used for the named methods.
         The constructor will be called with no parameters.
         The resulting object should usually implement getSignature(baseString).
         You can easily define such a constructor by calling makeSubclass, below.
         */</span>
        registerMethodClass: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">registerMethodClass</span>(<span class="hljs-params">names, classConstructor</span>) </span>{
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; names.length; ++n) {
                OAuth.SignatureMethod.REGISTERED[names[n]] = classConstructor;
            }
        },
        <span class="hljs-comment">/** Create a subclass of OAuth.SignatureMethod, with the given getSignature function. */</span>
        makeSubclass: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">makeSubclass</span>(<span class="hljs-params">getSignatureFunction</span>) </span>{
            <span class="hljs-keyword">var</span> superClass = OAuth.SignatureMethod;
            <span class="hljs-keyword">var</span> subClass = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                superClass.call(<span class="hljs-keyword">this</span>);
            };
            subClass.prototype = <span class="hljs-keyword">new</span> superClass();
            <span class="hljs-comment">// Delete instance variables from prototype:</span>
            <span class="hljs-comment">// delete subclass.prototype... There aren't any.</span>
            subClass.prototype.getSignature = getSignatureFunction;
            subClass.prototype.constructor = subClass;
            <span class="hljs-keyword">return</span> subClass;
        },
        getBaseString: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getBaseString</span>(<span class="hljs-params">message</span>) </span>{
            <span class="hljs-keyword">var</span> URL = message.action;
            <span class="hljs-keyword">var</span> q = URL.indexOf(<span class="hljs-string">'?'</span>);
            <span class="hljs-keyword">var</span> parameters;
            <span class="hljs-keyword">if</span> (q &lt; <span class="hljs-number">0</span>) {
                parameters = message.parameters;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">// Combine the URL query string with the other parameters:</span>
                parameters = OAuth.decodeForm(URL.substring(q + <span class="hljs-number">1</span>));
                <span class="hljs-keyword">var</span> toAdd = OAuth.getParameterList(message.parameters);
                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>; a &lt; toAdd.length; ++a) {
                    parameters.push(toAdd[a]);
                }
            }
            <span class="hljs-keyword">return</span> OAuth.percentEncode(message.method.toUpperCase()) + <span class="hljs-string">'&amp;'</span> + OAuth.percentEncode(OAuth.SignatureMethod.normalizeUrl(URL)) + <span class="hljs-string">'&amp;'</span> + OAuth.percentEncode(OAuth.SignatureMethod.normalizeParameters(parameters));
        },
        normalizeUrl: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">normalizeUrl</span>(<span class="hljs-params">url</span>) </span>{
            <span class="hljs-keyword">var</span> uri = OAuth.SignatureMethod.parseUri(url);
            <span class="hljs-keyword">var</span> scheme = uri.protocol.toLowerCase();
            <span class="hljs-keyword">var</span> authority = uri.authority.toLowerCase();
            <span class="hljs-keyword">var</span> dropPort = (scheme == <span class="hljs-string">"http"</span> &amp;&amp; uri.port == <span class="hljs-number">80</span>) || (scheme == <span class="hljs-string">"https"</span> &amp;&amp; uri.port == <span class="hljs-number">443</span>);
            <span class="hljs-keyword">if</span> (dropPort) {
                <span class="hljs-comment">// find the last : in the authority</span>
                <span class="hljs-keyword">var</span> index = authority.lastIndexOf(<span class="hljs-string">":"</span>);
                <span class="hljs-keyword">if</span> (index &gt;= <span class="hljs-number">0</span>) {
                    authority = authority.substring(<span class="hljs-number">0</span>, index);
                }
            }
            <span class="hljs-keyword">var</span> path = uri.path;
            <span class="hljs-keyword">if</span> (!path) {
                path = <span class="hljs-string">"/"</span>; <span class="hljs-comment">// conforms to RFC 2616 section 3.2.2</span>
            }
            <span class="hljs-comment">// we know that there is no query and no fragment here.</span>
            <span class="hljs-keyword">return</span> scheme + <span class="hljs-string">"://"</span> + authority + path;
        },
        parseUri: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseUri</span>(<span class="hljs-params">str</span>) </span>{
            <span class="hljs-comment">/* This function was adapted from parseUri 1.2.1
             http://stevenlevithan.com/demo/parseuri/js/assets/parseuri.js
             */</span>
            <span class="hljs-keyword">var</span> o = {
                key: [<span class="hljs-string">"source"</span>, <span class="hljs-string">"protocol"</span>, <span class="hljs-string">"authority"</span>, <span class="hljs-string">"userInfo"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"password"</span>, <span class="hljs-string">"host"</span>, <span class="hljs-string">"port"</span>, <span class="hljs-string">"relative"</span>, <span class="hljs-string">"path"</span>, <span class="hljs-string">"directory"</span>, <span class="hljs-string">"file"</span>, <span class="hljs-string">"query"</span>, <span class="hljs-string">"anchor"</span>],
                parser: {
                    strict: <span class="hljs-regexp">/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/</span>
                }
            };
            <span class="hljs-keyword">var</span> m = o.parser.strict.exec(str);
            <span class="hljs-keyword">var</span> uri = {};
            <span class="hljs-keyword">var</span> i = <span class="hljs-number">14</span>;
            <span class="hljs-keyword">while</span> (i--) uri[o.key[i]] = m[i] || <span class="hljs-string">""</span>;
            <span class="hljs-keyword">return</span> uri;
        },
        normalizeParameters: <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">normalizeParameters</span>(<span class="hljs-params">parameters</span>) </span>{
            <span class="hljs-keyword">if</span> (parameters == <span class="hljs-literal">null</span>) {
                <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
            }
            <span class="hljs-keyword">var</span> list = OAuth.getParameterList(parameters);
            <span class="hljs-keyword">var</span> sortable = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p = <span class="hljs-number">0</span>; p &lt; list.length; ++p) {
                <span class="hljs-keyword">var</span> nvp = list[p];
                <span class="hljs-keyword">if</span> (nvp[<span class="hljs-number">0</span>] != <span class="hljs-string">"oauth_signature"</span>) {
                    sortable.push([OAuth.percentEncode(nvp[<span class="hljs-number">0</span>]) + <span class="hljs-string">" "</span> <span class="hljs-comment">// because it comes before any character that can appear in a percentEncoded string.</span>
                        + OAuth.percentEncode(nvp[<span class="hljs-number">1</span>]), nvp]);
                }
            }
            sortable.sort(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">a, b</span>) </span>{
                <span class="hljs-keyword">if</span> (a[<span class="hljs-number">0</span>] &lt; b[<span class="hljs-number">0</span>]) <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;
                <span class="hljs-keyword">if</span> (a[<span class="hljs-number">0</span>] &gt; b[<span class="hljs-number">0</span>]) <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;
                <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
            });
            <span class="hljs-keyword">var</span> sorted = [];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> s = <span class="hljs-number">0</span>; s &lt; sortable.length; ++s) {
                sorted.push(sortable[s][<span class="hljs-number">1</span>]);
            }
            <span class="hljs-keyword">return</span> OAuth.formEncode(sorted);
        }
    });

OAuth.SignatureMethod.registerMethodClass([<span class="hljs-string">"PLAINTEXT"</span>, <span class="hljs-string">"PLAINTEXT-Accessor"</span>], OAuth.SignatureMethod.makeSubclass(

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSignature</span>(<span class="hljs-params">baseString</span>) </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.key;
    }));

OAuth.SignatureMethod.registerMethodClass([<span class="hljs-string">"HMAC-SHA1"</span>, <span class="hljs-string">"HMAC-SHA1-Accessor"</span>], OAuth.SignatureMethod.makeSubclass(

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getSignature</span>(<span class="hljs-params">baseString</span>) </span>{
        b64pad = <span class="hljs-string">'='</span>;
        <span class="hljs-keyword">var</span> signature = b64_hmac_sha1(<span class="hljs-keyword">this</span>.key, baseString);
        <span class="hljs-keyword">return</span> signature;
    }));

<span class="hljs-keyword">try</span> {
    OAuth.correctTimestampFromSrc();
} <span class="hljs-keyword">catch</span> (e) {
}


<span class="hljs-comment">/*
 * ATTENTION: Some efforts has been put in order to produce this code.
 * If you like and use it consider making a dontation in order
 * to allow me to do more and provide you with more solutions.
 *
 * Thanks,
 * David Riccitelli
 *
 * To donate, copy and paste this link in your browser:
 * https://www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=T5HUU4J5EQTJU&amp;lc=IT&amp;item_name=OAuth%20Adapter&amp;currency_code=USD&amp;bn=PP%2dDonationsBF%3abtn_donate_LG%2egif%3aNonHosted
 *
 * Copyright 2010 David Riccitelli, Interact SpA
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */</span>
<span class="hljs-comment">/*
 * This library currently works only with Twitter, although I'd like to
 * spend some more time to make it generally compatible with other services
 * too.
 *
 * Sample use with Twitter:

 // create a new OAuthAdapter instance by passing by your consumer data and signature method
 var oAuthAdapter = new OAuthAdapter(
 'your-consumer-secret',
 'your-consumer-key',
 'HMAC-SHA1');

 // load the access token for the service (if previously saved)
 oAuthAdapter.loadAccessToken('twitter');

 // consume a service API - in this case the status update by Twitter
 oAuthAdapter.send('https://api.twitter.com/1/statuses/update.json', [['status','Hey @ziodave, I managed to use the #oauth adapter for @titanium consuming @twitterapi']],'Twitter','Tweet published.','Tweet not published.');

 // if the client is not authorized, ask for authorization. the previous tweet will be sent automatically after authorization
 if (oAuthAdapter.isAuthorized() == false)
 {
 // this function will be called as soon as the application is authorized
 var receivePin = function() {
 // get the access token with the provided pin/oauth_verifier
 oAuthAdapter.getAccessToken('https://api.twitter.com/oauth/access_token');
 // save the access token
 oAuthAdapter.saveAccessToken('twitter');
 };

 // show the authorization UI and call back the receive PIN function
 oAuthAdapter.showAuthorizeUI('https://api.twitter.com/oauth/authorize?' + oAuthAdapter.getRequestToken('https://api.twitter.com/oauth/request_token'), receivePin);
 }

 */</span>

<span class="hljs-comment">// create an OAuthAdapter instance</span>
<span class="hljs-keyword">var</span> OAuthAdapter = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pConsumerSecret, pConsumerKey, pSignatureMethod</span>) </span>{

    Ti.API.info(<span class="hljs-string">'*********************************************'</span>);
    Ti.API.info(<span class="hljs-string">'If you like the OAuth Adapter, consider donating at'</span>);
    Ti.API.info(<span class="hljs-string">'https://www.paypal.com/cgi-bin/webscr?cmd=_donations&amp;business=T5HUU4J5EQTJU&amp;lc=IT&amp;item_name=OAuth%20Adapter&amp;currency_code=USD&amp;bn=PP%2dDonationsBF%3abtn_donate_LG%2egif%3aNonHosted'</span>);
    Ti.API.info(<span class="hljs-string">'*********************************************'</span>);

    <span class="hljs-comment">// will hold the consumer secret and consumer key as provided by the caller</span>
    <span class="hljs-keyword">var</span> consumerSecret = pConsumerSecret;
    <span class="hljs-keyword">var</span> consumerKey = pConsumerKey;

    <span class="hljs-comment">// will set the signature method as set by the caller</span>
    <span class="hljs-keyword">var</span> signatureMethod = pSignatureMethod;

    <span class="hljs-comment">// the pin or oauth_verifier returned by the authorization process window</span>
    <span class="hljs-keyword">var</span> pin = <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// will hold the request token and access token returned by the service</span>
    <span class="hljs-keyword">var</span> requestToken = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> requestTokenSecret = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> accessToken = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> accessTokenSecret = <span class="hljs-literal">null</span>;

    <span class="hljs-comment">// the accessor is used when communicating with the OAuth libraries to sign the messages</span>
    <span class="hljs-keyword">var</span> accessor = {
        consumerSecret: consumerSecret,
        tokenSecret: <span class="hljs-string">''</span>
    };

    <span class="hljs-comment">// will hold UI components</span>
    <span class="hljs-keyword">var</span> <span class="hljs-built_in">window</span> = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> view = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> webView = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> loadingView = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> loadingContainer = <span class="hljs-literal">null</span>;
    <span class="hljs-keyword">var</span> receivePinCallback = <span class="hljs-literal">null</span>;

    <span class="hljs-keyword">var</span> accessTokenStore = {};

    <span class="hljs-keyword">this</span>.loadAccessToken = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pService</span>) </span>{
        <span class="hljs-keyword">var</span> token;
        <span class="hljs-keyword">if</span> (accessTokenStore[pService]) {
            token = accessTokenStore[pService];
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> raw = Ti.App.Properties.getString(<span class="hljs-string">'Social.js-AccessToken-'</span> + pService, <span class="hljs-string">''</span>);
            <span class="hljs-keyword">if</span> (!raw) {
                <span class="hljs-keyword">return</span>;
            }

            <span class="hljs-keyword">try</span> {
                token = accessTokenStore[pService] = <span class="hljs-built_in">JSON</span>.parse(raw);
            }
            <span class="hljs-keyword">catch</span> (err) {
                Ti.API.error(<span class="hljs-string">'Failed to parse stored access token for '</span> + pService + <span class="hljs-string">'!'</span>);
                Ti.API.error(err);
                <span class="hljs-keyword">return</span>;
            }
        }

        <span class="hljs-keyword">if</span> (token.accessToken)
            accessToken = token.accessToken;
        <span class="hljs-keyword">if</span> (token.accessTokenSecret)
            accessTokenSecret = token.accessTokenSecret;
    };
    <span class="hljs-keyword">this</span>.saveAccessToken = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pService</span>) </span>{
        accessTokenStore[pService] = {
            accessToken: accessToken,
            accessTokenSecret: accessTokenSecret
        };
        Ti.App.Properties.setString(<span class="hljs-string">'Social.js-AccessToken-'</span> + pService, <span class="hljs-built_in">JSON</span>.stringify(accessTokenStore[pService]));
    };
    <span class="hljs-keyword">this</span>.clearAccessToken = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pService</span>) </span>{
        <span class="hljs-keyword">delete</span> accessTokenStore[pService];
        Ti.App.Properties.setString(<span class="hljs-string">'Social.js-AccessToken-'</span> + pService, <span class="hljs-literal">null</span>);
        accessToken = <span class="hljs-literal">null</span>;
        accessTokenSecret = <span class="hljs-literal">null</span>;
    };

    <span class="hljs-comment">// will tell if the consumer is authorized</span>
    <span class="hljs-keyword">this</span>.isAuthorized = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> !(accessToken == <span class="hljs-literal">null</span> || accessTokenSecret == <span class="hljs-literal">null</span>);
    };

    <span class="hljs-comment">// creates a message to send to the service</span>
    <span class="hljs-keyword">var</span> createMessage = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pUrl</span>) </span>{
        <span class="hljs-keyword">var</span> message = {
            action: pUrl,
            method: <span class="hljs-string">'POST'</span>,
            parameters: []
        };
        message.parameters.push([<span class="hljs-string">'oauth_consumer_key'</span>, consumerKey]);
        message.parameters.push([<span class="hljs-string">'oauth_signature_method'</span>, signatureMethod]);
        <span class="hljs-keyword">return</span> message;
    };

    <span class="hljs-comment">// returns the pin</span>
    <span class="hljs-keyword">this</span>.getPin = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> pin;
    };

    <span class="hljs-comment">// requests a requet token with the given Url</span>
    <span class="hljs-keyword">this</span>.getRequestToken = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pUrl, callback</span>) </span>{
        accessor.tokenSecret = <span class="hljs-string">''</span>;

        <span class="hljs-keyword">var</span> message = createMessage(pUrl);
        OAuth.setTimestampAndNonce(message);
        OAuth.SignatureMethod.sign(message, accessor);

        <span class="hljs-keyword">var</span> done = <span class="hljs-literal">false</span>;
        <span class="hljs-keyword">var</span> client = Ti.Network.createHTTPClient({
            onload: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> responseParams = OAuth.getParameterMap(<span class="hljs-keyword">this</span>.responseText);
                requestToken = responseParams[<span class="hljs-string">'oauth_token'</span>];
                requestTokenSecret = responseParams[<span class="hljs-string">'oauth_token_secret'</span>];
                callback({ success: <span class="hljs-literal">true</span>, token: <span class="hljs-keyword">this</span>.responseText });
                done = <span class="hljs-literal">true</span>;
            },
            onerror: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                Ti.API.error(<span class="hljs-string">'Social.js: FAILED to getRequestToken!'</span>);
                Ti.API.error(<span class="hljs-keyword">this</span>.responseText);
                callback({ success: <span class="hljs-literal">false</span> });
                done = <span class="hljs-literal">true</span>;
            }
        });
        client.open(<span class="hljs-string">'POST'</span>, pUrl);
        client.send(OAuth.getParameterMap(message.parameters));
    };

    <span class="hljs-comment">// unloads the UI used to have the user authorize the application</span>
    <span class="hljs-keyword">var</span> destroyAuthorizeUI = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-comment">// if the window doesn't exist, exit</span>
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span> == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">return</span>;

        <span class="hljs-comment">// remove the UI</span>
        <span class="hljs-keyword">try</span> {
            webView.removeEventListener(<span class="hljs-string">'load'</span>, authorizeUICallback);
            webView.removeEventListener(<span class="hljs-string">'beforeload'</span>, showLoading);
            loadingView.hide();
            <span class="hljs-built_in">window</span>.close();
            loading = <span class="hljs-literal">null</span>;
            webView = <span class="hljs-literal">null</span>;
            loadingView = <span class="hljs-literal">null</span>;
            loading = <span class="hljs-literal">false</span>;
            firstLoad = <span class="hljs-literal">true</span>;
            view = <span class="hljs-literal">null</span>;
            <span class="hljs-built_in">window</span> = <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">catch</span> (ex) {
            Ti.API.debug(<span class="hljs-string">'Cannot destroy the authorize UI. Ignoring.'</span>);
        }
    };

    <span class="hljs-keyword">var</span> firstLoad = <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">var</span> loading = <span class="hljs-literal">false</span>;
    <span class="hljs-keyword">var</span> estimates = <span class="hljs-built_in">JSON</span>.parse(Ti.App.Properties.getString(<span class="hljs-string">'Social-LoadingEstimates'</span>, <span class="hljs-string">'{}'</span>));
    <span class="hljs-keyword">var</span> estimateID;
    <span class="hljs-keyword">var</span> startTime;
    <span class="hljs-keyword">var</span> intervalID = <span class="hljs-number">0</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showLoading</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (loading)
            <span class="hljs-keyword">return</span>;
        loading = <span class="hljs-literal">true</span>;
        loadingView.value = <span class="hljs-number">0</span>;
        estimateID = firstLoad ? <span class="hljs-string">'tokenRequest'</span> : <span class="hljs-string">'pageLoad'</span>;
        <span class="hljs-keyword">if</span> (!estimates[estimateID]) {
            estimates[estimateID] = firstLoad ? <span class="hljs-number">2000</span> : <span class="hljs-number">1000</span>;
        }
        firstLoad = <span class="hljs-literal">false</span>;
        startTime = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();
        intervalID = setInterval(updateProgress, <span class="hljs-number">30</span>);
        webView &amp;&amp; webView.hide();
        loadingView &amp;&amp; loadingView.show();
        loadingContainer &amp;&amp; loadingContainer.show();
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateProgress</span>(<span class="hljs-params"></span>) </span>{
        loadingView &amp;&amp; (loadingView.value = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - startTime) / estimates[estimateID]);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authorizeUICallback</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">var</span> response = e.source.evalJS(<span class="hljs-string">'(p = document.getElementById("oauth_pin")) &amp;&amp; p.innerHTML;'</span>);
        <span class="hljs-keyword">if</span> (response) {
            pin = response.split(<span class="hljs-string">'&lt;code&gt;'</span>)[<span class="hljs-number">1</span>].split(<span class="hljs-string">'&lt;/code&gt;'</span>)[<span class="hljs-number">0</span>];
            destroyAuthorizeUI();
            receivePinCallback();
        }
        <span class="hljs-keyword">else</span> {
            loadingView &amp;&amp; loadingView.hide();
            loadingContainer &amp;&amp; loadingContainer.hide();
            webView &amp;&amp; webView.show();
        }
        loading = <span class="hljs-literal">false</span>;
        clearInterval(intervalID);
        estimates[estimateID] = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() - startTime;
        Ti.App.Properties.setString(<span class="hljs-string">'Social-LoadingEstimates'</span>, <span class="hljs-built_in">JSON</span>.stringify(estimates));
    }

    <span class="hljs-keyword">this</span>.showLoadingUI = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">window</span> = Ti.UI.createWindow({
            backgroundColor: <span class="hljs-string">'transparent'</span>
        });
        <span class="hljs-keyword">if</span> (!Ti.Android) {
            <span class="hljs-built_in">window</span>.opacity = <span class="hljs-number">0</span>;
            <span class="hljs-built_in">window</span>.transform = Ti.UI.create2DMatrix().scale(<span class="hljs-number">0</span>)
        }
        view = Ti.UI.createView({
            top: <span class="hljs-number">10</span>, right: <span class="hljs-number">10</span>, bottom: <span class="hljs-number">10</span>, left: <span class="hljs-number">10</span>,
            backgroundColor: <span class="hljs-string">'#52D3FE'</span>,
            border: <span class="hljs-number">10</span>,
            borderColor: <span class="hljs-string">'#52D3FE'</span>, borderRadius: <span class="hljs-number">10</span>, borderWidth: <span class="hljs-number">4</span>,
            zIndex: -<span class="hljs-number">1</span>
        });
        <span class="hljs-keyword">var</span> closeLabel = Ti.UI.createButton({
            font: { fontSize: <span class="hljs-number">11</span>, fontWeight: <span class="hljs-string">'bold'</span> },
            backgroundColor: <span class="hljs-string">'#52D3FE'</span>,
            borderColor: <span class="hljs-string">'#52D3FE'</span>,
            color: <span class="hljs-string">'#fff'</span>,
            style: <span class="hljs-number">0</span>,
            borderRadius: <span class="hljs-number">6</span>,
            title: <span class="hljs-string">'X'</span>,
            top: <span class="hljs-number">8</span>, right: <span class="hljs-number">8</span>,
            width: <span class="hljs-number">30</span>, height: <span class="hljs-number">30</span>
        });
        closeLabel.addEventListener(<span class="hljs-string">'click'</span>, destroyAuthorizeUI);
        <span class="hljs-built_in">window</span>.open();

        <span class="hljs-keyword">var</span> offset = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (Ti.Android) {
            offset = <span class="hljs-string">'10dp'</span>;
        }

        loadingContainer = Ti.UI.createView({
            top: offset, right: offset, bottom: offset, left: offset,
            backgroundColor: <span class="hljs-string">'#fff'</span>
        });
        loadingView = Ti.UI.createProgressBar({
            top: <span class="hljs-number">10</span>, right: <span class="hljs-number">10</span>, bottom: <span class="hljs-number">10</span>, left: <span class="hljs-number">10</span>,
            min: <span class="hljs-number">0</span>, max: <span class="hljs-number">1</span>, value: <span class="hljs-number">0.5</span>,
            message: <span class="hljs-string">'Loading, please wait.'</span>,
            backgroundColor: <span class="hljs-string">'#fff'</span>,
            font: { fontSize: <span class="hljs-number">14</span>, fontWeight: <span class="hljs-string">'bold'</span> },
            style: <span class="hljs-number">0</span>
        });
        view.add(loadingContainer);
        loadingContainer.add(loadingView);
        loadingView.show();

        <span class="hljs-built_in">window</span>.add(view);
        <span class="hljs-built_in">window</span>.add(closeLabel);

        <span class="hljs-keyword">if</span> (!Ti.Android) {
            <span class="hljs-keyword">var</span> tooBig = Ti.UI.createAnimation({
                transform: Ti.UI.create2DMatrix().scale(<span class="hljs-number">1.1</span>),
                opacity: <span class="hljs-number">1</span>,
                duration: <span class="hljs-number">350</span>
            });
            <span class="hljs-keyword">var</span> shrinkBack = Ti.UI.createAnimation({
                transform: Ti.UI.create2DMatrix(),
                duration: <span class="hljs-number">400</span>
            });
            tooBig.addEventListener(<span class="hljs-string">'complete'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-built_in">window</span>.animate(shrinkBack);
            });
            <span class="hljs-built_in">window</span>.animate(tooBig);
        }
        <span class="hljs-comment">// Kick off the timer.</span>
        showLoading();
    };

    <span class="hljs-comment">// shows the authorization UI</span>
    <span class="hljs-keyword">this</span>.showAuthorizeUI = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pUrl, pReceivePinCallback</span>) </span>{
        receivePinCallback = pReceivePinCallback;

        <span class="hljs-keyword">var</span> offset = <span class="hljs-number">0</span>;
        <span class="hljs-keyword">if</span> (Ti.Android) {
            offset = <span class="hljs-string">'10dp'</span>;
        }
        webView = Ti.UI.createWebView({
            url: pUrl,
            top: offset, right: offset, bottom: offset, left: offset,
            autoDetect: [ Ti.UI.AUTODETECT_NONE ]
        });
        webView.addEventListener(<span class="hljs-string">'beforeload'</span>, showLoading);
        webView.addEventListener(<span class="hljs-string">'load'</span>, authorizeUICallback);
        view.add(webView);
    };

    <span class="hljs-keyword">this</span>.getAccessToken = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pUrl, callback</span>) </span>{
        accessor.tokenSecret = requestTokenSecret;

        <span class="hljs-keyword">var</span> message = createMessage(pUrl);
        message.parameters.push([<span class="hljs-string">'oauth_token'</span>, requestToken]);
        message.parameters.push([<span class="hljs-string">'oauth_verifier'</span>, pin]);

        OAuth.setTimestampAndNonce(message);
        OAuth.SignatureMethod.sign(message, accessor);

        <span class="hljs-keyword">var</span> parameterMap = OAuth.getParameterMap(message.parameters);
        <span class="hljs-keyword">var</span> client = Ti.Network.createHTTPClient({
            onload: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> responseParams = OAuth.getParameterMap(<span class="hljs-keyword">this</span>.responseText);
                accessToken = responseParams[<span class="hljs-string">'oauth_token'</span>];
                accessTokenSecret = responseParams[<span class="hljs-string">'oauth_token_secret'</span>];
                callback({ success: <span class="hljs-literal">true</span> });
            },
            onerror: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                Ti.API.error(<span class="hljs-string">'Social.js: FAILED to getAccessToken!'</span>);
                Ti.API.error(<span class="hljs-keyword">this</span>.responseText);
                callback({ success: <span class="hljs-literal">false</span> });
            }
        });
        client.open(<span class="hljs-string">'POST'</span>, pUrl);
        client.send(parameterMap);

    };

    <span class="hljs-keyword">this</span>.send = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">options, callback</span>) </span>{
        <span class="hljs-keyword">var</span> pUrl = options.url,
            pParameters = options.parameters,
            pTitle = options.title,
            pSuccessMessage = options.onSuccess,
            pErrorMessage = options.onError;

        <span class="hljs-keyword">if</span> (accessToken == <span class="hljs-literal">null</span> || accessTokenSecret == <span class="hljs-literal">null</span>) {

            Ti.API.debug(<span class="hljs-string">'The send status cannot be processed as the client doesn\'t have an access token. Authorize before trying to send.'</span>);
            <span class="hljs-keyword">return</span>;
        }

        accessor.tokenSecret = accessTokenSecret;

        <span class="hljs-keyword">var</span> message = createMessage(pUrl);
        message.parameters.push([<span class="hljs-string">'oauth_token'</span>, accessToken]);
        <span class="hljs-keyword">for</span> (p <span class="hljs-keyword">in</span> pParameters) message.parameters.push(pParameters[p]);
        OAuth.setTimestampAndNonce(message);
        OAuth.SignatureMethod.sign(message, accessor);

        <span class="hljs-keyword">var</span> parameterMap = OAuth.getParameterMap(message.parameters);
        <span class="hljs-keyword">var</span> client = Ti.Network.createHTTPClient({
            onload: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">if</span> (client.status == <span class="hljs-number">200</span>) {
                    pSuccessMessage &amp;&amp; pSuccessMessage(<span class="hljs-keyword">this</span>.responseText);
                } <span class="hljs-keyword">else</span> {
                    pErrorMessage &amp;&amp; pErrorMessage(<span class="hljs-keyword">this</span>.responseText);
                }
            },
            onerror: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                Ti.API.error(<span class="hljs-string">'Social.js: FAILED to send a request!'</span>);
                pErrorMessage &amp;&amp; pErrorMessage(<span class="hljs-keyword">this</span>.responseText);
            }
        });
        client.open(<span class="hljs-string">'POST'</span>, pUrl);
        client.send(parameterMap);
    };

};


<span class="hljs-keyword">var</span> supportedSites = {
    twitter: {
        accessToken: <span class="hljs-string">'https://api.twitter.com/oauth/access_token'</span>,
        requestToken: <span class="hljs-string">'https://api.twitter.com/oauth/request_token'</span>,
        authorize: <span class="hljs-string">'https://api.twitter.com/oauth/authorize?'</span>,
        update: <span class="hljs-string">'https://api.twitter.com/1.1/statuses/update.json '</span>
    }
};

<span class="hljs-comment">/**
 * Initializes the module with the passed in settings.
 * @param settings A dictionary containing "consumerKey", "consumerSecret", and "site". "site" defaults to Twitter.
 * @returns An object that can be used to share with the created site.
 */</span>
exports.create = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">settings</span>) </span>{

    <span class="hljs-keyword">var</span> site = (settings.site || <span class="hljs-string">'twitter'</span>).toLowerCase();

    <span class="hljs-keyword">var</span> adapter = <span class="hljs-keyword">new</span> OAuthAdapter(settings.consumerSecret, settings.consumerKey, <span class="hljs-string">'HMAC-SHA1'</span>);
    adapter.loadAccessToken(site);

    <span class="hljs-keyword">var</span> urls = supportedSites[site];
    <span class="hljs-keyword">if</span> (urls == <span class="hljs-literal">null</span>) {
        alert(<span class="hljs-string">'The Social.js module does not support '</span> + site + <span class="hljs-string">' yet!'</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-comment">// And return the site to the user.</span>
    <span class="hljs-keyword">return</span> {
        isAuthorized: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> adapter.isAuthorized();
        },
        deauthorize: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            adapter.clearAccessToken(site);
        },
        authorize: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">callback</span>) </span>{
            <span class="hljs-keyword">if</span> (!adapter.isAuthorized()) {
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">receivePin</span>(<span class="hljs-params"></span>) </span>{
                    adapter.getAccessToken(urls.accessToken, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>{
                        <span class="hljs-keyword">if</span> (!evt.success) {
                            alert(<span class="hljs-string">'Twitter did not give us an access token!'</span>);
                        }
                        <span class="hljs-keyword">else</span> {
                            adapter.saveAccessToken(site);
                            callback &amp;&amp; callback();
                        }
                    });
                }

                adapter.showLoadingUI();
                adapter.getRequestToken(urls.requestToken, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">evt</span>) </span>{
                    <span class="hljs-keyword">if</span> (!evt.success) {
                        alert(<span class="hljs-string">'Twitter did not give us a request token!'</span>);
                    }
                    <span class="hljs-keyword">else</span> {
                        adapter.showAuthorizeUI(urls.authorize + evt.token, receivePin);
                    }
                });
            }
            <span class="hljs-keyword">else</span> {
                callback &amp;&amp; callback();
            }
        },
        share: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">options</span>) </span>{

            Ti.API.info(urls.update);

            <span class="hljs-keyword">this</span>.authorize(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                adapter.send({

                    url: urls.update,
                    parameters: [
                        [<span class="hljs-string">'status'</span>, options.message]
                    ],
                    title: <span class="hljs-string">'Twitter'</span>,
                    onSuccess: options.success,
                    onError: options.error
                });
            });
        }
    };
};
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="November 15th 2013, 8:24:30 am">November 15th 2013</span>
											by <span class='authorname'>narasimha reddy</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>HI Martyn joyce, if you don&#39;t mine can you please share your socia.js file . because it&#39;s working me</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 19th 2013, 4:03:01 am">November 19th 2013</span>
											by <span class='authorname'>narasimha reddy</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi, not sure how to upload files here so the file is available at: http:&#x2F;&#x2F;we.tl&#x2F;QmgwyfPYfD â¦ it will be there for 7 days.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 19th 2013, 7:30:37 am">November 19th 2013</span>
											by <span class='authorname'>Martyn Joyce</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Thanks Martyn Joyce</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 19th 2013, 9:05:34 am">November 19th 2013</span>
											by <span class='authorname'>narasimha reddy</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
