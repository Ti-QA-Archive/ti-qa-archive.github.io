<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Defining a custom sqlite function » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Defining a custom sqlite function</h1>
		</header>
		<section>
			<p>Is there a way to define a custom sqlite function in Appcelerator?<br>I am trying to do a distance calculation using latitude and longitude points in a sqlite database but the normal formula I would use relies on SQL Math Functions that sqlite does not have such as SQRT and Power.</p>
<p>So I have worked out I could create a custom sqlite function to do the calulations however I am not sure how to add a custom sqlite function in Appcelerator.</p>
<p>Has anyone tried this or can point me in the right direction?<br>Do I need to add the custom sqlite function to my XCode project first?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="September 15th 2011, 11:11:43 pm">September 15th 2011</span>
				by <span class='authorname'>Rafe Roberts</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>geolocation</span></li>
					
						<li><span class='tagname'>sqlite</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>6</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>6 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-219361">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>Check out <a href="https:&#x2F;&#x2F;github.com&#x2F;appcelerator&#x2F;titanium_mobile&#x2F;pull&#x2F;159">my pull request on Github</a>, and see <a href="https:&#x2F;&#x2F;github.com&#x2F;appcelerator&#x2F;titanium_mobile&#x2F;pull&#x2F;159&#x2F;files">the diff</a> for the changes you need to make to what files to get a custom sqlite function to work.</p>
<p>Note that all the SDK files are in ~&#x2F;Library&#x2F;Application Support&#x2F;Titanium&#x2F;mobilesdk (on a mac)</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 23rd 2011, 5:45:41 am">September 23rd 2011</span>
								by <span class='authorname'>Jeroen Kntl</span><br>
								<a class="icon-bg icon-link" href="question/125649/defining-a-custom-sqlite-function#answer-219361" rel="permalink">permalink</a>
							</div>

							<h5>9 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Correction: sdk files are not in the ~&#x2F; but &#x2F; path.</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 23rd 2011, 5:58:36 am">September 23rd 2011</span>
											by <span class='authorname'>Jeroen Kntl</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Jeroen,</p>
<p>to me this would be the perfect solution for my needs! Thank you!</p>
<p>Am I correct in assuming that this should also work on Android?</p>
<p>As I come from Web Development and have no clues of Xcode &amp; Co. could you please provide a step-by-step guidance on how to integrate your code into a Titanium project? That would be great!</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 28th 2011, 6:59:50 am">September 28th 2011</span>
											by <span class='authorname'>N N</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Thanks Jeroen your Github code helps as that was the function I was hoping to add that I found on http:&#x2F;&#x2F;www.thismuchiknow.co.uk&#x2F;?p=71<br>It all worked great!<br>You totally Rock!</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 28th 2011, 9:00:20 am">September 28th 2011</span>
											by <span class='authorname'>Rafe Roberts</span>
										</div>
									</li>
								
									<li class="comment">
										<p><ol>
<li><p>Make sure you make adjustment to the latest SDK folder which is in my case located at &#x2F;Users&#x2F;YOURUSERNAME&#x2F;Library&#x2F;Application Support&#x2F;Titanium&#x2F;mobilesdk&#x2F;osx&#x2F;1.7.3&#x2F;iphone&#x2F;Classes&#x2F;PlausibleDatabase</p>
</li>
<li><p>The SQL syntax that works for me:</p>
<pre><code class="hljs">var rows = db.execute('<span class="hljs-operator"><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> pet_stations <span class="hljs-keyword">WHERE</span> distance(latitude, longitude,<span class="hljs-string">' + oriLat + '</span>,<span class="hljs-string">' + oriLong + '</span>) &lt; <span class="hljs-number">25</span> <span class="hljs-keyword">LIMIT</span> <span class="hljs-number">0</span> , <span class="hljs-number">20</span><span class="hljs-string">');</span></span>
</code></pre><p>where oriLat and oriLong are the current pos pull from eventlistener &#39;location&#39;.</p>
</li>
</ol>
</p>
										<div class="author">
											&mdash; commented <span title="October 23rd 2011, 2:39:03 pm">October 23rd 2011</span>
											by <span class='authorname'>Aizil Akmar Omar</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Thank you very much Jeroen!</p>
</p>
										<div class="author">
											&mdash; commented <span title="October 23rd 2011, 2:50:37 pm">October 23rd 2011</span>
											by <span class='authorname'>Aizil Akmar Omar</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Thanks Jeroen, works like a charm.</p>
<p>Heads up though to anyone using this, if you change your sdk or clean the project, the files will be returned to their original state. That&#39;s what happens on my machine anyways.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 19th 2011, 7:21:29 am">November 19th 2011</span>
											by <span class='authorname'>Tim Mueller</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>This doesn&#39;t seem to work on Android.</p>
<p>Ray Belisle</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 9th 2012, 5:29:31 pm">January 9th 2012</span>
											by <span class='authorname'>Ray Belisle</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Why can&#39;t the SQLite code be used for Android and what is the alternative for doing the same thing for Android to get near by locations by longitude and latitude from a SQLite db stored in the phone?<br>Dave Addey&#39;s code works great for iOS but I don&#39;t see how to get Titanium to use it for Android.<br>http:&#x2F;&#x2F;www.thismuchiknow.co.uk&#x2F;?p=71</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 15th 2013, 1:23:14 am">April 15th 2013</span>
											by <span class='authorname'>David Socoro</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Does this work on sdk 3.1.3GA ?<br>I have an error function saying &quot;no such function: distance&quot;.<br>regards</p>
</p>
										<div class="author">
											&mdash; commented <span title="October 10th 2013, 10:45:07 am">October 10th 2013</span>
											by <span class='authorname'>Armindo Da Silva</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>4</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-218995">
				
						<section>
							<p>I know this is not exactly what you are asking for, but just in case it is helpful you can use JavaScript to do the calculations. Here&#39;s a site with several different distance calculations  http:&#x2F;&#x2F;www.movable-type.co.uk&#x2F;scripts&#x2F;latlong.html</p>
<p>If applicable, you can reduce the number of calculations you actually have to do, by filtering the results in SQL and only returning items within +&#x2F;- a degree or two of latitude&#x2F;longitude.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 17th 2011, 4:52:00 am">September 17th 2011</span>
								by <span class='authorname'>Mike Robinson</span><br>
								<a class="icon-bg icon-link" href="question/125649/defining-a-custom-sqlite-function#answer-218995" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-219353">
				
						<section>
							<p>Thanks for the suggestion but the problem I have is trying to order a dataset from SQLite by the distance so I need to be able to have SQLite calculate the distance. Unless there is some way to order the results in a row object.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 23rd 2011, 12:17:59 am">September 23rd 2011</span>
								by <span class='authorname'>Rafe Roberts</span><br>
								<a class="icon-bg icon-link" href="question/125649/defining-a-custom-sqlite-function#answer-219353" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-219354">
				
						<section>
							<p>Since you can&#39;t create your own UDP in Titanium (to my knowledge), I think you will have to take a two-step approach here.  Use a temporary table and insert into it the subset of records which has the potential of being in the distance radius you want.  Then loop over those records and update them with the actual distance from your center point, and delete those records beyond the desired distance.  Then just do a Select on the temporary table with an Order By on the distance field.</p>
<p>I&#39;ve done something similar on another platform where I didn&#39;t have UDP capabilities, so I computed the min&#x2F;max of both the lat&#x2F;long in each direction from the center point, then used that to subset the records in the first pass.  Looping over those I could compute the actual distance and subset again to those within the desired radius instead of the square obtained via the min&#x2F;max lat&#x2F;long pairs.</p>
<p>Not ideal, but it gets the job done without too much fuss.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 23rd 2011, 2:13:36 am">September 23rd 2011</span>
								by <span class='authorname'>Doug Handy</span><br>
								<a class="icon-bg icon-link" href="question/125649/defining-a-custom-sqlite-function#answer-219354" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-219689">
				
						<section>
							<p>Thanks Jeroen your Github code helps as that was the function I was hoping to add that I found on http:&#x2F;&#x2F;www.thismuchiknow.co.uk&#x2F;?p=71 </p>
<p>It all worked great! </p>
<p>You totally Rock!</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 28th 2011, 8:59:47 am">September 28th 2011</span>
								by <span class='authorname'>Rafe Roberts</span><br>
								<a class="icon-bg icon-link" href="question/125649/defining-a-custom-sqlite-function#answer-219689" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi, just found Jeroen&#39;s code, before seeing this thread, works great, but how do you set a distance parameter in the sql? It&#39;s one thing ordering, but I&#39;m trying to limit the result set by distance, anything up to 50miles&#x2F;km - any ideas how you attempt that?</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 26th 2011, 8:01:40 pm">December 26th 2011</span>
											by <span class='authorname'>Ian Tearle</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Ian,<br>You can work out the result set by distance using the where clause in your SQL query. You don&#39;t even need the custom SQL function to do it.<br>I did it by simply creating a where statement using the lat and long values and adding a constant which was a decimal value.<br>At the equator adding a value of 0.1 to your GPS value adds 111km to it.<br>See this chart http:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Decimal_degrees</p>
<p>That changes depending on how far away from the equator you are but once you work that out for where you are its easy. So for where I am in Australia its around 0.4 to add 50km.<br>So then to get locations in a 50km radius of the GPS location of the user:</p>
<p>I first create Lat and Long boundry:</p>
<pre><code class="hljs">     <span class="hljs-variable"><span class="hljs-keyword">var</span> proxMapBoundryLatMax</span> = e.coords.latitude + <span class="hljs-number">0.4</span>;

        <span class="hljs-variable"><span class="hljs-keyword">var</span> proxMapBoundryLatMin</span> = e.coords.latitude - <span class="hljs-number">0.4</span>;

        <span class="hljs-variable"><span class="hljs-keyword">var</span> proxMapBoundryLongMax</span> = e.coords.longitude + <span class="hljs-number">0.4</span>;

        <span class="hljs-variable"><span class="hljs-keyword">var</span> proxMapBoundryLongMin</span> = e.coords.longitude - <span class="hljs-number">0.4</span>;
</code></pre><p>I then create the following where clause:</p>
<p>&#39;WHERE Latitude &gt; &#39; + proxMapBoundryLatMin + &#39; AND Latitude &lt; &#39; + proxMapBoundryLatMax + &#39; AND Longitude &gt; &#39; + proxMapBoundryLongMin + &#39; AND Longitude &lt; &#39; + proxMapBoundryLongMax + &#39; &#39;;</p>
<p>That gets me all the locations within a 50km radius of the user.<br>It is not super accurate but works pretty well.</p>
<p>Hope that helps.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 26th 2011, 10:49:03 pm">December 26th 2011</span>
											by <span class='authorname'>Rafe Roberts</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-227075">
				
						<section>
							<p>This works perfectly on iOS, but doesn&#39;t on Android. Does anyone have suggestions on how you can provide the same functionality on Android?</p>
<p>Ray Belisle</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 9th 2012, 5:27:21 pm">January 9th 2012</span>
								by <span class='authorname'>Ray Belisle</span><br>
								<a class="icon-bg icon-link" href="question/125649/defining-a-custom-sqlite-function#answer-227075" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
