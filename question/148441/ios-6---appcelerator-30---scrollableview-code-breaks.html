<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>iOS 6 - Appcelerator 3.0 - ScrollableView code breaks » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>iOS 6 - Appcelerator 3.0 - ScrollableView code breaks</h1>
		</header>
		<section>
			<p>Hey all,</p>
<p>I&#39;m working with some pre-existing code that handles essentially an unlimited number of images in a ScrollableView by updating the urls for 5 ImageViews and changing the currentPage property of the ScrollableView.</p>
<p>This code was working fine in older versions of Appcelerator, but on 3.0 it breaks. Scrolling is now too fast and jerky, and in some cases ImageViews do not appear. For example, if I load the ScrollableView at the start of the image list, the last two images will not appear. These problems happen both in the simulator and on an actual device.</p>
<p>I&#39;m definitely not expecting to get a full-on code review here, but anyone have a quick thought on why this code would now be breaking? (Code included below.) Thanks!</p>
<p>Gabe</p>
<pre><code class="hljs"><span class="hljs-comment">/**====================================================**
 * TattooScroller Class
 * 
 * http://developer.appcelerator.com/question/46481/explain-scrollview-values
 **====================================================**/</span>
tn.TattooScroller = av.Root.create({
    <span class="hljs-comment">/**====================================================**
     * ivs
     **====================================================**/</span>
    _logOn: <span class="hljs-literal">false</span>,
    _parent: <span class="hljs-literal">null</span>,
    _scrollableView: <span class="hljs-literal">null</span>,
    views: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._scrollableView.views;
    },
    tattooCollection: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._parent.tattooCollection();
    },

    <span class="hljs-comment">/**====================================================**
     * instance creation
     **====================================================**/</span>
    onParent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(oScrollPage)</span> </span>{
        <span class="hljs-keyword">var</span> instance = <span class="hljs-keyword">this</span>.create();
        instance._parent = oScrollPage;
        <span class="hljs-keyword">return</span> instance;
    },

    <span class="hljs-comment">/**====================================================**
     * scrolling
     **====================================================**/</span>
    logState: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sTitle)</span> </span>{
        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._logOn) {<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;}
        log.v(<span class="hljs-string">'STATE - '</span> + sTitle, <span class="hljs-number">4</span>);
        log.nv(<span class="hljs-string">'length'</span>, <span class="hljs-keyword">this</span>.tattooCollection().length(), <span class="hljs-number">8</span>);
        log.nv(<span class="hljs-string">'currentPage'</span>, <span class="hljs-keyword">this</span>._scrollableView.currentPage, <span class="hljs-number">8</span>);
        <span class="hljs-keyword">var</span> indices = <span class="hljs-keyword">this</span>.views().map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(each)</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">each</span>.tnIndex;
        });
        log.nv(<span class="hljs-string">'indices'</span>, indices, <span class="hljs-number">8</span>);
    },

    adjustTo: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(iScrollIndex, iTattooIndex)</span> </span>{
        <span class="hljs-keyword">var</span> imageUrl = <span class="hljs-keyword">this</span>.tattooCollection().galleryUrlAt(iTattooIndex);
        <span class="hljs-keyword">var</span> date = <span class="hljs-keyword">this</span>.tattooCollection().shortDateAt(iTattooIndex);
        <span class="hljs-keyword">this</span>.views()[iScrollIndex].tnIndex = iTattooIndex;

        <span class="hljs-keyword">this</span>.views()[iScrollIndex].children[<span class="hljs-number">0</span>].image = imageUrl;

        <span class="hljs-keyword">this</span>.views()[iScrollIndex].tnDate = date;
    },
    adjustFrom: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(iScrollIndex, iTattooIndex)</span> </span>{
        <span class="hljs-comment">//log.v('=== adjustFrom ' + iScrollIndex + ' ' + iTattooIndex);</span>
        <span class="hljs-keyword">this</span>.logState(<span class="hljs-string">'before'</span>);

        <span class="hljs-keyword">if</span> (iScrollIndex &lt; <span class="hljs-number">2</span>) {
            <span class="hljs-keyword">if</span> (iTattooIndex &lt; <span class="hljs-number">2</span>) {
                <span class="hljs-comment">//at start 0,0 or 1,1</span>
                <span class="hljs-keyword">this</span>._parent.title(iTattooIndex);
                <span class="hljs-keyword">this</span>.logState(<span class="hljs-string">'after A'</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-comment">//go top to bottom</span>
                <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">4</span>, iTattooIndex + <span class="hljs-number">2</span>);
                <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">3</span>, iTattooIndex + <span class="hljs-number">1</span>);
                <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">2</span>, iTattooIndex);
                <span class="hljs-comment">//adjust current page after 2 has changed and before 1 has changed</span>
                <span class="hljs-keyword">this</span>._parent.title(iTattooIndex);
                <span class="hljs-keyword">this</span>._scrollableView.currentPage = <span class="hljs-number">2</span>;
                <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">1</span>, iTattooIndex - <span class="hljs-number">1</span>);
                <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">0</span>, iTattooIndex - <span class="hljs-number">2</span>);

                <span class="hljs-keyword">this</span>.logState(<span class="hljs-string">'after B'</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            }
        }

        <span class="hljs-keyword">if</span> (iScrollIndex &gt; <span class="hljs-number">2</span>) {
            <span class="hljs-keyword">var</span> length = <span class="hljs-keyword">this</span>.tattooCollection().length();
            <span class="hljs-keyword">var</span> lastIndex = length - <span class="hljs-number">1</span>;
            <span class="hljs-keyword">if</span> (iTattooIndex &gt;= lastIndex - <span class="hljs-number">1</span>) {
                <span class="hljs-comment">//near end</span>
                <span class="hljs-keyword">this</span>._parent.title(iTattooIndex);
                <span class="hljs-keyword">this</span>.logState(<span class="hljs-string">'after C'</span>);
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
            }

            <span class="hljs-comment">//go bottom to top</span>
            <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">0</span>, iTattooIndex - <span class="hljs-number">2</span>);
            <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">1</span>, iTattooIndex - <span class="hljs-number">1</span>);
            <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">2</span>, iTattooIndex);
            <span class="hljs-comment">//adjust current page after 2 has changed and before 3 has changed</span>
            <span class="hljs-keyword">this</span>._parent.title(iTattooIndex);
            <span class="hljs-keyword">this</span>._scrollableView.currentPage = <span class="hljs-number">2</span>;
            <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">3</span>, iTattooIndex + <span class="hljs-number">1</span>);
            <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">4</span>, iTattooIndex + <span class="hljs-number">2</span>);

            <span class="hljs-keyword">this</span>.logState(<span class="hljs-string">'after D'</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

        <span class="hljs-keyword">this</span>._parent.title(iTattooIndex);
        <span class="hljs-keyword">this</span>.logState(<span class="hljs-string">'after E'</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    },

    <span class="hljs-comment">/**====================================================**
     * create views
     **====================================================**/</span>
    createEmptyImageView: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> view = Ti.UI.createImageView({
            defaultImage: av.settings.defaultImage,
            <span class="hljs-comment">// 13 February, 2013 - Set these positions to make the image</span>
            <span class="hljs-comment">// fill the available space</span>
            left: <span class="hljs-number">0</span>,
            top: <span class="hljs-number">0</span>,
            width: <span class="hljs-number">200</span>,
            <span class="hljs-comment">// bottom: 0,</span>
            <span class="hljs-comment">// right: 0</span>
            <span class="hljs-comment">//need these here to make the empty boxes (I think)</span>
            tnIndex: <span class="hljs-literal">null</span>,
            tnDate: <span class="hljs-literal">null</span>            
        });

<span class="hljs-comment">//          return view;</span>

        <span class="hljs-keyword">var</span> imgWrapper = Ti.UI.createScrollView({maxZoomScale:<span class="hljs-number">3.0</span>});
        imgWrapper.add(view);

        <span class="hljs-keyword">return</span> imgWrapper;
    },
    addEmptyImageViews: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> views = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>._numberItems; i++) {
            <span class="hljs-comment">//add empty imageViews</span>
            views.push(<span class="hljs-keyword">this</span>.createEmptyImageView());
        }
        <span class="hljs-comment">//OK here, but fyi - even if all views are set by addView, still need</span>
        <span class="hljs-comment">//to this.views() = [] to access the views later</span>
        <span class="hljs-keyword">this</span>._scrollableView.views = views;
    },
    createEmptyScrollableView: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(numberItems)</span> </span>{

        <span class="hljs-comment">// Store number of items that'll be displayed</span>
        <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> numberItems === <span class="hljs-string">'undefined'</span>)
        {
            <span class="hljs-keyword">this</span>._numberItems = <span class="hljs-number">5</span>;
        }
        <span class="hljs-keyword">else</span>
        {
            <span class="hljs-keyword">this</span>._numberItems = numberItems;
        } 

        <span class="hljs-keyword">var</span> scrollableView = Ti.UI.createScrollableView({
             <span class="hljs-comment">// contentWidth:'auto',</span>
            <span class="hljs-comment">// contentHeight:'auto',</span>
            <span class="hljs-comment">//showVerticalScrollIndicator:true,</span>
            showHorizontalScrollIndicator:<span class="hljs-literal">true</span>,

<span class="hljs-comment">//           showPagingControl: true,</span>
<span class="hljs-comment">//           pagingControlHeight: 30,    //default is 20, but is covered by tab group</span>
<span class="hljs-comment">///            maxZoomScale: 10,</span>
<span class="hljs-comment">//           minZoomScale: 0.1,</span>
            <span class="hljs-comment">//this does not help</span>
            <span class="hljs-comment">//if current picture is zoomed, next picture</span>
            <span class="hljs-comment">//is not reset - it is zoomed also</span>
            <span class="hljs-comment">//not working on it - leave it for now</span>
<span class="hljs-comment">//            zoomScale: 1</span>
        });
        <span class="hljs-keyword">this</span>._scrollableView = scrollableView;


        <span class="hljs-keyword">this</span>.addEmptyImageViews();

        <span class="hljs-keyword">var</span> _this = <span class="hljs-keyword">this</span>;
        scrollableView.addEventListener(<span class="hljs-string">'scroll'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{                        
            <span class="hljs-keyword">var</span> scrollIndex = _this._scrollableView.currentPage;


            <span class="hljs-keyword">if</span>(scrollIndex != _this.previousIndex) {
                <span class="hljs-comment">// Make sure zoom is set back to normal</span>
                <span class="hljs-keyword">for</span>( i = <span class="hljs-number">0</span>; i &lt; _this._numberItems; i++) {
                    _this.views()[i].zoomScale = <span class="hljs-number">1.0</span>;
                }
            }


            <span class="hljs-keyword">var</span> view = _this.views()[scrollIndex];
            <span class="hljs-keyword">var</span> tattooIndex = view.tnIndex;
            _this.adjustFrom(scrollIndex, tattooIndex);

            _this.previousIndex = scrollIndex;


        });

        scrollableView.addEventListener(<span class="hljs-string">'doubletap'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
        </span>{
            <span class="hljs-keyword">var</span> scrollIndex = _this._scrollableView.currentPage;
            _this.views()[scrollIndex].zoomScale = <span class="hljs-number">1.0</span>;    
        });

        <span class="hljs-keyword">return</span> scrollableView;
    },

    <span class="hljs-comment">/**====================================================**
     * initialize
     **====================================================**/</span>
    initializeForTattooIndex: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(iTattooIndex)</span> </span>{

        <span class="hljs-keyword">if</span> (iTattooIndex === <span class="hljs-number">0</span>) {

            <span class="hljs-keyword">this</span>.setImagesFromTattooIndex(<span class="hljs-number">0</span>);
            <span class="hljs-keyword">this</span>.setScrollPosition(<span class="hljs-number">0</span>);

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }
        <span class="hljs-keyword">if</span> (iTattooIndex === <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">this</span>.setImagesFromTattooIndex(<span class="hljs-number">0</span>);
            <span class="hljs-keyword">this</span>.setScrollPosition(<span class="hljs-number">1</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }
        <span class="hljs-keyword">var</span> length = <span class="hljs-keyword">this</span>.tattooCollection().length();
        <span class="hljs-keyword">var</span> lastIndex = length - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (iTattooIndex === lastIndex) {
            <span class="hljs-keyword">this</span>.setImagesFromTattooIndex(iTattooIndex - <span class="hljs-number">4</span>);
            <span class="hljs-keyword">this</span>.setScrollPosition(<span class="hljs-number">4</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }
        <span class="hljs-keyword">if</span> (iTattooIndex === lastIndex - <span class="hljs-number">1</span>) {
            <span class="hljs-keyword">this</span>.setImagesFromTattooIndex(iTattooIndex - <span class="hljs-number">3</span>);
            <span class="hljs-keyword">this</span>.setScrollPosition(<span class="hljs-number">3</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }
        <span class="hljs-comment">//normal case</span>
        <span class="hljs-keyword">this</span>.setImagesFromTattooIndex(iTattooIndex - <span class="hljs-number">2</span>);
        <span class="hljs-keyword">this</span>.setScrollPosition(<span class="hljs-number">2</span>);
    },
    setScrollPosition: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(iScrollIndex)</span> </span>{
        <span class="hljs-comment">//0 for start, 2 for middle, 4 for end</span>
        <span class="hljs-keyword">this</span>._scrollableView.currentPage = iScrollIndex;
    },
    setImagesFromTattooIndex: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(iTattooIndex)</span> </span>{
        <span class="hljs-comment">//assumes tattooCollection is full</span>
        <span class="hljs-comment">//av.backgroundFor(start, end, delay, function(i) {</span>
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
            <span class="hljs-keyword">var</span> tattooIndex = iTattooIndex + i;
            <span class="hljs-keyword">var</span> url = <span class="hljs-keyword">this</span>.tattooCollection().galleryUrlAt(tattooIndex);
            <span class="hljs-keyword">var</span> date = <span class="hljs-keyword">this</span>.tattooCollection().shortDateAt(tattooIndex);

            <span class="hljs-comment">// "views" is an array of ScrollViews which each have one image view</span>
            <span class="hljs-keyword">var</span> view = <span class="hljs-keyword">this</span>.views()[i];
<span class="hljs-comment">//            var view = this.views()[i];</span>

            view.children[<span class="hljs-number">0</span>].image = url;

            view.tnIndex = tattooIndex;
            view.tnDate = date;
        }
    },

    <span class="hljs-comment">/**====================================================**
     * querying
     **====================================================**/</span>
    currentTattooIndex: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> scrollIndex = <span class="hljs-keyword">this</span>._scrollableView.currentPage;
        <span class="hljs-keyword">var</span> view = <span class="hljs-keyword">this</span>.views()[scrollIndex];
        <span class="hljs-keyword">var</span> tattooIndex = view.tnIndex;
        <span class="hljs-keyword">return</span> tattooIndex;
    },
    currentTattoo: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.tattooCollection().tattooAt(<span class="hljs-keyword">this</span>.currentTattooIndex());
    }

});
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="February 18th 2013, 5:14:13 pm">February 18th 2013</span>
				by <span class='authorname'>Gabe K.</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>ios scrollableview</span></li>
					
				</ul>
			

			<section>
				<h5>5 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Heck, sorry, seem to be having trouble getting the markdown working?! Code is:</p>
<p>tn.TattooScroller = av.Root.create({<br>    &#x2F;<strong>====================================================</strong></p>
<pre><code class="hljs"> * ivs
 **====================================================**/
_logOn: <span class="hljs-literal">false</span>,
_parent: <span class="hljs-literal">null</span>,
_scrollableView: <span class="hljs-literal">null</span>,
views: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._scrollableView.views;
},
tattooCollection: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>._parent.tattooCollection();
},

<span class="hljs-comment">/**====================================================**
 * instance creation
 **====================================================**/</span>
onParent: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(oScrollPage)</span> </span>{
    <span class="hljs-keyword">var</span> instance = <span class="hljs-keyword">this</span>.create();
    instance._parent = oScrollPage;
    <span class="hljs-keyword">return</span> instance;
},

<span class="hljs-comment">/**====================================================**
 * scrolling
 **====================================================**/</span>
logState: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(sTitle)</span> </span>{
    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>._logOn) {<span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;}
    log.v(<span class="hljs-string">'STATE - '</span> + sTitle, <span class="hljs-number">4</span>);
    log.nv(<span class="hljs-string">'length'</span>, <span class="hljs-keyword">this</span>.tattooCollection().length(), <span class="hljs-number">8</span>);
    log.nv(<span class="hljs-string">'currentPage'</span>, <span class="hljs-keyword">this</span>._scrollableView.currentPage, <span class="hljs-number">8</span>);
    <span class="hljs-keyword">var</span> indices = <span class="hljs-keyword">this</span>.views().map(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(each)</span> </span>{
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">each</span>.tnIndex;
    });
    log.nv(<span class="hljs-string">'indices'</span>, indices, <span class="hljs-number">8</span>);
},

adjustTo: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(iScrollIndex, iTattooIndex)</span> </span>{
    <span class="hljs-keyword">var</span> imageUrl = <span class="hljs-keyword">this</span>.tattooCollection().galleryUrlAt(iTattooIndex);
    <span class="hljs-keyword">var</span> date = <span class="hljs-keyword">this</span>.tattooCollection().shortDateAt(iTattooIndex);
    <span class="hljs-keyword">this</span>.views()[iScrollIndex].tnIndex = iTattooIndex;

    <span class="hljs-keyword">this</span>.views()[iScrollIndex].children[<span class="hljs-number">0</span>].image = imageUrl;

    <span class="hljs-keyword">this</span>.views()[iScrollIndex].tnDate = date;
},
adjustFrom: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(iScrollIndex, iTattooIndex)</span> </span>{
    <span class="hljs-comment">//log.v('=== adjustFrom ' + iScrollIndex + ' ' + iTattooIndex);</span>
    <span class="hljs-keyword">this</span>.logState(<span class="hljs-string">'before'</span>);

    <span class="hljs-keyword">if</span> (iScrollIndex &lt; <span class="hljs-number">2</span>) {
        <span class="hljs-keyword">if</span> (iTattooIndex &lt; <span class="hljs-number">2</span>) {
            <span class="hljs-comment">//at start 0,0 or 1,1</span>
            <span class="hljs-keyword">this</span>._parent.title(iTattooIndex);
            <span class="hljs-keyword">this</span>.logState(<span class="hljs-string">'after A'</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-comment">//go top to bottom</span>
            <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">4</span>, iTattooIndex + <span class="hljs-number">2</span>);
            <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">3</span>, iTattooIndex + <span class="hljs-number">1</span>);
            <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">2</span>, iTattooIndex);
            <span class="hljs-comment">//adjust current page after 2 has changed and before 1 has changed</span>
            <span class="hljs-keyword">this</span>._parent.title(iTattooIndex);
            <span class="hljs-keyword">this</span>._scrollableView.currentPage = <span class="hljs-number">2</span>;
            <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">1</span>, iTattooIndex - <span class="hljs-number">1</span>);
            <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">0</span>, iTattooIndex - <span class="hljs-number">2</span>);

            <span class="hljs-keyword">this</span>.logState(<span class="hljs-string">'after B'</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }
    }

    <span class="hljs-keyword">if</span> (iScrollIndex &gt; <span class="hljs-number">2</span>) {
        <span class="hljs-keyword">var</span> length = <span class="hljs-keyword">this</span>.tattooCollection().length();
        <span class="hljs-keyword">var</span> lastIndex = length - <span class="hljs-number">1</span>;
        <span class="hljs-keyword">if</span> (iTattooIndex &gt;= lastIndex - <span class="hljs-number">1</span>) {
            <span class="hljs-comment">//near end</span>
            <span class="hljs-keyword">this</span>._parent.title(iTattooIndex);
            <span class="hljs-keyword">this</span>.logState(<span class="hljs-string">'after C'</span>);
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
        }

        <span class="hljs-comment">//go bottom to top</span>
        <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">0</span>, iTattooIndex - <span class="hljs-number">2</span>);
        <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">1</span>, iTattooIndex - <span class="hljs-number">1</span>);
        <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">2</span>, iTattooIndex);
        <span class="hljs-comment">//adjust current page after 2 has changed and before 3 has changed</span>
        <span class="hljs-keyword">this</span>._parent.title(iTattooIndex);
        <span class="hljs-keyword">this</span>._scrollableView.currentPage = <span class="hljs-number">2</span>;
        <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">3</span>, iTattooIndex + <span class="hljs-number">1</span>);
        <span class="hljs-keyword">this</span>.adjustTo(<span class="hljs-number">4</span>, iTattooIndex + <span class="hljs-number">2</span>);

        <span class="hljs-keyword">this</span>.logState(<span class="hljs-string">'after D'</span>);
        <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
    }

    <span class="hljs-keyword">this</span>._parent.title(iTattooIndex);
    <span class="hljs-keyword">this</span>.logState(<span class="hljs-string">'after E'</span>);
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>;
},

<span class="hljs-comment">/**====================================================**
 * create views
 **====================================================**/</span>
createEmptyImageView: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> view = Ti.UI.createImageView({
        defaultImage: av.settings.defaultImage,
        <span class="hljs-comment">// 13 February, 2013 - Set these positions to make the image</span>
        <span class="hljs-comment">// fill the available space</span>
        left: <span class="hljs-number">0</span>,
        top: <span class="hljs-number">0</span>,
        width: <span class="hljs-number">200</span>,
        <span class="hljs-comment">// bottom: 0,</span>
        <span class="hljs-comment">// right: 0</span>
        <span class="hljs-comment">//need these here to make the empty boxes (I think)</span>
        tnIndex: <span class="hljs-literal">null</span>,
        tnDate: <span class="hljs-literal">null</span>            
    });
</code></pre><p>&#x2F;&#x2F;          return view;</p>
<pre><code class="hljs">    <span class="hljs-keyword">var</span> imgWrapper = Ti.UI.createScrollView({maxZoomScale:<span class="hljs-number">3.0</span>});
    imgWrapper.add(view);

    <span class="hljs-keyword">return</span> imgWrapper;
},
addEmptyImageViews: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> views = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-keyword">this</span>._numberItems; i++) {
        <span class="hljs-comment">//add empty imageViews</span>
        views.push(<span class="hljs-keyword">this</span>.createEmptyImageView());
    }
    <span class="hljs-comment">//OK here, but fyi - even if all views are set by addView, still need</span>
    <span class="hljs-comment">//to this.views() = [] to access the views later</span>
    <span class="hljs-keyword">this</span>._scrollableView.views = views;
},
createEmptyScrollableView: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(numberItems)</span> </span>{

    <span class="hljs-comment">// Store number of items that'll be displayed</span>
    <span class="hljs-keyword">if</span>(<span class="hljs-keyword">typeof</span> numberItems === <span class="hljs-string">'undefined'</span>)
    {
        <span class="hljs-keyword">this</span>._numberItems = <span class="hljs-number">5</span>;
    }
    <span class="hljs-keyword">else</span>
    {
        <span class="hljs-keyword">this</span>._numberItems = numberItems;
    } 

    <span class="hljs-keyword">var</span> scrollableView = Ti.UI.createScrollableView({
         <span class="hljs-comment">// contentWidth:'auto',</span>
        <span class="hljs-comment">// contentHeight:'auto',</span>
        <span class="hljs-comment">//showVerticalScrollIndicator:true,</span>
        showHorizontalScrollIndicator:<span class="hljs-literal">true</span>,
</code></pre><p>&#x2F;&#x2F;           showPagingControl: true,<br>&#x2F;&#x2F;           pagingControlHeight: 30,    &#x2F;&#x2F;default is 20, but is covered by tab group<br>&#x2F;&#x2F;&#x2F;            maxZoomScale: 10,<br>&#x2F;&#x2F;           minZoomScale: 0.1,<br>            &#x2F;&#x2F;this does not help<br>            &#x2F;&#x2F;if current picture is zoomed, next picture<br>            &#x2F;&#x2F;is not reset - it is zoomed also<br>            &#x2F;&#x2F;not working on it - leave it for now<br>&#x2F;&#x2F;            zoomScale: 1<br>        });<br>        this._scrollableView = scrollableView;</p>
<pre><code class="hljs">    this.addEmptyImageViews();

    var <span class="hljs-built_in">_this</span> = this;
    scrollableView.addEventListener(<span class="hljs-string">'scroll'</span>, function(e) {                        
        var scrollIndex = <span class="hljs-built_in">_this</span>._scrollableView.currentPage;


        <span class="hljs-keyword">if</span>(scrollIndex != <span class="hljs-built_in">_this</span>.previousIndex) {
            <span class="hljs-comment">// Make sure zoom is set back to normal</span>
            <span class="hljs-keyword">for</span>( i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">_this</span>._numberItems; i++) {
                <span class="hljs-built_in">_this</span>.views()[i].zoomScale = <span class="hljs-number">1.0</span>;
            }
        }


        var view = <span class="hljs-built_in">_this</span>.views()[scrollIndex];
        var tattooIndex = view.tnIndex;
        <span class="hljs-built_in">_this</span>.adjustFrom(scrollIndex, tattooIndex);

        <span class="hljs-built_in">_this</span>.previousIndex = scrollIndex;


    });

    scrollableView.addEventListener(<span class="hljs-string">'doubletap'</span>, function(e)
    {
        var scrollIndex = <span class="hljs-built_in">_this</span>._scrollableView.currentPage;
        <span class="hljs-built_in">_this</span>.views()[scrollIndex].zoomScale = <span class="hljs-number">1.0</span>;    
    });

    return scrollableView;
},

<span class="hljs-comment">/**====================================================**
 * initialize
 **====================================================**/</span>
initializeForTattooIndex: function(iTattooIndex) {

    <span class="hljs-keyword">if</span> (iTattooIndex === <span class="hljs-number">0</span>) {

        this.setImagesFromTattooIndex(<span class="hljs-number">0</span>);
        this.setScrollPosition(<span class="hljs-number">0</span>);

        return this;
    }
    <span class="hljs-keyword">if</span> (iTattooIndex === <span class="hljs-number">1</span>) {
        this.setImagesFromTattooIndex(<span class="hljs-number">0</span>);
        this.setScrollPosition(<span class="hljs-number">1</span>);
        return this;
    }
    var length = this.tattooCollection().length();
    var lastIndex = length - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">if</span> (iTattooIndex === lastIndex) {
        this.setImagesFromTattooIndex(iTattooIndex - <span class="hljs-number">4</span>);
        this.setScrollPosition(<span class="hljs-number">4</span>);
        return this;
    }
    <span class="hljs-keyword">if</span> (iTattooIndex === lastIndex - <span class="hljs-number">1</span>) {
        this.setImagesFromTattooIndex(iTattooIndex - <span class="hljs-number">3</span>);
        this.setScrollPosition(<span class="hljs-number">3</span>);
        return this;
    }
    <span class="hljs-comment">//normal case</span>
    this.setImagesFromTattooIndex(iTattooIndex - <span class="hljs-number">2</span>);
    this.setScrollPosition(<span class="hljs-number">2</span>);
},
setScrollPosition: function(iScrollIndex) {
    <span class="hljs-comment">//0 for start, 2 for middle, 4 for end</span>
    this._scrollableView.currentPage = iScrollIndex;
},
setImagesFromTattooIndex: function(iTattooIndex) {
    <span class="hljs-comment">//assumes tattooCollection is full</span>
    <span class="hljs-comment">//av.backgroundFor(start, end, delay, function(i) {</span>
    <span class="hljs-keyword">for</span> (var i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {
        var tattooIndex = iTattooIndex + i;
        var url = this.tattooCollection().galleryUrlAt(tattooIndex);
        var <span class="hljs-built_in">date</span> = this.tattooCollection().shortDateAt(tattooIndex);

        <span class="hljs-comment">// "views" is an array of ScrollViews which each have one image view</span>
        var view = this.views()[i];
</code></pre><p>&#x2F;&#x2F;            var view = this.views()[i];</p>
<pre><code class="hljs">        view.children[<span class="hljs-number">0</span>].image = url;

        view.tnIndex = tattooIndex;
        view.tnDate = date;
    }
},


currentTattooIndex: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">var</span> scrollIndex = <span class="hljs-keyword">this</span>._scrollableView.currentPage;
    <span class="hljs-keyword">var</span> view = <span class="hljs-keyword">this</span>.views()[scrollIndex];
    <span class="hljs-keyword">var</span> tattooIndex = view.tnIndex;
    <span class="hljs-keyword">return</span> tattooIndex;
},
currentTattoo: <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.tattooCollection().tattooAt(<span class="hljs-keyword">this</span>.currentTattooIndex());
}
</code></pre><p>});</p>
</div>
							<div class="author">
								&mdash; commented <span title="February 18th 2013, 5:17:31 pm">February 18th 2013</span>
								by <span class='authorname'>Gabe K.</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>You have too much code - which is why the markdown is not working.  Either break the code up into smaller chunks of code blocks or use <a href="http:&#x2F;&#x2F;pastie.org&#x2F;">pastie.org</a> and paste the URL back here.</p>
</div>
							<div class="author">
								&mdash; commented <span title="February 18th 2013, 5:37:03 pm">February 18th 2013</span>
								by <span class='authorname'>Malcolm Hollingsworth</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Thanks for the tip Malcom! Code is here on pastie.org:</p>
<p><a href="http:&#x2F;&#x2F;pastie.org&#x2F;6216801">scroller code</a></p>
</div>
							<div class="author">
								&mdash; commented <span title="February 18th 2013, 5:51:51 pm">February 18th 2013</span>
								by <span class='authorname'>Gabe K.</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>How are you calling this class?</p>
</div>
							<div class="author">
								&mdash; commented <span title="February 18th 2013, 6:55:13 pm">February 18th 2013</span>
								by <span class='authorname'>Malcolm Hollingsworth</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Hey Malcom - the calling object runs a few functions of this class. First &quot;createEmptyScrollableView&quot; to create the hierarchy of views and to get a reference to the ScrollableView object. Then initializeForTattooIndex to set up the views. I did a reimplementation today of the scroller class that just creates a view within the ScrollableView object for each image we need to display. This is running fine with around 10 images on a current gen iPod Touch, but I&#39;m concerned about what&#39;ll happen if we have, say, 50 or 100+ images (which could definitely be the case), especially on older hardware.</p>
</div>
							<div class="author">
								&mdash; commented <span title="February 18th 2013, 9:16:41 pm">February 18th 2013</span>
								by <span class='authorname'>Gabe K.</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-261956">
				
						<section>
							<p>If any one else happens to run into this same issue: I got hold of an iPhone 3GS and set up the ScrollableView with 100 or so images, each in a separate ImageView. The 3GS handled it fine, so the solution for my case was to not worry about a fancy approach (e.g. switching images in and out of a fixed number of ImageViews) and just give each image its own view.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 1st 2013, 1:44:16 pm">May 1st 2013</span>
								by <span class='authorname'>Gabe K.</span><br>
								<a class="icon-bg icon-link" href="question/148441/ios-6---appcelerator-30---scrollableview-code-breaks#answer-261956" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
