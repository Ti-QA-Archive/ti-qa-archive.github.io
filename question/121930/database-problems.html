<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>database problems! » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>database problems!</h1>
		</header>
		<section>
			<p>&lt;code&gt;var db = Titanium.Database.install( &quot;yes.sqlite&quot;,&quot;hatethis&quot;);</p>
<p>var data = [];<br>var rows = db.execute(&quot;SELECT * FROM names&quot;);<br>while (rows.isValidRow()) {<br>  data.push({<br>    first: rows.fieldByName(&#39;first&#39;),<br>    middle: rows.fieldByName(&#39;middle&#39;),<br>    last: rows.fieldByName(&#39;last&#39;),</p>
<pre><code class="hljs">  })<span class="hljs-comment">;</span>
rows.next()<span class="hljs-comment">;</span>
</code></pre><p>}<br>rows.close();</p>
<p>Ti.API.info(data[0]);<br>&lt;&#x2F;code&gt;</p>
<p>I used sqlite manager (firefox plugin) to make a sqlite database. I copy and paste the database in the resources folder and run the code. (this is on android with 2.2 emulator)</p>
<p>I initially had 10 people in my database -&gt; the code worked fine.</p>
<p>I then tried 30 people and i get null values from the Ti.API.info.</p>
<p>why is it doing this? i tested it 100 times importing different data etc. still same problem, every time i put more data in it starts returning null values in the data array.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="July 2nd 2011, 8:30:35 am">July 2nd 2011</span>
				by <span class='authorname'>Bojan Markoski</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>array</span></li>
					
						<li><span class='tagname'>database</span></li>
					
						<li><span class='tagname'>field</span></li>
					
						<li><span class='tagname'>install</span></li>
					
						<li><span class='tagname'>parse</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-212028">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>Bojan</p>
<p>It&#39;s difficult to know what is going wrong without seeing your create table statements.</p>
<p>However, rather than using <code>Ti.API.info(data[0]);</code>, try the following:</p>
<pre><code class="hljs"><span class="hljs-tag">Ti</span><span class="hljs-class">.API</span><span class="hljs-class">.info</span>(<span class="hljs-tag">data</span><span class="hljs-attr_selector">[0]</span><span class="hljs-class">.first</span>);
<span class="hljs-tag">Ti</span><span class="hljs-class">.API</span><span class="hljs-class">.info</span>(<span class="hljs-tag">data</span><span class="hljs-attr_selector">[0]</span><span class="hljs-class">.middle</span>);
<span class="hljs-tag">Ti</span><span class="hljs-class">.API</span><span class="hljs-class">.info</span>(<span class="hljs-tag">data</span><span class="hljs-attr_selector">[0]</span><span class="hljs-class">.last</span>);
</code></pre><p>Cheers</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 2nd 2011, 1:26:40 pm">July 2nd 2011</span>
								by <span class='authorname'>Paul Dowsett</span><br>
								<a class="icon-bg icon-link" href="question/121930/database-problems#answer-212028" rel="permalink">permalink</a>
							</div>

							<h5>7 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Paul,<br>Thanks for the reply, I decided to use a remote mysql database with a server side php script returning the data in JSON format and then creating and inserting the data to a local database.</p>
<p>Another question for you, is there a way i can query the local database to return me a value from a certain column within a field by using its index?</p>
<p>e.g Column 1(NAMES) = [&quot;Paul&quot;, &quot;Bojan&quot;]</p>
<p>something like resultSet.getRowByIndex(2) = Bojan</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 2nd 2011, 1:42:38 pm">July 2nd 2011</span>
											by <span class='authorname'>Bojan Markoski</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Bojan</p>
<p>If you want to use the column index, rather than the <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;apidoc&#x2F;mobile&#x2F;latest&#x2F;Titanium.Database.ResultSet.fieldByName-method.html">column name</a>, you can use the <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;apidoc&#x2F;mobile&#x2F;latest&#x2F;Titanium.Database.ResultSet.field-method.html">field()</a> method. This is actually a slightly more performant way of accessing data in the resultSet.</p>
<p>Also see <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;apidoc&#x2F;mobile&#x2F;latest&#x2F;Titanium.Database.ResultSet-object">Titanium.Database.ResultSet</a> for the other methods available.</p>
<p>Hope this helps.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 2nd 2011, 3:08:45 pm">July 2nd 2011</span>
											by <span class='authorname'>Paul Dowsett</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Thanks for that, got it working! </p>
<p>one more question, i call Ti.Database.open() on a database i want to create. and then i load the JSON return from my server into the newly created local db, will that db remain installed in my phone? even if i close the application and run it again will i be able to query the local db from the data i synced from the server anytime i want.</p>
<p>if so then whats a good way of making your local db only update from the remote server when it is empty.</p>
<p>i use:</p>
<pre><code class="hljs">var db = Titanium.Database.open('mydb11');
    db.execute('<span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> <span class="hljs-keyword">DATA</span> (<span class="hljs-keyword">id</span> <span class="hljs-built_in">INTEGER</span>, lat <span class="hljs-keyword">DOUBLE</span>, lon <span class="hljs-keyword">DOUBLE</span>, location <span class="hljs-built_in">TEXT</span>)<span class="hljs-string">');
    var resultSet = db.execute('</span><span class="hljs-keyword">SELECT</span> * <span class="hljs-keyword">FROM</span> <span class="hljs-keyword">DATA</span><span class="hljs-string">');


if(resultSet.rowCount &lt; 1){    
var xhr = Ti.Network.createHTTPClient(); 

xhr.open('</span><span class="hljs-keyword">GET</span><span class="hljs-string">', "http://10.0.2.2/script.php");
xhr.send();


xhr.onload = function(){
        var json = JSON.parse(this.responseText);
        if (!json) { 
        Titanium.API.info('</span><span class="hljs-keyword">Error</span> - <span class="hljs-literal">Null</span> <span class="hljs-keyword">return</span>!<span class="hljs-string">'); 
        return;
        }

        for(var i=0; i &lt; json.red.length; i++){
           db.execute('</span><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> <span class="hljs-keyword">DATA</span> (<span class="hljs-keyword">id</span>, lat, lon, location) <span class="hljs-keyword">VALUES</span>(?,?,?,?)<span class="hljs-string">',json.sqltable[i].id,json.sqltable[i].lat,json.sqltable[i].lon,json.sqltable[i].location);
           }

    };</span></span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="July 3rd 2011, 7:44:25 am">July 3rd 2011</span>
											by <span class='authorname'>Bojan Markoski</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>json.red.length should be json.sqltable.length -&gt; dont mind the typo.</p>
<p>the resultSet if statement isn&#39;t ideal for me because after it i have:</p>
<pre><code class="hljs"><span class="hljs-keyword">while</span>(<span class="hljs-keyword">resultSet</span><span class="hljs-built_in">.</span>isValidRow()){
<span class="hljs-built_in">var</span> lat = <span class="hljs-keyword">resultSet</span><span class="hljs-built_in">.</span>fieldByName(<span class="hljs-string">'lat'</span>);
<span class="hljs-built_in">var</span> lon = <span class="hljs-keyword">resultSet</span><span class="hljs-built_in">.</span>fieldByName(<span class="hljs-string">'lon'</span>);
<span class="hljs-built_in">var</span> loc = <span class="hljs-keyword">resultSet</span><span class="hljs-built_in">.</span>fieldByName(<span class="hljs-string">'location'</span>);
<span class="hljs-built_in">var</span> <span class="hljs-keyword">type</span> = <span class="hljs-keyword">resultSet</span><span class="hljs-built_in">.</span>fieldByName(<span class="hljs-string">'Point'</span>)

 <span class="hljs-built_in">var</span> annotate = Ti<span class="hljs-built_in">.</span><span class="hljs-built_in">Map</span><span class="hljs-built_in">.</span>createAnnotation({
        longitude: lat,
        latitude: lon,
        subtitle: loc,
        pincol<span class="hljs-subst">or</span>: Ti<span class="hljs-built_in">.</span><span class="hljs-built_in">Map</span><span class="hljs-built_in">.</span>ANNOTATION_GREEN,
        title: <span class="hljs-keyword">type</span>,
        animate: <span class="hljs-literal">true</span>

    });

          Ti<span class="hljs-built_in">.</span>API<span class="hljs-built_in">.</span>info(lat);
           <span class="hljs-keyword">resultSet</span><span class="hljs-built_in">.</span>next();
 }<span class="hljs-comment">//END OF isValidRow</span>
</code></pre><p>so when i create a new db it executes the search, it finds nothing so then it downloads the data from the server and fills the local db. but then my isValidRow loop doesn&#39;t work because the initial resultSet returned empty, and i have to exit the app and run it again to make it show the results.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 3rd 2011, 7:49:53 am">July 3rd 2011</span>
											by <span class='authorname'>Bojan Markoski</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Bojan</p>
<p>It&#39;s important that each &quot;question&quot; in the Q&amp;A is focused on one specific issue, as it makes it easier for other users to find answers to specific problems. In your latest post, you are starting on your third and forth!  ;)</p>
<p>I also note that you have not even titled this thread with a proper question. I urge you to read the <a href="http:&#x2F;&#x2F;wiki.appcelerator.org&#x2F;display&#x2F;guides&#x2F;Contributing+to+Titanium#ContributingtoTitanium-ParticipatingintheQ%26A">Participating in the Q&amp;A</a>, before creating any more questions here.</p>
<p>Please would you close this question, and create a new one, using these guidelines?</p>
<p>Yes, the db will be persistent on your phone. It&#39;s stored in a file, and hence the filesystem is also persistent. That&#39;s the point db and filesystem storage!  ;)  See <a href="http:&#x2F;&#x2F;wiki.appcelerator.org&#x2F;display&#x2F;guides&#x2F;Working+with+Local+Data">Working with Local Data</a> for more information.</p>
<p>I can´t recall a time with my own code where it has mattered when a resultSet has returned empty, because the related code is inside the loop and so it will not run accordingly. As long as the db file exists and the tables have been created, resultSets will always be valid, even if they are empty. Thus, the code inside <code>while(resultSet.isValidRow())</code> will simply not execute.</p>
<pre><code class="hljs"><span class="hljs-built_in">var</span> <span class="hljs-keyword">resultSet</span> = db<span class="hljs-built_in">.</span>execute(<span class="hljs-string">'SELECT * FROM DATA LIMIT 1'</span>);
<span class="hljs-keyword">if</span>(<span class="hljs-keyword">resultSet</span><span class="hljs-built_in">.</span>rowCount &gt; <span class="hljs-number">0</span>){
  <span class="hljs-keyword">while</span>(<span class="hljs-keyword">resultSet</span><span class="hljs-built_in">.</span>isValidRow()){
    <span class="hljs-comment">// do something</span>
  }
}
</code></pre><p>If you want to check for a non-empty resultSet, I suppose you could use <code>if(resultSet.rowCount &amp;gt; 0)</code>. See the docs for more info about the <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;apidoc&#x2F;mobile&#x2F;latest&#x2F;Titanium.Database.ResultSet-object.html">rowCount</a> property.</p>
<p>Cheers</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 3rd 2011, 9:00:51 am">July 3rd 2011</span>
											by <span class='authorname'>Paul Dowsett</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Thanks and sorry, just thought that i would be creating pointless threads to simple answers.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 3rd 2011, 2:07:20 pm">July 3rd 2011</span>
											by <span class='authorname'>Bojan Markoski</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>No worries, Bojan. :)  You can close the question by marking one of the answers as &quot;best&quot;.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 3rd 2011, 4:06:59 pm">July 3rd 2011</span>
											by <span class='authorname'>Paul Dowsett</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-212030">
				
						<section>
							<p>The .install() method will copy the database from the resources folder ONLY IF a database by that name does not already exist for your application.  So I would have expected each of your tries to continue to show the same 10 rows.  The fact it doesn&#39;t suggests you somehow cleared some of the data in that table, but did not completely removed the database.</p>
<p>One way to work around this automatically while developing your app is to do this:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> <span class="hljs-keyword">db</span> = Titanium.Database.<span class="hljs-keyword">open</span>(<span class="hljs-string">"hatethis"</span>);
<span class="hljs-keyword">db</span>.remote();
<span class="hljs-keyword">db</span> = Titanium.Database.install( <span class="hljs-string">"yes.sqlite"</span>,<span class="hljs-string">"hatethis"</span>);
</code></pre><p>What this does is open the existing database (or create an empty one if none exists yet), then turns around and immediately deletes it.  The open is necessary to get the object reference to the database in order to use the remove() method.  Once it is removed, the subsequent install() will always copy in a fresh version because the database no longer exists.</p>
<p>Note that this is typically NOT what you want to do when in production, unless the database does not get updated by the user.  On an app update, you typically WANT to retain the older copy of the database.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 2nd 2011, 2:04:35 pm">July 2nd 2011</span>
								by <span class='authorname'>Doug Handy</span><br>
								<a class="icon-bg icon-link" href="question/121930/database-problems#answer-212030" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
