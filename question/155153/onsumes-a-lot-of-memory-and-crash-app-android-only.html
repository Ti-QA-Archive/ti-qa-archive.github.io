<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>onsumes a lot of memory and crash app (android only) » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>onsumes a lot of memory and crash app (android only)</h1>
		</header>
		<section>
			<p>Hi, I&#39;m developing an app for iPhone and Android, on iPhone it works well, but when I test it on android (emulator&#x2F;device) there are some errors that I can&#39;t find the solution.</p>
<p>I&#39;m using:<br>Mac OS X 10.7.5<br>Titanium Studio, build: 3.1.1.201306112235<br>Alloy 1.1.3 </p>
<p>I have 5 tabs, the last is a config tab, the first 4 each one has a table with rows created by a loop of alloy.createController and their arguments (id, title, description, image), the list is loaded as expected (only 10 rows p&#x2F; tab) , this happens in index.js.</p>
<p>So, in Android the app is loaded normally, but if I click to open a tab about 3 or 4 times it runs out of memory, the same happens when I scroll the table up and down quickly. It shows a alert box to Force Close </p>
<p>This is what the console says (more at the end):<br>[ERROR][dalvikvm-heap(  469)] 614400-byte external allocation too large for this process.<br>[ERROR][GraphicsJNI(  469)] VM won&#39;t let us allocate 614400 bytes<br>[WARN][dalvikvm(  469)] threadid=1: thread exiting with uncaught exception (group=0x40015560)<br>[ERROR][TiApplication(  469)] (main) [4139,51502] Sending event: exception on thread: main msg:java.lang.OutOfMemoryError: bitmap size exceeds VM budget; Titanium 3.1.1,2013&#x2F;06&#x2F;15 16:10,f7592c1<br>[ERROR][TiApplication(  469)] java.lang.OutOfMemoryError: bitmap size exceeds VM budget<br>[ERROR][TiApplication(  469)]     at android.graphics.BitmapFactory.nativeDecodeStream(Native Method)<br>[ERROR][TiApplication(  469)]     at android.graphics.BitmapFactory.decodeStream(BitmapFactory.java:470)<br>[ERROR][TiApplication(  469)]     at android.graphics.BitmapFactory.decodeResourceStream(BitmapFactory.java:336)<br>[ERROR][TiApplication(  469)]     at android.graphics.drawable.Drawable.createFromResourceStream(Drawable.java:697)<br>[ERROR][TiApplication(  469)]     at android.graphics.drawable.Drawable.createFromStream(Drawable.java:657)<br>[ERROR][TiApplication(  469)]     at org.appcelerator.titanium.util.TiUIHelper.loadFastDevDrawable(TiUIHelper.java:818)<br>[ERROR][TiApplication(  469)]     at org.appcelerator.titanium.util.TiUIHelper.getResourceDrawable(TiUIHelper.java:830)<br>[ERROR][TiApplication(  469)]     at org.appcelerator.titanium.util.TiFileHelper.loadDrawable(TiFileHelper.java:279)<br>[ERROR][TiApplication(  469)]     at org.appcelerator.titanium.util.TiUIHelper.buildBackgroundDrawable(TiUIHelper.java:508)<br>[ERROR][TiApplication(  469)]     at org.appcelerator.titanium.util.TiUIHelper.buildBackgroundDrawable(TiUIHelper.java:577)<br>[ERROR][TiApplication(  469)]     at org.appcelerator.titanium.view.TiUIView.handleBackgroundImage(TiUIView.java:942)<br>[ERROR][TiApplication(  469)]     at org.appcelerator.titanium.view.TiUIView.processProperties(TiUIView.java:684)<br>[ERROR][TiApplication(  469)]     at org.appcelerator.kroll.KrollProxy.handleMessage(KrollProxy.java:1034)<br>[ERROR][TiApplication(  469)]     at org.appcelerator.titanium.proxy.TiViewProxy.handleMessage(TiViewProxy.java:316)<br>[ERROR][TiApplication(  469)]     at org.appcelerator.titanium.proxy.TiWindowProxy.handleMessage(TiWindowProxy.java:107)<br>[ERROR][TiApplication(  469)]     at android.os.Handler.dispatchMessage(Handler.java:95)<br>[ERROR][TiApplication(  469)]     at android.os.Looper.loop(Looper.java:130)<br>[ERROR][TiApplication(  469)]     at android.app.ActivityThread.main(ActivityThread.java:3683)<br>[ERROR][TiApplication(  469)]     at java.lang.reflect.Method.invokeNative(Native Method)<br>[ERROR][TiApplication(  469)]     at java.lang.reflect.Method.invoke(Method.java:507)<br>[ERROR][TiApplication(  469)]     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:839)<br>[ERROR][TiApplication(  469)]     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:597)<br>[ERROR][TiApplication(  469)]     at dalvik.system.NativeStart.main(Native Method)<br>[ERROR][AndroidRuntime(  469)] FATAL EXCEPTION: main<br>[ERROR][AndroidRuntime(  469)] java.lang.OutOfMemoryError: bitmap size exceeds VM budget<br>[ERROR][AndroidRuntime(  469)]     at android.graphics.BitmapFactory.nativeDecodeStream(Native Method)<br>[ERROR][AndroidRuntime(  469)]     at android.graphics.BitmapFactory.decodeStream(BitmapFactory.java:470)<br>[ERROR][AndroidRuntime(  469)]     at android.graphics.BitmapFactory.decodeResourceStream(BitmapFactory.java:336)<br>[ERROR][AndroidRuntime(  469)]     at android.graphics.drawable.Drawable.createFromResourceStream(Drawable.java:697)<br>[ERROR][AndroidRuntime(  469)]     at android.graphics.drawable.Drawable.createFromStream(Drawable.java:657)<br>[ERROR][AndroidRuntime(  469)]     at org.appcelerator.titanium.util.TiUIHelper.loadFastDevDrawable(TiUIHelper.java:818)<br>[ERROR][AndroidRuntime(  469)]     at org.appcelerator.titanium.util.TiUIHelper.getResourceDrawable(TiUIHelper.java:830)<br>[ERROR][AndroidRuntime(  469)]     at org.appcelerator.titanium.util.TiFileHelper.loadDrawable(TiFileHelper.java:279)<br>[ERROR][AndroidRuntime(  469)]     at org.appcelerator.titanium.util.TiUIHelper.buildBackgroundDrawable(TiUIHelper.java:508)<br>[ERROR][AndroidRuntime(  469)]     at org.appcelerator.titanium.util.TiUIHelper.buildBackgroundDrawable(TiUIHelper.java:577)<br>[ERROR][AndroidRuntime(  469)]     at org.appcelerator.titanium.view.TiUIView.handleBackgroundImage(TiUIView.java:942)<br>[ERROR][AndroidRuntime(  469)]     at org.appcelerator.titanium.view.TiUIView.processProperties(TiUIView.java:684)<br>[ERROR][AndroidRuntime(  469)]     at org.appcelerator.kroll.KrollProxy.handleMessage(KrollProxy.java:1034)<br>[ERROR][AndroidRuntime(  469)]     at org.appcelerator.titanium.proxy.TiViewProxy.handleMessage(TiViewProxy.java:316)<br>[ERROR][AndroidRuntime(  469)]     at org.appcelerator.titanium.proxy.TiWindowProxy.handleMessage(TiWindowProxy.java:107)<br>[ERROR][AndroidRuntime(  469)]     at android.os.Handler.dispatchMessage(Handler.java:95)<br>[ERROR][AndroidRuntime(  469)]     at android.os.Looper.loop(Looper.java:130)<br>[ERROR][AndroidRuntime(  469)]     at android.app.ActivityThread.main(ActivityThread.java:3683)<br>[ERROR][AndroidRuntime(  469)]     at java.lang.reflect.Method.invokeNative(Native Method)<br>[ERROR][AndroidRuntime(  469)]     at java.lang.reflect.Method.invoke(Method.java:507)<br>[ERROR][AndroidRuntime(  469)]     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:839)<br>[ERROR][AndroidRuntime(  469)]     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:597)<br>[ERROR][AndroidRuntime(  469)]     at dalvik.system.NativeStart.main(Native Method)<br>[WARN][ActivityManager(   62)]   Force finishing activity company_url&#x2F;org.appcelerator.titanium.TiActivity<br>[WARN][ActivityManager(   62)] Activity pause timeout for HistoryRecord{406c2000 company_url&#x2F;org.appcelerator.titanium.TiActivity}<br>[WARN][ActivityManager(   62)] Launch timeout has expired, giving up wake lock!<br>[WARN][ActivityManager(   62)] Activity idle timeout for HistoryRecord{40544940 company_url&#x2F;.SoPromocoesActivity}<br>[WARN][ActivityManager(   62)] Activity destroy timeout for HistoryRecord{406c2000 company_url&#x2F;org.appcelerator.titanium.TiActivity}</p>
<p>While I don&#39;t press the Force Close button, the console creates a loop off:</p>
<p>[INFO][dalvikvm-heap(  469)] Clamp target GC heap from 50.000MB to 48.000MB<br>[INFO][dalvikvm-heap(  469)] Clamp target GC heap from 48.000MB to 48.000MB<br>[INFO][dalvikvm-heap(  469)] Grow heap (frag case) to 48.000MB for 8-byte allocation</p>
<p>And finally:</p>
<p>[INFO][Process (  469)] Sending signal. PID: 469 SIG: 9<br>[INFO][ActivityManager(   62)] Process company_url (pid 469) has died.<br>[WARN][GpsLocationProvider(   62)] Unneeded remove listener for uid 1000<br>[ERROR][InputDispatcher(   62)] channel &#39;40738920 company_url&#x2F;company_url.SoPromocoesActivity (server)&#39; ~ Consumer closed input channel or an error occurred.  events=0x8<br>[ERROR][InputDispatcher(   62)] channel &#39;40738920 company_url&#x2F;company_url.SoPromocoesActivity (server)&#39; ~ Channel is unrecoverably broken and will be disposed!<br>[INFO][WindowManager(   62)] WIN DEATH: Window{40738920 company_url&#x2F;company_url.SoPromocoesActivity paused=false}<br>[INFO][WindowManager(   62)] WIN DEATH: Window{4074a218 company_url&#x2F;org.appcelerator.titanium.TiActivity paused=false}<br>[ERROR][InputDispatcher(   62)] Received spurious receive callback for unknown input channel.  fd=170, events=0x8</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="July 22nd 2013, 2:26:23 pm">July 22nd 2013</span>
				by <span class='authorname'>Ricardo Pereira</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>alloy</span></li>
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>crash</span></li>
					
						<li><span class='tagname'>memory</span></li>
					
				</ul>
			

			<section>
				<h5>6 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>function insertPromotionsData() {</p>
<pre><code class="hljs">$.contentLoaderPromotions.setOpacity(<span class="hljs-number">1</span>);

<span class="hljs-keyword">var</span> updatePromoData = <span class="hljs-literal">false</span>;

promoItems = [];
promotionPage = <span class="hljs-number">1</span>;

constructPromotionsData();

<span class="hljs-keyword">if</span>(scrollEventFirstPromo) {
    $.promoList.removeEventListener(<span class="hljs-string">'scroll'</span>,scrollEventPromo);
    $.promoList.removeEventListener(<span class="hljs-string">'scrollEnd'</span>,scrollEndEventPromo);
}

scrollEventFirstPromo = <span class="hljs-literal">true</span>;

$.promoList.addEventListener(<span class="hljs-string">'scroll'</span>,scrollEventPromo);
$.promoList.addEventListener(<span class="hljs-string">'scrollEnd'</span>,scrollEndEventPromo);
</code></pre><p>}</p>
<p>var scrollEventPromo = function(e) {</p>
<pre><code class="hljs">var <span class="hljs-command">offset</span> = e.contentOffset.y;
<span class="hljs-keyword">if</span> (<span class="hljs-command">offset</span> &gt; <span class="hljs-number">0</span> &amp;&amp; <span class="hljs-command">offset</span> &lt; <span class="hljs-number">80.0</span>) {
    updatePromoData = <span class="hljs-constant">true</span>;
}
</code></pre><p>}</p>
<p>var scrollEndEventPromo = function(e) {</p>
<pre><code class="hljs">if(updatePromoData) {
    promotionPage++<span class="hljs-comment">;</span>
    constructPromotionsData()<span class="hljs-comment">;</span>
}
</code></pre><p>}</p>
<p>function constructPromotionsData() {</p>
<pre><code class="hljs">HTTPCLIENT ...

onload: {

$.contentLoaderPromotions.setOpacity(<span class="hljs-number">0</span>);

<span class="hljs-keyword">var</span> promoResult = <span class="hljs-built_in">eval</span>(<span class="hljs-string">'('</span>+<span class="hljs-keyword">this</span>.responseText+<span class="hljs-string">')'</span>);
<span class="hljs-keyword">var</span> promoItem = promoResult.data;

<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>, ilen=promoResult.total; i&lt;ilen; i++) {

    <span class="hljs-keyword">var</span> imagePath = promoItem[i].image;

    <span class="hljs-keyword">if</span>(imagePath==<span class="hljs-literal">null</span> || imagePath==<span class="hljs-string">""</span>) {
        <span class="hljs-keyword">if</span>(promotionSettings) {
            imagePath=L(<span class="hljs-string">"emptyImagePromotions"</span>);
        }
        <span class="hljs-keyword">else</span> {
            imagePath=L(<span class="hljs-string">"emptyImagePartners"</span>);
        }
    }

    <span class="hljs-keyword">var</span> promoRow = Alloy.createController(<span class="hljs-string">"promoList"</span>,{
        promoImage:imagePath,
        promoTitle:promoItem[i].title,
        promoDescription:promoItem[i].description,
        promoPrice:promoItem[i].price,
        promoOldPrice:promoItem[i].oldPrice,
        promoDiscount:promoItem[i].discount,
        promotionAlias:promoItem[i].promotionAlias,
        partnerAlias:promoItem[i].partnerAlias,
        promoAction:<span class="hljs-string">"promo"</span>
    });

    promoItems.push(promoRow.getView());
}

$.promoList.setData(promoItems);

updatePromoData = <span class="hljs-literal">false</span>;
</code></pre><p>}</p>
</div>
							<div class="author">
								&mdash; commented <span title="July 22nd 2013, 2:35:16 pm">July 22nd 2013</span>
								by <span class='authorname'>Ricardo Pereira</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Judging by the error it sounds like you are loading large images. Have your tried on device instead of the limited emulator? Also, we can&#39;t do much more than guess without a small reproducible test case. Not just snippets of your code, but the smallest possible standalone code that causes the problem.</p>
</div>
							<div class="author">
								&mdash; commented <span title="July 22nd 2013, 2:38:35 pm">July 22nd 2013</span>
								by <span class='authorname'>Tony Lukasavage</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>yes, I tested on Xperia Miro, Samsung Gallaxy S2 and S4, it&#39;s the same, slow, and when i click on the tabs a few times it crashes</p>
</div>
							<div class="author">
								&mdash; commented <span title="July 22nd 2013, 2:48:01 pm">July 22nd 2013</span>
								by <span class='authorname'>Ricardo Pereira</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Hello,</p>
<p>can you try setting this on your tiapp.xml:</p>
<pre><code class="hljs">&lt;<span class="hljs-keyword">property</span> <span class="hljs-property">name</span>=<span class="hljs-string">"ti.android.threadstacksize"</span> type=<span class="hljs-string">"int"</span>&gt;<span class="hljs-number">32768</span>&lt;/<span class="hljs-keyword">property</span>&gt;
</code></pre><p>in any project, in the tiapp.xml, and if you only support android 3.x and 4.x, add this too:</p>
<pre><code class="hljs">&lt;<span class="hljs-keyword">property</span> <span class="hljs-property">name</span>=<span class="hljs-string">"ti.android.largeHeap"</span> type=<span class="hljs-string">"bool"</span>&gt;<span class="hljs-constant">true</span>&lt;/<span class="hljs-keyword">property</span>&gt;
</code></pre><p>More info <a href="https:&#x2F;&#x2F;wiki.appcelerator.org&#x2F;display&#x2F;guides&#x2F;tiapp.xml+and+timodule.xml+Reference#tiapp.xmlandtimodule.xmlReference-Androidspecificsection">here</a>. </p>
<p>Best,</p>
<p>Mauro</p>
</div>
							<div class="author">
								&mdash; commented <span title="July 22nd 2013, 7:04:58 pm">July 22nd 2013</span>
								by <span class='authorname'>Mauro Parra</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Thanks, that improved a little bit</p>
<p>I&#39;m testing now on samsung gallaxy S2, in the normal state the app resources are:<br>RAM: 55MB, CPU: 5%</p>
<p>When I navigate through the tabs the RAM increases 10MB and the CPU percentage rises to double</p>
<p>When I open a controller (alloy window) to show the details of the row, the RAM MBs goes to 75</p>
<p>I don&#39;t know if this have any influence, but I have an login action with a timeout of 30 seconds, and even then, sometimes it takes 7 or 8 attempts to login. It&#39;s an action that carries only two inputs, &#39;email&#39; and &#39;pass&#39;. On iPhone, this takes less than 2 seconds to login</p>
</div>
							<div class="author">
								&mdash; commented <span title="July 23rd 2013, 8:02:04 am">July 23rd 2013</span>
								by <span class='authorname'>Ricardo Pereira</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>sorry the double post, I can&#39;t use the second property because the app is for 2.3.3</p>
</div>
							<div class="author">
								&mdash; commented <span title="July 23rd 2013, 8:05:07 am">July 23rd 2013</span>
								by <span class='authorname'>Ricardo Pereira</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>0</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>0 Answers</h3>

	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
