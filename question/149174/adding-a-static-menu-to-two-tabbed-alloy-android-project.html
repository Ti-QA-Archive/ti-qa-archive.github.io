<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Adding a static menu to two tabbed Alloy Android project » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Adding a static menu to two tabbed Alloy Android project</h1>
		</header>
		<section>
			<p>Hi,</p>
<p>I&#39;m trying to add a menu (so far a static one) which is defined as a &quot;mainMenu&quot; Controller (mainMenu.js, mainMenu.tss and mainMenu.xml in their respective folders) to the click event off &quot;Menu Button&quot; (either HW or soft on some tablets).<br>I don&#39;t know how to include that new controller into main Controller (index.js) so that the same menu&#x2F;view gets rendered regardless of the fact on which tab&#x2F;widow is user currently.</p>
<p>I tried this code in index.js:</p>
<pre><code class="hljs">$.<span class="hljs-built_in">index</span>.<span class="hljs-keyword">open</span>();

var win = Ti.UI.currentWindow,
    activity = win.activity;

activity.onCreateOptionsMenu = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> {</span>
    var <span class="hljs-keyword">menu</span> = <span class="hljs-keyword">e</span>.<span class="hljs-keyword">menu</span>;
    <span class="hljs-keyword">menu</span> = Alloy.createController(<span class="hljs-string">'mainMenu'</span>).getView();
};
</code></pre><p>but I get &quot;Uncought TypeError: Cannot read property &#39;activity&#39; of null&quot;</p>
<p>How do I get an active window reference in the main controller?<br>Is that even possible? And if so how?</p>
<p>Or do I need to rethink… Some pointers, please.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="March 5th 2013, 11:34:31 am">March 5th 2013</span>
				by <span class='authorname'>Misel Mesnjak</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>alloy</span></li>
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>menu</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Do you want  slider menu?</p>
<p>Thanks</p>
</div>
							<div class="author">
								&mdash; commented <span title="March 5th 2013, 11:44:12 am">March 5th 2013</span>
								by <span class='authorname'>Muhammad Wahhab Mirza</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Which kind exactly? Can You give an example?</p>
<p>I will be satisfied with a plain Menu like the one I can get if I put &lt;Menu&gt;,&lt;MenuItem&gt; block in any &lt;Window&gt; block, like this:</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">Alloy</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Window</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"win"</span> <span class="hljs-attribute">fullscreen</span>=<span class="hljs-value">"true"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Menu</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"menu"</span> <span class="hljs-attribute">platform</span>=<span class="hljs-value">"android"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">MenuItem</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"menuItem"</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Item 1"</span> <span class="hljs-attribute">icon</span>=<span class="hljs-value">"item1.png"</span> <span class="hljs-attribute">onClick</span>=<span class="hljs-value">"doClick"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">Menu</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">Window</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">Alloy</span>&gt;</span>
</code></pre></div>
							<div class="author">
								&mdash; commented <span title="March 5th 2013, 12:14:16 pm">March 5th 2013</span>
								by <span class='authorname'>Misel Mesnjak</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-258121">
				
						<section>
							<p>There was a bug in the way Titanium handled activities of windows in TabGroups on Android, detailed here <a href="https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TIMOB-1512">TIMOB-1512</a>. This was <em>just</em> fixed in Titanium 3.0.2 I believe. The ticket comments include some workarounds, but it appears that using the standard Alloy markup for menus inside each window of a tabgroup will not work and I will need to eventually implement it such that one menu is used for the whole tabgroup. In any case, the comments include a workaround for creating unique menus for each tab, so be sure to check there.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 5th 2013, 1:11:32 pm">March 5th 2013</span>
								by <span class='authorname'>Tony Lukasavage</span><br>
								<a class="icon-bg icon-link" href="question/149174/adding-a-static-menu-to-two-tabbed-alloy-android-project#answer-258121" rel="permalink">permalink</a>
							</div>

							<h5>5 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>I have read  the discussion on the issue tracker You linked to and if I understand correctly I should now be able to add menu items to the menu attached to activity of the main tab group and then the android menu should be the same for all the descendant window elements?<br>I tried this code in the index.js file:</p>
<pre><code class="hljs">$.tabGroup.open();

<span class="hljs-keyword">var</span> activity = $.tabGroup.activity;

activity.onCreateOptionsMenu = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> menu = e.menu;
    <span class="hljs-keyword">var</span> menuItem = menu.add({
        title : <span class="hljs-string">"Item 1"</span>
    });
    menuItem.icon = <span class="hljs-string">"_images/play.png"</span>;
    menuItem.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        Ti.API.info(<span class="hljs-string">"I was clicked"</span>);
    });
};
</code></pre><p>but for the life of me I can not get menu to appear :(</p>
<p>This is the index.xml:</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">Alloy</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">TabGroup</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"tabGroup"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Require</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"delegatedWorkTasks"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Require</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"notDelegatedWorkTasks"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">TabGroup</span>&gt;</span>        
<span class="hljs-tag">&lt;/<span class="hljs-title">Alloy</span>&gt;</span>
</code></pre><p>I&#39;m a real &quot;noob&quot; in Android development so please be more specific if you can on how to do this - one global android menu that is available on all the windows which are descendant of the main Tab Group (id=&quot;tabGroup&quot;).</p>
<p>Or did I misunderstood something and this in fact still isn&#39;t possible.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 6th 2013, 8:35:43 am">March 6th 2013</span>
											by <span class='authorname'>Misel Mesnjak</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>try doing the code inside the tabgroup&#39;s open event:</p>
<pre><code class="hljs">$.tabGroup.addEventListener(<span class="hljs-string">'open'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> activity = $.tabGroup.activity;
    activity.onCreateOptionsMenu = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">var</span> menu = e.menu;
        <span class="hljs-keyword">var</span> menuItem = menu.add({
            title : <span class="hljs-string">"Item 1"</span>
        });
        menuItem.icon = <span class="hljs-string">"_images/play.png"</span>;
        menuItem.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
            Ti.API.info(<span class="hljs-string">"I was clicked"</span>);
        });
    };
});

$.tabGroup.open();
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 6th 2013, 10:42:53 am">March 6th 2013</span>
											by <span class='authorname'>Tony Lukasavage</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>OK. This works in both tabs of the app. But if I open a new window with this code:</p>
<pre><code class="hljs">$.dwtTable.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    Alloy.createController(<span class="hljs-string">'workTask'</span>);
});
</code></pre><p>there the menu doesn&#39;t show up on clicking F2 (emulator).</p>
<p>This is the view for 1st tab:</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">Alloy</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Tab</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"dwtTab"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Window</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"dwtWindow"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">TableView</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"dwtTable"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">Window</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">Tab</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">Alloy</span>&gt;</span>
</code></pre><p>And this is workTask.js (controller created):</p>
<pre><code class="hljs">$.workTask.<span class="hljs-keyword">open</span><span class="hljs-literal">()</span>;
</code></pre><p>and workTask.xml:</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">Alloy</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Window</span> <span class="hljs-attribute">fullscreen</span>=<span class="hljs-value">"true"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"newWinLabel"</span>&gt;</span>Nova stranica<span class="hljs-tag">&lt;/<span class="hljs-title">Label</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">Window</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">Alloy</span>&gt;</span>
</code></pre><p>Shouldn&#39;t menu code work inside new window also?</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 6th 2013, 11:48:16 am">March 6th 2013</span>
											by <span class='authorname'>Misel Mesnjak</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>No, the menu will only be associated with the tabgroup. Any other windows opened up will need their own menus.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 6th 2013, 12:23:53 pm">March 6th 2013</span>
											by <span class='authorname'>Tony Lukasavage</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Right. Only one more question, I promise :)</p>
<p>What is then &quot;best practice&quot; method of modularizing the code given that menu will be same for every window opened in the app (some options to log in&#x2F;out and such things)? Should I create a widget and then assosciate e.menu with it?</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 6th 2013, 1:08:57 pm">March 6th 2013</span>
											by <span class='authorname'>Misel Mesnjak</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-258118">
				
						<section>
							<p>Hi</p>
<p>Here is simple example for you</p>
<p>simplemenuexample.xml:</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">Alloy</span>&gt;</span>
    <span class="hljs-comment">&lt;!-- Create a heavyweight window to use the Android menu. --&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Window</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"win"</span> <span class="hljs-attribute">fullscreen</span>=<span class="hljs-value">"true"</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- The Menu tag adds the Android menu. --&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Menu</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"menu"</span> <span class="hljs-attribute">platform</span>=<span class="hljs-value">"android"</span>&gt;</span>

            <span class="hljs-comment">&lt;!-- Cannot specify node text.  Use attributes only. --&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">MenuItem</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"menuItem"</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Item 1"</span> <span class="hljs-attribute">icon</span>=<span class="hljs-value">"item1.png"</span> <span class="hljs-attribute">onClick</span>=<span class="hljs-value">"doClick"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">Menu</span>&gt;</span>

        <span class="hljs-comment">&lt;!-- Place additional views here --&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">Window</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">Alloy</span>&gt;</span>
</code></pre><p>simplemenuexample.js:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> doClick = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    Ti.API.info(<span class="hljs-string">"Menu item clicked: "</span> + e.source.title);
}
</code></pre><p>Thanks</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 5th 2013, 12:47:11 pm">March 5th 2013</span>
								by <span class='authorname'>Muhammad Wahhab Mirza</span><br>
								<a class="icon-bg icon-link" href="question/149174/adding-a-static-menu-to-two-tabbed-alloy-android-project#answer-258118" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Ok.</p>
<p>I saw that example at <a href="http:&#x2F;&#x2F;goo.gl&#x2F;J2KlB">Appcelerateor docs</a>, but:</p>
<p>How exactly do I instantiate&#x2F;require or otherwise include this code in default Controller (index.js)?<br>Or is it done somewhere else? How?</p>
<p>Keep in mind that I&#39;m using &quot;Two Tabbed Alloy Application&quot; project as a starting point.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 5th 2013, 1:10:36 pm">March 5th 2013</span>
											by <span class='authorname'>Misel Mesnjak</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-1</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
