<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>New ACS CloudPush GCM - buggy? » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>New ACS CloudPush GCM - buggy?</h1>
		</header>
		<section>
			<p>Hi there,</p>
<p>I&#39;m pretty darned sure there are some serious problems (or teething problems) with GCM and ACS CloudPush</p>
<p>I&#39;ve been using the original MQTT implementation for more than 9 months and it was working fine.</p>
<p>I&#39;ve finally been able to get GCM to half run. The documentation says GCM is compatible with Android 2.2+</p>
<p>I&#39;m testing on 3 devices:</p>
<p>1) Asus TF300T running Android 4.2.1</p>
<p>2) Sony Xperia Miro running Android 4.0.4</p>
<p>3) Sony Ericsson Xperia Arc S &#x2F; LT18i running Android 2.3.4</p>
<p>SO…</p>
<p>1) Seems to work as expected. Notifications are received &#39;silently&#39; on the device and passed to the app aok.</p>
<p>2) Half works - it receives push notifications but despite having the app currently running and in the foreground, I get the notification sound from the phone and the push message never actually reaches the app until I close it. The <em>next</em> time I run the app - then it suddenly tells me there are &#x2F; were a whole host of notifications! ONCE and just once it actually worked correctly… but the next time I ran the app, it went back to the pattern of notifications not reaching the running app! (no code change took place! Go figure?)</p>
<p>3) Kills it stone dead! No warning, the app exits &quot;The application …has stopped unexpectedly. Please try again.&quot;, the INSTANT I execute <code>CloudPush.retrieveDeviceToken(etc</code>.</p>
<p>In my admittedly lay-opinion, I would say there are serious compatibility issues</p>
<p>(obviously) all 3 devices are running the same code!</p>
<p>Can anyone please offer any advice or first hand experience of converting from mqtt to GCM? I&#39;m out of ideas!</p>
<p>Many thanks in advance!</p>
<p>Robin</p>
<hr>
<p>I&#39;m building using Ti SDK 3.1.3.GA</p>
<hr>
<p>Titanium Studio, build: 3.1.3.201309132423<br>(c) Copyright 2012-2013 by Appcelerator, Inc.  All rights reserved.</p>
<p>Build: jenkins-titanium-rcp-master-21 (origin&#x2F;master)<br>Date: 13 September 2013, 00:23:57</p>
<hr>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="November 1st 2013, 7:19:54 pm">November 1st 2013</span>
				by <span class='authorname'>Robin Williams</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>acs</span></li>
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>bug</span></li>
					
						<li><span class='tagname'>gcm</span></li>
					
						<li><span class='tagname'>push</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-270824">
				
						<section>
							<p>For case 2, did you see any notifications on Android Tray Notifications bar? Also did you configure focusAppOnPush? I may need your code to see if this is a code problem or a module problem. Also I suggest you use <a href="https:&#x2F;&#x2F;github.com&#x2F;appcelerator-modules&#x2F;ti.cloud&#x2F;tree&#x2F;master&#x2F;commonjs&#x2F;example">Ti.Cloud example app</a> to have a try again with multiple Ti.CloudPush configurable options.</p>
<p>For case 3, there is a bug of Ti.CloudPush: <a href="https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TIMODOPEN-279">TIMODOPEN-279</a>, and it was fixed in Ti.CloudPush 2.3.3. Please make sure you are using the latest one</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 3rd 2013, 10:59:36 pm">November 3rd 2013</span>
								by <span class='authorname'>Paul Lv</span><br>
								<a class="icon-bg icon-link" href="question/159031/new-acs-cloudpush-gcm---buggy.html#answer-270824" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Paul,</p>
<p>Many thanks for your response, you&#39;ve been very helpful.</p>
<p>I&#39;ll try to answer all your points :)</p>
<p>Notifications on the app bar - Yes. The notification sound plays and the icon appears but the app doesn&#39;t receive it. Next time I load the game, suddenly it receives them all!</p>
<p>focusAppOnPush? No I wasn&#39;t using this as the docs describe it as &quot;strongly discouraged&quot; !</p>
<p>Case 3 - Ah ok that sounds helpful - I have 2.3.3 which came with the 3.1.3.GA I haven&#39;t received a notification from Ti Studio that there is an update (I install them all immediately)  :) I&#39;ll have a google and try to fin the updated Cloudpush version you mention - any chance you could post a link please in case I don&#39;t find it?</p>
<p>Many thanks again,</p>
<p>Robin</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 4th 2013, 2:16:57 pm">November 4th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>All I can find is the usual place to d&#x2F;l Release Candidates (etc) of the main SDK…</p>
<p>http:&#x2F;&#x2F;preview.appcelerator.com&#x2F;studio&#x2F;</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 4th 2013, 3:42:16 pm">November 4th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-270876">
				
						<section>
							<p>hmm… For your case 2, I guess you might need to click lines in notification bar to trigger your event callback. Or there is another option <a href="http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;latest&#x2F;#!&#x2F;api&#x2F;Titanium.CloudPush-property-singleCallback">Ti.CloudPush.singleCallback</a> you can have a try, and it will trigger callback one by one, when you click one line in notification bar.</p>
<p>For Ti.CloudPush 2.3.3, it should be integrated in the latest Titanium SDK. If you don&#39;t have one, I may suggest you download it directly from <a href="https:&#x2F;&#x2F;github.com&#x2F;appcelerator&#x2F;titanium_mobile&#x2F;blob&#x2F;master&#x2F;support&#x2F;module&#x2F;packaged&#x2F;ti.cloudpush-android-2.3.3.zip">titanium_mobile repo</a>, and click Help -&gt; Install Mobile Module in menu, to install it into either your Titanium or your project.</p>
<p>For case 2, if it is still a problem, hope you could email me your example code and your adb logcat debug output, so that I can see if it is a bug or not.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 5th 2013, 1:42:47 am">November 5th 2013</span>
								by <span class='authorname'>Paul Lv</span><br>
								<a class="icon-bg icon-link" href="question/159031/new-acs-cloudpush-gcm---buggy.html#answer-270876" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Paul,</p>
<p>Thank you very much for your response.</p>
<p>hmm interesting. Okay I downloaded the 2.3.3 version of the module (the tiapp.mxl is set to use <code>* [latest]</code> )</p>
<p>Now it just doesn&#39;t really work at all on any of the devices!</p>
<p>The 2.3.4 device doesn&#39;t crash (which is a plus!) however it does not seem to receive any push notifications at all! Not even in the notifications tray! It does appear to send notifications though!</p>
<p>The 4.0.4 device (the Xperia Miro) is the same as it was and receives the messages to the device &#x2F; tray but the notifications are not passed on to the app (despite running and being in focus). The app only picks up the notifications after I exit and restart it. New notifications are then added to the tray like the previous ones were and so the cycle continues!</p>
<p>The 4.2.1 device (the Asus tablet) now doesn&#39;t work (whereas it did before!) and now it behaves like the miro - it silently receives the notifications to the tray but they don&#39;t get passed to the app until the next time you run it!</p>
<p>Bear in mind that it all works perfectly when set to mqtt - all I have done is change the settings in tiapp.xml</p>
<pre><code class="hljs">    &lt;<span class="hljs-keyword">property</span> <span class="hljs-property">name</span>=<span class="hljs-string">"acs-push-type-development"</span> type=<span class="hljs-string">"string"</span>&gt;gcm&lt;/<span class="hljs-keyword">property</span>&gt;
    &lt;<span class="hljs-keyword">property</span> <span class="hljs-property">name</span>=<span class="hljs-string">"acs-push-type-production"</span> type=<span class="hljs-string">"string"</span>&gt;gcm&lt;/<span class="hljs-keyword">property</span>&gt;
    &lt;<span class="hljs-keyword">property</span> <span class="hljs-property">name</span>=<span class="hljs-string">"acs-push-type"</span> type=<span class="hljs-string">"string"</span>&gt;gcm&lt;/<span class="hljs-keyword">property</span>&gt;
</code></pre><p>and changed the SDK to 3.1.3.GA (from 3.1.1.v20130531163723)</p>
<p>The code has been written to change the Cloud.PushNotifications &#39;type&#39; parameter from &quot;android&quot; to &quot;gcm&quot; by detecting the app version number.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 5th 2013, 11:08:22 am">November 5th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Interestingly, running mqtt (instead of gcm) under 3.1.3.GA with cloudpush 2.3.3 results in the Asus working but the other 2 devices putting the notifications in the tray and not passing them to the app.</p>
<p>Change it back to 3.1.1.v201…  and cloudpush 2.3.2 and everything&#39;s aok again!</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 5th 2013, 12:18:53 pm">November 5th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>You may need to re-subscribe device tokens since tokens are not the same between MQTT and GCM. If you just simply change push type to GCM, you may be not able to receive push.</p>
<p>I may suggest you use a clean app to try GCM first, and then consider about migration.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 5th 2013, 10:10:52 pm">November 5th 2013</span>
											by <span class='authorname'>Paul Lv</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi there,</p>
<p>Ah, yes, I think I mentioned before that whenever swapping &#39;push types&#39;, I execute <code>CloudPush.clearStatus();</code></p>
<p>I also uninstall the app and now that it has been added, remove any subscribed devices from the Dashboard :)</p>
<p>Migration? To a different module? Or to a different SDK (eg Unity?)</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 6th 2013, 5:44:21 am">November 6th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-271209">
				
						<section>
							<p>Robin, did you solve your problem?</p>
<p>While testing in my Galaxy ACE, I detect the behaviour of your devices (not receiving the notification in the APP but yes in the status bar), but was for my fault. When I launched my app, I did not made the &#39;CloudPush.retrieveDeviceToken()&#39; nor the <code>CloudPush.addEventListener(&amp;#39;callback&amp;#39;, function (evt) {});</code> at the start (I had a button for testing it instead of do it at the start).</p>
<p>I received the notifications in the status bar, enter in the app and not receiving anything… until I pressed the button to &quot;tokenize&quot; the app and, suddenly, all my notifications appeared together.</p>
<p>Maybe this could be your problem or something related, I don&#39;t know.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 12th 2013, 2:24:31 pm">November 12th 2013</span>
								by <span class='authorname'>Manuel Conde Vendrell</span><br>
								<a class="icon-bg icon-link" href="question/159031/new-acs-cloudpush-gcm---buggy.html#answer-271209" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Manuel,</p>
<p>Thanks for taking the time to reply but I do both of those things. My code works perfectly for MQTT, I only experience these odd problems with GCM!</p>
<p>Thanks again.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 12th 2013, 3:48:53 pm">November 12th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Sorry then. In my ACE (2.3.4, using Ti.CloudPush 2.3.3 with a Google account and Google Pay installed)  all seems to work well, but I&#39;m not able to make it work in the emulator (2.3.3 or 4.2.2). When I try to get the token it throws an error telling that I need Google Play (it supposes that it&#39;s not needed for Android 4 and above).</p>
<p>I think that all push system is not completely stable for now…</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 12th 2013, 3:58:32 pm">November 12th 2013</span>
											by <span class='authorname'>Manuel Conde Vendrell</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
