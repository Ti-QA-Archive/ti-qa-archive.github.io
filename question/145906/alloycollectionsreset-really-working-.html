<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Alloy.Collections.reset() really working ? » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Alloy.Collections.reset() really working ?</h1>
		</header>
		<section>
			<p>Hi,</p>
<p>Playing with Alloy Model&#x2F;Collection, i&#39;m facing a curious problem.<br>I can&#39;t reset a collection using :</p>
<pre><code class="hljs">var collectionRssArticle = Alloy.Collections.article<span class="hljs-comment">;</span>
collectionRssArticle.reset()<span class="hljs-comment">;</span>
</code></pre><p>OR</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> collectionRssArticle = Alloy.Collections.article;
collectionRssArticle.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(a)</span><span class="hljs-comment">{
    a.destroy()
}</span>);</span>
</code></pre><p>After .fetch()  before or after the code above…. all models are still in the collection, no matter what…</p>
<p>It should work… knowing that Models&#x2F;Collections are based on backbone.js and underscore.js<br>Did anyone faced the same kind of issue ?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="December 18th 2012, 12:39:26 pm">December 18th 2012</span>
				by <span class='authorname'>Thierry RUIZ</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>alloy</span></li>
					
						<li><span class='tagname'>backbone</span></li>
					
						<li><span class='tagname'>collections</span></li>
					
						<li><span class='tagname'>model</span></li>
					
						<li><span class='tagname'>underscore</span></li>
					
				</ul>
			

			<section>
				<h5>3 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>you&#39;re right, the reset() is not emptying the collection in my case either. Let me investigate a bit then report back. Sadly I&#39;ll likely report back with a ticket number for work to be done later, but I&#39;ll do my best not to leave this hanging.</p>
</div>
							<div class="author">
								&mdash; commented <span title="December 18th 2012, 2:23:11 pm">December 18th 2012</span>
								by <span class='authorname'>Tony Lukasavage</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Is this related to collection&#x2F;model binding? Or can you not use reset() at all, even manually? I am able to reset collections manually, but the binding isn&#39;t working as expected. WILl report with an answer soon…</p>
</div>
							<div class="author">
								&mdash; commented <span title="December 18th 2012, 2:43:58 pm">December 18th 2012</span>
								by <span class='authorname'>Tony Lukasavage</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Yes, it was related to collection&#x2F;model binding. Thank you for your quick look.</p>
</div>
							<div class="author">
								&mdash; commented <span title="December 19th 2012, 9:30:10 am">December 19th 2012</span>
								by <span class='authorname'>Thierry RUIZ</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-253041">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>OK, quick turnaround on this one. The ticket I created, which is already resolved, is here: <a href="https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;ALOY-430">https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;ALOY-430</a></p>
<p>Essentially, with collection binding, I wasn&#39;t listening for the &quot;reset&quot; event that Backbone throws when reset() is called on a collection. I am now. I has been updated in the master branch of the <a href="https:&#x2F;&#x2F;github.com&#x2F;appcelerator&#x2F;alloy">alloy github repo</a> and will be available officially in Alloy 0.3.4, which should be out in the next couple days, maybe as soon as tomorrow.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 18th 2012, 2:45:50 pm">December 18th 2012</span>
								by <span class='authorname'>Tony Lukasavage</span><br>
								<a class="icon-bg icon-link" href="../../question/145906/alloycollectionsreset-really-working-.html#answer-253041" rel="permalink">permalink</a>
							</div>

							<h5>14 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Awesome. Just have to wait for that update. Great.<br>Thanks</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 19th 2012, 9:33:16 am">December 19th 2012</span>
											by <span class='authorname'>Thierry RUIZ</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Re Tony,</p>
<p>Just update Alloy to 0.3.4 and try again this reset() method….<br>Unfortunately it&#39;s still doesn&#39;t work for me…. probably something i&#39;m missing…</p>
<p>When my window is open, the collection is fetch and fill TableView<br>Clicking a button, empty the collection and add 3 items (nothing dramatic)</p>
<p>Actual results: </p>
<ul>
<li>The list is not refresh&#x2F;empty </li>
<li>My 3 items are correctly stored</li>
<li>The Tableview is correctly updated but with the previous entries + the 3 news one</li>
</ul>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">Window</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"winRssList"</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Blog"</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">RightNavButton</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Button</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"btnRefresh"</span> <span class="hljs-attribute">onClick</span>=<span class="hljs-value">"prepareList"</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Refresh"</span> /&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">RightNavButton</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">TableView</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"tblRssList"</span> <span class="hljs-attribute">dataCollection</span>=<span class="hljs-value">"article"</span> <span class="hljs-attribute">dataTransform</span>=<span class="hljs-value">"transformArticle"</span>&gt;</span>
           <span class="hljs-tag">&lt;<span class="hljs-title">TableViewRow</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"rwArticle"</span> <span class="hljs-attribute">url</span>=<span class="hljs-value">"{link}"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"lblArticleTitle"</span> <span class="hljs-attribute">text</span>=<span class="hljs-value">"{title}"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"lblArticleDate"</span> <span class="hljs-attribute">text</span>=<span class="hljs-value">"{date}"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">TableViewRow</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">TableView</span>&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">Window</span>&gt;</span>
</code></pre><pre><code class="hljs">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prepareList</span>(<span class="hljs-params"></span>)</span>{

    collectionRssArticle.reset();


    <span class="hljs-keyword">var</span> article1 = Alloy.createModel(<span class="hljs-string">'article'</span>, {title:<span class="hljs-string">'Hello Appcelator'</span>, date:<span class="hljs-string">'2012-12-18 13:35:00'</span>, link:<span class="hljs-string">'http://www.langports.com'</span>});
    <span class="hljs-keyword">var</span> article2 = Alloy.createModel(<span class="hljs-string">'article'</span>, {title:<span class="hljs-string">'Hello Apple'</span>, date:<span class="hljs-string">'2012-12-17 13:35:00'</span>, link:<span class="hljs-string">'http://www.apple.com'</span>});
    <span class="hljs-keyword">var</span> article3 = Alloy.createModel(<span class="hljs-string">'article'</span>, {title:<span class="hljs-string">'Hello Google'</span>, date:<span class="hljs-string">'2012-12-16 13:35:00'</span>, link:<span class="hljs-string">'http://www.google.com'</span>}); 

    article1.save()
    article2.save()
    article3.save()

    collectionRssArticle.fetch();

}


$.winRssList.addEventListener(<span class="hljs-string">'open'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{
    collectionRssArticle.fetch();
});
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="December 25th 2012, 9:53:40 am">December 25th 2012</span>
											by <span class='authorname'>Thierry RUIZ</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>From the code you are showing, it appears to be working as expected. If I&#39;m understanding correctly, before <code>prepareList</code> is called, you have 3 rows in your table. You call <code>reset</code>, which removes the 3 existing models from the local collection, but <code>reset</code> does <strong>not</strong> remove these models from the persistence layer. When you save article 1, 2, &amp; 3, you are then saving 3 additional items to the persistence layer, for a total of 6 now. When you call <code>fetch</code>, all of your persisted items will be put back into your local collection. At that point, when rendered in your table, the 6 items from your persistence layer will appear.</p>
<p>Do you want to delete the items from persistence when they are replaced? For that you will need to actually <a href="http:&#x2F;&#x2F;backbonejs.org&#x2F;#Model-destroy">destroy</a> them and they will be removed from the persistence layer. If that is not your intention, you&#39;ll probably need a field for your items that indicates whether or not you want them to show up and filter for that field in your <code>dataFilter</code> function.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 25th 2012, 7:49:15 pm">December 25th 2012</span>
											by <span class='authorname'>Tony Lukasavage</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Tony,</p>
<p>Sorry for the delay and thank you for your answer.<br>I finally succeed in doing what i want…</p>
<p>Here is the new code. I&#39;m keen to have some optimisation advise…</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cleanArticleCollection</span><span class="hljs-params">()</span></span>{
    cltRssArticleDB = collectionRssArticle.toJSON() 
    <span class="hljs-keyword">for</span>(i=<span class="hljs-number">0</span>; i &lt; cltRssArticleDB.length; i++){
        marticle = collectionRssArticle.<span class="hljs-keyword">get</span>(cltRssArticleDB[i].id)
        marticle.destroy();
    }    
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">prepareList</span><span class="hljs-params">()</span></span>{

    <span class="hljs-keyword">if</span>(collectionRssArticle.length &gt; <span class="hljs-number">0</span>){
        cleanArticleCollection()
    }

    <span class="hljs-keyword">var</span> article1 = Alloy.createModel(<span class="hljs-string">'article'</span>, {title:<span class="hljs-string">'Hello Appcelator'</span>, date:<span class="hljs-string">'2012-12-18 13:35:00'</span>, link:<span class="hljs-string">'http://www.langports.com'</span>, read:<span class="hljs-literal">false</span>});
    <span class="hljs-keyword">var</span> article2 = Alloy.createModel(<span class="hljs-string">'article'</span>, {title:<span class="hljs-string">'Hello Apple'</span>, date:<span class="hljs-string">'2012-12-17 13:35:00'</span>, link:<span class="hljs-string">'http://www.apple.com'</span>, read:<span class="hljs-literal">false</span>});
    <span class="hljs-keyword">var</span> article3 = Alloy.createModel(<span class="hljs-string">'article'</span>, {title:<span class="hljs-string">'Hello Google'</span>, date:<span class="hljs-string">'2012-12-16 13:35:00'</span>, link:<span class="hljs-string">'http://www.google.com'</span>, read:<span class="hljs-literal">false</span>}); 

    article1.save()
    article2.save()
    article3.save()

    collectionRssArticle.fetch();

}

<span class="hljs-comment">/* LISTENERS */</span>
$.winRssList.addEventListener(<span class="hljs-string">'open'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
    collectionRssArticle.fetch();
});
</code></pre><p>I&#39;m not expert as i would like to be…. but it&#39;s still look too much code from my point of view… and you know this equation as i do: less code, less bugs, less pain….</p>
<p>it Wouldn&#39;t be great if doing a Collection.reset() or Collection.truncate() or Collection.reset(ignorePersistenceLayer=true) (or whatever you want to do it)…. but just get rid of all the lines &#x2F; reset the table in one shot without fighting with the persistence Layer which in that case annoy more than help… likea basic and simple TRUNCATE dbtable.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 13th 2013, 12:25:39 pm">January 13th 2013</span>
											by <span class='authorname'>Thierry RUIZ</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I&#39;m confused, you want to use persistence but you also want to constantly delete it? Does the <a href="http:&#x2F;&#x2F;backbonejs.org&#x2F;#Collection-update">Backbone update()</a> function sound like what you are looking for? If it is, Alloy doesn&#39;t support Backbone 0.9.9 yet (we&#39;re at 0.9.2), but it will very soon. If you really want to use Backbone 0.9.9 before we officially support it, you can put the latest backbone.js file in your project&#39;s <strong>app&#x2F;lib&#x2F;alloy</strong> folder and it&#39;ll overwrite the pre-packaged one that comes with alloy.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 14th 2013, 12:01:37 pm">January 14th 2013</span>
											by <span class='authorname'>Tony Lukasavage</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Well, the Backbone update() sounds good… but it&#39;s still to much work to do for a simple thing.<br>My wish would be to have a function that completely reset DB + PesistenceLayer in one shot.<br>Like a Hard Reset.<br>Simply because in some particular context it&#39;s much more efficient&#x2F;simple to DELETE everything with 1 line of code (TRUNCATE) and then do multiple ADD within a loop.</p>
<p>Do you have any suggestion or advise on the latest code below? Is it the right way to do it ?</p>
<p>ps: I will try to use Backbone 0.9.9 just to test this update function…. but at the end i&#39;m trying to be as close as possible to all official Titanium&#x2F;Alloy release.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 15th 2013, 3:56:10 am">January 15th 2013</span>
											by <span class='authorname'>Thierry RUIZ</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Just added a ticket for updating to Backbone 0.9.9 before Alloy&#39;s 1.0.0 version is released: <a href="https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;ALOY-462">https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;ALOY-462</a></p>
<p>The nature of Backbone is that it does not attempt to make direct operations on your backend data per se. It is meant to marshall commands between your app&#39;s state&#x2F;interactions and sync those to your backend, if you have it configured in that manner. It doesn&#39;t care if its SQLite, REST, a flat file, etc… It&#39;s just executing the commands you give it. Our aim is to keep the models&#x2F;collections as close to the actual Backbone intended use as possible, and this requires maintaining that abstraction.</p>
<p>If you look at this <a href="http:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;9911588&#x2F;how-to-clear-the-backbone-localstorage">StackOverflow entry</a>, you&#39;ll see that even in traditional Backbone web development, it is advised that you should individually destroy the modes in your collection, like this:</p>
<pre><code class="hljs">collection.<span class="hljs-keyword">each</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(model)</span> </span>{ model.destroy(); } );
</code></pre><p>which would allow the sync operation to remove them from your backend, in this case SQLite. </p>
<p>In the future you may want to do a more direct adapter-specific approach. The sql adapter doesn&#39;t support it yet, but soon it will support <a href="https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;ALOY-458">executing arbitrary sql queries on fetch()</a>. At that point you could call a reset() on your collection and then manually delete your database with the <strong>Ti.Database</strong> API. This would deviate from the &quot;Backbone way of doing things&quot;, but the nice thing is, that is totally up to you. This is Titanium in the end, and you can do whatever you need to to achieve your goal.</p>
<p>If all of the above pretty much answers your original question, can you mark it as the &quot;best answer&quot;? This will help other identify the correct answer if they search. Don&#39;t worry, I&#39;ll continue our conversation here if necessary.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 15th 2013, 1:23:33 pm">January 15th 2013</span>
											by <span class='authorname'>Tony Lukasavage</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Perfect, Thank you Tony.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 16th 2013, 12:55:01 pm">January 16th 2013</span>
											by <span class='authorname'>Thierry RUIZ</span>
										</div>
									</li>
								
									<li class="comment">
										<p><pre><code class="hljs">collection.<span class="hljs-keyword">each</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(model)</span> </span>{ model.destroy(); });
</code></pre><p>won&#39;t destroy every record, but only half of them. Easy to figure why.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 28th 2013, 4:56:00 pm">January 28th 2013</span>
											by <span class='authorname'>PicSafe Operations</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>PicSafe can you explain why it only destroy&#39;s half? How would you modify this so that all models are destroyed?</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 12th 2013, 1:39:47 pm">February 12th 2013</span>
											by <span class='authorname'>Nando Cammarota</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>@Nando - So when you destroy a model from the collection, starting from the bottom of the collection, say at index=0, the indices shift as you destroy the models - meaning that when you destroy one model, the indices shift down by one, and you effectively skip a model - thereby leading to only half being destroyed.</p>
<pre><code class="hljs">collection.fetch();
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; collection.models.length-<span class="hljs-number">1</span>; i++) {
  collection.models[i].destroy();
}

/*
<span class="hljs-type">Starting</span> at i=<span class="hljs-number">0</span>:
<span class="hljs-type">We</span> destroy model at i=<span class="hljs-number">0</span>;
<span class="hljs-type">As</span> a <span class="hljs-literal">result</span>, the model originally at i=<span class="hljs-number">2</span> gets shifted to i=<span class="hljs-number">1</span>;

<span class="hljs-type">Continue</span> <span class="hljs-keyword">with</span> i=<span class="hljs-number">1</span>;
<span class="hljs-type">We</span> destroy model at i=<span class="hljs-number">1</span>, which was originally i=<span class="hljs-number">2</span>;
<span class="hljs-type">As</span> a <span class="hljs-literal">result</span>, we have completely skipped the model at i=<span class="hljs-number">1</span>;
*/
</code></pre><p>Best way to get around this is to go from the top of the collection:</p>
<pre><code class="hljs">collection.fetch();
<span class="hljs-keyword">for</span> (var <span class="hljs-built_in">i</span> = collection.models.<span class="hljs-built_in">length</span>-<span class="hljs-number">1</span>; <span class="hljs-built_in">i</span> &gt;= <span class="hljs-number">0</span>; <span class="hljs-built_in">i</span>--) <span class="hljs-cell">{
  collection.models[i].destroy();        
}</span>
</code></pre><p>Hope that helps -</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 5th 2013, 10:41:41 pm">March 5th 2013</span>
											by <span class='authorname'>Haseeb Qureshi</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>this might not be the best way to delete the collection objects, just extend the object to handle the deletions, The approach varies based on what the underlying persistence mechanism is</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 5th 2013, 11:05:53 pm">March 5th 2013</span>
											by <span class='authorname'>Aaron Saunders</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>@Aaron - Sure thing, another approach is to extend the Model protoype, and simply trigger its deletion. At this point, it definitely does vary with approach.</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 13th 2013, 2:09:29 am">May 13th 2013</span>
											by <span class='authorname'>Haseeb Qureshi</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>i want to update data in tableview with adding new entry in table but so that i add global fetch but it not update data but  when i close and open again it fetch ? any how i need to update collection or reset or save or what?</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 9th 2014, 7:38:33 am">September 9th 2014</span>
											by <span class='authorname'>Jayesh  Joshi</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
