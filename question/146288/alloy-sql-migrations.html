<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Alloy SQL Migrations Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Alloy SQL Migrations</h1>
		</header>
		<section>
			<p>There are very little docs on Alloy SQL and Migrations.<br>Currently I&#39;m trying to setup a database, but something is failing for me.<br>Here is the code:</p>
<pre><code class="hljs">migration.up = <span class="hljs-keyword">function</span>(db) {
  db.createTable({
          <span class="hljs-string">"columns"</span>:
          {
              <span class="hljs-string">"name"</span>: <span class="hljs-string">"string"</span>,
              <span class="hljs-string">"time"</span>: <span class="hljs-string">"integer"</span>
          },

          <span class="hljs-string">"adapter"</span>: {
              <span class="hljs-string">"type"</span>: <span class="hljs-string">"sql"</span>,
              <span class="hljs-string">"collection_name"</span>: <span class="hljs-string">"projects"</span>
          }
      });
};

migration.down = <span class="hljs-keyword">function</span>(db) {
 db.dropTable(<span class="hljs-string">"projects"</span>);
};
</code></pre><p>And the error produced.</p>
<pre><code class="hljs">[INFO] :  <span class="hljs-operator"><span class="hljs-keyword">create</span> <span class="hljs-keyword">table</span> <span class="hljs-keyword">migration</span> called <span class="hljs-keyword">for</span> projects
[INFO] :  <span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> projects ( <span class="hljs-keyword">id</span> <span class="hljs-built_in">INTEGER</span>,<span class="hljs-keyword">name</span> <span class="hljs-built_in">TEXT</span>,total <span class="hljs-built_in">INTEGER</span>,<span class="hljs-keyword">id</span> )
[<span class="hljs-keyword">ERROR</span>] :  A SQLite <span class="hljs-keyword">database</span> <span class="hljs-keyword">error</span> occurred <span class="hljs-keyword">on</span> <span class="hljs-keyword">database</span> <span class="hljs-string">'/Users/hb/Library/Application Support/iPhone Simulator/6.0/Applications/76C37108-3747-445A-987D-EFB3652FCE92/Library/Private Documents/_alloy_.sql'</span>: <span class="hljs-keyword">Error</span> <span class="hljs-keyword">Domain</span>=com.plausiblelabs.pldatabase Code=<span class="hljs-number">3</span> <span class="hljs-string">"An error occured parsing the provided SQL statement."</span> UserInfo=<span class="hljs-number">0xd684c60</span> {com.plausiblelabs.pldatabase.<span class="hljs-keyword">error</span>.vendor.code=<span class="hljs-number">1</span>, NSLocalizedDescription=An <span class="hljs-keyword">error</span> occured parsing the provided <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">statement</span>., com.plausiblelabs.pldatabase.<span class="hljs-keyword">error</span>.<span class="hljs-keyword">query</span>.<span class="hljs-keyword">string</span>=<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> projects ( <span class="hljs-keyword">id</span> <span class="hljs-built_in">INTEGER</span>,<span class="hljs-keyword">name</span> <span class="hljs-built_in">TEXT</span>,total <span class="hljs-built_in">INTEGER</span>,<span class="hljs-keyword">id</span> ), com.plausiblelabs.pldatabase.<span class="hljs-keyword">error</span>.vendor.<span class="hljs-keyword">string</span>=<span class="hljs-keyword">duplicate</span> <span class="hljs-keyword">column</span> <span class="hljs-keyword">name</span>: <span class="hljs-keyword">id</span>} (SQLite #<span class="hljs-number">1</span>: <span class="hljs-keyword">duplicate</span> <span class="hljs-keyword">column</span> <span class="hljs-keyword">name</span>: <span class="hljs-keyword">id</span>) (<span class="hljs-keyword">query</span>: <span class="hljs-string">'CREATE TABLE IF NOT EXISTS projects ( id INTEGER,name TEXT,total INTEGER,id )'</span>)
[<span class="hljs-keyword">ERROR</span>] :  invalid <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">statement</span>. <span class="hljs-keyword">Error</span> <span class="hljs-keyword">Domain</span>=com.plausiblelabs.pldatabase Code=<span class="hljs-number">3</span> <span class="hljs-string">"An error occured parsing the provided SQL statement."</span> UserInfo=<span class="hljs-number">0xd684c60</span> {com.plausiblelabs.pldatabase.<span class="hljs-keyword">error</span>.vendor.code=<span class="hljs-number">1</span>, NSLocalizedDescription=An <span class="hljs-keyword">error</span> occured parsing the provided <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">statement</span>., com.plausiblelabs.pldatabase.<span class="hljs-keyword">error</span>.<span class="hljs-keyword">query</span>.<span class="hljs-keyword">string</span>=<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> projects ( <span class="hljs-keyword">id</span> <span class="hljs-built_in">INTEGER</span>,<span class="hljs-keyword">name</span> <span class="hljs-built_in">TEXT</span>,total <span class="hljs-built_in">INTEGER</span>,<span class="hljs-keyword">id</span> ), com.plausiblelabs.pldatabase.<span class="hljs-keyword">error</span>.vendor.<span class="hljs-keyword">string</span>=<span class="hljs-keyword">duplicate</span> <span class="hljs-keyword">column</span> <span class="hljs-keyword">name</span>: <span class="hljs-keyword">id</span>}  <span class="hljs-keyword">in</span> -[TiDatabaseProxy <span class="hljs-keyword">execute</span>:] (TiDatabaseProxy.<span class="hljs-keyword">m</span>:<span class="hljs-number">186</span>)
[<span class="hljs-keyword">ERROR</span>] :  Script <span class="hljs-keyword">Error</span> = invalid <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">statement</span>. <span class="hljs-keyword">Error</span> <span class="hljs-keyword">Domain</span>=com.plausiblelabs.pldatabase Code=<span class="hljs-number">3</span> <span class="hljs-string">"An error occured parsing the provided SQL statement."</span> UserInfo=<span class="hljs-number">0xd684c60</span> {com.plausiblelabs.pldatabase.<span class="hljs-keyword">error</span>.vendor.code=<span class="hljs-number">1</span>, NSLocalizedDescription=An <span class="hljs-keyword">error</span> occured parsing the provided <span class="hljs-keyword">SQL</span> <span class="hljs-keyword">statement</span>., com.plausiblelabs.pldatabase.<span class="hljs-keyword">error</span>.<span class="hljs-keyword">query</span>.<span class="hljs-keyword">string</span>=<span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">EXISTS</span> projects ( <span class="hljs-keyword">id</span> <span class="hljs-built_in">INTEGER</span>,<span class="hljs-keyword">name</span> <span class="hljs-built_in">TEXT</span>,total <span class="hljs-built_in">INTEGER</span>,<span class="hljs-keyword">id</span> ), com.plausiblelabs.pldatabase.<span class="hljs-keyword">error</span>.vendor.<span class="hljs-keyword">string</span>=<span class="hljs-keyword">duplicate</span> <span class="hljs-keyword">column</span> <span class="hljs-keyword">name</span>: <span class="hljs-keyword">id</span>}  <span class="hljs-keyword">in</span> -[TiDatabaseProxy <span class="hljs-keyword">execute</span>:] (TiDatabaseProxy.<span class="hljs-keyword">m</span>:<span class="hljs-number">186</span>) <span class="hljs-keyword">at</span> <span class="hljs-keyword">sql</span>.js (line <span class="hljs-number">62</span>).
[<span class="hljs-keyword">ERROR</span>] :  Script <span class="hljs-keyword">Error</span> = <span class="hljs-keyword">Module</span> <span class="hljs-string">"alloy/models/Projects"</span> <span class="hljs-keyword">failed</span> <span class="hljs-keyword">to</span> leave a valid exports <span class="hljs-keyword">object</span> <span class="hljs-keyword">at</span> app.js (line <span class="hljs-number">0</span>).
[WARN] :  ing: Attempt <span class="hljs-keyword">to</span> <span class="hljs-keyword">present</span> &lt;TiErrorController: <span class="hljs-number">0xb39b4d0</span>&gt; <span class="hljs-keyword">on</span> &lt;TiRootViewController: <span class="hljs-number">0xb2b7740</span>&gt; <span class="hljs-keyword">while</span> a presentation <span class="hljs-keyword">is</span> <span class="hljs-keyword">in</span> progress!</span>
</code></pre><p>I can see that the query ( id INTEGER,name TEXT,total INTEGER,id ) looks wrong, but I didn&#39;t write it. What do I do ?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="December 30th 2012, 7:12:25 pm">December 30th 2012</span>
				by <span class='authorname'>Nauris Pukis</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>alloy</span></li>
					
						<li><span class='tagname'>mobile</span></li>
					
						<li><span class='tagname'>sqlite</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>4</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>4 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-253620">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>Are you sure your migration columns match those in your corresponding model definition? Do you have more than one migration, perhaps one you are not showing? The columns you show don&#39;t match the ones in your error log.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 30th 2012, 7:39:02 pm">December 30th 2012</span>
								by <span class='authorname'>Tony Lukasavage</span><br>
								<a class="icon-bg icon-link" href="question/146288/alloy-sql-migrations.html#answer-253620" rel="permalink">permalink</a>
							</div>

							<h5>3 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Is there a way to just clear out all the SQL there and restart from scratch ?<br>I created a Model, then a Migration and then edited the migration. I also re-created the migration (and deleted the existing one).<br>Basically at this point I&#39;ve tried a lot of trial and error.<br>I tried deleting Resources and build folders and cleaning out the project, but nothing helped.<br>Is there any more documentation  or examples maybe ?</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 30th 2012, 8:29:02 pm">December 30th 2012</span>
											by <span class='authorname'>Nauris Pukis</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Turns out in the end that the Migration didn&#39;t correspond to the Model. Simple as that.<br>Model - Projects.js (which I didn&#39;t post here) had an &quot;id&quot; column, which apparently is bad.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 31st 2012, 11:26:41 am">December 31st 2012</span>
											by <span class='authorname'>Nauris Pukis</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Especially bad if you don&#39;t include it in the Migration :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 31st 2012, 11:27:03 am">December 31st 2012</span>
											by <span class='authorname'>Nauris Pukis</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-253629">
				
						<section>
							<p>If there is already a table there on your device or emulator, one thing you could try is dropping the table in the migration up before trying to create it.  This is fine as long as you don&#39;t mind losing any previous data.  Either that or you need to put in the correct alter statements to upgrade your schema.</p>
<pre><code class="hljs">db.execute('<span class="hljs-operator"><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> <span class="hljs-keyword">IF</span> <span class="hljs-keyword">EXISTS</span> projects;</span>');
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 31st 2012, 12:01:18 am">December 31st 2012</span>
								by <span class='authorname'>Asher D</span><br>
								<a class="icon-bg icon-link" href="question/146288/alloy-sql-migrations.html#answer-253629" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>The other thing is that if you are using the adapter you probably don&#39;t need to created the id column.It looks like that is already being done for you.  If you want to control the id, use a different name for your id column that &#39;id&#39;.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 31st 2012, 12:04:43 am">December 31st 2012</span>
											by <span class='authorname'>Asher D</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>use comments under the answer you are addressing to keep the conversation in order.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 31st 2012, 10:21:58 am">December 31st 2012</span>
											by <span class='authorname'>Tony Lukasavage</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-253653">
				
						<section>
							<p>You can delete the installed app. You can also be extra careful on ios sims and reset the sim&#39;s configuration.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 31st 2012, 10:22:32 am">December 31st 2012</span>
								by <span class='authorname'>Tony Lukasavage</span><br>
								<a class="icon-bg icon-link" href="question/146288/alloy-sql-migrations.html#answer-253653" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-270052">
				
						<section>
							<p>Check this Migration Tutorial <a href="http:&#x2F;&#x2F;bit.ly&#x2F;AlloyMigration">AlloyMigrationExample</a></p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="October 16th 2013, 10:20:12 am">October 16th 2013</span>
								by <span class='authorname'>Prakash M</span><br>
								<a class="icon-bg icon-link" href="question/146288/alloy-sql-migrations.html#answer-270052" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-1</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
