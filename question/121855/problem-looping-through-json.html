<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>problem looping through json » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>problem looping through json</h1>
		</header>
		<section>
			<p>I have a .net web service that is succesfully returning the json you see in the image below.<br>&lt;img src=&quot;http:&#x2F;&#x2F;i.imgur.com&#x2F;HJtHQ.png&quot; alt=&quot;&quot; title=&quot;Hosted by imgur.com&quot; &#x2F;&gt;</p>
<p>I need to create a tablerow for each location. below are 2 methods ive tried and neither work:</p>
<pre><code class="hljs"><span class="hljs-comment">//e is responseText</span>
<span class="hljs-keyword">var</span> locations = JSON.<span class="hljs-keyword">parse</span>(<span class="hljs-keyword">e</span>);


<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> locations) {
    <span class="hljs-comment">//do stuff...</span>
}


<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = 0;i&lt;locations.length;i++) {
    <span class="hljs-comment">//do stuff...</span>

}
</code></pre><p>any insight?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="June 30th 2011, 2:03:22 pm">June 30th 2011</span>
				by <span class='authorname'>Andrew Royce</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>json</span></li>
					
						<li><span class='tagname'>web service</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-211870">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>That JSON looks invalid. There certainly shouldn&#39;t be a &#39;d =&#39; in there.</p>
<p>Where is the screengrab from? A browser? Or a debug console?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 30th 2011, 2:37:07 pm">June 30th 2011</span>
								by <span class='authorname'>Kosso</span><br>
								<a class="icon-bg icon-link" href="question/121855/problem-looping-through-json#answer-211870" rel="permalink">permalink</a>
							</div>

							<h5>7 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>It looks like the d is insterted there by .net. I found this article that explains more about it but still not sure how to go about looping it.<br>&lt;br &#x2F;&gt;http:&#x2F;&#x2F;encosia.com&#x2F;a-breaking-change-between-versions-of-aspnet-ajax&#x2F;</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 30th 2011, 2:48:07 pm">June 30th 2011</span>
											by <span class='authorname'>andrew royce</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>the screenshot is actually just the value of the response in a textbox in the iphone emulator.</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 30th 2011, 2:49:02 pm">June 30th 2011</span>
											by <span class='authorname'>andrew royce</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>This is clearly a .net issue then. That JSON is invalid. it should be a d: , not d =</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 30th 2011, 2:57:18 pm">June 30th 2011</span>
											by <span class='authorname'>Kosso</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>OK so if it was d: then it should parse successfully?</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 30th 2011, 3:01:58 pm">June 30th 2011</span>
											by <span class='authorname'>andrew royce</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I ended up doing a replace on the serverside and that fixed it. Not sure why .net put a = instead of a : there.</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 30th 2011, 3:13:52 pm">June 30th 2011</span>
											by <span class='authorname'>Andrew Royce</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>PHP FTW! :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 30th 2011, 3:15:24 pm">June 30th 2011</span>
											by <span class='authorname'>Kosso</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Yea Yea Yea, so to give a little more detail into what was needed I had to do the following:<br>after replacing the = with a : on the server side I had to json.parse(e).<br>Then I had to json.parse(e.d) which gave me the dataset of locations to loop through. thanks for the help.</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 30th 2011, 3:45:39 pm">June 30th 2011</span>
											by <span class='authorname'>Andrew Royce</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-211875">
				
						<section>
							<p>You will not be able to loop it until you have valid JSON.  You can paste the JSON into something like <a href="http:&#x2F;&#x2F;jsonlint.com&#x2F;">JSONLint</a> for quick validation.  JSON.parse can fail and in this case with the d= in there it will.  You&#39;ll need to track down the source of that and correct it.  I&#39;d suggest adding a try&#x2F;catch around the parse.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 30th 2011, 2:56:53 pm">June 30th 2011</span>
								by <span class='authorname'>Chad Auld</span><br>
								<a class="icon-bg icon-link" href="question/121855/problem-looping-through-json#answer-211875" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>I understand that it is not valid json but from this article it seems thats what .net will always return<br><a href="http:&#x2F;&#x2F;encosia.com&#x2F;a-breaking-change-between-versions-of-aspnet-ajax&#x2F;">click here to see what I am talking about</a></p>
<p>heres a comment from a ms employee</p>
<pre><code class="hljs">Dave Reed Subscribed to followup comments
1:43 pm - February 10, 2009

Thanks for the explaination, Dave. :)

It’s one of those security features that has a very easy to misunderstand purpose. The protection isn’t really against accidentally executing the alert in your example. Although that is one benefit of ‘d’, you’d still have to worry about that while evaluating the JSON to convert it to an object.

What it does <span class="hljs-operator"><span class="hljs-keyword">do</span> <span class="hljs-keyword">is</span> prevent the <span class="hljs-keyword">JSON</span> response <span class="hljs-keyword">from</span> being wholesale executed <span class="hljs-keyword">as</span> the <span class="hljs-keyword">result</span> <span class="hljs-keyword">of</span> a XSS attack. <span class="hljs-keyword">In</span> such an attack, the attacker could <span class="hljs-keyword">insert</span> a script <span class="hljs-keyword">element</span> that calls a <span class="hljs-keyword">JSON</span> webservice, even one <span class="hljs-keyword">on</span> a different <span class="hljs-keyword">domain</span>, since script tags support that. <span class="hljs-keyword">And</span>, since it <span class="hljs-keyword">is</span> a script tag afterall, <span class="hljs-keyword">if</span> the response looks <span class="hljs-keyword">like</span> javascript it will <span class="hljs-keyword">execute</span> <span class="hljs-keyword">as</span> javascript. The same XSS attack can overload the <span class="hljs-keyword">object</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">array</span> constructors (among other possibilities) <span class="hljs-keyword">and</span> thereby <span class="hljs-keyword">get</span> <span class="hljs-keyword">access</span> <span class="hljs-keyword">to</span> that <span class="hljs-keyword">JSON</span> <span class="hljs-keyword">data</span> <span class="hljs-keyword">from</span> the other <span class="hljs-keyword">domain</span>.

<span class="hljs-keyword">To</span> successfully pull that <span class="hljs-keyword">off</span>, you need (<span class="hljs-number">1</span>) a xss vulnerable site (good.com) — <span class="hljs-keyword">any</span> site will <span class="hljs-keyword">do</span>, (<span class="hljs-number">2</span>) a <span class="hljs-keyword">JSON</span> webservice that <span class="hljs-keyword">returns</span> a desired payload <span class="hljs-keyword">on</span> a <span class="hljs-keyword">GET</span> request (<span class="hljs-keyword">e</span>.<span class="hljs-keyword">g</span>. bank.com/getaccounts), (<span class="hljs-number">3</span>) an evil location (evil.com) <span class="hljs-keyword">to</span> which <span class="hljs-keyword">to</span> send the <span class="hljs-keyword">data</span> you captured <span class="hljs-keyword">from</span> bank.com <span class="hljs-keyword">while</span> people visit good.com, (<span class="hljs-number">4</span>) an unlucky visitor <span class="hljs-keyword">to</span> good.com that just happened <span class="hljs-keyword">to</span> be logged <span class="hljs-keyword">into</span> bank.com <span class="hljs-keyword">using</span> the same browser <span class="hljs-keyword">session</span>.

Protecting your <span class="hljs-keyword">JSON</span> service <span class="hljs-keyword">from</span> <span class="hljs-keyword">returning</span> valid javascript <span class="hljs-keyword">is</span> just one thing you can <span class="hljs-keyword">do</span> <span class="hljs-keyword">to</span> prevent this. Disallowing <span class="hljs-keyword">GET</span> <span class="hljs-keyword">is</span> another (script tags <span class="hljs-keyword">always</span> <span class="hljs-keyword">do</span> <span class="hljs-keyword">GET</span>). Requiring a certain <span class="hljs-keyword">HTTP</span> header <span class="hljs-keyword">is</span> another (script tags can’<span class="hljs-keyword">t</span> <span class="hljs-keyword">set</span> custom headers <span class="hljs-keyword">or</span> <span class="hljs-keyword">values</span>). The webservice stack <span class="hljs-keyword">in</span> ASP.NET AJAX does all <span class="hljs-keyword">of</span> these. Anyone creating their own stack should be careful <span class="hljs-keyword">to</span> <span class="hljs-keyword">do</span> the same.</span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="June 30th 2011, 3:00:59 pm">June 30th 2011</span>
											by <span class='authorname'>andrew royce</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
