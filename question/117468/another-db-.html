<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Another Db ??? Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Another Db ???</h1>
		</header>
		<section>
			<p>Ok I hate to ask this question again but the person that asked this question before closed his question because he found his solution but didn&#39;t post his&#x2F;her solution.  I have my database, I&#39;m using </p>
<p>var db = Titanium.Database.install(&#39;myPTO.sqlite&#39;,&#39;tbl_PTOSetup&#39;);  the db is in the resources folder.  my select statement is simply<br>var rows = db.execute(&#39;select * from tbl_PTOSetup&#39;); </p>
<p>All of the rows are returning the correct values but the row I updated is returning the previous value.  I changed it from a 1 to a 0.  It still returns a 1 and I can&#39;t figure out why it&#39;s not returning the new value.  My app will be contingent on each page picking up changes in the database.</p>
<p>Any ideas why the change isn&#39;t being detected?</p>
<p>Thank you.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="March 18th 2011, 9:57:13 pm">March 18th 2011</span>
				by <span class='authorname'>Kevin Brown</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>iphone</span></li>
					
						<li><span class='tagname'>mobile</span></li>
					
						<li><span class='tagname'>sqlite</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Can you put the code for the insert and select in your question?</p>
</div>
							<div class="author">
								&mdash; commented <span title="March 20th 2011, 4:36:22 pm">March 20th 2011</span>
								by <span class='authorname'>Luc Martin</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Post all of your code regarding this.</p>
</div>
							<div class="author">
								&mdash; commented <span title="March 21st 2011, 5:09:06 pm">March 21st 2011</span>
								by <span class='authorname'>Josh Lewis</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-204779">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>Your problem is that the device doesn&#39;t load the DB from the Resources directory every time you call install, only the first time. So depending on whether you are testing on a device or simulator you need to get rid of the old db file for changes like those to be seen. Or you can add a button hidden somewhere for now that could call something like this</p>
<p> var f = Ti.Filesystem.getFile(<br>    Ti.Filesystem.applicationSupportDirectory+&#39;&#x2F;database&#39;, &#39;tbl_PTOSetup.sql&#39;);<br>    &#x2F;&#x2F;If it&#39;s there, delete it and reinstall the DB<br>    if(f.exists() == true){<br>         f.deleteFile();<br>    }</p>
<p>to clear out the old, you&#39;ll have to run an install again after this to get things working.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 21st 2011, 8:00:05 pm">March 21st 2011</span>
								by <span class='authorname'>Mr triux</span><br>
								<a class="icon-bg icon-link" href="question/117468/another-db-.html#answer-204779" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Thank you, I just spoke to a friend and he alerted me to the copy issue and then I saw your code.  I&#39;m going to try this when I get home, thank you very much!!!</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 23rd 2011, 3:18:56 pm">March 23rd 2011</span>
											by <span class='authorname'>Kevin Brown</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-204768">
				
						<section>
							<p>As Luc says, can you put some more code on here? Specifically the insert you do?</p>
<p>My suspicion is that the code is not actually updating the database.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 21st 2011, 4:41:34 pm">March 21st 2011</span>
								by <span class='authorname'>Joe iEntry</span><br>
								<a class="icon-bg icon-link" href="question/117468/another-db-.html#answer-204768" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Ok, I think the reason is that titanium is using a copy of the original database, which is completely stupid but if that&#39;s how titanium works then I guess I&#39;ll have to deal with it.  My next question is, when I finally get this working on my phone will I only have to worry about testing with one database or am I going to have to work with an original and a copy.  Thanks everyone!</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 23rd 2011, 3:17:12 pm">March 23rd 2011</span>
											by <span class='authorname'>Kevin Brown</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>No, it&#39;s not stupid.  See the explanation in my reply above.  It <strong>has</strong> to work that way because the only way to include a database is to place somewhere in your Resources folder or below, but on a device the OS will sandbox those folders and make them read-only.  Thus they cannot be updated at run time.  This leaves Appcelerator no choice but to copy from the resources folder to a folder that can be updated.</p>
<p>Plus, assuming the user or application does update the database, you typically don&#39;t just want to obliterate the changes by replacing it during an upgrade.  So the current paradigm makes perfect sense to me.  It just isn&#39;t documented well, but that is not unique to the database module.</p>
<p>In terms of how you deal with it, please see my other reply.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 23rd 2011, 3:24:24 pm">March 23rd 2011</span>
											by <span class='authorname'>Doug Handy</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-204796">
				
						<section>
							<p>Kevin,</p>
<p>To expand on Mr triux&#39;s answer, maybe it will help if you understand better what is going on here.  On the device, the resources folder is read-only (though it is not in the simulator).  Thus when you &quot;install&quot; a db it needs to copy it to another location which can be updated by the application as it runs.</p>
<p>When you call the install method, if first checks to see if the other copy already exists.  If so, it just opens it directly and ignores the copy in the resources folder.  If it does not exist, it copies it then opens it.</p>
<p>In most scenarios this is what you want as it preserves data changes made by a user in previous sessions.  But it does mean you can&#39;t just expect a new resource db to override a previous execution.</p>
<p>If you <strong>want</strong> the new database to override the old one, what you do depends again on your scenario.  If you do not need to preserve any of the old data, then you can do any of these:</p>
<ul>
<li>In iphone simulator, use menu option Reset Contents and Settings</li>
<li>In Finder window, navigate to folder with real db and delete it</li>
<li>In your app.js, check for &quot;installed&quot; db and delete it prior to running the &quot;install&quot; method, which will then copy the fresh db again</li>
</ul>
<p>If you do need to preserve user data, then your app.js will need to see if there is an existing copy and if so execute SQL statements like ALTER TABLE or CREATE TABLE or CREATE INDEX or whatever else is needed to &quot;upgrade&quot; the existing db to the format needed by your new version.</p>
<p>You can use a tool like Lite or the Firefox SQL Manager add-in to inspect the database changes, but be sure to look at the installed copy and not the copy in the resources folder.  For iOS, that will be at a location something like:</p>
<p>Users &gt; (username) &gt; Library &gt; Application Support &gt; iPhone Simulator &gt; (version, i.e. &quot;4.1&quot;) &gt; Applications &gt; (app hash) &gt;<br>Library &gt; Application Support &gt; database &gt; (databasename).sql</p>
<p>Be sure to close the db in Lite or FF SQL Mgr while your application is making any updates to the database.  SQLite can easily have lock table errors otherwise as it is not intended as a multi-user database.</p>
<p>Hope this helps.</p>
<p>Doug</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 22nd 2011, 2:27:38 am">March 22nd 2011</span>
								by <span class='authorname'>Doug Handy</span><br>
								<a class="icon-bg icon-link" href="question/117468/another-db-.html#answer-204796" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>&quot;Users &gt; (username) &gt; Library &gt; Application Support &gt; iPhone Simulator &gt; (version, i.e. &quot;4.1&quot;) &gt; Applications &gt; (app hash) &gt; Library &gt; Application Support &gt; database &gt; (databasename).sql&quot;</p>
<p>In my local system i dont find the path you mentioned above. Can you please guide somewhat briefly???</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 12th 2011, 10:58:26 am">July 12th 2011</span>
											by <span class='authorname'>Balu C</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
