<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>SQLite and BLOBs » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>SQLite and BLOBs</h1>
		</header>
		<section>
			<p>Hi there,</p>
<p>Have a question. I&#39;m working with an embedded sqllite database with stored images (I know that a common practice says to store filepaths in database and the image itself on the filesystem). Long story short, I HAVE to get blobs (images) from database.</p>
<p>I&#39;m working with titanium 1.8.2 and google emulator 4.0.3. Win 7 64.</p>
<p>Here is what i tried:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> db = <span class="hljs-type">Titanium</span>.<span class="hljs-type">Database</span>.install(<span class="hljs-type">DATABASE_FILE</span>.nativePath, <span class="hljs-type">DATABASE_NAME</span>);

<span class="hljs-keyword">var</span> <span class="hljs-literal">result</span> = db.execute('<span class="hljs-type">SELECT</span> * <span class="hljs-type">FROM</span> <span class="hljs-type">Product_Image</span> <span class="hljs-type">WHERE</span> id=<span class="hljs-number">80</span>');

<span class="hljs-keyword">if</span> (<span class="hljs-literal">result</span>.isValidRow()) {
    <span class="hljs-keyword">var</span> retrievedImage = <span class="hljs-literal">result</span>.field(<span class="hljs-number">2</span>);
}
<span class="hljs-literal">result</span>.close();


<span class="hljs-keyword">var</span> myImageView = <span class="hljs-type">Titanium</span>.<span class="hljs-type">UI</span>.createImageView({
 image:retrievedImage
});
</code></pre><p>that gives me &#39;unable to convert Blob to string&#39; execption</p>
<p>I&#39;ll apprciate any kind of help</p>
<p>Regards</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="March 15th 2012, 7:03:50 am">March 15th 2012</span>
				by <span class='authorname'>Jakub Pilimon</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>blob</span></li>
					
						<li><span class='tagname'>database</span></li>
					
						<li><span class='tagname'>image</span></li>
					
						<li><span class='tagname'>sqllite</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>14</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>14 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-233435">
				
						<section>
							<p>Any ideas why it keeps trying to convert to String? The Titanium API for .field() says &quot; If the data in the column is a BLOB, the data is returned as a Titanium.Blob object.&quot;</p>
<p>And, the app recognizes the result as BLOB because the exepction I get is about converting Blob to String. So it gets the blob from database column but why is trying to cast it to String?</p>
<p>Regards</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 15th 2012, 12:30:07 pm">March 15th 2012</span>
								by <span class='authorname'>Jakub Pilimon</span><br>
								<a class="icon-bg icon-link" href="question/133836/sqlite-and-blobs#answer-233435" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Can you share the DDL for the Product_Image Table ?</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 15th 2012, 12:40:19 pm">March 15th 2012</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233376">
				
						<section>
							<p>Sounds like you need to use a http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;apidoc&#x2F;mobile&#x2F;latest&#x2F;Titanium.BlobStream-object</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 15th 2012, 7:07:35 am">March 15th 2012</span>
								by <span class='authorname'>Nick Milner</span><br>
								<a class="icon-bg icon-link" href="question/133836/sqlite-and-blobs#answer-233376" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233378">
				
						<section>
							<p>Thanks, but I&#39;ve just tried that:</p>
<pre><code class="hljs">    <span class="hljs-keyword">var</span> instream = <span class="hljs-type">Titanium</span>.<span class="hljs-type">Stream</span>.createStream({
        mode : <span class="hljs-type">Titanium</span>.<span class="hljs-type">Stream</span>.<span class="hljs-type">MODE_READ</span>,
        source : <span class="hljs-literal">result</span>.field(<span class="hljs-number">2</span>)
    });
}
</code></pre><p>… and the same exception occurs</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 15th 2012, 7:22:10 am">March 15th 2012</span>
								by <span class='authorname'>Jakub Pilimon</span><br>
								<a class="icon-bg icon-link" href="question/133836/sqlite-and-blobs#answer-233378" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233390">
				
						<section>
							<p>Thanks, but the code crashes while receiving the database content. The result cannot be casted to blob and i get nothing</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 15th 2012, 8:33:17 am">March 15th 2012</span>
								by <span class='authorname'>Jakub Pilimon</span><br>
								<a class="icon-bg icon-link" href="question/133836/sqlite-and-blobs#answer-233390" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>casted to string*</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 15th 2012, 8:50:27 am">March 15th 2012</span>
											by <span class='authorname'>Jakub Pilimon</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233393">
				
						<section>
							<p>hi Jakub,</p>
<p>after reading the solution given by experts , i want to know that how you set image in the table…?</p>
<p>are your image exists in the resources folder…?</p>
<p>thnx</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 15th 2012, 8:42:30 am">March 15th 2012</span>
								by <span class='authorname'>Mitul Bhalia</span><br>
								<a class="icon-bg icon-link" href="question/133836/sqlite-and-blobs#answer-233393" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233394">
				
						<section>
							<p>Hi Mitul,</p>
<p>Thanks for resonding.</p>
<p>What do you mean? You mean how is it store in database? As blob, and it works fine on IOS. The database was given and I check it via SQLite Administrator. I dont have my image in resources, cause that is not what i want - i want them to be fetched from database firstly (maybe later to store smwhere). Anyway, the point is that the result from resultSet cannot be cast to String from Blob. I don&#39;t know why It keeps trying to cast to string by the way.</p>
<p>Thanks in advance for any help</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 15th 2012, 8:50:10 am">March 15th 2012</span>
								by <span class='authorname'>Jakub Pilimon</span><br>
								<a class="icon-bg icon-link" href="question/133836/sqlite-and-blobs#answer-233394" rel="permalink">permalink</a>
							</div>

							<h5>5 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Now, your post made me to check those blobs and nothing happens in SQLIte Admin when i click on the record and chose &#39;show picture&#39;. And the row stays like &#39;%oPNG&#39;</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 15th 2012, 8:55:27 am">March 15th 2012</span>
											by <span class='authorname'>Jakub Pilimon</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>means you are testing it in android….</p>
<p>you can do one thing if you can save your images in the applicationDataDirectory folder then just save your image name in the database as a string and you can get that image back by using Filesystem object</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 15th 2012, 8:57:49 am">March 15th 2012</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Yes i know it, I posted it at the very beginning. But the thing is, I have to get those images from database</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 15th 2012, 8:58:46 am">March 15th 2012</span>
											by <span class='authorname'>Jakub Pilimon</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>have you tried this….?</p>
<pre><code class="hljs"><span class="hljs-keyword">if</span> (<span class="hljs-literal">result</span>.isValidRow()) {
    <span class="hljs-keyword">var</span> retrievedImage = <span class="hljs-literal">result</span>.field(<span class="hljs-number">2</span>).toString();
}

<span class="hljs-keyword">var</span> myImageView = <span class="hljs-type">Titanium</span>.<span class="hljs-type">UI</span>.createImageView({
 image:retrievedImage.toBlob()
});
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 15th 2012, 10:17:16 am">March 15th 2012</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>yes, I did. Didn&#39;t work out :(</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 15th 2012, 10:30:08 am">March 15th 2012</span>
											by <span class='authorname'>Jakub Pilimon</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233735">
				
						<section>
							<p>Here it is: </p>
<pre><code class="hljs"><span class="hljs-operator"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> [Product_Image] (
    [<span class="hljs-keyword">id</span>] <span class="hljs-built_in">integer</span> PRIMARY <span class="hljs-keyword">KEY</span> AUTOINCREMENT <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    [product_Id] <span class="hljs-built_in">integer</span> <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    [imageData] image <span class="hljs-keyword">NOT</span> <span class="hljs-literal">NULL</span>,
    <span class="hljs-keyword">CONSTRAINT</span> [FK_Product_Image_product_Id_Product_id] FOREIGN <span class="hljs-keyword">KEY</span> ([product_Id]) <span class="hljs-keyword">REFERENCES</span> [Product] ([<span class="hljs-keyword">id</span>])
)</span>
</code></pre><p>No i see that imageData is if image type.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 19th 2012, 5:53:12 am">March 19th 2012</span>
								by <span class='authorname'>Jakub Pilimon</span><br>
								<a class="icon-bg icon-link" href="question/133836/sqlite-and-blobs#answer-233735" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>now<em>, of</em></p>
</p>
										<div class="author">
											&mdash; commented <span title="March 19th 2012, 7:36:57 am">March 19th 2012</span>
											by <span class='authorname'>Jakub Pilimon</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233755">
				
						<section>
							<p>hi Jakub,</p>
<p>instead of image can you try to use blob datatype…?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 19th 2012, 7:52:03 am">March 19th 2012</span>
								by <span class='authorname'>Mitul Bhalia</span><br>
								<a class="icon-bg icon-link" href="question/133836/sqlite-and-blobs#answer-233755" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233786">
				
						<section>
							<p>I&#39;ve changed the database and column to the type BLOB. I&#39;ve tried forms like that:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> <span class="hljs-literal">result</span> = db.execute('<span class="hljs-type">SELECT</span> * <span class="hljs-type">FROM</span> <span class="hljs-type">Product_Image</span> <span class="hljs-type">WHERE</span> id=<span class="hljs-number">1</span>')

<span class="hljs-keyword">if</span>(<span class="hljs-literal">result</span>.isValidRow()) {
    img = <span class="hljs-literal">result</span>.fieldByName('imageData').toString();
}

<span class="hljs-literal">result</span>.close();

<span class="hljs-keyword">var</span> myImageView = <span class="hljs-type">Titanium</span>.<span class="hljs-type">UI</span>.createImageView({
    image : img.toImage()
});
</code></pre><p>Now no exception got. But the app freezes on the startup with the titanium logo in the background</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 19th 2012, 10:32:44 am">March 19th 2012</span>
								by <span class='authorname'>Jakub Pilimon</span><br>
								<a class="icon-bg icon-link" href="question/133836/sqlite-and-blobs#answer-233786" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Remember, now you have changed the database structure you need to uninstall the app so that the next Ti.Database.install method copies the updated db to the device</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 19th 2012, 11:14:24 am">March 19th 2012</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Yes, I did that :) I didnt unistall the app just pushed the old installed db from the device</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 20th 2012, 5:36:33 am">March 20th 2012</span>
											by <span class='authorname'>Jakub Pilimon</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233787">
				
						<section>
							<p>try this</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> <span class="hljs-literal">result</span> = db.execute('<span class="hljs-type">SELECT</span> * <span class="hljs-type">FROM</span> <span class="hljs-type">Product_Image</span> <span class="hljs-type">WHERE</span> id=<span class="hljs-number">1</span>')

<span class="hljs-keyword">if</span>(<span class="hljs-literal">result</span>.isValidRow()) {
    img = <span class="hljs-literal">result</span>.fieldByName('imageData');
}

<span class="hljs-literal">result</span>.close();

<span class="hljs-keyword">var</span> myImageView = <span class="hljs-type">Titanium</span>.<span class="hljs-type">UI</span>.createImageView({
    image : img
});
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 19th 2012, 10:37:49 am">March 19th 2012</span>
								by <span class='authorname'>Mitul Bhalia</span><br>
								<a class="icon-bg icon-link" href="question/133836/sqlite-and-blobs#answer-233787" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>or</p>
<pre><code class="hljs"><span class="hljs-variable"><span class="hljs-keyword">var</span> myImageView</span> = Titanium.UI.createImageView({
    image : img.toBlob()
});
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 19th 2012, 10:38:14 am">March 19th 2012</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233863">
				
						<section>
							<p>I tried the first one before, the second didnt work</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 20th 2012, 5:39:15 am">March 20th 2012</span>
								by <span class='authorname'>Jakub Pilimon</span><br>
								<a class="icon-bg icon-link" href="question/133836/sqlite-and-blobs#answer-233863" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233904">
				
						<section>
							<p>When i insert sth short like &#39;1110000abc&#39; into my blob manually, then evrything works fine. I guess it has sth to do with the blob size allowed by sqlite. Now trying to change it.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 20th 2012, 11:24:10 am">March 20th 2012</span>
								by <span class='authorname'>Jakub Pilimon</span><br>
								<a class="icon-bg icon-link" href="question/133836/sqlite-and-blobs#answer-233904" rel="permalink">permalink</a>
							</div>

							<h5>3 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>so tell me how you set the imageData in your table…?</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 20th 2012, 1:07:48 pm">March 20th 2012</span>
											by <span class='authorname'>Mitul Bhalia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Seems like you are getting pretty close, did you succeed?</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 24th 2012, 11:15:45 pm">April 24th 2012</span>
											by <span class='authorname'>Mark Henderson</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Nope. It&#39;s probably a bug, I&#39;ve started two issues about that, but noone helped me :) I decided to move everything and keep paths to filesystem in my database. Good luck</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 25th 2012, 5:25:14 am">April 25th 2012</span>
											by <span class='authorname'>Jakub Pilimon</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-238660">
				
						<section>
							<p>Try this!</p>
<ol>
<li><p>save Blob image to SQLite</p>
<pre><code class="hljs"><span class="hljs-variable"><span class="hljs-keyword">var</span> sImg</span> = Ti.Utils.base64encode(_blob);
</code></pre></li>
<li><p>use Blob image from SQLite<br>~~~<br>var encodedImg = db.getImage(rowId);</p>
</li>
</ol>
<p>var blobImg = Ti.Utils.base64decode(encodedImg) ;<br>~~~</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 15th 2012, 1:39:29 pm">May 15th 2012</span>
								by <span class='authorname'>ByungDae Sohn</span><br>
								<a class="icon-bg icon-link" href="question/133836/sqlite-and-blobs#answer-238660" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>there&#39;s no such method as <code>db.getImage</code>, did you just make it up?</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 29th 2013, 9:38:24 am">March 29th 2013</span>
											by <span class='authorname'>Alberto Marcone</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233387">
				
						<section>
							<p>try:<br><code>image:retrievedImage.toImage()</code></p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 15th 2012, 8:09:02 am">March 15th 2012</span>
								by <span class='authorname'>Gagan Tiwari</span><br>
								<a class="icon-bg icon-link" href="question/133836/sqlite-and-blobs#answer-233387" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-2</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
