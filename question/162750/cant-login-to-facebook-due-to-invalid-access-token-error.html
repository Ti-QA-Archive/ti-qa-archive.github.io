<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Can&#39;t login to Facebook due to invalid access token error Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Can&#39;t login to Facebook due to invalid access token error</h1>
		</header>
		<section>
			<p>I&#39;m working with Titanium Studio build 3.2.0.201312191547 and Titanium SDK 3.2.0.GA, and deploying to Android devices with or without the Facebook app. To login to Facebook I&#39;m using the Titanium Module.</p>
<p>I&#39;m having the same problem described in <a href="https:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;156426&#x2F;facebook-module---invalid-access-token-on-android-23x">this link</a>. When I authorize for the first time, the log in event from Facebook is fired with no problem at all. But if I log out and then try to authorize again(at this point my app&#39;s permissions have been already accepted so in theory it should fire the login event) I get the following error on logcat:</p>
<pre><code class="hljs">E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>: (main) [<span class="hljs-number">11631</span>,<span class="hljs-number">11631</span>] LoginDialogListener onFacebookError: Invalid access token.
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>: com<span class="hljs-class">.facebook</span><span class="hljs-class">.android</span><span class="hljs-class">.FacebookError</span>: Invalid access token.
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>:     at com<span class="hljs-class">.facebook</span><span class="hljs-class">.android</span><span class="hljs-class">.Facebook</span><span class="hljs-class">.onSessionCallback</span>(Facebook<span class="hljs-class">.java</span>:<span class="hljs-number">433</span>)
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>:     at com<span class="hljs-class">.facebook</span><span class="hljs-class">.android</span><span class="hljs-class">.Facebook</span><span class="hljs-class">.access</span>$<span class="hljs-number">000</span>(Facebook<span class="hljs-class">.java</span>:<span class="hljs-number">97</span>)
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>:     at com<span class="hljs-class">.facebook</span><span class="hljs-class">.android</span><span class="hljs-class">.Facebook</span>$<span class="hljs-number">2</span>.<span class="hljs-function"><span class="hljs-title">call</span><span class="hljs-params">(Facebook.java:<span class="hljs-number">379</span>)</span></span>
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>:     at com<span class="hljs-class">.facebook</span><span class="hljs-class">.Session</span>$<span class="hljs-number">3</span>$<span class="hljs-number">1</span>.<span class="hljs-function"><span class="hljs-title">run</span><span class="hljs-params">(Session.java:<span class="hljs-number">1239</span>)</span></span>
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>:     at android<span class="hljs-class">.os</span><span class="hljs-class">.Handler</span><span class="hljs-class">.handleCallback</span>(Handler<span class="hljs-class">.java</span>:<span class="hljs-number">605</span>)
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>:     at android<span class="hljs-class">.os</span><span class="hljs-class">.Handler</span><span class="hljs-class">.dispatchMessage</span>(Handler<span class="hljs-class">.java</span>:<span class="hljs-number">92</span>)
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>:     at android<span class="hljs-class">.os</span><span class="hljs-class">.Looper</span><span class="hljs-class">.loop</span>(Looper<span class="hljs-class">.java</span>:<span class="hljs-number">154</span>)
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>:     at android<span class="hljs-class">.app</span><span class="hljs-class">.ActivityThread</span><span class="hljs-class">.main</span>(ActivityThread<span class="hljs-class">.java</span>:<span class="hljs-number">4624</span>)
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>:     at java<span class="hljs-class">.lang</span><span class="hljs-class">.reflect</span><span class="hljs-class">.Method</span><span class="hljs-class">.invokeNative</span>(Native Method)
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>:     at java<span class="hljs-class">.lang</span><span class="hljs-class">.reflect</span><span class="hljs-class">.Method</span><span class="hljs-class">.invoke</span>(Method<span class="hljs-class">.java</span>:<span class="hljs-number">511</span>)
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>:     at com<span class="hljs-class">.android</span><span class="hljs-class">.internal</span><span class="hljs-class">.os</span><span class="hljs-class">.ZygoteInit</span><span class="hljs-variable">$MethodAndArgsCaller</span>.<span class="hljs-function"><span class="hljs-title">run</span><span class="hljs-params">(ZygoteInit.java:<span class="hljs-number">809</span>)</span></span>
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>:     at com<span class="hljs-class">.android</span><span class="hljs-class">.internal</span><span class="hljs-class">.os</span><span class="hljs-class">.ZygoteInit</span><span class="hljs-class">.main</span>(ZygoteInit<span class="hljs-class">.java</span>:<span class="hljs-number">576</span>)
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>:     at dalvik<span class="hljs-class">.system</span><span class="hljs-class">.NativeStart</span><span class="hljs-class">.main</span>(Native Method)
E/<span class="hljs-function"><span class="hljs-title">FacebookModule</span><span class="hljs-params">( <span class="hljs-number">1584</span>)</span></span>: (main) [<span class="hljs-number">6</span>,<span class="hljs-number">11637</span>] onAuthFail: Invalid access token.
</code></pre><p>I even tried to catch this error with a try&#x2F;catch to handle it, but even though I placed the authorize call inside one, the code inside the catch didn&#39;t get executed. There&#39;s nothing unusual on how I do the authorization as far as I know:</p>
<pre><code class="hljs">$.LoginButtonHolder.addEventListener(<span class="hljs-string">'singletap'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        $.activityIndicator.show();
        $.LoginButtonLabel.setOpacity(<span class="hljs-number">0</span>);
        <span class="hljs-keyword">try</span>
        {
            fb.authorize();
        }
        <span class="hljs-keyword">catch</span>(err)
        {
            <span class="hljs-comment">// if the authorize call fails, show the error on the console and show the controls to try again</span>
            <span class="hljs-comment">// but these four lines of code never get executed, an unhandled exception is still thrown</span>
            Ti.API.info(<span class="hljs-string">'error in Facebook login'</span>);
            Ti.API.info(err);
            $.activityIndicator.hide();
            $.LoginButtonLabel.setOpacity(<span class="hljs-number">1</span>);
        }
});
</code></pre><p>After some digging I realized something, the first time I try to authorize I get redirected to the Facebook app and after accepting the permissions, the login event is fired like it should (as proof of it I get an access token), when I logout the access token that was used for the session is nullified (I checked it in the logout event), then if I try to authorize again it seems the Facebook module isn&#39;t reaching out for a new access token, even though my app is already allowed, it&#39;s trying to use the nullified one, hence throwing this <em>Invalid access token</em>. <strong>This is only a guess from my part.</strong></p>
<p>How can I solve this problem? The solution I&#39;m using at the moment is to remove the permissions from my Facebook user account through a Graph api call, which is not the correct way but it&#39;s the only way for me to fire the Facebook login event again. Also my hash keys are in order, the issue here is the access token, the authorize call should generate a new one as far as I know.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="February 18th 2014, 9:30:51 pm">February 18th 2014</span>
				by <span class='authorname'>Nenvo Software</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>facebook</span></li>
					
						<li><span class='tagname'>login</span></li>
					
						<li><span class='tagname'>module</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-277478">
				
						<section>
							<p>Hi Nenvo, I have  come across exactly the same problem. The facebook SSO works fine on iOS but has the same behaviour as you explained in Android.</p>
<p>Did you find a solution to this problem?</p>
<p>Thanks<br>Arman</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 7th 2014, 7:10:13 am">April 7th 2014</span>
								by <span class='authorname'>Arman Masoudi</span><br>
								<a class="icon-bg icon-link" href="question/162750/cant-login-to-facebook-due-to-invalid-access-token-error.html#answer-277478" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>no, we haven&#39;t found a solution to this problem, what we do is revoke permissions of the app from the user&#39;s Facebook account but that shouldn&#39;t be done but we have no way to log in again in Android after an app uninstall or data wipe.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 8th 2014, 7:02:03 pm">April 8th 2014</span>
											by <span class='authorname'>Nenvo Software</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I have logged an issue for this in Jira (https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TC-3976). Feel free to review and add comments.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 8th 2014, 8:28:14 pm">April 8th 2014</span>
											by <span class='authorname'>Arman Masoudi</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Finally got it resolved; you get this error because of a bad has key. my app is still is dev so this is the command I used to generate the hash key that finally sorted out the issue:<br>keytool -exportcert -alias tidev -keystore ~&#x2F;Library&#x2F;&quot;Application Support&quot;&#x2F;Titanium&#x2F;mobilesdk&#x2F;osx&#x2F;3.2.2.GA&#x2F;android&#x2F;dev_keystore -s<br>torepass tirocks | openssl sha1 -binary | openssl base64</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 10th 2014, 8:39:43 am">April 10th 2014</span>
											by <span class='authorname'>Arman Masoudi</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I created my hash keys with that same line of code, the problem isn&#39;t there apparently</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 10th 2014, 3:39:16 pm">April 10th 2014</span>
											by <span class='authorname'>Nenvo Software</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
