<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Android WebView crashes Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Android WebView crashes</h1>
		</header>
		<section>
			<p>Hi,</p>
<p>I see the following in my crash logs from many of my users.  It seems to primarily effect users with Samsung phones (I know, weird).  Any ideas:</p>
<pre><code class="hljs">09-11 07:13:57.519 W/webview (27804): java.lang.Throwable: Warning: A WebView method was called on thread 'KrollRuntimeThread'. All WebView methods must be called on the UI thread. Future versions of WebView may not support <span class="hljs-operator"><span class="hljs-keyword">use</span> <span class="hljs-keyword">on</span> other threads.
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.519</span> W/webview (<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> android.webkit.WebView.checkThread(WebView.<span class="hljs-keyword">java</span>:<span class="hljs-number">9673</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.519</span> W/webview (<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> android.webkit.WebView.getSettings(WebView.<span class="hljs-keyword">java</span>:<span class="hljs-number">4204</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.519</span> W/webview (<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> ti.modules.titanium.ui.widget.webview.TiUIWebView.getUserAgentString(TiUIWebView.<span class="hljs-keyword">java</span>:<span class="hljs-number">550</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.519</span> W/webview (<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> ti.modules.titanium.ui.WebViewProxy.getUserAgent(WebViewProxy.<span class="hljs-keyword">java</span>:<span class="hljs-number">159</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.519</span> W/webview (<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> org.appcelerator.kroll.runtime.v8.V8Function.nativeInvoke(<span class="hljs-keyword">Native</span> Method)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.519</span> W/webview (<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> org.appcelerator.kroll.runtime.v8.V8Function.callSync(V8Function.<span class="hljs-keyword">java</span>:<span class="hljs-number">58</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.519</span> W/webview (<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> org.appcelerator.kroll.runtime.v8.V8Function.<span class="hljs-keyword">call</span>(V8Function.<span class="hljs-keyword">java</span>:<span class="hljs-number">44</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.519</span> W/webview (<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> org.appcelerator.kroll.runtime.v8.V8Function$<span class="hljs-number">1.</span>run(V8Function.<span class="hljs-keyword">java</span>:<span class="hljs-number">71</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.519</span> W/webview (<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> android.os.<span class="hljs-keyword">Handler</span>.handleCallback(<span class="hljs-keyword">Handler</span>.<span class="hljs-keyword">java</span>:<span class="hljs-number">605</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.519</span> W/webview (<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> android.os.<span class="hljs-keyword">Handler</span>.dispatchMessage(<span class="hljs-keyword">Handler</span>.<span class="hljs-keyword">java</span>:<span class="hljs-number">92</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.519</span> W/webview (<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> android.os.Looper.<span class="hljs-keyword">loop</span>(Looper.<span class="hljs-keyword">java</span>:<span class="hljs-number">137</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.519</span> W/webview (<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> org.appcelerator.kroll.KrollRuntime$KrollRuntimeThread.run(KrollRuntime.<span class="hljs-keyword">java</span>:<span class="hljs-number">109</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.667</span> W/InputManagerService(  <span class="hljs-number">376</span>): <span class="hljs-keyword">Starting</span> <span class="hljs-keyword">input</span> <span class="hljs-keyword">on</span> non-focused <span class="hljs-keyword">client</span> com.android.internal.<span class="hljs-keyword">view</span>.IInputMethodClient$Stub$Proxy@<span class="hljs-number">415</span>d12e0 (uid=<span class="hljs-number">10161</span> pid=<span class="hljs-number">27804</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.675</span> <span class="hljs-keyword">D</span>/AndroidRuntime(<span class="hljs-number">27804</span>): Shutting down VM
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.675</span> W/dalvikvm(<span class="hljs-number">27804</span>): threadid=<span class="hljs-number">1</span>: <span class="hljs-keyword">thread</span> exiting <span class="hljs-keyword">with</span> uncaught <span class="hljs-keyword">exception</span> (<span class="hljs-keyword">group</span>=<span class="hljs-number">0x40ab7210</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.683</span> <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">27804</span>): (<span class="hljs-keyword">main</span>) [<span class="hljs-number">963</span>,<span class="hljs-number">53297</span>] Sending <span class="hljs-keyword">event</span>: <span class="hljs-keyword">exception</span> <span class="hljs-keyword">on</span> <span class="hljs-keyword">thread</span>: <span class="hljs-keyword">main</span> msg:<span class="hljs-keyword">java</span>.lang.NullPointerException;</span> Titanium 2.1.2,2012/08/24 14:46,ed7f777
09-11 07:13:57.683 E/TiApplication(27804): java.lang.NullPointerException
09-11 07:13:57.683 E/TiApplication(27804):  at org.appcelerator.titanium.proxy.TiViewProxy.handleMessage(TiViewProxy.java:280)
09-11 07:13:57.683 E/TiApplication(27804):  at ti.modules.titanium.ui.WebViewProxy.handleMessage(WebViewProxy.java:129)
09-11 07:13:57.683 E/TiApplication(27804):  at android.os.Handler.dispatchMessage(<span class="hljs-operator"><span class="hljs-keyword">Handler</span>.<span class="hljs-keyword">java</span>:<span class="hljs-number">95</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.683</span> <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> android.os.Looper.<span class="hljs-keyword">loop</span>(Looper.<span class="hljs-keyword">java</span>:<span class="hljs-number">137</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.683</span> <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> android.app.ActivityThread.<span class="hljs-keyword">main</span>(ActivityThread.<span class="hljs-keyword">java</span>:<span class="hljs-number">4697</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.683</span> <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> <span class="hljs-keyword">java</span>.lang.reflect.Method.invokeNative(<span class="hljs-keyword">Native</span> Method)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.683</span> <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> <span class="hljs-keyword">java</span>.lang.reflect.Method.invoke(Method.<span class="hljs-keyword">java</span>:<span class="hljs-number">511</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.683</span> <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.<span class="hljs-keyword">java</span>:<span class="hljs-number">787</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.683</span> <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> com.android.internal.os.ZygoteInit.<span class="hljs-keyword">main</span>(ZygoteInit.<span class="hljs-keyword">java</span>:<span class="hljs-number">554</span>)
<span class="hljs-number">09</span>-<span class="hljs-number">11</span> <span class="hljs-number">07</span>:<span class="hljs-number">13</span>:<span class="hljs-number">57.683</span> <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">27804</span>):  <span class="hljs-keyword">at</span> dalvik.<span class="hljs-keyword">system</span>.NativeStart.<span class="hljs-keyword">main</span>(<span class="hljs-keyword">Native</span> Method)</span>
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="September 11th 2012, 10:52:44 am">September 11th 2012</span>
				by <span class='authorname'>Frank A</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>crash</span></li>
					
						<li><span class='tagname'>webview</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>can you post the code that is related to this crash?</p>
</div>
							<div class="author">
								&mdash; commented <span title="September 11th 2012, 11:58:38 am">September 11th 2012</span>
								by <span class='authorname'>Aaron Saunders</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Well the code that runs BEFORE this is:</p>
<pre><code class="hljs">        whereAPI.getWhereAds(lat,lng,page,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(res)</span></span>{
            <span class="hljs-keyword">if</span> (res!=<span class="hljs-literal">null</span>){

                <span class="hljs-keyword">var</span> width = util.getDPWidth();
                Ti.API.info(width)
                <span class="hljs-keyword">var</span> html = <span class="hljs-string">"&lt;html&gt;&lt;head&gt;&lt;style&gt;body { margin:0; padding:0; width:"</span>+width+<span class="hljs-string">"px}&lt;/style&gt;&lt;body&gt;"</span>+res+<span class="hljs-string">"&lt;/body&gt;&lt;/html&gt;"</span>;
                <span class="hljs-comment">// Create a WebView</span>
                Ti.API.debug(<span class="hljs-string">"HTML: "</span>+html);
                <span class="hljs-keyword">var</span> aWebView = Ti.UI.createWebView({
                    html:html,
                    backgroundColor:<span class="hljs-string">'transparent'</span>,
                    height:<span class="hljs-string">'50dp'</span>,
                    left:<span class="hljs-number">0</span>,
                    right:<span class="hljs-number">0</span>,
                    enableZoomControls:<span class="hljs-literal">false</span>,
                    scalePagesToFit:<span class="hljs-literal">false</span>,
                    bottom:<span class="hljs-number">0</span>
                });


                <span class="hljs-comment">// Add to the parent view.</span>
                pView.add(aWebView);
                Ti.API.info(<span class="hljs-string">'Firing tvf:adgood from addad2'</span>);
                pView.fireEvent(<span class="hljs-string">"tvf:adgood"</span>,{ad:aWebView});
                <span class="hljs-keyword">return</span>;
</code></pre><p>The getWhereAds function makes an http call and returns some html.</p>
</div>
							<div class="author">
								&mdash; commented <span title="September 11th 2012, 12:59:13 pm">September 11th 2012</span>
								by <span class='authorname'>Frank A</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-247104">
				
						<section>
							<p>This should never work.</p>
<pre><code class="hljs"><span class="hljs-tag">pView</span><span class="hljs-class">.fireEvent</span>("<span class="hljs-tag">tvf</span><span class="hljs-pseudo">:adgood"</span>,<span class="hljs-rules">{<span class="hljs-rule"><span class="hljs-attribute">ad</span>:<span class="hljs-value">aWebView</span></span></span>});
</code></pre><p><a href="http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;2.1&#x2F;index.html#!&#x2F;guide&#x2F;Event_Handling">you can only pass serializable objects when you fire events.</a></p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 11th 2012, 3:43:00 pm">September 11th 2012</span>
								by <span class='authorname'>Aaron Saunders</span><br>
								<a class="icon-bg icon-link" href="question/142124/android-webview-crashes#answer-247104" rel="permalink">permalink</a>
							</div>

							<h5>5 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hmm, it works on 95% of the she devices I&#39;ve tested on.  Now I&#39;m more confused :-)</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 11th 2012, 4:22:54 pm">September 11th 2012</span>
											by <span class='authorname'>Frank A</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I am just going by what the documentation says, also I have no idea what you are doing in the associated eventListener</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 11th 2012, 4:45:57 pm">September 11th 2012</span>
											by <span class='authorname'>Aaron Saunders</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>where is the code that calls this code?</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 11th 2012, 4:47:22 pm">September 11th 2012</span>
											by <span class='authorname'>Aaron Saunders</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>This code is called inside an event listener for the open event of a given window (and the window itself is passed as pView).  The idea was a window opens, calls this code passing a reference to itself (pView) the advertisement in the webview is added to the window and an event is fired back on the window passing the actual webview (so it can be later hidden or removed, etc).  I was trying to make a nice reusable module for adding this ad unit.  It works fine on almost all phones although on some devices I get a lot of intermittent crashes with the trace above.</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 11th 2012, 5:09:11 pm">September 11th 2012</span>
											by <span class='authorname'>Frank A</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Just curious if you&#39;ve looked at the Ti source code.  From what I see it sure looks like the issue is that when the the event gets fired the underlying activity is null.  If my analysis is correct its this line that throws the NPE:</p>
<pre><code class="hljs">
                        <span class="hljs-type">View</span> decorView = <span class="hljs-type">TiApplication</span>.getAppCurrentActivity<span class="hljs-literal">()</span>.getWindow<span class="hljs-literal">()</span>.getDecorView<span class="hljs-literal">()</span>;
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="September 11th 2012, 5:28:59 pm">September 11th 2012</span>
											by <span class='authorname'>Frank A</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
