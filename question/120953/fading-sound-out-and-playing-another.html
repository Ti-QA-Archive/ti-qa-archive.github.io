<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Fading Sound out and playing another » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Fading Sound out and playing another</h1>
		</header>
		<section>
			<p>I&#39;m messing around trying to get a sound file to fade out and then play another file upon fade completion. I&#39;ve whipped together this dirty function that looks like it&#39;s going to cause memory leaks (unless Ti will sort that out for me?).</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> currentSong = Titanium.Media.createSound();

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fadeOut</span><span class="hljs-params">(newfile)</span> </span>{
    <span class="hljs-keyword">if</span> (currentSong.volume &gt; <span class="hljs-number">0</span>) {
        Ti.API.log(<span class="hljs-string">'greater than 0: '</span> + currentSong.volume);
        currentSong.setVolume(currentSong.volume - <span class="hljs-number">0.1</span>);
        setTimeout(fadeOut(newfile), <span class="hljs-number">200</span>);
    } <span class="hljs-keyword">else</span> {
        Ti.API.log(<span class="hljs-string">'now playing new sound: '</span> + newfile);
        currentSong = Titanium.Media.createSound({
            url: newfile
        });
        currentSong.play();
    }
}
</code></pre><p>The problem I&#39;m facing is when run the first time, the sound starts playing, however when ran a second time during the previous file playing, the volume appears to fade out and then …<strong>crash</strong>.</p>
<pre><code class="hljs"><span class="hljs-attr_selector">[INFO]</span> <span class="hljs-tag">greater</span> <span class="hljs-tag">than</span> 0: 1
<span class="hljs-attr_selector">[INFO]</span> <span class="hljs-tag">greater</span> <span class="hljs-tag">than</span> 0: 0<span class="hljs-class">.8999999761581421</span>
<span class="hljs-attr_selector">[INFO]</span> <span class="hljs-tag">greater</span> <span class="hljs-tag">than</span> 0: 0<span class="hljs-class">.7999999523162842</span>
<span class="hljs-attr_selector">[INFO]</span> <span class="hljs-tag">greater</span> <span class="hljs-tag">than</span> 0: 0<span class="hljs-class">.6999999284744263</span>
<span class="hljs-attr_selector">[INFO]</span> <span class="hljs-tag">greater</span> <span class="hljs-tag">than</span> 0: 0<span class="hljs-class">.5999999046325684</span>
<span class="hljs-attr_selector">[INFO]</span> <span class="hljs-tag">greater</span> <span class="hljs-tag">than</span> 0: 0<span class="hljs-class">.49999991059303284</span>
<span class="hljs-attr_selector">[INFO]</span> <span class="hljs-tag">greater</span> <span class="hljs-tag">than</span> 0: 0<span class="hljs-class">.3999999165534973</span>
<span class="hljs-attr_selector">[INFO]</span> <span class="hljs-tag">greater</span> <span class="hljs-tag">than</span> 0: 0<span class="hljs-class">.2999999225139618</span>
<span class="hljs-attr_selector">[INFO]</span> <span class="hljs-tag">greater</span> <span class="hljs-tag">than</span> 0: 0<span class="hljs-class">.19999992847442627</span>
<span class="hljs-attr_selector">[INFO]</span> <span class="hljs-tag">greater</span> <span class="hljs-tag">than</span> 0: 0<span class="hljs-class">.09999992698431015</span>
<span class="hljs-attr_selector">[INFO]</span> <span class="hljs-tag">now</span> <span class="hljs-tag">playing</span> <span class="hljs-tag">new</span> <span class="hljs-tag">sound</span>: <span class="hljs-tag">c</span><span class="hljs-class">.m4a</span>
<span class="hljs-attr_selector">[INFO]</span> <span class="hljs-tag">Application</span> <span class="hljs-tag">has</span> <span class="hljs-tag">exited</span> <span class="hljs-tag">from</span> <span class="hljs-tag">Simulator</span>
</code></pre><p>Please could someone let me know if I&#39;m being really stupid and have missed something obvious? and the more experienced, how would you approach the same task - would you do it differently?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="June 13th 2011, 3:49:48 pm">June 13th 2011</span>
				by <span class='authorname'>Sam Jordan</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>crash</span></li>
					
						<li><span class='tagname'>fade</span></li>
					
						<li><span class='tagname'>media</span></li>
					
						<li><span class='tagname'>sound</span></li>
					
						<li><span class='tagname'>volume</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-210065">
				
						<section>
							<p>I think it&#39;s due to the fact that you&#39;re creating a new sound object while it&#39;s still playing.</p>
<p>Try this:</p>
<pre><code class="hljs">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fadeOut</span><span class="hljs-params">(newfile)</span> </span>{
    <span class="hljs-keyword">if</span> (currentSong.volume &gt; <span class="hljs-number">0</span>) {
        Ti.API.log(<span class="hljs-string">'greater than 0: '</span> + currentSong.volume);
        currentSong.setVolume(currentSong.volume - <span class="hljs-number">0.1</span>);
        setTimeout(fadeOut(newfile), <span class="hljs-number">200</span>);
    } <span class="hljs-keyword">else</span> {
        Ti.API.log(<span class="hljs-string">'now playing new sound: '</span> + newfile);

        currentSong.stop();
        currentSong = <span class="hljs-literal">null</span>;

        currentSong = Titanium.Media.createSound({
            url: newfile
        });
        currentSong.play();
    }
}
</code></pre><p>or even …</p>
<pre><code class="hljs">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fadeOut</span><span class="hljs-params">(newfile)</span> </span>{
    <span class="hljs-keyword">if</span> (currentSong.volume &gt; <span class="hljs-number">0</span>) {
        Ti.API.log(<span class="hljs-string">'greater than 0: '</span> + currentSong.volume);
        currentSong.setVolume(currentSong.volume - <span class="hljs-number">0.1</span>);
        setTimeout(fadeOut(newfile), <span class="hljs-number">200</span>);
    } <span class="hljs-keyword">else</span> {
        Ti.API.log(<span class="hljs-string">'now playing new sound: '</span> + newfile);

        currentSong.stop();
        <span class="hljs-comment">// set the new url</span>
        currentSong.url = newfile;
        <span class="hljs-comment">// play the newfile</span>
        currentSong.play();
    }
}
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 13th 2011, 4:06:45 pm">June 13th 2011</span>
								by <span class='authorname'>Kosso</span><br>
								<a class="icon-bg icon-link" href="../../question/120953/fading-sound-out-and-playing-another.html#answer-210065" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>also, if using the same variable for the currentSong, you might want to reset the volume back up.</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 13th 2011, 4:09:09 pm">June 13th 2011</span>
											by <span class='authorname'>Kosso</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Unfortunately, both of these examples crash still -.-</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 13th 2011, 4:10:35 pm">June 13th 2011</span>
											by <span class='authorname'>Sam Jordan</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>hmm… how about if you replace currentSong = null with currentSong.release();</p>
<p>It&#39;s definitely got something to do with trying to create a new sound using the same variable name while the old one is still playing (albeit at zero volume). </p>
<p>Maybe check for the currentSong.playing boolean value too?</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 13th 2011, 4:25:47 pm">June 13th 2011</span>
											by <span class='authorname'>Kosso</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>The reason for me not releasing is I want to keep the song data in memory for it to be used again :)</p>
<p>Since I&#39;ve edited the code, the volume definitely fades out and I get about 50miliseconds of the next sound before it cuts out and crashes the app :s</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 13th 2011, 4:51:06 pm">June 13th 2011</span>
											by <span class='authorname'>Sam Jordan</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-210066">
				
						<section>
							<p>if your volume by chance is 0.05, you&#39;d try to set it to a negative value. may work but it&#39;s not nice. i&#39;d also stop (and release &#x2F; reset) the current before creating a new one on a running sound. or use two sound vars, current and previous. –u</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 13th 2011, 4:07:36 pm">June 13th 2011</span>
								by <span class='authorname'>u no</span><br>
								<a class="icon-bg icon-link" href="../../question/120953/fading-sound-out-and-playing-another.html#answer-210066" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>I&#39;ve given this a go (see my above comment on Kosso&#39;s post) and no luck :(</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 13th 2011, 4:51:42 pm">June 13th 2011</span>
											by <span class='authorname'>Sam Jordan</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-210104">
				
						<section>
							<p>I have an app that works similarly.  Use the stop method and add an event listener for the complete event.  At that point you can safely set the new sound and play it.  It works for me.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 13th 2011, 10:13:40 pm">June 13th 2011</span>
								by <span class='authorname'>Herb Rose</span><br>
								<a class="icon-bg icon-link" href="../../question/120953/fading-sound-out-and-playing-another.html#answer-210104" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
