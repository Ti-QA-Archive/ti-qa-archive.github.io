<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Alloy REST SQL adapter - napp.alloy.adapter.restsql - lastModified not getting set » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Alloy REST SQL adapter - napp.alloy.adapter.restsql - lastModified not getting set</h1>
		</header>
		<section>
			<p>I sent an email to Mads about his adapter, but I thought I&#39;d ask here in case someone else can answer. In Mads Møller&#39;s <a href="https:&#x2F;&#x2F;github.com&#x2F;viezel&#x2F;napp.alloy.adapter.restsql">code</a>, there is an adapter property called </p>
<pre><code class="hljs"><span class="hljs-string">lastModifiedColumn :</span> <span class="hljs-string">"modified"</span>
</code></pre><p>that I assume gets set by adding a timestamp to the model property</p>
<pre><code class="hljs"><span class="hljs-string">"modified"</span> : <span class="hljs-string">"TEXT"</span>
</code></pre><p>on the save() method like this example</p>
<pre><code class="hljs">    <span class="hljs-tag">tracker</span><span class="hljs-class">.save</span>(<span class="hljs-rules">{
        <span class="hljs-rule"><span class="hljs-attribute">last_visit </span>:<span class="hljs-value"> helper.<span class="hljs-function">timestamp</span>(),
        modified : helper.<span class="hljs-function">timestamp</span>()
    </span></span></span>});
</code></pre><p>The problem is that I get an error in the console output like this:</p>
<pre><code class="hljs"><span class="hljs-collection">[INFO]</span> <span class="hljs-collection">{
    error = <span class="hljs-string">"&lt;KrollCallback: 0xcc85040&gt;"</span><span class="hljs-comment">;</span>
    headers =     <span class="hljs-collection">{
        <span class="hljs-string">"Content-Type"</span> = <span class="hljs-string">"application/json"</span><span class="hljs-comment">;</span>
        <span class="hljs-string">"Last-Modified"</span> = <span class="hljs-string">"&lt;null&gt;"</span><span class="hljs-comment">;</span>
    }</span><span class="hljs-comment">;</span>
    success = <span class="hljs-string">"&lt;KrollCallback: 0xcc850d0&gt;"</span><span class="hljs-comment">;</span>
    type = GET;
    url = <span class="hljs-string">"http://localhost:8888/test.php"</span><span class="hljs-comment">;</span>
}</span>
</code></pre><p>So, can anyone tell me how to properly set <code>Last-Modified</code>?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="December 31st 2013, 9:37:34 pm">December 31st 2013</span>
				by <span class='authorname'>Michael Stelly</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>alloy</span></li>
					
						<li><span class='tagname'>api</span></li>
					
						<li><span class='tagname'>backbone</span></li>
					
						<li><span class='tagname'>rest</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>More info. If I let the app run to its stopping point I get this: </p>
<pre><code class="hljs"><span class="hljs-string">[error]</span> <span class="hljs-string">[SQL REST API]</span> apiCall PARSE ERROR: Unable to parse JSON string
<span class="hljs-string">[error]</span> <span class="hljs-string">[SQL REST API]</span> apiCall PARSE ERROR: Array
(
    <span class="hljs-string">[last_visit]</span> =&gt; 
    <span class="hljs-string">[first_visit]</span> =&gt; 
    <span class="hljs-string">[this_visit]</span> =&gt; <span class="hljs-number">1388593706</span>.<span class="hljs-number">64</span>
    <span class="hljs-string">[latitude]</span> =&gt; 
    <span class="hljs-string">[longitude]</span> =&gt; 
    <span class="hljs-string">[opted_out]</span> =&gt; <span class="hljs-number">0</span>
    <span class="hljs-string">[opted_in]</span> =&gt; <span class="hljs-number">0</span>
    <span class="hljs-string">[modified]</span> =&gt; <span class="hljs-number">1388593706</span>.<span class="hljs-number">64</span>
)
</code></pre><p>Maybe that&#39;ll help someone understand my issue better. Looks like my object isn&#39;t JSON formatted for some reason. I&#39;m still investigating.</p>
</div>
							<div class="author">
								&mdash; commented <span title="January 1st 2014, 2:32:16 pm">January 1st 2014</span>
								by <span class='authorname'>Michael Stelly</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>More info: Here is a link to the entire <a href="http:&#x2F;&#x2F;pastie.org&#x2F;8593963">tracker model</a>.</p>
</div>
							<div class="author">
								&mdash; commented <span title="January 2nd 2014, 3:34:06 pm">January 2nd 2014</span>
								by <span class='authorname'>Michael Stelly</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-273383">
				
						<section>
							<p>Hi Michael,</p>
<p>Ill answer in here, so other can benefit from this this.</p>
<p>You are using the <strong>useStrictValidation</strong>, meaning that values must have the correct format. You have modified as a float value:</p>
<pre><code class="hljs"><span class="hljs-collection">{
   <span class="hljs-collection">[modified]</span> =&gt; <span class="hljs-number">1388593706.64</span>
}</span>
</code></pre><p>but you have been specifying:</p>
<pre><code class="hljs"><span class="hljs-string">"modified"</span> : <span class="hljs-string">"TEXT"</span>
</code></pre><p>Thats the first thing. </p>
<p>The next thing: When you get a output statement like this:</p>
<pre><code class="hljs">[SQL REST API] <span class="hljs-built_in">server</span> <span class="hljs-built_in">response</span>: 
[<span class="hljs-keyword">error</span>] [SQL REST API] apiCall PARSE <span class="hljs-keyword">ERROR</span>: Unable <span class="hljs-keyword">to</span> parse JSON <span class="hljs-built_in">string</span>
[<span class="hljs-keyword">error</span>] [SQL REST API] apiCall PARSE <span class="hljs-keyword">ERROR</span>: <span class="hljs-built_in">Array</span>
</code></pre><p>Then its because the JSON feed is incorrect formatted, or the feed and adapter config does not match. So its unable to parse the JSON feed. You should look into if the feed is an array filled with objects, if not its not valid. you can use <strong><a href="http:&#x2F;&#x2F;jsonlint.com">jsonlint</a></strong> to verify.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 3rd 2014, 5:27:46 am">January 3rd 2014</span>
								by <span class='authorname'>Mads Møller</span><br>
								<a class="icon-bg icon-link" href="question/161052/alloy-rest-sql-adapter---nappalloyadapterrestsql---lastmodified-not-getting-set#answer-273383" rel="permalink">permalink</a>
							</div>

							<h5>3 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Caught the first part earlier. Changed it to&quot;modified&quot; : &quot;REAL&quot;. For the second part, I didn&#39;t know about jsonlint. I&#39;ll have to check that out. I&#39;m almost certain that it&#39;s a json format issue. I&#39;ve just never debugged something like this before. So, I&#39;m in the dark on how to start. Guess jsonlint is the first place. </p>
<p>Thanks Mads!</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 3rd 2014, 5:38:31 am">January 3rd 2014</span>
											by <span class='authorname'>Michael Stelly</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Well, I thought I was on to something when I ran the data output through jsonlint (which I now see is a similar tool as <a href="http:&#x2F;&#x2F;jsonformatter.curiousconcept.com&#x2F;">JSON Formatter</a>. The output has all the double-quotes escaped like this:</p>
<pre><code class="hljs">data = "<span class="hljs-special">{</span><span class="hljs-command">\"</span>last_visit<span class="hljs-command">\"</span>:null,<span class="hljs-command">\"</span>first_visit<span class="hljs-command">\"</span>:1388766316.459,<span class="hljs-command">\"</span>this_visit<span class="hljs-command">\"</span>:1388766316.458,<span class="hljs-command">\"</span>latitude<span class="hljs-command">\"</span>:null,<span class="hljs-command">\"</span>longitude<span class="hljs-command">\"</span>:null,<span class="hljs-command">\"</span>opted_out<span class="hljs-command">\"</span>:0,<span class="hljs-command">\"</span>opted_in<span class="hljs-command">\"</span>:0,<span class="hljs-command">\"</span>device_maker<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>unknown<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>device_model<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>Simulator<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>os_platform<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>iPhone OS<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>os_version<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>7.0.3<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>locale<span class="hljs-command">\"</span>:<span class="hljs-command">\"</span>en<span class="hljs-command">\"</span>,<span class="hljs-command">\"</span>modified<span class="hljs-command">\"</span>:1388766316.46<span class="hljs-special">}</span>";
</code></pre><p>If I run that string through a validator, I get</p>
<pre><code class="hljs">Parse error on line 1:
<span class="hljs-header">{    \"last_visit\": null
-----^</span>
Expecting <span class="hljs-emphasis">'STRING'</span>, <span class="hljs-emphasis">'}'</span>
</code></pre><p>I then noticed that all my model properties were quoted, so I removed the quotes thinking that this may be the answer.</p>
<pre><code class="hljs">        <span class="hljs-tag">columns</span> : {
            <span class="hljs-attribute">user_id </span>: <span class="hljs-string">"INTEGER PRIMARY KEY AUTOINCREMENT"</span>,
            <span class="hljs-attribute">last_visit </span>: <span class="hljs-string">"REAL"</span>,
            <span class="hljs-attribute">first_visit </span>: <span class="hljs-string">"REAL"</span>,
            <span class="hljs-attribute">locale </span>: <span class="hljs-string">"TEXT"</span>,
            <span class="hljs-attribute">this_visit </span>: <span class="hljs-string">"REAL"</span>,
            <span class="hljs-attribute">latitude </span>: <span class="hljs-string">"REAL"</span>,
            <span class="hljs-attribute">longitude </span>: <span class="hljs-string">"REAL"</span>,
            <span class="hljs-attribute">device_maker </span>: <span class="hljs-string">"TEXT"</span>,
            <span class="hljs-attribute">device_model </span>: <span class="hljs-string">"TEXT"</span>,
            <span class="hljs-attribute">os_platform </span>: <span class="hljs-string">"TEXT"</span>,
            <span class="hljs-attribute">os_version </span>: <span class="hljs-string">"TEXT"</span>,
            <span class="hljs-attribute">opted_out </span>: <span class="hljs-string">"INTEGER"</span>,
            <span class="hljs-attribute">opted_in </span>: <span class="hljs-string">"INTEGER"</span>,
            <span class="hljs-attribute">modified </span>: <span class="hljs-string">"REAL"</span>
        },
</code></pre><p>No such luck. The output is the same. Can someone provide insight into why my JSON object gets formatted with double-quotes? I think that may be the root of my problem (or at least I hope it is).</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 3rd 2014, 2:31:07 pm">January 3rd 2014</span>
											by <span class='authorname'>Michael Stelly</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>First, it appears that changing the datatype fixed the first problem</p>
<pre><code class="hljs"><span class="hljs-label">modified:</span> <span class="hljs-string">"REAL"</span>
</code></pre><p>At least that&#39;s some good news.</p>
<p>However, I&#39;m very much at a loss on how to debug the remaining issue. I think I narrowed down the problem to the JSON parsing function called parseJSON(), but I can&#39;t get Studio to stop at my selected breakpoints. I think this SO question <a href="http:&#x2F;&#x2F;stackoverflow.com&#x2F;questions&#x2F;15545353&#x2F;how-to-escape-from-json-string-in-titanium">How to escape from  \ in JSON - Titanium</a> may provide a clue to what is happening here. </p>
<p>Maybe - what I <em>think</em> is a json object is &quot;not a real JSON object&quot;. So, something adds quotes to the properties which causes the parser to escape the quotes. I don&#39;t yet know what that &quot;something&quot; is.</p>
<p>Now, I don&#39;t know if this is relevent, but I don&#39;t use a <code>createModel()</code> function. I create a singleton in the alloy.js` file like this:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> tracker = Alloy.Models.instance(<span class="hljs-string">'tracker'</span>);
</code></pre><p>I don&#39;t think it should matter, but I&#39;m throwing it out there just in case it does. </p>
<p>If anyone has anything I might try, please post it here even if you&#39;re not sure. I&#39;ll try anything. This issue has brought my progress to a standstill which never makes for a happy client.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 3rd 2014, 5:51:07 pm">January 3rd 2014</span>
											by <span class='authorname'>Michael Stelly</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-273595">
				
						<section>
							<p>Finally found my <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;161229&#x2F;alloy-rest-adapter-redux">solution</a>. It was a stripped-down version of the sql rest adapter.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 7th 2014, 5:48:58 pm">January 7th 2014</span>
								by <span class='authorname'>Michael Stelly</span><br>
								<a class="icon-bg icon-link" href="question/161052/alloy-rest-sql-adapter---nappalloyadapterrestsql---lastmodified-not-getting-set#answer-273595" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
