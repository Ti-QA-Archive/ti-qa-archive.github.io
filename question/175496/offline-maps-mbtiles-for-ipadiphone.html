<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Offline Maps (mbtiles) for iPad/iPhone » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Offline Maps (mbtiles) for iPad/iPhone</h1>
		</header>
		<section>
			<p>Hi,</p>
<p>for a land register app I&#39;m looking for an offline solution, because in Germany the Datenautobahn is not everwhere.</p>
<ol>
<li>from <a href="https:&#x2F;&#x2F;marketplace.appcelerator.com&#x2F;apps&#x2F;4360?restoreSearch=true#!questions&#x2F;question&#x2F;2426&#x2F;answer">marketplace</a> doesn&#39;t support draggable annotations.</li>
<li>this <a href="https:&#x2F;&#x2F;www.netfunctional.com&#x2F;apps&#x2F;mapoverlay&#x2F;">ti.map patch from netfunctional</a> works if I compile the example.</li>
</ol>
<p>Now you have generated my own mbtiles with the perl script &#39;Geo-OSM-Tiles&#39; and with mbutil. The result is a <a href="https:&#x2F;&#x2F;github.com&#x2F;AppWerft&#x2F;Pommkataster&#x2F;tree&#x2F;master&#x2F;Resources&#x2F;assets">sqlite DB</a> with suffix &#39;mbtiles&#39;.</p>
<p>If I embed my mbtilesI see the apple map,but not my OSM map:</p>
<pre><code class="hljs">var MapNF = require(<span class="hljs-string">'ti.map'</span>);
var mbtilesDB = Ti.Filesystem.getFile(Ti.Filesystem.getResourcesDirectory(), <span class="hljs-string">'assets'</span>, <span class="hljs-string">'enkheim.mbtiles'</span>).nativePath;
    self.mapview = MapNF.createView({
        <span class="hljs-string">mapType :</span> MapNF.STANDARD_TYPE,
        <span class="hljs-string">region :</span> {   
            <span class="hljs-string">latitude :</span> <span class="hljs-number">50.1559955</span>,
            <span class="hljs-string">longitude :</span> <span class="hljs-number">8.7657151</span>,
            <span class="hljs-string">animate :</span> <span class="hljs-literal">true</span>,
            <span class="hljs-string">latitudeDelta :</span> <span class="hljs-number">0.005</span>,
            <span class="hljs-string">longitudeDelta :</span> <span class="hljs-number">0.005</span>
        },
        <span class="hljs-string">tileDB :</span> mbtilesDB
    });
</code></pre><p>This is copied and modified example.</p>
<p>Question:</p>
<p>How can I solve?</p>
<ol>
<li>other module</li>
<li>wrong format of my db ?</li>
</ol>
<p>Rainer</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="June 25th 2014, 6:14:18 am">June 25th 2014</span>
				by <span class='authorname'>Rainer Schleevoigt</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>ihone</span></li>
					
						<li><span class='tagname'>mbtiles</span></li>
					
						<li><span class='tagname'>offline maps</span></li>
					
				</ul>
			

			<section>
				<h5>3 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>This i my command to retrieve:</p>
<p><code>perl downloadosmtiles.pl --latitude=50.151:50.159 --longitude=8.76:8.788 --zoom=11:19 --destdir enkheim</code></p>
<p>In console I see:</p>
<pre><code class="hljs">[Pommkataster[<span class="hljs-number">14615</span>:<span class="hljs-number">70</span>b] Tiler overlay view has been initialized
[Pommkataster[<span class="hljs-number">14615</span>:<span class="hljs-number">2903</span>] zoomscale is <span class="hljs-number">0.125000</span>
[Pommkataster[<span class="hljs-number">14615</span>:<span class="hljs-number">2903</span>] determined tile for coordinates (lat,lon,zoom) <span class="hljs-number">50.156666</span>,<span class="hljs-number">8.760223</span>,<span class="hljs-number">6</span> to have indexes <span class="hljs-number">33.557373</span>,<span class="hljs-number">42.338135</span>
Pommkataster[<span class="hljs-number">14615</span>:<span class="hljs-number">2903</span>] id for tile query is SELECT tile_id FROM map WHERE zoom_level=<span class="hljs-number">6</span> and tile_column=<span class="hljs-number">33</span> and tile_row=<span class="hljs-number">42</span>
Pommkataster[<span class="hljs-number">14615</span>:<span class="hljs-number">2903</span>] query creation ret val is <span class="hljs-number">1</span>
Pommkataster[<span class="hljs-number">14615</span>:<span class="hljs-number">2903</span>] Error: tile ID is nil, cannot retrieve image for tile because tile ID passed is nil
[DE
</code></pre><p>My thoughts:</p>
<ol>
<li>the requested position is inside my region.</li>
<li>the system calculates index and zoomlevel (I believe this calculaltion)</li>
<li>the system doesn&#39;t find a tile</li>
</ol>
<p>If I open the mbtile DB with my sqlite client and start the sql &#39; SELECT tile_id FROM map WHERE zoom_level=6 and tile_column=33 and tile_row=42&#39; then the db says: &#39;no such table: map&#39;. This tabel is named &#39;tiles&#39;.</p>
</div>
							<div class="author">
								&mdash; commented <span title="June 25th 2014, 6:58:06 am">June 25th 2014</span>
								by <span class='authorname'>Rainer Schleevoigt</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>I found the problem:</p>
<p>Here is a <a href="https:&#x2F;&#x2F;github.com&#x2F;mapbox&#x2F;mbtiles-spec&#x2F;blob&#x2F;master&#x2F;1.1&#x2F;spec.md">spec of mbtiles</a> from mapbox. In this data model the table is named &#39;tiles&#39; and in a field &#39;tile_data&#39; is the blob.</p>
<p>The  netfunctional solution uses an other schema (table is named map and there is a tile_id).</p>
<p>The question: which format uses the module from marketplace or how can I convert my flippy tiles from my folder to the mbtileDB with this other format?</p>
</div>
							<div class="author">
								&mdash; commented <span title="June 25th 2014, 7:14:21 am">June 25th 2014</span>
								by <span class='authorname'>Rainer Schleevoigt</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>After a long day and purchasing of the module from maketplace I&#39;am a little clever:</p>
<p>There are two specs of mbtiles:</p>
<ol>
<li><a href="https:&#x2F;&#x2F;gist.github.com&#x2F;bFlood&#x2F;3381377">https:&#x2F;&#x2F;gist.github.com&#x2F;bFlood&#x2F;3381377</a> (tiles in extra table &#39;images&#39;)</li>
<li><a href="https:&#x2F;&#x2F;github.com&#x2F;mapbox&#x2F;mbtiles-spec">https:&#x2F;&#x2F;github.com&#x2F;mapbox&#x2F;mbtiles-spec</a> (tiles same table)</li>
</ol>
<p>The free moduel from canada and the module from marketplace uses the first spec. But I only found converter from flippy tiles folder to mbtiles according the second spec.</p>
</div>
							<div class="author">
								&mdash; commented <span title="June 25th 2014, 10:13:26 am">June 25th 2014</span>
								by <span class='authorname'>Rainer Schleevoigt</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>-1</span> Votes</div>
			<div class="answers"><span>0</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>0 Answers</h3>

	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
