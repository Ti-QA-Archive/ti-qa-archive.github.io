<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>1.7.5 Android Issue with Global Namespace » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>1.7.5 Android Issue with Global Namespace</h1>
		</header>
		<section>
			<p>I realize I do not have a test case, so please don&#39;t lecture me on it. Been battling Android issues and inconsistencies for three hours so not really in the mood…</p>
<p>One of the many issues I encountered was I make a SINGLE object in the global namespace and then build on it. This is the entire base that the app is working under and it is working almost every where. Almost.</p>
<p>I am using CommonJS require and all that.</p>
<p>Anyway… in one place it is not working. In include a module via require and then within that module I attempt to access that global object. Works fine every other place where i&#39;m doing the same exact thing. Works fine in iPhone emulator. But Android emulator…. undefined.</p>
<p>I pulled my hair out for a while and then decided to try dropping back to 1.7.3 and it worked fine. So the issue is with 1.7.5 for Android.</p>
<p>Again… I know I don&#39;t have a test case, but thought I&#39;d throw it out there to see if anyone knows of this bug or not.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="November 26th 2011, 6:38:14 am">November 26th 2011</span>
				by <span class='authorname'>Jason B</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-224291">
				
						<section>
							<p>Check this out: <a href="http:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TIMOB-6033">http:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TIMOB-6033</a></p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 26th 2011, 10:21:50 am">November 26th 2011</span>
								by <span class='authorname'>Ivan Škugor</span><br>
								<a class="icon-bg icon-link" href="question/128724/175-android-issue-with-global-namespace#answer-224291" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-224317">
				
						<section>
							<p>Hi Jason.</p>
<p>I have just completed refactoring an app to which used namespaces and anonymous functions to use global namespaces and commonJS. I used the 1.8.0 SDK and configured it for Android and iPhone. Admittedly there was a few issues with this.</p>
<p>If you could post some code I might be able to help resolve your issue…</p>
<p>T…</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 26th 2011, 6:12:27 pm">November 26th 2011</span>
								by <span class='authorname'>Trevor Ward</span><br>
								<a class="icon-bg icon-link" href="question/128724/175-android-issue-with-global-namespace#answer-224317" rel="permalink">permalink</a>
							</div>

							<h5>9 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Okay thanks. I&#39;m trying to get a simplified test case.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 26th 2011, 7:46:16 pm">November 26th 2011</span>
											by <span class='authorname'>Jason B</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>excellent. I am in the process of doing one as well…</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 26th 2011, 8:00:03 pm">November 26th 2011</span>
											by <span class='authorname'>Trevor Ward</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Still working on narrowing it down further, but this seems to replicate it:<br>http:&#x2F;&#x2F;pastebin.com&#x2F;K8cXcYj9</p>
<p>Seems similar to what Ivan reported already. Although I found that setting navBarHidden to anything (true or false) will make it break. If I leave off the setting altogether then it works!</p>
<p>Still experimenting.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 26th 2011, 8:17:09 pm">November 26th 2011</span>
											by <span class='authorname'>Jason B</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Further simplified… didn&#39;t need second module layer to replicate. This again seems to be the exact same thing Ivan is reporting, but slightly simpler test</p>
<p>http:&#x2F;&#x2F;pastebin.com&#x2F;CGntvS9q</p>
<p>Comment out the navBarHidden and it works fine… set navBarHidden to true or false and the click event throws an undefined variable error.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 26th 2011, 8:35:35 pm">November 26th 2011</span>
											by <span class='authorname'>Jason B</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Jason….</p>
<p>I will take a full look later. But just curios you just require the file rather than require the file into a variable. Is there a reason for this….</p>
<p>Also the issue between window types in Titanium is being addressed but really interesting to see how defining the window causes the application to fail..</p>
<p>T</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 27th 2011, 10:25:20 am">November 27th 2011</span>
											by <span class='authorname'>Trevor Ward</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I was just creating an example to illustrate what i am experiencing… Not suggesting that in practice. I am using exports to return into a variable in my app.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 27th 2011, 3:03:19 pm">November 27th 2011</span>
											by <span class='authorname'>Jason B</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>But I do have some methods on a global object that I am trying to access inside the module. That is what is failing and currently I have no workaround.</p>
<p>This is for the Atomic22 framework that I am working on and open sourced if you saw that.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 27th 2011, 3:06:03 pm">November 27th 2011</span>
											by <span class='authorname'>Jason B</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>are yes the work around … here you go….</p>
<p>set your global variables into a separate file… I use namespaces to save polluting the global space, then include this file into the app.js. note include not require then your variables are accessible to the whole app including the required files. exactly the issue I had not ideal but a full bug report is being raised… to get it resolved.</p>
<p>Basically I think not sure yet, there is an issue with exporting global variables functions work great but variables don&#39;t.</p>
<p>Hope this helps.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 27th 2011, 9:02:24 pm">November 27th 2011</span>
											by <span class='authorname'>Trevor Ward</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Thanks for the work around. I&#39;ll give it a shot.</p>
<p>I am only putting one variable into the global namespace and that is my A22 object (https:&#x2F;&#x2F;github.com&#x2F;milesplit&#x2F;Atomic22) which is essentially a namespace object that everything else is built upon… similar to the jQuery global object.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 27th 2011, 10:28:32 pm">November 27th 2011</span>
											by <span class='authorname'>Jason B</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-224597">
				
						<section>
							<p>Me too, I am struggling with global variables and CommonJS. I have read that globals shouldn&#39;t be used with CommonJS (see <a href="http:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TIMOB-6033?focusedCommentId=173145&amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-173145">jira</a> and <a href="http:&#x2F;&#x2F;wiki.appcelerator.org&#x2F;display&#x2F;guides&#x2F;CommonJS+in+Titanium#CommonJSinTitanium-GlobalVariables%2CClosures%2CandMore">wiki</a>). In fact, they do work in iOs but give some problems on Android. Have a look at this <a href="http:&#x2F;&#x2F;pastebin.com&#x2F;kiNbFHrP">code</a>.<br>I tried with 1.7.6 and 1.8.0.v20111114103905. Global variable (myGlobal) is visible in win1.js and win2.js, not in win3.js (an error occurs). If you modify your code in app.js (as in the bottom section), it works.<br>My question is: can we use globals in &quot;required&quot; modules? Is it just a matter of fixing a bug, or is it something discouraged? I am writing an app that would really need this feature, please let me know.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 30th 2011, 4:21:23 pm">November 30th 2011</span>
								by <span class='authorname'>Fabio Barbieri</span><br>
								<a class="icon-bg icon-link" href="question/128724/175-android-issue-with-global-namespace#answer-224597" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>You should not use global variables in required modules…..</p>
<p>If you require a global variable and your app architecture is such then declare them in app.js or a separate file which is included in your ap.js.</p>
<p>Your going to use them anyway…</p>
<p>in your required files creating a variable with var makes it local to that file and not global..</p>
<p>T.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 30th 2011, 5:58:55 pm">November 30th 2011</span>
											by <span class='authorname'>Trevor Ward</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>CommonJS is not perfect.</p>
<p>Global variables are just one thing. If you have some common functionality, for example, you use Array and Object objects for you own purpose and you don&#39;t want to mix with their prototypes because it&#39;s a bad practice, then you have a huge issue because you need to re-include them in every module you use. It&#39;s against DRY principles and from maintenance point of view it&#39;s a disaster, especially in Titanium where currently packages are not implemented (as far as I know).</p>
<p>Speaking of Titanium and CommonJS … in Titanium you write in CommonJS style, but then you use:</p>
<pre><code class="hljs"><span class="hljs-variable"><span class="hljs-keyword">var</span> Window</span> = Ti.UI.createWindow();
</code></pre><p>instead of </p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> Window = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ui'</span>).Window();
</code></pre><p>That&#39;s not consistent and not portable code, which was the first premise in CommonJS approach.</p>
<p>And for the end … (CommonJS) modules are &quot;evil&quot; in JS from OOP point of view due to lacking of &quot;protected&quot; variables. I&#39;ll write about it in some future … but anyway, to conclude this … I wonder should I use them anyway (especially now when Ti.include will work in functions on Android).</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 1st 2011, 7:18:45 am">December 1st 2011</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Ivan,</p>
<p>In simple test cases, load time on Android is decreased significantly with commonJS.  However, two things have become apparent for us that are troublesome.  </p>
<p>The first is the lack of single global namespace with commonjs support on Android.  For 6 months+, single namespace was preached and preached and preached. Suddenly, its a child of the devil and should be avoided apparently.</p>
<p>The second is debugging.  While I can rarely get the debugger to work with Android, it is very nice to have around for iOS.  But, the breakpoints don&#39;t grab in my modules.  Module problems return strange messages that are nearly impossible to track down.</p>
<p>So for now, I&#39;m torn.  Include works.  commonJS is buggy.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 7th 2011, 1:08:10 am">December 7th 2011</span>
											by <span class='authorname'>Stephen Feather</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Stephen.</p>
<p>I&#39;m developing Android application with large number of files. The problem I had is that everything needed to be pre-loaded since &quot;Ti.include&quot; doesn&#39;t work inside functions on Android, therefore my app couldn&#39;t benefit from lazy-loading. Because of that my app after some time started to load slowly. And that&#39;s tragic, because compilation takes time, app load time takes time … and in the end a lot of time is lost.</p>
<p>When CommonJS came out, I thought - awesome! I could load CommonJS modules inside functions and therefore my app could use lazy loading. I managed to find solution how to simply refactor my app to use CommonJS and it worked fine when everything was preloaded (but I didn&#39;t see the difference in load time - V8 is where I saw the difference ;) ). I tried to move including of files inside functions, but then everything broke. I figured out that my global object does not exist in module scope if everything is not preloaded (works fine with lightweight windows, but not with heavyweight windows which I use because of back-button). I reported that as a bug, but got strange answers which I don&#39;t want to comment. :D</p>
<p>Anyway, after some research of CommonJS, I found some great ideas in it, but also some very dangerous. At the moment, I&#39;m thinking about hybrid approach (once &quot;Ti.include&quot; is fixed so it works inside functions) that will benefit from some CommonJS ideas, while it will be more flexible. It&#39;s simple idea actually:</p>
<pre><code class="hljs"><span class="hljs-comment">//app.js</span>
<span class="hljs-keyword">var</span> NS = {};
<span class="hljs-keyword">require</span>(<span class="hljs-string">'module'</span>, NS);

<span class="hljs-comment">//now I can use "Ns.module", but also I can do this:</span>

<span class="hljs-keyword">var</span> myModule = <span class="hljs-keyword">require</span>(<span class="hljs-string">'module'</span>);

<span class="hljs-comment">//global variable</span>
<span class="hljs-keyword">var</span> CommonStuff = {};

<span class="hljs-comment">//module.js</span>
(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(require, exports)</span> </span>{
    <span class="hljs-comment">//module code</span>
    exports.something = <span class="hljs-string">'Test'</span>;

    exports.doSomething = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> otherModule = <span class="hljs-keyword">require</span>(<span class="hljs-string">'otherModule'</span>);
        <span class="hljs-comment">//or without</span>

    };

    CommonStuff; <span class="hljs-comment">//works fine</span>

})(<span class="hljs-keyword">require</span>, exports);


<span class="hljs-comment">//the trick is custom "require" function</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">require</span> = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(modulePath, exports)</span> </span>{
    exports = exports || {};
    Ti.<span class="hljs-keyword">include</span>(modulePath.slice(<span class="hljs-number">0</span>, -<span class="hljs-number">3</span>));
    <span class="hljs-keyword">return</span> exports;
}
</code></pre><p>(closure in module.js is actually how CommonJS is implemented in browser)</p>
<p>Right now, I have some work to do, but soon I&#39;ll dive into this to see what&#39;s the best approach. For now, I don&#39;t see CommonJS as something beneficial.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 7th 2011, 9:42:14 am">December 7th 2011</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
