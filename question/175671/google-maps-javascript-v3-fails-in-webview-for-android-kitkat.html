<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Google Maps JavaScript v3 fails in WebView for Android KitKat » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Google Maps JavaScript v3 fails in WebView for Android KitKat</h1>
		</header>
		<section>
			<p>Google Maps JavaScript V3 comes up blank when shown in a WebView - nothing renders. </p>
<p>I am testing with the exact script as shown in the API documentation (except the API key is added), also copied below: [https:&#x2F;&#x2F;developers.google.com&#x2F;maps&#x2F;documentation&#x2F;javascript&#x2F;tutorial#LoadingMap]</p>
<p>The demo file and Maps API work great on desktop browsers and for iOS and older Android, but fails on KitKat (tested on Galaxy S5 and Moto-X). </p>
<p>I have posted the test file to a web server and opened it from Chrome directly, and the code works fine on the same device outside of Titanium. The only case that fails is the Titanium WebView with Android 4.4. I am building with Titanium version 3.2.3GA.</p>
<p>Has anyone seen this or have a suggestion? </p>
<pre><code class="hljs"><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"initial-scale=1.0, user-scalable=no"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">style</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span>&gt;</span><span class="css">
      <span class="hljs-tag">html</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">100%</span> </span></span></span>}
      <span class="hljs-tag">body</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">100%</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">0</span> </span></span></span>}
      <span class="hljs-id">#map-canvas</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">100%</span> </span></span></span>}
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>
      <span class="hljs-attribute">src</span>=<span class="hljs-value">"https://maps.googleapis.com/maps/api/js?key=[---api-key---]&amp;sensor=false"</span>&gt;</span><span class="undefined">
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>&gt;</span><span class="javascript">
      <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initialize</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> mapOptions = {
          center: <span class="hljs-keyword">new</span> google.maps.LatLng(-<span class="hljs-number">34.397</span>, <span class="hljs-number">150.644</span>),
          zoom: <span class="hljs-number">8</span>
        };
        <span class="hljs-keyword">var</span> map = <span class="hljs-keyword">new</span> google.maps.Map(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"map-canvas"</span>),
            mapOptions);
      }
      google.maps.event.addDomListener(<span class="hljs-built_in">window</span>, <span class="hljs-string">'load'</span>, initialize);
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"map-canvas"</span>/&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="July 1st 2014, 11:19:52 pm">July 1st 2014</span>
				by <span class='authorname'>David Asher</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>google maps</span></li>
					
						<li><span class='tagname'>kitkat</span></li>
					
						<li><span class='tagname'>webview</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-280340">
				
						<section>
							<p>Working code is below, seems to work okay on both Android and iPhone. The bugs in Android KitKat are:</p>
<ol>
<li>It will not tolerate a proportional height for the map div, i.e. map-canvas must be set to a fixed pixel size.</li>
<li>Several timing quirks that require delays before processing.</li>
<li>The resize trigger doesn&#39;t work, so when changing the map&#39;s pixel size after an orientation change, you have to reset the map (which wouldn&#39;t be necessary if proportional sizing worked).</li>
<li>Also pinch-zoom won&#39;t work on Android, might be an older problem, but pinch-zoom works on iPhone.</li>
</ol>
<pre><code class="hljs"><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"initial-scale=1.0, user-scalable=no"</span> /&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">style</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span>&gt;</span><span class="css">
        <span class="hljs-tag">html</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">100%</span> </span></span></span>}
        <span class="hljs-tag">body</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">100%</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">0</span></span></span>; <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">0</span> </span></span></span>}
        <span class="hljs-id">#map-canvas</span> <span class="hljs-rules">{ <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">100%</span> </span></span></span>}
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>&gt;</span><span class="javascript">
    <span class="hljs-keyword">var</span> gmap, mapCanvas, mapOptions = { zoomControl: <span class="hljs-literal">true</span>, streetViewControl: <span class="hljs-literal">false</span>, noClear: <span class="hljs-literal">true</span> };
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">mapInitialize</span>(<span class="hljs-params"> mapCenter, mapZoom </span>) </span>{
        mapOptions.center = mapCenter;
        mapOptions.zoom = mapZoom;
        mapCanvas.setAttribute( <span class="hljs-string">"style"</span>, <span class="hljs-string">"height:"</span> + <span class="hljs-built_in">window</span>.innerHeight + <span class="hljs-string">"px;"</span> );
        setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                gmap = <span class="hljs-keyword">new</span> google.maps.Map( mapCanvas, mapOptions );
        }, <span class="hljs-number">20</span> );
    }
    <span class="hljs-built_in">window</span>.onorientationchange = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        mapInitialize( gmap.getCenter(), gmap.getZoom() );
    }
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">startup</span>(<span class="hljs-params"></span>) </span>{
              setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                mapCanvas = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">"map-canvas"</span>);
            mapInitialize( <span class="hljs-keyword">new</span> google.maps.LatLng(-<span class="hljs-number">34.397</span>, <span class="hljs-number">150.644</span>), <span class="hljs-number">8</span> );
        }, <span class="hljs-number">125</span> );
    }
  </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"map-canvas"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"https://maps.googleapis.com/maps/api/js?sensor=true"</span> <span class="hljs-attribute">onload</span>=<span class="hljs-value">"startup()"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 3rd 2014, 2:50:07 pm">July 3rd 2014</span>
								by <span class='authorname'>David Asher</span><br>
								<a class="icon-bg icon-link" href="../../question/175671/google-maps-javascript-v3-fails-in-webview-for-android-kitkat.html#answer-280340" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Thanks for the follow-up, David.  This saved me a lot of time.</p>
<p>The key for me was this line:</p>
<pre><code class="hljs">mapCanvas.setAttribute( <span class="hljs-string">"style"</span>, <span class="hljs-string">"height:"</span> + <span class="hljs-built_in">window</span>.innerHeight + <span class="hljs-string">"px;"</span> );
</code></pre><p>I didn&#39;t have to use a timeout, nor did I have to add an onorientationchange event listener.  Not sure what the difference is.  My code is very similar to yours; I started with <a href="https:&#x2F;&#x2F;developers.google.com&#x2F;maps&#x2F;documentation&#x2F;javascript&#x2F;examples&#x2F;layer-traffic">Google&#39;s sample code for using a traffic layer</a>:</p>
<pre><code class="hljs"><span class="hljs-doctype">&lt;!DOCTYPE html&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"initial-scale=1.0, user-scalable=no"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>Traffic layer<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">style</span>&gt;</span><span class="css">
      <span class="hljs-tag">html</span>, <span class="hljs-tag">body</span>, <span class="hljs-id">#map-canvas</span> <span class="hljs-rules">{
        <span class="hljs-rule"><span class="hljs-attribute">height</span>:<span class="hljs-value"> <span class="hljs-number">100%</span></span></span>;
        <span class="hljs-rule"><span class="hljs-attribute">margin</span>:<span class="hljs-value"> <span class="hljs-number">0px</span></span></span>;
        <span class="hljs-rule"><span class="hljs-attribute">padding</span>:<span class="hljs-value"> <span class="hljs-number">0px</span>
      </span></span></span>}
    </span><span class="hljs-tag">&lt;/<span class="hljs-title">style</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"https://maps.googleapis.com/maps/api/js?v=3.exp"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">script</span>&gt;</span><span class="javascript">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">initialize</span>(<span class="hljs-params"></span>) </span>{
  <span class="hljs-keyword">var</span> myLatlng = <span class="hljs-keyword">new</span> google.maps.LatLng(<span class="hljs-number">34.04924594193164</span>, -<span class="hljs-number">118.24104309082031</span>);
  <span class="hljs-keyword">var</span> mapOptions = {
    zoom: <span class="hljs-number">13</span>,
    center: myLatlng
  }

  <span class="hljs-keyword">var</span> map = <span class="hljs-keyword">new</span> google.maps.Map(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'map-canvas'</span>), mapOptions);

  <span class="hljs-keyword">var</span> trafficLayer = <span class="hljs-keyword">new</span> google.maps.TrafficLayer();
  trafficLayer.setMap(map);
}

google.maps.event.addDomListener(<span class="hljs-built_in">window</span>, <span class="hljs-string">'load'</span>, initialize);

    </span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
  <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">div</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"map-canvas"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">div</span>&gt;</span>
  <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="October 17th 2014, 11:10:13 am">October 17th 2014</span>
											by <span class='authorname'>Jason Priebe</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Actually, now that I look at it, maybe I <em>do</em> need a timeout.  Without it, it seems like the map initializes <em>close</em> to my desired lat&#x2F;lon, but off by a few tiles.  Hmmm…</p>
</p>
										<div class="author">
											&mdash; commented <span title="October 17th 2014, 11:13:08 am">October 17th 2014</span>
											by <span class='authorname'>Jason Priebe</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-285183">
				
						<section>
							<p>Out of curiosity, how are you calling the html page? I&#39;m having a rotten time trying all sorts of code to get the maps working, especially on android</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 16th 2015, 4:49:17 pm">January 16th 2015</span>
								by <span class='authorname'>Bastien Koert</span><br>
								<a class="icon-bg icon-link" href="../../question/175671/google-maps-javascript-v3-fails-in-webview-for-android-kitkat.html#answer-285183" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
