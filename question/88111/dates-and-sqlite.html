<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Dates and sqlite » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Dates and sqlite</h1>
		</header>
		<section>
			<p>Hi All,</p>
<p>I am having a problem with date storage and retrieval with my iPhone app.</p>
<p>I need be able to store dates generated by datetime picker, then perform a variety of queries based on the date field. I also need to be able to retrieve the stored dates and present them to user and set a datetime picker to the retrieved value.</p>
<p>This is all very straight forward for me but for some reason I can&#39;t seem to get it work in Ti Mobile.</p>
<p>For example, I have a picker while in operation I can manipulate it and perform date mathematics without issue. </p>
<p>The problems start after I store the datetime. No matter what I do the datetime is stored as epoch time plus 3 decimal places, which would be fine but I loose the time zone information, which is important.</p>
<p>I have tried pre-casting the data, I have used sqlite data types of DATETIME, TEXT and INTEGER but I still get this strange version of epoch time.</p>
<p>For example:<br>Picker time <em>Sat Dec 11 2010 01:22:37 GMT+1100 (EST)</em> ends up as epoch time <em>1291991257.366</em>.</p>
<p>Trying to convert it back casting that as a date gets me <em>Fri Jan 16 1970 09:52:11 GMT+1100 (EST)</em>.</p>
<p>It appears that the three additional decimals throw the date function off.</p>
<p>Is anyone else storing dates in a sqlite db facing this problem? If not how is your db configured and are you doing pre or post casting of the datatypes?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="December 10th 2010, 12:46:33 pm">December 10th 2010</span>
				by <span class='authorname'>Nick The Geek</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>dates</span></li>
					
						<li><span class='tagname'>epoch</span></li>
					
						<li><span class='tagname'>iphone</span></li>
					
						<li><span class='tagname'>sqlite</span></li>
					
						<li><span class='tagname'>timezone</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>4</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>4 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-159241">
				
						<section>
							<p>Okay, I have tried to post this 3 times now but I keep getting bad request.</p>
<p>I have solved the issue for working with unix time at least.</p>
<p>SQLite takes unix time into an integer column as seconds.<br>Ti&#x2F;JS provide unix time in milliseconds.<br>SQLite, coverts to seconds on insert.</p>
<p>So I am leaving the insert alone to keep math consistency. Now when I select the data for use, I multiply it by 1000 before casting back as a Date. ie.</p>
<p>new Date( fieldByName(&#39;date_time&#39;) * 1000 );</p>
<p>Cheers,</p>
<p>Nick</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 12th 2010, 7:14:27 am">December 12th 2010</span>
								by <span class='authorname'>Nick The Geek</span><br>
								<a class="icon-bg icon-link" href="question/88111/dates-and-sqlite#answer-159241" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>I have confirmed this.</p>
<p>Code:</p>
<pre><code class="hljs"><span class="hljs-comment">// stored in db =  1414450988</span>

<span class="hljs-keyword">var</span> myDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(str);
Ti.API.info(myDate);

<span class="hljs-comment">// incorrect selection from picker</span>
<span class="hljs-comment">// returns 1970-01-17 08:54:10 +0000</span>


<span class="hljs-keyword">var</span> myDate = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>(str *<span class="hljs-number">1000</span>);
Ti.API.info(myDate);

<span class="hljs-comment">// correct selection from picker</span>
<span class="hljs-comment">// returns 2014-10-27 23:03:08 +0000</span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="October 27th 2012, 9:15:45 pm">October 27th 2012</span>
											by <span class='authorname'>LEVEL Technology</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-208515">
				
						<section>
							<p>I&#39;m not sure if it&#39;s the same problem as I encountered, but when I execute on iPhone:</p>
<pre><code class="hljs"><span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> my_table (creation_date) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">'1306343918302'</span>)</span>
</code></pre><p>and retrieve the row back, I get the value truncated to 32-bits (673860318). The column data type is DATETIME, affinity NUMERIC.</p>
<p>The workaround is to store a datetime stamp as text (spelled out using strftime or something). Or (which I did), to store seconds instead of milliseconds.</p>
<p>I think this is a bug, not sure of which component (iOS, Titanium, ?). Because when a number is too large to fit, it should automatically be stored as a TEXT in Sqlite.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 25th 2011, 4:07:02 pm">May 25th 2011</span>
								by <span class='authorname'>Mark Ruys</span><br>
								<a class="icon-bg icon-link" href="question/88111/dates-and-sqlite#answer-208515" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-158821">
				
						<section>
							<p>While I certainly don&#39;t have all the answers, I have done things like:</p>
<p>SELECT strftime(&quot;%m&#x2F;%d&#x2F;%Y %H:%M:%S&quot;, t1.Time) AS START_TIME.<br>You then have to call new Date(rows.fieldByName(&#39;START_TIME&#39;))</p>
<p>Also, you may find that SQLite likes to do UTC conversion for you automatically…so depending on your query you may need to do something like date(\&#39;now\&#39;, \&#39;localtime\&#39;) in your sqlite query string to indicate you want localtime.</p>
<p>Some people are somewhat mistaken about javascript itself, thinking they can pretty much ignore UTC while javascript pretty much always uses it with an offset……even when you are not wanting it. So that may cause some people&#39;s date worries, javascript rather than SQLite (which can be confusing).  Anyways I sometimes use  ISO 8601 date strings within my app, you can find <a href="http:&#x2F;&#x2F;webcloud.se&#x2F;log&#x2F;JavaScript-and-ISO-8601&#x2F;">more here</a>.</p>
<p>Probably no specific answer, but a few things you can look into.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 10th 2010, 11:38:42 pm">December 10th 2010</span>
								by <span class='authorname'>Mike Robinson</span><br>
								<a class="icon-bg icon-link" href="question/88111/dates-and-sqlite#answer-158821" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-158861">
				
						<section>
							<p>Hi Mike, </p>
<p>thanks for the suggestion but I had already tried formatting in the select query, without luck.</p>
<p>I am going to keep trying playing with the format before the insert.</p>
<p>Nick.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 11th 2010, 2:41:42 am">December 11th 2010</span>
								by <span class='authorname'>Nick The Geek</span><br>
								<a class="icon-bg icon-link" href="question/88111/dates-and-sqlite#answer-158861" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
