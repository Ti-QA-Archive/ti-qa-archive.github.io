<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>iOS crashing when using native back button » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>iOS crashing when using native back button</h1>
		</header>
		<section>
			<p>For our iOS mobile app, we are getting some intermittent crashing whenever we use the native back button to go back to our main view, which contains a ListView in a tab group.</p>
<p>Titanium SDK: v3.2.3.GA, Alloy 1.3.1</p>
<p>Platform: iOS6 (frequently crashes), iOS7 (crashes less frequently, but happens when you navigate between pages quickly)</p>
<p>Device: iOS6 Simulator, iPod Touch (iOS 6.1.6), iPhone 5s (iOS 7.1.1)</p>
<p>Host: Mac OS X Mavericks</p>
<p>Building from the Titanium CLI</p>
<p>Possibly Related: <a href="https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TIMOB-16924">TIMOB-16924</a></p>
<p>Console output from Xcode:</p>
<pre><code class="hljs">May 15 12:35:16 My-iPod ReportCrash[2291] <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">Notice</span>&gt;</span></span>: Formulating crash report for process Test App[2288]
May 15 12:35:16 My-iPod com.apple.launchd[<span class="hljs-link_label">1</span>] (UIKitApplication:com.testapp.mobile[<span class="hljs-link_label">0x641e</span>][<span class="hljs-link_reference">2288</span>]) <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">Warning</span>&gt;</span></span>: (UIKitApplication:com.testapp.mobile[0x641e]) Job appears to have crashed: Segmentation fault: 11
May 15 12:35:16 My-iPod backboardd[26] <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">Warning</span>&gt;</span></span>: Application 'UIKitApplication:com.testapp.mobile[0x641e]' exited abnormally with signal 11: Segmentation fault: 11
May 15 12:35:16 My-iPod ReportCrash[2291] <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">Error</span>&gt;</span></span>: libMobileGestalt copySystemVersionDictionaryValue: Could not lookup ReleaseType from system version dictionary
May 15 12:35:16 My-iPod ReportCrash[2291] <span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">Notice</span>&gt;</span></span>: Saved crashreport to /var/mobile/Library/Logs/CrashReporter/Test App<span class="hljs-emphasis">_2014-05-15-123514_</span>My-iPod.plist using uid: 0 gid: 0, synthetic_euid: 501 egid: 0
</code></pre><p>Crash log from Xcode:</p>
<pre><code class="hljs">Incident Identifier: A21EE2E2-<span class="hljs-number">9677</span>-<span class="hljs-number">49F</span>B-<span class="hljs-number">883</span>B-<span class="hljs-number">30F</span>6E51FC652
CrashReporter Key:   <span class="hljs-number">8f</span>533eb5387d0511040297cc4ff3bf4315144414
Hardware Model:      iPod4,<span class="hljs-number">1</span>
Process:         Test App [<span class="hljs-number">2288</span>]
Path:            /var/mobile/Applications/<span class="hljs-number">9</span>DF5C32B-F068-<span class="hljs-number">426</span>B-<span class="hljs-number">8</span>BF4-<span class="hljs-number">7</span>CA5F7A5DC8C/Test App.app/Test App
Identifier:      Test App
Version:         ??? (???)
Code Type:       ARM (Native)
Parent Process:  launchd [<span class="hljs-number">1</span>]

Date/Time:       <span class="hljs-number">2014</span>-<span class="hljs-number">05</span>-<span class="hljs-number">15</span> <span class="hljs-number">12</span>:<span class="hljs-number">35</span>:<span class="hljs-number">14.753</span> -<span class="hljs-number">0600</span>
OS Version:      iOS <span class="hljs-number">6.1</span><span class="hljs-number">.6</span> (<span class="hljs-number">10</span>B500)
Report Version:  <span class="hljs-number">104</span>

Exception Type:  EXC_BAD_ACCESS (SIGSEGV)
Exception Codes: KERN_INVALID_ADDRESS at <span class="hljs-number">0x00000047</span>
Crashed Thread:  <span class="hljs-number">0</span>

Thread <span class="hljs-number">0</span> name:  Dispatch <span class="hljs-built_in">queue</span>: com.apple.main-thread
Thread <span class="hljs-number">0</span> Crashed:
<span class="hljs-number">0</span>   libobjc.A.dylib                   <span class="hljs-number">0x3b39b5b0</span> objc_msgSend + <span class="hljs-number">16</span>
<span class="hljs-number">1</span>   Test App                          <span class="hljs-number">0x00127cf2</span> -[TiViewProxy relayout] (TiViewProxy.m:<span class="hljs-number">2243</span>)
<span class="hljs-number">2</span>   Test App                          <span class="hljs-number">0x001269b0</span> -[TiViewProxy refreshView:] (TiViewProxy.m:<span class="hljs-number">2074</span>)
<span class="hljs-number">3</span>   Test App                          <span class="hljs-number">0x00127f64</span> -[TiViewProxy layoutChildrenIfNeeded] (TiViewProxy.m:<span class="hljs-number">2274</span>)
<span class="hljs-number">4</span>   Test App                          <span class="hljs-number">0x00248624</span> +[TiLayoutQueue layoutProxy:] (TiLayoutQueue.m:<span class="hljs-number">79</span>)
<span class="hljs-number">5</span>   Test App                          <span class="hljs-number">0x00248434</span> performLayoutRefresh (TiLayoutQueue.m:<span class="hljs-number">46</span>)
<span class="hljs-number">6</span>   CoreFoundation                    <span class="hljs-number">0x336f55dc</span> __CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__ + <span class="hljs-number">12</span>
<span class="hljs-number">7</span>   CoreFoundation                    <span class="hljs-number">0x336f528c</span> __CFRunLoopDoTimer + <span class="hljs-number">268</span>
<span class="hljs-number">8</span>   CoreFoundation                    <span class="hljs-number">0x336f3efc</span> __CFRunLoopRun + <span class="hljs-number">1228</span>
<span class="hljs-number">9</span>   CoreFoundation                    <span class="hljs-number">0x33666eb8</span> CFRunLoopRunSpecific + <span class="hljs-number">352</span>
<span class="hljs-number">10</span>  CoreFoundation                    <span class="hljs-number">0x33666d44</span> CFRunLoopRunInMode + <span class="hljs-number">100</span>
<span class="hljs-number">11</span>  GraphicsServices                  <span class="hljs-number">0x372192e6</span> GSEventRunModal + <span class="hljs-number">70</span>
<span class="hljs-number">12</span>  UIKit                             <span class="hljs-number">0x3557c2fc</span> UIApplicationMain + <span class="hljs-number">1116</span>
<span class="hljs-number">13</span>  Test App                          <span class="hljs-number">0x000bc6fe</span> main (main.m:<span class="hljs-number">36</span>)
<span class="hljs-number">14</span>  libdyld.dylib                     <span class="hljs-number">0x3b7d7b1c</span> start + <span class="hljs-number">0</span>
</code></pre><p>Thinking it might be the ListView, I stripped it down to its bare minimum data, but it still happens no matter the layout or properties.  We open the detail controller (which also contains a ListView) like this:</p>
<pre><code class="hljs"><span class="hljs-comment">// ListView Clicks</span>
<span class="hljs-keyword">var</span> itemClick = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
  <span class="hljs-keyword">var</span> item = e.section.getItemAt(e.itemIndex);
  <span class="hljs-keyword">var</span> detailController = Alloy.createController(<span class="hljs-string">'candidates'</span>, {
    jobId: item.jobId,
    jobTitle: item.jobTitle
  });
  $.tabJobs.open(detailController.getView());
};
listView.addEventListener(<span class="hljs-string">'itemclick'</span>, itemClick);
</code></pre><p>We built our ListView out in Titanium Classic instead of Alloy just in case that was the problem, but it still crashes.  iOS 6 uses the native back button in the tab bar header to go back to the main page.  We can navigate on iOS 7 a little bit more without crashing, but if we navigate a lot and quickly, it will crash when we go back to the parent tab window.  Things to note: you can tell when the app is going to crash when the ListViewItem that was originally selected on the parent view is styled as if it is selected when you go back to the first view.  It locks up for a second before crashing with the above log.</p>
<p>We were planning on releasing by next week, but this bug is holding us back from doing so.  Is there anything we can do to fix it for the time being?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="May 15th 2014, 5:16:00 pm">May 15th 2014</span>
				by <span class='authorname'>Dan Minkevitch</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>crash</span></li>
					
						<li><span class='tagname'>ios</span></li>
					
						<li><span class='tagname'>listview</span></li>
					
						<li><span class='tagname'>tabgroup</span></li>
					
						<li><span class='tagname'>window</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Bug reported to JIRA <a href="https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TC-4136">here</a>.</p>
</div>
							<div class="author">
								&mdash; commented <span title="May 15th 2014, 5:42:20 pm">May 15th 2014</span>
								by <span class='authorname'>Dan Minkevitch</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-278729">
				
						<section>
							<p>After debugging, I found that the problem was that my detail view&#39;s main window had <code>tabBarHidden=&amp;#39;true&amp;#39;</code> set.  Removing that stopped the app from crashing, but now the TabBar is there.  It will have to work for now.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 15th 2014, 8:43:55 pm">May 15th 2014</span>
								by <span class='authorname'>Dan Minkevitch</span><br>
								<a class="icon-bg icon-link" href="question/174242/ios-crashing-when-using-native-back-button#answer-278729" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-279552">
				
						<section>
							<p>I encountered the same issue, which is not due to <code>tabBarHidden=&amp;#39;true&amp;#39;</code></p>
<p>Despite my almost 0 knowledge of Objective-C, I followed the code. It looks it tries to execute <code>proxyDidRelayout</code> of TiUIListView.m.</p>
<p>For <a href="https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TIMOB-13417">this ticket</a>, @vishalduggal removed a few nil checks.<br><a href="https:&#x2F;&#x2F;github.com&#x2F;appcelerator&#x2F;titanium_mobile&#x2F;commit&#x2F;45798cf51874f1d7544308ae80abf53afd6a4dd2">Git diff</a></p>
<p>Probably it is intentional and <code>_headerViewProxy</code>, <code>_footerViewProxy</code>, and <code>_pullViewProxy</code> should never become nil, but I am not sure. I tried to add the nil check back.</p>
<p>In fact, applying the following code in TiUIListView.m made my app much more stable</p>
<pre><code class="hljs">-(<span class="hljs-keyword">void</span>)proxyDidRelayout:(<span class="hljs-keyword">id</span>)sender
{
    TiThreadPerformOnMainThread(^{
        <span class="hljs-keyword">if</span> ( (sender == _headerViewProxy) &amp;&amp; (_headerViewProxy != <span class="hljs-literal">nil</span>) ) {
            <span class="hljs-built_in">UIView</span>* headerView = [[<span class="hljs-keyword">self</span> tableView] tableHeaderView];
            [headerView setFrame:[headerView bounds]];
            [[<span class="hljs-keyword">self</span> tableView] setTableHeaderView:headerView];
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( (sender == _footerViewProxy) &amp;&amp; (_footerViewProxy != <span class="hljs-literal">nil</span>) ) {
            <span class="hljs-built_in">UIView</span> *footerView = [[<span class="hljs-keyword">self</span> tableView] tableFooterView];
            [footerView setFrame:[footerView bounds]];
            [[<span class="hljs-keyword">self</span> tableView] setTableFooterView:footerView];
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> ( (sender == _pullViewProxy) &amp;&amp; (_pullViewProxy != <span class="hljs-literal">nil</span>) ) {
            pullThreshhold = ([_pullViewProxy view]<span class="hljs-variable">.frame</span><span class="hljs-variable">.origin</span><span class="hljs-variable">.y</span> - _pullViewWrapper<span class="hljs-variable">.bounds</span><span class="hljs-variable">.size</span><span class="hljs-variable">.height</span>);
        }
    },<span class="hljs-literal">NO</span>);
}
</code></pre><p>Although, it becomes really rare to crash with this stack trace, sometimes it still does. I am hoping someone who has more Objective-C knowledge explains why the above code helped and what would be the right fix</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 7th 2014, 8:54:44 pm">June 7th 2014</span>
								by <span class='authorname'>Kazuyuki Tanimura</span><br>
								<a class="icon-bg icon-link" href="question/174242/ios-crashing-when-using-native-back-button#answer-279552" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Did you try the test case from the <a href="https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TC-4136">ticket</a>? You may want to mention this there. For me, the crashing stopped completely by removing the tabbarhidden property. There may be something else related to the list views like you mentioned.</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 7th 2014, 9:39:12 pm">June 7th 2014</span>
											by <span class='authorname'>Dan Minkevitch</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>No I did not, but my app does not use tabbarhidden at all. Multiple issues must be causing the same error here. We can log the issue in your ticket, once it becomes more clear what the root causes are</p>
<p>Probably not related to TIMOB-16924</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 7th 2014, 9:50:06 pm">June 7th 2014</span>
											by <span class='authorname'>Kazuyuki Tanimura</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-279555">
				
						<section>
							<p>I think I found the root cause. Created a pull request<br>https:&#x2F;&#x2F;github.com&#x2F;appcelerator&#x2F;titanium_mobile&#x2F;pull&#x2F;5781</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 8th 2014, 2:24:16 am">June 8th 2014</span>
								by <span class='authorname'>Kazuyuki Tanimura</span><br>
								<a class="icon-bg icon-link" href="question/174242/ios-crashing-when-using-native-back-button#answer-279555" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
