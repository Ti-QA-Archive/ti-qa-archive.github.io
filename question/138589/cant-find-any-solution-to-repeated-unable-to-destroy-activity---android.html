<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Can&#39;t find any solution to repeated &#39;Unable to destroy activity&#39; - Android » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Can&#39;t find any solution to repeated &#39;Unable to destroy activity&#39; - Android</h1>
		</header>
		<section>
			<p>The same code worked fine for iOS but for android emulator, I am getting the below error every time on clicking the back button. Any help to have this fixed will be highly appreciated.</p>
<p>Here is the scenario:</p>
<p>1) app.js have one button and on click of that opening a model window called Settings.</p>
<p>2) Settings window has tableview where on click of each row (A, B, C…), opening model window for sub settings.</p>
<p>3) Each model window has below code for back event.</p>
<pre><code class="hljs">winB.addEventListener(<span class="hljs-string">'android:back'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    winB.close();
});
</code></pre><p>4) On click of back button, current model window closes and instead of showing the previous window, it shows the splash image and stucks there. At the same time, below error also appears in log files.</p>
<p>Log extract:</p>
<p>[ERROR][TiApplication(  458)] (main) [1988,3594] Sending event: exception on thread: main msg:java.lang.RuntimeException: Unable to destroy activity {com.zykoon.myguard&#x2F;com.zykoon.myguard.MguardActivity}: java.lang.NullPointerException; Titanium 2.0.1,2012&#x2F;04&#x2F;12 16:36,999c68a</p>
<p>[ERROR][TiApplication(  458)] java.lang.RuntimeException: Unable to destroy activity {com.zykoon.myguard&#x2F;com.zykoon.myguard.MguardActivity}: java.lang.NullPointerException</p>
<p>[ERROR][TiApplication(  458)]     at android.app.ActivityThread.performDestroyActivity(ActivityThread.java:2672)<br>[ERROR][TiApplication(  458)]     at android.app.ActivityThread.handleDestroyActivity(ActivityThread.java:2690)<br>[ERROR][TiApplication(  458)]     at android.app.ActivityThread.access$2100(ActivityThread.java:117)<br>[ERROR][TiApplication(  458)]     at android.app.ActivityThread$H.handleMessage(ActivityThread.java:964)<br>[ERROR][TiApplication(  458)]     at android.os.Handler.dispatchMessage(Handler.java:99)<br>[ERROR][TiApplication(  458)]     at android.os.Looper.loop(Looper.java:130)<br>[ERROR][TiApplication(  458)]     at android.app.ActivityThread.main(ActivityThread.java:3683)<br>[ERROR][TiApplication(  458)]     at java.lang.reflect.Method.invokeNative(Native Method)<br>[ERROR][TiApplication(  458)]     at java.lang.reflect.Method.invoke(Method.java:507)<br>[ERROR][TiApplication(  458)]     at com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.java:839)<br>[ERROR][TiApplication(  458)]     at com.android.internal.os.ZygoteInit.main(ZygoteInit.java:597)<br>[ERROR][TiApplication(  458)]     at dalvik.system.NativeStart.main(Native Method)</p>
<p>[ERROR][TiApplication(  458)] Caused by: java.lang.NullPointerException</p>
<p>[ERROR][TiApplication(  458)]     at org.appcelerator.titanium.TiApplication.postAnalyticsEvent(TiApplication.java:626)<br>[ERROR][TiApplication(  458)]     at org.appcelerator.titanium.TiLaunchActivity.onDestroy(TiLaunchActivity.java:428)<br>[ERROR][TiApplication(  458)]     at org.appcelerator.titanium.TiRootActivity.onDestroy(TiRootActivity.java:102)<br>[ERROR][TiApplication(  458)]     at android.app.ActivityThread.performDestroyActivity(ActivityThread.java:2659)<br>[ERROR][TiApplication(  458)]     … 11 more<br>[ERROR][TiApplication(  458)] (KrollRuntimeThread) [395,6123] APP PROXY: ti.modules.titanium.app.AppModule@4057c890</p>
<p>[WARN][V8Object(  458)] Runtime disposed, cannot set property &#39;userAgent&#39;</p>
<p>[WARN][ActivityManager(   72)] Activity destroy timeout for HistoryRecord{407c5538 com.zykoon.myguard&#x2F;.MguardActivity}</p>
<p>[WARN][ActivityManager(   72)] Launch timeout has expired, giving up wake lock!</p>
<p>5) If I try to click to rerun the app on emulator (w&#x2F;o restart) then the below error appears. Means, I have to restart the emulator for clean run.</p>
<p>[WARN][TiFastDev(  458)] (Thread-14) [1,821604] Killing app from Fastdev server request</p>
<p>[ERROR][TiFastDev(  458)] (Thread-14) [5,821609] null</p>
<p>[ERROR][TiFastDev(  458)] java.lang.NullPointerException</p>
<p>[ERROR][TiFastDev(  458)]     at android.widget.Toast.&lt;init&gt;(Toast.java:89)</p>
<p>[ERROR][TiFastDev(  458)]     at android.widget.Toast.makeText(Toast.java:231)<br>[ERROR][TiFastDev(  458)]     at org.appcelerator.kroll.common.TiFastDev.showToast(TiFastDev.java:158)<br>[ERROR][TiFastDev(  458)]     at org.appcelerator.kroll.common.TiFastDev$Session.executeKill(TiFastDev.java:443)<br>[ERROR][TiFastDev(  458)]     at org.appcelerator.kroll.common.TiFastDev$Session.execute(TiFastDev.java:429)<br>[ERROR][TiFastDev(  458)]     at org.appcelerator.kroll.common.TiFastDev$Session.run(TiFastDev.java:360)</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="June 20th 2012, 11:02:22 am">June 20th 2012</span>
				by <span class='authorname'>Ratty A</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>destroy activity</span></li>
					
						<li><span class='tagname'>modal back event</span></li>
					
						<li><span class='tagname'>null pointer</span></li>
					
						<li><span class='tagname'>toast</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Using Titanium SDK 2.0.1GA2, Android Google Api 2.3.3</p>
</div>
							<div class="author">
								&mdash; commented <span title="June 20th 2012, 11:03:46 am">June 20th 2012</span>
								by <span class='authorname'>Ratty A</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>4</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>4 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-241484">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>So how did you create and open the Settings window?  Is it heavyweight?</p>
<p>See my example below where app.js opens a window with a button – click the button to open a window with a tableview.  Click a row, and it opens a blue window.  Use the back button once, and you&#39;re back at the tableview.  Use the back button again, and you&#39;re back at the main window.  Use the back button a third time, and the app exits.</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> win1 = Ti.UI.createWindow ({
    title: <span class="hljs-string">"Win 1"</span>,
    backgroundColor: <span class="hljs-string">'#fff'</span>,
    layout: <span class="hljs-string">"vertical"</span>
});

<span class="hljs-keyword">var</span> btn1 = Ti.UI.createButton ({
    title: <span class="hljs-string">'click me'</span>,
    left: <span class="hljs-number">10</span>,
    right: <span class="hljs-number">10</span>,
    top: <span class="hljs-number">20</span>
});

btn1.addEventListener (<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">var</span> win1a = Ti.UI.createWindow ({
        title: <span class="hljs-string">"Win 1a"</span>,
        backgroundColor: <span class="hljs-string">'#fff'</span>,
        fullscreen: <span class="hljs-literal">false</span>
    });

    <span class="hljs-keyword">var</span> tv = Ti.UI.createTableView ({
        top: <span class="hljs-number">0</span>,
        bottom: <span class="hljs-number">0</span>,
        data: [{title: <span class="hljs-string">'foo'</span>}, {title: <span class="hljs-string">'bar'</span>}, {title: <span class="hljs-string">'baz'</span>}]
    });

    tv.addEventListener (<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
        <span class="hljs-keyword">var</span> win1b = Ti.UI.createWindow ({
            title: <span class="hljs-string">"Win 1b"</span>,
            backgroundColor: <span class="hljs-string">'#00b'</span>,
            fullscreen: <span class="hljs-literal">false</span>
        });

        win1b.open ();
    });

    win1a.add (tv);
    win1a.open ();
});

win1.add (btn1);

win1.open ();
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 20th 2012, 3:38:14 pm">June 20th 2012</span>
								by <span class='authorname'>Jason Priebe</span><br>
								<a class="icon-bg icon-link" href="question/138589/cant-find-any-solution-to-repeated-unable-to-destroy-activity---android.html#answer-241484" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>My bad. During all tryouts, I commented the modal: true for Settings window that&#39;s why it was not working and all others worked fine. I uncommented and now it&#39;s working fine w&#x2F;o &#39;unable to destroy….&#39; errors. Thanks Jason for your help.</p>
<p>I also have one more issue separate from this and if you can provide some suggestions on that then it will be great. http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;138512&#x2F;formsjs—retrieving-picker-value-not-working-in-android-works-fine-in-ios</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 20th 2012, 4:36:03 pm">June 20th 2012</span>
											by <span class='authorname'>Ratty A</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>2</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-241467">
				
						<section>
							<p>I don&#39;t think you need to mess with the android:back event.  In fact, if you just make sure that your new window is heavyweight, the back button will automatically close the window and take you back to the first screen.</p>
<p>From the <a href="http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;2.0&#x2F;index.html#!&#x2F;guide&#x2F;Android_Platform_Overview-section-29004888_AndroidPlatformOverview-Heavyweightandlightweightwindows">guides</a>:</p>
<p><em>A window is heavyweight if: Any of these properties are set to either true or false: fullscreen, navBarHidden, or modal; Or if the window&#39;s windowSoftInputMode property is set to any of the Ti.UI.Android constants; Or if the tabOpen property is true.</em></p>
<p>(note that I think the API docs are wrong, as they state:</p>
<p><em>The createWindow call creates a heavyweight window if any of the following properties are true on creation: fullscreen, navBarHidden, modal, windowSoftInputMode</em></p>
<p>You might want to consider the cross-platform navigation controller: <a href="https:&#x2F;&#x2F;github.com&#x2F;kwhinnery&#x2F;NavigationController">code</a>, <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;blog&#x2F;2011&#x2F;08&#x2F;forging-titanium-episode-2-a-cross-platform-navigation-controller.html">video tutorial</a></p>
<p>In my example below, clicking button 1 brings up a yellow window which you can close with the back button.  A second press of the back button exits the application.  Button 2 brings up a blue window.  You can also close it with the back button.  But from that point on, the back button doesn&#39;t close the application.</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> tabGroup = Ti.UI.createTabGroup();

<span class="hljs-keyword">var</span> win1 = Ti.UI.createWindow ({
    title: <span class="hljs-string">"Win 1"</span>,
    backgroundColor: <span class="hljs-string">'#fff'</span>,
    layout: <span class="hljs-string">"vertical"</span>
});

<span class="hljs-keyword">var</span> btn1 = Ti.UI.createButton ({
    title: <span class="hljs-string">'click me'</span>,
    left: <span class="hljs-number">10</span>,
    right: <span class="hljs-number">10</span>,
    top: <span class="hljs-number">20</span>
});

btn1.addEventListener (<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">var</span> win1a = Ti.UI.createWindow ({
        title: <span class="hljs-string">"Win 1a"</span>,
        backgroundColor: <span class="hljs-string">'#ff0'</span>,
        fullscreen: <span class="hljs-literal">false</span>
    });
    win1a.open ();
});

win1.add (btn1);

<span class="hljs-keyword">var</span> btn2 = Ti.UI.createButton ({
    title: <span class="hljs-string">'click me'</span>,
    left: <span class="hljs-number">10</span>,
    right: <span class="hljs-number">10</span>,
    top: <span class="hljs-number">20</span>
});

btn2.addEventListener (<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">var</span> win1b = Ti.UI.createWindow ({
        title: <span class="hljs-string">"Win 1b"</span>,
        backgroundColor: <span class="hljs-string">'#00b'</span>
    });

    win1b.addEventListener(<span class="hljs-string">'android:back'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
        win1b.close();
    });

    win1b.open ();
});

win1.add (btn2);

win1.open ();
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 20th 2012, 12:35:33 pm">June 20th 2012</span>
								by <span class='authorname'>Jason Priebe</span><br>
								<a class="icon-bg icon-link" href="question/138589/cant-find-any-solution-to-repeated-unable-to-destroy-activity---android.html#answer-241467" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Your suggested solution works for clicking back from any modal window opened from Settings window&#x2F;tableview but unfortunately, it doesn&#39;t work when you are on settings windows and want to go back to Home(app.js) as in that case, the splash screen shows up and stuck forever with following error in log.</p>
<p>[ERROR][TiBaseActivity(  435)] (main) [375,375] Layout cleanup.</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 20th 2012, 2:06:30 pm">June 20th 2012</span>
											by <span class='authorname'>Ratty A</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I&#39;m not sure what you mean – my example window <em>is</em> the main app window.  Put my code into app.js.  It works fine.</p>
<p>Again, I really don&#39;t think you want to mess with the android:back event to try to manage the windows yourself.  Just make sure you&#39;re opening heavyweight windows, and the back button will work for you.</p>
<p>If you have a simple example that shows I&#39;m wrong, please post it, and I&#39;ll have a look.</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 20th 2012, 2:28:03 pm">June 20th 2012</span>
											by <span class='authorname'>Jason Priebe</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I did remove all android:back and also ensured all are modal windows. As I said earlier that it worked well except going back from Settings modal window to app.js</p>
<p>Not doubting the example you provided, it&#39;s just that there is so much of code in my app.js that I can&#39;t figure why it&#39;s not working for this one case?</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 20th 2012, 2:40:20 pm">June 20th 2012</span>
											by <span class='authorname'>Ratty A</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Just noticed the createTabGroup() call at the top – ignore that.  D&#39;oh!</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 20th 2012, 3:38:42 pm">June 20th 2012</span>
											by <span class='authorname'>Jason Priebe</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-241482">
				
						<section>
							<p>What is the &quot;Settings&quot; modal window you mention?</p>
<p>The fact that your app.js contains so much code is a bad thing.  My current project is fairly large (around 4000 lines of Javascript), but only 85 lines are in app.js.  The rest are in CommonJS modules.</p>
<p>Break your code into manageable pieces.  It will be easier for you to isolate what&#39;s going on.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 20th 2012, 3:07:28 pm">June 20th 2012</span>
								by <span class='authorname'>Jason Priebe</span><br>
								<a class="icon-bg icon-link" href="question/138589/cant-find-any-solution-to-repeated-unable-to-destroy-activity---android.html#answer-241482" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-241483">
				
						<section>
							<p>Correct, that&#39;s a lesson learned and going forward need to break code into different js etc. </p>
<p>iOS version from same code worked well and it&#39;s just android giving trouble.</p>
<p>On app. js, there is a button which opens a modal window called Settings which has a tableview with each row click opens another modal window.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 20th 2012, 3:21:11 pm">June 20th 2012</span>
								by <span class='authorname'>Ratty A</span><br>
								<a class="icon-bg icon-link" href="question/138589/cant-find-any-solution-to-repeated-unable-to-destroy-activity---android.html#answer-241483" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
