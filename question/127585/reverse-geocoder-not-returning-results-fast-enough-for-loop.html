<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Reverse geocoder not returning results fast enough for loop » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Reverse geocoder not returning results fast enough for loop</h1>
		</header>
		<section>
			<p>Hi. OK. I&#39;m building for iPhone using SDK v1.7.3. Basically, I am looping through XML and within the loop I&#39;m calling reverseGeocoder to obtain the city name for each record and then adding this information to a tableview, but the tableview is built by the time the reversegeocoder has returned the results and subsequently only the last row in the table has the city. Is there any way I can pause the loop until the data is returned by the ReverseGeocoder method?</p>
<p>Here is the relevant code…</p>
<pre><code class="hljs">
for <span class="hljs-list">(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; tips.length; i++) {</span>
    var tiptype = tips.item<span class="hljs-list">(<span class="hljs-keyword">i</span>)</span>.getElementsByTagName<span class="hljs-list">(<span class="hljs-string">"type"</span>)</span>.item<span class="hljs-list">(<span class="hljs-number">0</span>)</span>.text.toUpperCase<span class="hljs-list">()</span><span class="hljs-comment">;</span>
    var tiptext = tips.item<span class="hljs-list">(<span class="hljs-keyword">i</span>)</span>.getElementsByTagName<span class="hljs-list">(<span class="hljs-string">"tip"</span>)</span>.item<span class="hljs-list">(<span class="hljs-number">0</span>)</span>.text<span class="hljs-comment">;</span>
    var tiplat = tips.item<span class="hljs-list">(<span class="hljs-keyword">i</span>)</span>.getElementsByTagName<span class="hljs-list">(<span class="hljs-string">"latitude"</span>)</span>.item<span class="hljs-list">(<span class="hljs-number">0</span>)</span>.text<span class="hljs-comment">;</span>
    var tiplon = tips.item<span class="hljs-list">(<span class="hljs-keyword">i</span>)</span>.getElementsByTagName<span class="hljs-list">(<span class="hljs-string">"longitude"</span>)</span>.item<span class="hljs-list">(<span class="hljs-number">0</span>)</span>.text<span class="hljs-comment">;</span>

    var row = Ti.UI.createTableViewRow<span class="hljs-list">()</span><span class="hljs-comment">;</span>

    var typeTip = Ti.UI.createLabel<span class="hljs-list">({
        color:<span class="hljs-quoted">'#576996</span>',
        font:{fontSize:<span class="hljs-number">12</span>,fontWeight:<span class="hljs-quoted">'bold</span>', fontFamily:<span class="hljs-quoted">'Helvetica</span> Neue'},
        left:<span class="hljs-number">10</span>,
        top:<span class="hljs-number">0</span>,
        height:<span class="hljs-number">30</span>,
        width:<span class="hljs-number">100</span>,
        text<span class="hljs-keyword">:tiptype</span>
    })</span><span class="hljs-comment">;</span>
    row.add<span class="hljs-list">(<span class="hljs-keyword">typeTip</span>)</span><span class="hljs-comment">;</span>
    var lblLocation = Ti.UI.createLabel<span class="hljs-list">({
        color:<span class="hljs-quoted">'#383838</span>',
        font:{fontSize:<span class="hljs-number">11</span>,fontFamily:<span class="hljs-quoted">'Helvetica</span> Neue'},
        left:<span class="hljs-number">210</span>,
        top:<span class="hljs-number">5</span>,
        height:<span class="hljs-number">15</span>,
        width:<span class="hljs-number">100</span>,
        text:''
    })</span><span class="hljs-comment">;</span>
    row.add<span class="hljs-list">(<span class="hljs-keyword">lblLocation</span>)</span><span class="hljs-comment">;</span>

    Titanium.Geolocation.reverseGeocoder<span class="hljs-list">(<span class="hljs-keyword">tiplat</span>,tiplon,function<span class="hljs-list">(<span class="hljs-keyword">e</span>)</span> {
        var geoAddress = e.places<span class="hljs-comment">;</span>
        lblLocation.text = geoAddress[<span class="hljs-number">0</span>].city<span class="hljs-comment">;</span>
    })</span><span class="hljs-comment">;</span>

    data.push<span class="hljs-list">(<span class="hljs-keyword">row</span>)</span><span class="hljs-comment">;</span>
}<span class="hljs-comment">;</span></span>
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="October 31st 2011, 11:29:07 am">October 31st 2011</span>
				by <span class='authorname'>Andrew Mills</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>geolocation</span></li>
					
						<li><span class='tagname'>iphone4</span></li>
					
						<li><span class='tagname'>reversegeocoder</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-222286">
				
						<section>
							<p>You could move the entire row creation in to the reverseGeocoder callback, thus making the row creation asynchronous (a row will be created after each successful reverseGeocoder action). Since the reverseGeocoder is an asynchronous function, lblLocation will refer to the current lblLocation at the moment of the callback happening, in your case it&#39;s the last one, but it could be the one before or one before that.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="October 31st 2011, 11:58:24 am">October 31st 2011</span>
								by <span class='authorname'>Yaniv Nagar</span><br>
								<a class="icon-bg icon-link" href="question/127585/reverse-geocoder-not-returning-results-fast-enough-for-loop#answer-222286" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>I tried as you suggested and now the locations are correct but the typetip label is now the last value provided in the loop. The problem (I think) is that I can&#39;t move the section where I loop through the XML and assign the value to variables into the reverseGeocoder function - the reverseGeocoder function requires the lat&#x2F;long I am retrieving. Any ideas how I can get around this?</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 1st 2011, 5:09:44 am">November 1st 2011</span>
											by <span class='authorname'>Andrew Mills</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>3</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-222343">
				
						<section>
							<p>Just in case anybody else encounters this problem. I finally got this working by:</p>
<p>(1) Creating the table (outside of the loop)<br>(2) Looped through my XML and assigned all the values to an array and once completed I called another function<br>(3) Inside this function I then looped through the array and (for each loop) fired an event, passing the values retrieved to the event<br>(4) I then created an eventlistener which was basically the reversegeocoder function and inside this function I built the row and then appended the row to the tableview</p>
<p>I did try leaving step 2 out and simply firing the event as I was looping through the XML but for some reason it wouldn&#39;t append every row only the last row, but by including this step it works.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 1st 2011, 6:10:34 am">November 1st 2011</span>
								by <span class='authorname'>Andrew Mills</span><br>
								<a class="icon-bg icon-link" href="question/127585/reverse-geocoder-not-returning-results-fast-enough-for-loop#answer-222343" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
