<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Alloy not Saving Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Alloy not Saving</h1>
		</header>
		<section>
			<p>II&#39;m creating an app using Alloy and can not save any data in SQL. There is no error message displayed, but when I close and open the emulator, compiling a new application (without uninstalling), no data is maintained, implying that the SQLite database is not being created and saved by Alloy. The test was done with both iOS as Android using Titanium SDK 3.1.0.GA. Help!</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="May 20th 2013, 4:57:51 am">May 20th 2013</span>
				by <span class='authorname'>Arley Andrada Maria</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>alloy</span></li>
					
						<li><span class='tagname'>sqlite</span></li>
					
				</ul>
			

			<section>
				<h5>4 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Alloy&#39;m using version 1.1.2 and I&#39;ve done tests with and without the idAttribute and also id integer id and text, without success. No error, until i close application everything works fine, but when the application is closed or device is restarted, all data is lost. Finally, I tested also using the native Titanium Properties and data are kept (not lost) as with SQL. Help!</p>
</div>
							<div class="author">
								&mdash; commented <span title="May 20th 2013, 5:04:56 am">May 20th 2013</span>
								by <span class='authorname'>Arley Andrada Maria</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Please PRovide your code</p>
</div>
							<div class="author">
								&mdash; commented <span title="May 20th 2013, 5:16:12 am">May 20th 2013</span>
								by <span class='authorname'>Jigar Maheshwari</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Absolutely impossible to know what you may be doing wrong without showing your code</p>
</div>
							<div class="author">
								&mdash; commented <span title="May 20th 2013, 10:48:03 am">May 20th 2013</span>
								by <span class='authorname'>Tony Lukasavage</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Below is the source code, based on a new Alloy project, just created to isolate the problem SQL persistence.</p>
<p>The information displayed on the console is always the same, indicating that whenever the application is started there is no data persisted.</p>
<p>Any suggestions?<br>Thanks!</p>
<p>models&#x2F;user.js</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> moment = <span class="hljs-built_in">require</span>(<span class="hljs-string">'alloy/moment'</span>);

exports.definition = {
    config : {
        <span class="hljs-string">'columns'</span> : {
            <span class="hljs-string">'myid'</span> : <span class="hljs-string">'INTEGER PRIMARY KEY AUTOINCREMENT'</span>,
            <span class="hljs-comment">//'username' : 'text primary key',</span>
            <span class="hljs-string">'username'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'password'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'realname'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'email'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'authKey'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'role'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'avatar'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'facebook'</span> : <span class="hljs-string">'integer'</span>,
            <span class="hljs-string">'twitter'</span> : <span class="hljs-string">'integer'</span>,
            <span class="hljs-string">'loggedIn'</span> : <span class="hljs-string">'integer'</span>,
            <span class="hljs-string">'loggedInSince'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'authCookie'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'authLastRequest'</span> : <span class="hljs-string">'text'</span>
        },
        <span class="hljs-string">'adapter'</span> : {
            <span class="hljs-string">'type'</span> : <span class="hljs-string">'sql'</span>,
            <span class="hljs-string">'collection_name'</span> : <span class="hljs-string">'user'</span>,
            <span class="hljs-string">'idAttribute'</span> : <span class="hljs-string">'myid'</span>
        }
    },

    extendModel : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Model</span>) </span>{
        _.extend(Model.prototype, {
        });

        <span class="hljs-keyword">return</span> Model;
    },

    extendCollection : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">Collection</span>) </span>{
        _.extend(Collection.prototype, {
        });
        <span class="hljs-keyword">return</span> Collection;
    }
}
</code></pre><p>migrations\201304201353658_user.js</p>
<pre><code class="hljs">migration.up = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(migrator)</span></span> {
    migrator.createTable({
        <span class="hljs-string">'columns'</span> : {
            <span class="hljs-string">'myid'</span> : <span class="hljs-string">'INTEGER PRIMARY KEY AUTOINCREMENT'</span>,
            //<span class="hljs-string">'username'</span> : <span class="hljs-string">'text primary key'</span>,
            <span class="hljs-string">'username'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'password'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'realname'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'email'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'authKey'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'role'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'avatar'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'facebook'</span> : <span class="hljs-string">'integer'</span>,
            <span class="hljs-string">'twitter'</span> : <span class="hljs-string">'integer'</span>,
            <span class="hljs-string">'loggedIn'</span> : <span class="hljs-string">'integer'</span>,
            <span class="hljs-string">'loggedInSince'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'authCookie'</span> : <span class="hljs-string">'text'</span>,
            <span class="hljs-string">'authLastRequest'</span> : <span class="hljs-string">'text'</span>
        }
    });
};

migration.down = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(migrator)</span></span> {
    migrator.dropTable(<span class="hljs-string">'user'</span>);
};
</code></pre><p>controllers\index.js</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">doClick</span><span class="hljs-params">(e)</span> </span>{
    alert($.label.text);
}

$.index.open();

<span class="hljs-keyword">var</span> users = Alloy.createCollection(<span class="hljs-string">'user'</span>);

Ti.API.info(<span class="hljs-string">'*** USERS BEFORE ***'</span>);
Ti.API.info(<span class="hljs-string">'USERS COUNT '</span> + users.length);
users.<span class="hljs-keyword">each</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(user, index)</span> </span>{
    Ti.API.info(<span class="hljs-string">'USERS['</span> + index + <span class="hljs-string">'] ('</span> + user.<span class="hljs-keyword">get</span>(<span class="hljs-string">'username'</span>) + <span class="hljs-string">')'</span>);
});

Ti.API.info(<span class="hljs-string">'*** CREATE UNIQUE USER ***'</span>);
<span class="hljs-keyword">var</span> user = users.at(<span class="hljs-number">0</span>);
<span class="hljs-keyword">if</span> (user) {

    Ti.API.info(<span class="hljs-string">'EXISTS ('</span> + user.<span class="hljs-keyword">get</span>(<span class="hljs-string">'username'</span>) + <span class="hljs-string">')'</span>);
} <span class="hljs-keyword">else</span> {
    user = Alloy.createModel(<span class="hljs-string">'user'</span>);
    user.<span class="hljs-keyword">set</span>({
        username : <span class="hljs-string">'teste'</span>
    });
    users.add(user);
    user.save();

    Ti.API.info(<span class="hljs-string">'NEW ('</span> + user.<span class="hljs-keyword">get</span>(<span class="hljs-string">'username'</span>) + <span class="hljs-string">')'</span>);
}

Ti.API.info(<span class="hljs-string">'*** USERS AFTER ***'</span>);
Ti.API.info(<span class="hljs-string">'USERS COUNT '</span> + users.length);
users.<span class="hljs-keyword">each</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(user, index)</span> </span>{
    Ti.API.info(<span class="hljs-string">'USERS['</span> + index + <span class="hljs-string">'] ('</span> + user.<span class="hljs-keyword">get</span>(<span class="hljs-string">'username'</span>) + <span class="hljs-string">')'</span>);
});
</code></pre><p>console results</p>
<pre><code class="hljs">[INFO] :   Launching application in iOS Simulator
[INFO] :   Application started
[INFO] :   TesteSQLite/1.0 (3.0.2.GA.5a77fe7)
[INFO] :   <span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span> USERS BEFORE <span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span>
[INFO] :   USERS COUNT 0
[INFO] :   <span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span> CREATE UNIQUE USER <span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span>
[INFO] :   NEW (teste)
[INFO] :   <span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span> USERS AFTER <span class="hljs-keyword">*</span><span class="hljs-keyword">*</span><span class="hljs-keyword">*</span>
[INFO] :   USERS COUNT 1
[INFO] :   USERS[0] (teste)
</code></pre></div>
							<div class="author">
								&mdash; commented <span title="May 20th 2013, 12:10:13 pm">May 20th 2013</span>
								by <span class='authorname'>Arley Andrada Maria</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-263032">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>You need to fetch the data from persistence before it will be present in your app.</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> users = Alloy.createCollection(<span class="hljs-string">'user'</span>);

users.fetch();

Ti.API.info(<span class="hljs-string">'*** USERS BEFORE ***'</span>);
Ti.API.info(<span class="hljs-string">'USERS COUNT '</span> + users.length);
users.<span class="hljs-keyword">each</span>(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(user, index)</span> </span>{
    Ti.API.info(<span class="hljs-string">'USERS['</span> + index + <span class="hljs-string">'] ('</span> + user.<span class="hljs-keyword">get</span>(<span class="hljs-string">'username'</span>) + <span class="hljs-string">')'</span>);
});
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 20th 2013, 12:43:08 pm">May 20th 2013</span>
								by <span class='authorname'>Tony Lukasavage</span><br>
								<a class="icon-bg icon-link" href="../../question/152595/alloy-not-saving.html#answer-263032" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Wow! Very simple! Thank you!</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 20th 2013, 1:08:15 pm">May 20th 2013</span>
											by <span class='authorname'>Arley Andrada Maria</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>2</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
