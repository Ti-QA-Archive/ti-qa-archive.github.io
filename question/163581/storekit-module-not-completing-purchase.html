<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Storekit Module not completing purchase. » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Storekit Module not completing purchase.</h1>
		</header>
		<section>
			<p>Hi,</p>
<p>I have created an alloy project and setup the project with the example from </p>
<p>https:&#x2F;&#x2F;gist.github.com&#x2F;dawsontoth&#x2F;1448587</p>
<p>It all works fine and I can click buy for the product but the code never confirms that a purchase has been made. I did have to modify the purchase product function to the following as I received an error message about zero quantity, so I have added the quantity. But it seems that the function doesn&#39;t fire to complete the process. I also added two alerts and I get the &#39;starting&#39; alert but not alert &#39;one&#39; </p>
<p>My code</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">purchaseProduct</span><span class="hljs-params">(product)</span> </span>{
    showLoading();
    alert(<span class="hljs-string">'starting'</span>);
    Storekit.purchase(product, <span class="hljs-number">1</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(evt)</span> </span>{
        alert(<span class="hljs-string">'one'</span>);
        hideLoading();
        <span class="hljs-keyword">switch</span> (evt.state) {
            <span class="hljs-keyword">case</span> Storekit.FAILED:
                alert(<span class="hljs-string">'ERROR: Buying failed!'</span>);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> Storekit.PURCHASED:
                alert(<span class="hljs-string">'Thanks! All Done'</span>);
                markProductAsPurchased(product.identifier);
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">case</span> Storekit.RESTORED:
                alert(<span class="hljs-string">'Thanks!'</span>);
                markProductAsPurchased(product.identifier);
                <span class="hljs-keyword">break</span>;
        }
    });
}
</code></pre><p>The end results is nothing is purchased, i get messages saying that its been purchased but not downloaded and i can&#39;t restore anything. So how do I get the process to flow and complete the transaction?</p>
<p>Thanks in advance…</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="March 15th 2014, 5:49:12 pm">March 15th 2014</span>
				by <span class='authorname'>Ian Newman</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>in app purchase</span></li>
					
						<li><span class='tagname'>iphone</span></li>
					
						<li><span class='tagname'>storekit</span></li>
					
						<li><span class='tagname'>ti.storekit</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Trying to install myself. I read passing seperated arguments is deprecated?<br>Not sure if that is your problem, although also read that the quantity should be 1 as default and having no quantity doesn&#39;t seem to work for me either.</p>
<p>If I work it out ill let you know!<br>Dave</p>
<pre><code class="hljs">purchase(args[<span class="hljs-built_in">object</span>])

Purchases the Ti.Storekit.Product <span class="hljs-built_in">object</span> passed <span class="hljs-keyword">to</span> it. The transactionState <span class="hljs-keyword">event</span> <span class="hljs-keyword">is</span> fired <span class="hljs-keyword">when</span> the purchase request<span class="hljs-comment">'s state changes.</span>

Takes one argument, a dictionary <span class="hljs-keyword">with</span> the following values:

product[Ti.Storekit.Product]: The product <span class="hljs-keyword">to</span> be purchased.
quantity[number] (<span class="hljs-keyword">optional</span>): The quantity <span class="hljs-keyword">to</span> be purchased. Has a <span class="hljs-keyword">default</span> value <span class="hljs-keyword">of</span> <span class="hljs-number">1.</span>
applicationUsername[<span class="hljs-built_in">string</span>] (<span class="hljs-keyword">optional</span>): An opaque identifier <span class="hljs-keyword">for</span> the user<span class="hljs-comment">'s account on your system. Used by Apple to detect irregular activity. Should hash the username before setting. Available in iOS 7.0 and later.</span>
DEPRECATED: Passing separate arguments purchase(<span class="hljs-built_in">object</span>, quantity[int, <span class="hljs-keyword">optional</span>]). Use a dictionary <span class="hljs-keyword">of</span> arguments <span class="hljs-keyword">as</span> seen above.
</code></pre></div>
							<div class="author">
								&mdash; commented <span title="April 21st 2014, 12:29:06 pm">April 21st 2014</span>
								by <span class='authorname'>david brewer</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-277985">
				
						<section>
							<p>Yep, so just had this similar issue.</p>
<p>Basically the example code is out of date. You need to refactor to adhere to the note I pasted above.<br>I passed the parameters in using an object instead (like below) to avoid using separate arguments which is deprecated:</p>
<pre><code class="hljs">var productDict = {product:product, quantity:1}<span class="hljs-comment">;</span>
      purchaseProduct(productDict)<span class="hljs-comment">;</span>
</code></pre><p>I would also note that quantity seemed to be required (rather than optional and def to 1 as stated).</p>
<p>The callbacks for you are also not working as the callback function is an additional parameter in the original example.<br>What you need to do is add an eventListener (which makes perfect sense) something like this:</p>
<pre><code class="hljs">Storekit.addEventListener(<span class="hljs-string">'transactionState'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span>{
    alert(<span class="hljs-string">'transactionState: '</span> + e);
    hideLoading();
  <span class="hljs-keyword">switch</span> (e.state) {
    <span class="hljs-keyword">case</span> Storekit.FAILED:
      alert(<span class="hljs-string">'ERROR: Buying failed!'</span>);
      <span class="hljs-keyword">break</span>;
    <span class="hljs-keyword">case</span> Storekit.PURCHASED:
    <span class="hljs-keyword">case</span> Storekit.RESTORED:
      alert(<span class="hljs-string">'Thanks!'</span>);
      <span class="hljs-comment">//markProductAsPurchased(product.identifier);</span>
      <span class="hljs-keyword">break</span>;
  }
});
</code></pre><p>And you should get your responses.<br>Everything was working for you but I guess you were missing the event response which will provide the final payload or info.</p>
<p>By running this in xCode and installing to your device, the log shows any errors for you and is in sandbox mode. It just takes ages each time you need to make a change.<br>;-p!</p>
<p>Hope that clears things up if you gave in.<br>EnjoY!<br>Dave</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 21st 2014, 1:46:15 pm">April 21st 2014</span>
								by <span class='authorname'>david brewer</span><br>
								<a class="icon-bg icon-link" href="question/163581/storekit-module-not-completing-purchase.html#answer-277985" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
