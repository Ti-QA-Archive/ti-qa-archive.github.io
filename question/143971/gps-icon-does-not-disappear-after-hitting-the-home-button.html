<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>GPS icon does not disappear after hitting the home button » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>GPS icon does not disappear after hitting the home button</h1>
		</header>
		<section>
			<p>Before being told that I need to remove any Geolocation listener which I have already tried, please check the following scenario:</p>
<p>Tested on iPhone 4 with 5.1<br>Titanium SDK: 2.1.3 Mac</p>
<ol>
<li>Create a new mobile app project. After project has been created open the app.js file, remove its content and replace it with:</li>
</ol>
<pre><code class="hljs"><span class="hljs-variable"><span class="hljs-keyword">var</span> mapview</span> = Titanium.Map.createView({
        mapType: Titanium.Map.STANDARD_TYPE,
        animate:<span class="hljs-literal">true</span>,
        regionFit:<span class="hljs-literal">true</span>,
        userLocation:<span class="hljs-literal">true</span>,
        annotations:[]
    });
<span class="hljs-variable"><span class="hljs-keyword">var</span> win</span> = Ti.UI.createWindow();
win.add(mapview);
win.<span class="hljs-keyword">open</span>();
</code></pre><ol>
<li>Have a provisioning profile prepped and send the app to the iphone device.</li>
<li>Run the app, when the current location has been resolved, hit the home button.</li>
<li><p>Wait a few seconds, the GPS status indicator should turn off but it doesnt.</p>
</li>
<li><p>Download the KitchenSink app.</p>
</li>
<li>Open app.js and replace content with the code snippet in step 1.</li>
<li>Use the provisioning profile to send this app to the iphone device.</li>
<li>Run the app, when the current location has been resolved, hit the home button.</li>
<li>Wait a few seconds, the GPS status indicator should turn off and it does.</li>
</ol>
<p>So it appears to work with kitchen sink but not with a new app. What am I missing to ensure the icon goes away on my apps. I doubt there is an event listener lurking in kitchen sink that sets the MapView.userLocation to false, as I had overwritten app.js and also as an extra step removed all platform and resource code. What gives??</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="October 25th 2012, 2:00:49 pm">October 25th 2012</span>
				by <span class='authorname'>Christopher Stea</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>gps</span></li>
					
						<li><span class='tagname'>iphone</span></li>
					
						<li><span class='tagname'>mapview</span></li>
					
				</ul>
			

			<section>
				<h5>14 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Also, as soon as I change the app id in kitchen sink, it breaks it and starts acting like the new app scenario (GPS status icon stays on after hitting home)</p>
</div>
							<div class="author">
								&mdash; commented <span title="October 25th 2012, 2:48:16 pm">October 25th 2012</span>
								by <span class='authorname'>Christopher Stea</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Hi Christopher,</p>
<p>I&#39;ve tried on an iPhone 4 with iOS 6 using TiSDK 2.1.3 and it worked fine for me (GPS status indicator turned off as expected when pressing the Home button).<br>I will try it on an iPhone with iOS 5.1 (on the 5.1 simulator works fine for me too)</p>
</div>
							<div class="author">
								&mdash; commented <span title="October 25th 2012, 4:00:29 pm">October 25th 2012</span>
								by <span class='authorname'>Federico Casali</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Yes it works on 5.1 simulator for me and on an IOS6 device. Its 5.1 device where it doesnt work</p>
</div>
							<div class="author">
								&mdash; commented <span title="October 25th 2012, 4:03:29 pm">October 25th 2012</span>
								by <span class='authorname'>Christopher Stea</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Funny thing is that i created 2 provisioning profiles, one called qa and another called kitchensink. If i use the provision profile called kitchensink it works, if i use qa, it leaves it on…</p>
</div>
							<div class="author">
								&mdash; commented <span title="October 25th 2012, 4:10:21 pm">October 25th 2012</span>
								by <span class='authorname'>Christopher Stea</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Are they provisioning profiles both created in exactly the same context in your provisioning portal? Literally the only difference is the names? Just want to add that I tested this on a 5.1 iPhone 4 device and couldn&#39;t reproduce the issue either I&#39;m afraid.</p>
</div>
							<div class="author">
								&mdash; commented <span title="October 25th 2012, 6:46:38 pm">October 25th 2012</span>
								by <span class='authorname'>Daniel Sefton</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Yes, I created them today through the same Provisioning Portal. Ive noticed that changing the provisioning profile also affects it on the simulator for me. And sometimes it would work on the simulator but not the device. Is there any other way to force the GPS to turn off? Keeping in mind that I al already aware of the need to remove any location listeners. Im desperate as already some clients complained about battery and the need to remove the app to get it to stop.</p>
</div>
							<div class="author">
								&mdash; commented <span title="October 25th 2012, 6:55:27 pm">October 25th 2012</span>
								by <span class='authorname'>Christopher Stea</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>It could be that your app is crashing when it enters the background - does it restore its state or does the splash screen show again when re-opening it? An alternative to tell your customers besides deleting your app is to disable location services for it by going to Settings -&gt; Privacy -&gt; Location Services -&gt; Toggle App. You will also notice an arrow next to the toggle button, if it&#39;s purple the app is actively using location services.</p>
</div>
							<div class="author">
								&mdash; commented <span title="October 26th 2012, 2:32:36 pm">October 26th 2012</span>
								by <span class='authorname'>Daniel Sefton</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>It restores its state and not crashing. I suspected just a corrupt install on my dev machine, so I set myself up on another mac, and the GPS turns off on the simulator but not on the device. I also notice that even then setting the MapView.userLocation to false, if i take away all of my gps snippets, it still prompts that the app wants to use GPS. If i comment out win.app(MapView) no prompts appears so it looks like the map is opening a hidden connection to GPS, thus leaving it on. I&#39;ve also tried win.remove(MapView), Mapview = null no dice :(</p>
</div>
							<div class="author">
								&mdash; commented <span title="October 26th 2012, 3:49:51 pm">October 26th 2012</span>
								by <span class='authorname'>Christopher Stea</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>This for example, turns on the GPS on my device:</p>
<pre><code class="hljs">
<span class="hljs-keyword">var</span> win = Ti.UI.currentWindow;


<span class="hljs-comment"><span class="markdown">/**
 * Map view object
 * @param object (Titanium.UI.MapView)
 */</span></span>
<span class="hljs-keyword">var</span> MapView = Ti.<span class="hljs-built_in">Map</span>.createView({
    mapType: Ti.<span class="hljs-built_in">Map</span>.STANDARD_TYPE,
    animate: <span class="hljs-keyword">true</span>,
    regionFit: <span class="hljs-keyword">true</span>,
    userLocation: <span class="hljs-keyword">false</span>,
    top: <span class="hljs-number">0</span>,
    left: <span class="hljs-number">0</span>,

});
win.add(MapView);
</code></pre><p>can someone try this snippet and see if the app requests access to the GPS?</p>
</div>
							<div class="author">
								&mdash; commented <span title="October 26th 2012, 5:19:11 pm">October 26th 2012</span>
								by <span class='authorname'>Christopher Stea</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Mr. Federico Casali: can you tell me what XCode you are using as well as the OS? I created a clean VM with OSX Lion, XCode 4.2.1 running Titanium 2.1.3 and 2.0, compiled the kitchen sink onto an iphone4 with iOS 5.1 and the GPS icon doesnt turn off for kitchen sink either.</p>
</div>
							<div class="author">
								&mdash; commented <span title="November 5th 2012, 12:31:54 pm">November 5th 2012</span>
								by <span class='authorname'>Christopher Stea</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Christopher - </p>
<p>we are using Xcode 4.5, Titanium SDK 2.1.3 GA (and also latest 3.x branch).<br>Both OSX Lion and Mountain Lion, tried on an iPhone 4 with iOS 6 and on another one with iOS 5.1</p>
</div>
							<div class="author">
								&mdash; commented <span title="November 6th 2012, 4:26:38 pm">November 6th 2012</span>
								by <span class='authorname'>Federico Casali</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Thanks for the info. Ive managed to fix the issue by making a minor change in Geolocation.mm, function shutdownLocationManager i needed to comment out RELEASE_TO_NIL_AUTORELEASE(locationManager); and add an extra [locationManager stopUpdatingLocation]; in its place. Odd because I had confirmed that [locationManager stopUpdatingLocation]; is being invoked when all listenersa re removed. Looks like releasing the object before it has a chance to turn off the indicator leaves the indicator on, even is GPS is in fact off.</p>
</div>
							<div class="author">
								&mdash; commented <span title="November 6th 2012, 4:36:12 pm">November 6th 2012</span>
								by <span class='authorname'>Christopher Stea</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Interesting… I&#39;d definitely say a JIRA needs to be filed for this. Would you mind reporting your findings in a new issue at <a href="http:&#x2F;&#x2F;jira.appcelerator.org&#x2F;">http:&#x2F;&#x2F;jira.appcelerator.org&#x2F;</a>? Thanks a lot!</p>
</div>
							<div class="author">
								&mdash; commented <span title="November 8th 2012, 8:10:07 pm">November 8th 2012</span>
								by <span class='authorname'>Daniel Sefton</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Done. Ive comfirmed that by commenting out the release of the object it fixes the problem: http:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TC-1483</p>
</div>
							<div class="author">
								&mdash; commented <span title="November 8th 2012, 8:28:56 pm">November 8th 2012</span>
								by <span class='authorname'>Christopher Stea</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-250094">
				
						<section>
							<p>Further inspection, my app is opening two connections to CLLocation manager when starting the app: http:&#x2F;&#x2F;d.pr&#x2F;i&#x2F;hNgm, http:&#x2F;&#x2F;d.pr&#x2F;i&#x2F;DutB. When pausing the app, the instance called by &quot;libdispatch.dylib&quot; remains allocated, which explains why the GPS icon is still on. Any ideas on why this second instance is opening?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="October 28th 2012, 3:32:10 am">October 28th 2012</span>
								by <span class='authorname'>Christopher Stea</span><br>
								<a class="icon-bg icon-link" href="question/143971/gps-icon-does-not-disappear-after-hitting-the-home-button#answer-250094" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-250095">
				
						<section>
							<p>FYI I am also seeing a CLLocation allocated after opening the Map View in the Kitchen Sink</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="October 28th 2012, 4:06:23 am">October 28th 2012</span>
								by <span class='authorname'>Christopher Stea</span><br>
								<a class="icon-bg icon-link" href="question/143971/gps-icon-does-not-disappear-after-hitting-the-home-button#answer-250095" rel="permalink">permalink</a>
							</div>

							<h5>3 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>I have a similar issue, the compass icon still on screen when I press home button. Do you have solved this problem?</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 11th 2013, 7:22:53 am">August 11th 2013</span>
											by <span class='authorname'>Javier Hdez</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Yes I did. Other than ensuring that you are removing the listeners as most forum posts would suggest, make sure to do a Settings &gt; General &gt; Reset &gt; Reset Location &amp; Privacy. Seems like when changing the app id and profile it causes conflicts, this should flush it out.</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 11th 2013, 1:34:10 pm">August 11th 2013</span>
											by <span class='authorname'>Christopher Stea</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Thanks for your reply Christopher! also I disabled setTrackSignificantLocationChange before I remove the listener of geolocation.</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 12th 2013, 8:10:56 am">August 12th 2013</span>
											by <span class='authorname'>Javier Hdez</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
