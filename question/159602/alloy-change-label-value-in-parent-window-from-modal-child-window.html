<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Alloy: Change Label Value in Parent Window from modal Child Window. » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Alloy: Change Label Value in Parent Window from modal Child Window.</h1>
		</header>
		<section>
			<p>I&#39;m trying to do something similar to <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;144078&#x2F;alloy-id-selection--issue">this post</a> where I have a TAB with a modal child window that allows the user to set a value. On closing the child window I want to set the text value of a label to that value BEFORE the window begins to close (onClick) of the close button. </p>
<p>I was able to get it working a different way… with a listener in search.js on the child window&#39;s &quot;close&quot; event but that only changed the value after the window was off screen. Visually the users sees the value changing which seems ugly.</p>
<p>I tried replicating what the above mentioned post suggested but I think I&#39;m missing some important concept in all this. I&#39;m new to Alloy so still wrapping my head around controllers and such. </p>
<p>With the code below, I keep getting undefined errors in my child window controller when I close it by calling &quot;closeWindow&quot;. Any help is GREATLY appreciated. </p>
<p>index.xml</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">Alloy</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">TabGroup</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Require</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"search"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"searchController"</span> /&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Require</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"settings"</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"settingsController"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">TabGroup</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">Alloy</span>&gt;</span>
</code></pre><p>search.xml</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">Alloy</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">Tab</span> <span class="hljs-attribute">title</span>=<span class="hljs-value">"Search"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">Window</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">TableView</span>&gt;</span>
                <span class="hljs-tag">&lt;<span class="hljs-title">TableViewSection</span> <span class="hljs-attribute">class</span>=<span class="hljs-value">"tablesection"</span> <span class="hljs-attribute">headerTitle</span>=<span class="hljs-value">"Search"</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">TableViewRow</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">Label</span>&gt;</span>Keyword<span class="hljs-tag">&lt;/<span class="hljs-title">Label</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">TextField</span> <span class="hljs-attribute">clearOnEdit</span>=<span class="hljs-value">"true"</span>/&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">TableViewRow</span>&gt;</span>
                    <span class="hljs-tag">&lt;<span class="hljs-title">TableViewRow</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"filetypes_row"</span> <span class="hljs-attribute">onClick</span>=<span class="hljs-value">"openFileTypeSelector"</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">Label</span>&gt;</span>File Types<span class="hljs-tag">&lt;/<span class="hljs-title">Label</span>&gt;</span>
                        <span class="hljs-tag">&lt;<span class="hljs-title">Label</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"filetypes_set"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">Label</span>&gt;</span>
                    <span class="hljs-tag">&lt;/<span class="hljs-title">TableViewRow</span>&gt;</span>
                <span class="hljs-tag">&lt;/<span class="hljs-title">TableViewSection</span>&gt;</span>
            <span class="hljs-tag">&lt;/<span class="hljs-title">TableView</span>&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">Window</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">Tab</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">Alloy</span>&gt;</span>
</code></pre><p>search.js</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openFileTypeSelector</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">var</span> fileTypesController = Alloy.createController(<span class="hljs-string">'fileTypeSelector'</span>);
        <span class="hljs-keyword">var</span> fileTypesWin = fileTypesController.getView();
        fileTypesWin.open({ modal:<span class="hljs-literal">true</span>, navBarHidden:<span class="hljs-literal">false</span> });
}
</code></pre><p>fileTypeSelector.js</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">closeWindow</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> ftypes = Alloy.Globals.setFileTypeList();
    $.searchController.updateFileTypes( ftypes );
    $.fileTypeSelector.close();
}
</code></pre><p>alloy.js</p>
<pre><code class="hljs">Alloy.Globals.setFileTypeList = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">var</span> recoverDatabase = Alloy.createCollection(<span class="hljs-string">"fileTypes"</span>);
    <span class="hljs-keyword">var</span> filetypelist = <span class="hljs-string">""</span>;
    <span class="hljs-comment">//We need the database to iterate through it</span>
    recoverDatabase.fetch({query:<span class="hljs-string">"SELECT * FROM fileTypes where hasCheck = 1"</span>});
    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;recoverDatabase.length;i++){
        filetypelist += recoverDatabase.at(i).<span class="hljs-keyword">get</span>(<span class="hljs-string">"title"</span>) + <span class="hljs-string">", "</span>;
    }
    filetypelist = filetypelist.slice(<span class="hljs-number">0</span>, -<span class="hljs-number">2</span>);
    <span class="hljs-keyword">return</span> filetypelist;
};
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="November 18th 2013, 4:58:11 pm">November 18th 2013</span>
				by <span class='authorname'>Dave F</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>alloy</span></li>
					
						<li><span class='tagname'>controller</span></li>
					
						<li><span class='tagname'>ios</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>The error I get is</p>
<pre><code class="hljs"><span class="hljs-string">'undefined'</span> <span class="hljs-keyword">is</span> not an <span class="hljs-keyword">object</span> (evaluating <span class="hljs-string">'$.searchController.updateFileTypes'</span>)
</code></pre></div>
							<div class="author">
								&mdash; commented <span title="November 18th 2013, 5:01:02 pm">November 18th 2013</span>
								by <span class='authorname'>Dave F</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Ugh. I&#39;m sorry. This is my <strong>search.js</strong> file. I left off my exports function.</p>
<pre><code class="hljs">exports.updateFileTypes = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ftypes</span>) </span>{
    $.filetypes_set.setText(ftypes);
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openFileTypeSelector</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> fileTypesController = Alloy.createController(<span class="hljs-string">'fileTypeSelector'</span>);
        <span class="hljs-keyword">var</span> fileTypesWin = fileTypesController.getView();
        fileTypesWin.open({ modal:<span class="hljs-literal">true</span>, navBarHidden:<span class="hljs-literal">false</span> });
}
</code></pre></div>
							<div class="author">
								&mdash; commented <span title="November 18th 2013, 5:07:20 pm">November 18th 2013</span>
								by <span class='authorname'>Dave F</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-271452">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>Hi</p>
<p>You are complicating things by returning the window and opening it up in the calling controller, rather than leaving the work to the modal controller and let it return the thing you need.</p>
<p>If I read this correctly you want to be able to display a modal window, have something occur on that window and when it is closed one or more values can be updated?</p>
<p>Your should be making your life a bit easier and leaving some things for the TSS;</p>
<p><strong>fileTypeSelector.tss</strong></p>
<pre><code class="hljs"><span class="hljs-comment">// merge with your own</span>
<span class="hljs-string">"Window"</span>: {
    modal: <span class="hljs-literal">true</span>,
    navBarHidden: falase
}
</code></pre><p>Open the window inside the controller once you have set a few parameters;</p>
<p><strong>fileTypeSelector.js</strong></p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> args = <span class="hljs-built_in">arguments</span>[<span class="hljs-number">0</span>] || {};

<span class="hljs-comment">// assumes you have a close or action button somewhere</span>
$.close.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
    <span class="hljs-comment">// do whatever you would normally do</span>

    <span class="hljs-comment">// then if set pass back any value you want to the function that called this</span>
    <span class="hljs-keyword">if</span> (args.beforeClose) {
        args.beforeClose({
            firstname: <span class="hljs-string">'Malcolm'</span>,
            otherproperty: <span class="hljs-string">'Hello'</span>,
            <span class="hljs-comment">// anything you like</span>
            resultofafuncitioncall: arr
        });
    }
    <span class="hljs-comment">// assumes the window is called "win"</span>
   <span class="hljs-comment">// THEN close</span>
   $.win.close();
});

<span class="hljs-comment">// your other code</span>

<span class="hljs-comment">// open window inside here - much smarter - make this stand alone</span>
win.open();
</code></pre><p><strong>search.js</strong> snippet</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">openFileTypeSelector</span>(<span class="hljs-params"></span>) </span>{
    Alloy.createController(<span class="hljs-string">'fileTypeSelector'</span>, {
        beforeClose: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
            <span class="hljs-comment">// this returns those three properties above</span>
            <span class="hljs-comment">// or whatever you choose</span>
            alert(<span class="hljs-built_in">JSON</span>.stringify(e));
            $.filetypes_set.setText(e.resultofafuncitioncall);
            <span class="hljs-comment">// only when this function has finished will the window be closed</span>
            <span class="hljs-comment">// so the display is fine</span>
        }
    });
}
</code></pre><p>This should give you a starting point.</p>
<p>The basic idea is to move visual or presentation elements into the TSS.  Do NOT open stand-alone windows from controllers outside them (at least not when using this technique).  You CAN pass things in and use callbacks inside other controllers.</p>
<p>Nail this and many things get a lot easier in your apps.  </p>
<p>I would consider moving the global function to a CommonJS module in the future - no need to have it there at all.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 18th 2013, 7:02:09 pm">November 18th 2013</span>
								by <span class='authorname'>Malcolm Hollingsworth</span><br>
								<a class="icon-bg icon-link" href="../../question/159602/alloy-change-label-value-in-parent-window-from-modal-child-window.html#answer-271452" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hey Malcolm. I can&#39;t think you enough. Your answer was more than helpful. I got it working and even got my first commonJS module set up. Although, rethinking it. I&#39;m not sure this should even be a global function. It ended up as one as I was experimenting with finding a solution. I may move that function into search.js. Thanks again for your help with this.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 18th 2013, 7:56:04 pm">November 18th 2013</span>
											by <span class='authorname'>Dave F</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>You are very welcome, as I said; experiment with this in other places and you will find in can solve many things you may have solved with work a rounds before.  Trust me I have been there.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 18th 2013, 8:21:01 pm">November 18th 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-271445">
				
						<section>
							<p>Um, am I being daft but from what you show of <code>searchController</code> (search.js) is doesn&#39;t have a method called <code>updateFileTypes</code></p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 18th 2013, 5:05:24 pm">November 18th 2013</span>
								by <span class='authorname'>Nick Milner</span><br>
								<a class="icon-bg icon-link" href="../../question/159602/alloy-change-label-value-in-parent-window-from-modal-child-window.html#answer-271445" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hey Nick. I corrected that in my comment under my post. I hadn&#39;t copied all the text for the forum. I do have that in the exports.updateFileTypes  function. Please see above. Thanks. Any ideas?</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 18th 2013, 5:12:47 pm">November 18th 2013</span>
											by <span class='authorname'>Dave F</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
