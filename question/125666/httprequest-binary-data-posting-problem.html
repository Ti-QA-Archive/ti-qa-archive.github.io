<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>HTTPRequest binary data posting problem » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>HTTPRequest binary data posting problem</h1>
		</header>
		<section>
			<p>I am very new in titanium and I have an annoying problem with posting binary data. I am developing mobile android application and I wanna record an audio file and then post this file via http request to a http server. I have recorded the audio wav file successfully. But when the time comes for posting this file by http request, the problem begins. In the titanium side, the size of the file is 75000 byte for example, on the other side –on my server– I got a buffer with 82000 byte. When I compare the two sides&#39; files with a hex editor the bytes of the server side is not identical of the original one. Therefore, the wav file on the server is corrupted,it does not play. Is there any suspect that the http request in the titanium-project will alter the bytes? May be cast to string? Because I faced the same problem when listening network traffic via WireShark. In WireShark there comes manipulated byte data from http. </p>
<p>Please help..</p>
<p>Here is my code ;</p>
<p>Client : </p>
<p>sendBtn.addEventListener(&#39;click&#39;, function(e) {<br>    var client=Titanium.Network.createHTTPClient();</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> uploadFile = Titanium.Filesystem.getFile(sd_card_path,<span class="hljs-string">'myfile.ulaw'</span>);
<span class="hljs-keyword">var</span> content = uploadFile.read();
<span class="hljs-keyword">var</span> boundary = <span class="hljs-string">'----12345568790'</span>;

Ti.API.info(<span class="hljs-string">'content = '</span> + content);
Ti.API.info(<span class="hljs-string">'content.length = '</span>+content.length);

client.open(<span class="hljs-string">"POST"</span>,<span class="hljs-string">"http://172.20.143.47:8080/MyProject/mediaHandler"</span>);
client.setRequestHeader(<span class="hljs-string">"Content-type"</span>, <span class="hljs-string">"multipart/form-data; boundary=\""</span> + boundary + <span class="hljs-string">"\""</span>);  
client.setRequestHeader(<span class="hljs-string">"Connection"</span>, <span class="hljs-string">"close"</span>);
<span class="hljs-comment">//client.setRequestHeader('Content-Type', 'audio/basic');</span>
client.send(content);
client.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{  
   <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.readyState == <span class="hljs-number">4</span>){  
      alert(<span class="hljs-keyword">this</span>.responseText);  
   }  
}
</code></pre><p>});</p>
<p>Server : </p>
<p>protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {<br>        String header = request.getHeader(&quot;Content-Type&quot;);<br>        System.out.println(&quot;header : &quot;+header);<br>        ServletInputStream stream = request.getInputStream();<br>        System.out.println(request.getContentLength());<br>        byte b = (byte)stream.read();<br>        String strFilePath = &quot;C:&#x2F;&#x2F;Media&#x2F;&#x2F;demo.ulaw&quot;;<br>        File f = new File(strFilePath);<br>        FileOutputStream fos = new FileOutputStream(strFilePath);<br>        String length = &quot;&quot;;<br>        int contentLength = 0;<br>        boolean writeToFile = false;<br>        int i = 0;<br>        while (b!=-1){<br>            i++;<br>            fos.write(b);<br>            System.out.print((char)b);<br>            b = (byte)stream.read();<br>        }<br>        System.out.println(&quot;i : &quot;+i);<br>        fos.close();<br>    }</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="September 16th 2011, 11:27:25 am">September 16th 2011</span>
				by <span class='authorname'>emin özcan</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>audio</span></li>
					
						<li><span class='tagname'>httpclient</span></li>
					
						<li><span class='tagname'>sound</span></li>
					
						<li><span class='tagname'>xhr</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>0</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>0 Answers</h3>

	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
