<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Camera image files too large - compression option? » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Camera image files too large - compression option?</h1>
		</header>
		<section>
			<p>Mobile<br>Titanium 3.1.1<br>IOS - IPhone device 4S(although needs to work on Android as well)<br>Mac OS X</p>
<p>I have an app that requires the user to take up to 12 pictures and display them in imageviews on the screen.  The images are initially stored in the filesystem appdirectory, and will then be uploaded to server after.  The app crashed after just a few pictures due to lack of memory, and I cant seem to get the file sizes to compress or reduce.  I&#39;ve tried .toImage(), .toImage().media, .imageAsResized, and (image.width&#x2F;4, image.height&#x2F;4)……  nothing seems to work.  I&#39;ve also seen posts that say if you just resize in an imageView and send the imageView.toImage(), that should work.  It doesn&#39;t work either.  Theres got to be a way to resize not just the image display but filesize that is saved to the local filesystem…. right?  If not are there any other options to make this feature work?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="August 9th 2013, 2:38:50 pm">August 9th 2013</span>
				by <span class='authorname'>Jenna Harris</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>compression</span></li>
					
						<li><span class='tagname'>images</span></li>
					
						<li><span class='tagname'>memory</span></li>
					
						<li><span class='tagname'>mobile</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Hello,</p>
<p>just create the view&#39;s images, as in <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;149333&#x2F;converting-view-to-image-and-saving-it-as-png-or-jpg">this example</a>. </p>
<p>Best,</p>
<p>Mauro</p>
</div>
							<div class="author">
								&mdash; commented <span title="August 9th 2013, 4:52:17 pm">August 9th 2013</span>
								by <span class='authorname'>Mauro Parra</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>I&#39;ve tried that, both toImage() and .toImage().media, neither works unfortunately</p>
</div>
							<div class="author">
								&mdash; commented <span title="August 9th 2013, 5:04:14 pm">August 9th 2013</span>
								by <span class='authorname'>Jenna Harris</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-267034">
				
						<section>
							<p>Take a look at the <a href="https:&#x2F;&#x2F;marketplace.appcelerator.com&#x2F;apps&#x2F;4973?601073086">imagefactory module</a></p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="August 9th 2013, 2:54:45 pm">August 9th 2013</span>
								by <span class='authorname'>Stephen Feather</span><br>
								<a class="icon-bg icon-link" href="question/155839/camera-image-files-too-large---compression-option.html#answer-267034" rel="permalink">permalink</a>
							</div>

							<h5>3 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>that looked promising, but it doesn&#39;t work either…  could it be because I&#39;m using titanium 3.1.1?  I used it exactly like the example, but the app still crashes after the exact same number of images. I even used the compressed image file as the image in the imageView instead of event.media. Is it just that there is not enough memory in a mobile device to display more than a couple images at a time?</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2013, 4:57:59 pm">August 9th 2013</span>
											by <span class='authorname'>Jenna Harris</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>So even when I try and delete each file after use the app still crashes, could this be because the images are still being displayed in an imageview?  Here is a code block for one imageview:</p>
<pre><code class="hljs">picView12.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    Ti.Media.showCamera({

        success:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>)
        </span>{
            <span class="hljs-keyword">var</span> cropRect = event.cropRect;
            <span class="hljs-keyword">var</span> image = event.media;

            Ti.API.debug(<span class="hljs-string">'Our type was: '</span>+event.mediaType);
            <span class="hljs-keyword">if</span>(event.mediaType == Ti.Media.MEDIA_TYPE_PHOTO)
            {

                <span class="hljs-keyword">var</span> imageView = Ti.UI.createImageView({
                    borderRadius:<span class="hljs-number">10</span>,
                    top:<span class="hljs-string">"59%"</span>,
                    right:<span class="hljs-string">"5%"</span>,
                    height:<span class="hljs-string">"14%"</span>,
                    width:<span class="hljs-string">"20%"</span>,
                });
                win.add(imageView);    

                <span class="hljs-keyword">var</span> filename = Titanium.Filesystem.applicationDataDirectory + <span class="hljs-string">"/"</span>+ <span class="hljs-string">'picNum'</span> +     <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime() + <span class="hljs-string">".png"</span>;
                <span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(filename);
                <span class="hljs-keyword">if</span> (f.exists()) {
                    Ti.API.info(<span class="hljs-string">'The file exist , trying to delete it before using it :'</span> + f.deleteFile());
                    f = Titanium.Filesystem.getFile(filename);
                }
                f.write(image);
                <span class="hljs-keyword">var</span> blob = f.read();
                newBlob = ImageFactory.compress(blob, <span class="hljs-number">0.0</span>);
                imageView.image = newBlob;
                f.deleteFile(filename);
                <span class="hljs-comment">//f = Titanium.Filesystem.getFile(filename);</span>
                <span class="hljs-comment">//f.write(newBlob);</span>

            }
            <span class="hljs-keyword">else</span>
            {
                alert(<span class="hljs-string">"got the wrong type back ="</span>+event.mediaType);
            }
        },
        cancel:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)
        </span>{
        },
        error:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>)
        </span>{

            <span class="hljs-keyword">var</span> a = Titanium.UI.createAlertDialog({title:<span class="hljs-string">'Camera'</span>});

            <span class="hljs-keyword">if</span> (error.code == Titanium.Media.NO_CAMERA)
            {
                a.setMessage(<span class="hljs-string">'Please run this test on device'</span>);
            }
            <span class="hljs-keyword">else</span>
            {
                a.setMessage(<span class="hljs-string">'Unexpected error: '</span> + error.code);
            }

            a.show();
        },
        saveToPhotoGallery:<span class="hljs-literal">false</span>,
        allowEditing:<span class="hljs-literal">false</span>,
        mediaTypes:[Ti.Media.MEDIA_TYPE_VIDEO,Ti.Media.MEDIA_TYPE_PHOTO]
    });

});
</code></pre><p>what am I doing wrong?</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2013, 5:42:37 pm">August 9th 2013</span>
											by <span class='authorname'>Jenna Harris</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I would save the image from the camera to storage. Resize the image, save to storage (your choice on overwriting, or a smaller thumbnail) then reference that file from your image view.  my guess is you have too much stuff sitting in memory.</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2013, 5:49:26 pm">August 9th 2013</span>
											by <span class='authorname'>Stephen Feather</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-267044">
				
						<section>
							<p>Where exactly crashes? When displaying the images or when you try to send them or on compression?<br>Also what platform?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="August 9th 2013, 5:40:33 pm">August 9th 2013</span>
								by <span class='authorname'>Dan Tamas</span><br>
								<a class="icon-bg icon-link" href="question/155839/camera-image-files-too-large---compression-option.html#answer-267044" rel="permalink">permalink</a>
							</div>

							<h5>10 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>IOS device 4S - depending on the device (all iPhone 4S&#39;s) it crashes after either 4 or 5 pictures or after 7 or 8 pictures.  The app works like this: a user takes a picture and that picture gets displayed in an imageView.  Then the user clicks on another button and another picture gets taken and displayed (all pics are displayed on screen, none of them go away after another picture is taken).  The app crashes mid picture taking.  I never get to the point where I get to send them to the server, it seems the crash is just for local storage.  I put in alerts for troubleshooting and it appears the files get compressed, but it still crashes…  I&#39;m stumped!  I posted code above - maybe I&#39;m missing something??</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2013, 5:47:11 pm">August 9th 2013</span>
											by <span class='authorname'>Jenna Harris</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Let&#39;s clean some stuff as you are overloading the memory with too many TiBlobs</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> image = <span class="hljs-keyword">event</span>.media;

Ti.API.debug(<span class="hljs-string">'Our type was: '</span> + <span class="hljs-keyword">event</span>.mediaType);

<span class="hljs-keyword">if</span> (<span class="hljs-keyword">event</span>.mediaType == Ti.Media.MEDIA_TYPE_PHOTO) {

    <span class="hljs-keyword">var</span> imageView = Ti.UI.createImageView({
        borderRadius: <span class="hljs-number">10</span>,
        top: <span class="hljs-string">'59%'</span>,
        right: <span class="hljs-string">'5%'</span>,
        height:<span class="hljs-string">'14%'</span>,
        width: <span class="hljs-string">'20%'</span>,
    });
    win.add(imageView);

        <span class="hljs-keyword">var</span> filename = Titanium.Filesystem.applicationDataDirectory + <span class="hljs-string">'/'</span>+ <span class="hljs-string">'picNum'</span> + <span class="hljs-keyword">new</span> Date().getTime() + <span class="hljs-string">'.png'</span>;
        <span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(filename);

        <span class="hljs-keyword">var</span> newBlob = ImageFactory.compress(image, <span class="hljs-number">0.0</span>);  <span class="hljs-comment">// &lt;- we compress the image directly because it's already a blob</span>
        image = <span class="hljs-keyword">null</span>; <span class="hljs-comment">// &lt;- free the memory from the original blob</span>
        f.write(newBlob);

        imageView.image = f.nativePath;
        newBlob = <span class="hljs-keyword">null</span>; <span class="hljs-comment">// &lt;- free the memory from the newBlob</span>
} <span class="hljs-keyword">else</span> {
    alert( <span class="hljs-string">'got the wrong type back = '</span> + <span class="hljs-keyword">event</span>.mediaType);
}
</code></pre><p>You could also try to get rid of the resizing part and only write the image to the filesystem and set its nativePath to the imageView afterwards but <strong>not forgetting</strong> to set the image blob to null to clean the memory.</p>
<p>Let me know, untested code ;)</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2013, 5:59:30 pm">August 9th 2013</span>
											by <span class='authorname'>Dan Tamas</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Thanks for the code cleanup!  I was able with this code get all pictures without crashing, however the images weren&#39;t showing up.  In order to get the images to show up, I changed imageView.image = f.nativePath to = newBlob, and the images showed up.  And then it crashed again.  So it seems it is crashing due to the number of images displayed on the screen? Eventually I do need to end up with all the images in the appDirectory as well so they can be send to the server….</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2013, 6:49:02 pm">August 9th 2013</span>
											by <span class='authorname'>Jenna Harris</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>It <strong>has</strong> to show up,maybe you are not writing the file and then AFTER  this set the image to f.nativePath?</p>
<p>Also the compress argument <strong>0.0</strong> seems weird to me.<br>You can also try to move the nullification of the blobs at the end after you finished all the work</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2013, 7:07:20 pm">August 9th 2013</span>
											by <span class='authorname'>Dan Tamas</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>You&#39;re absolutely right I didn&#39;t pay attention to that, the images do show up with f.nativePath.  I moved the null statements to the end, but with the images being displayed it still crashes……</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2013, 7:42:35 pm">August 9th 2013</span>
											by <span class='authorname'>Jenna Harris</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>The best thing would be to make a test project and do only this (show the images) I do this with in ArtistBox with lots of images, the only difference boing the fact that the images are remote and I have absolutely no issues.</p>
<p>If you create a test project and <strong>still</strong> crashes, put it somewhere public and I&#39;ll try to have a look. Cannot test on a 4s but I can on a 5 and a 3GS.</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2013, 7:46:01 pm">August 9th 2013</span>
											by <span class='authorname'>Dan Tamas</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Oh  - the compression argument is from the documentation for ImageFactory…  I also tried .25 (as in the example) with no difference….</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2013, 7:47:54 pm">August 9th 2013</span>
											by <span class='authorname'>Jenna Harris</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Did u try to remove the compression and use only the image but in the same manner?</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2013, 7:49:02 pm">August 9th 2013</span>
											by <span class='authorname'>Dan Tamas</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I did try without compression as well, same thing…  the weird part is the app works fine on iPhone 5, no crash.  just iPhone 4S is crashing every time.  It hasn&#39;t been tested on any other platforms yet…  I&#39;ll try and create a test app for this, thanks for all your help!</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2013, 7:57:02 pm">August 9th 2013</span>
											by <span class='authorname'>Jenna Harris</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>:)</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 9th 2013, 7:57:46 pm">August 9th 2013</span>
											by <span class='authorname'>Dan Tamas</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
