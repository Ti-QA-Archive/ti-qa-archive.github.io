<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Reload music player module » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Reload music player module</h1>
		</header>
		<section>
			<p>Hi, I have a table view on a page.<br>Each row is ment to load a different url into a player.<br>If I click on a first row, the player is working fine. However, as soon as I click on another row to load another url, the player is going crazy. Actually it is loading every songs without stopping, loading one, then the next one etc… and never stops looping.<br>it is the same if I create different modules depending on the clicked row with approximately the same code.</p>
<p>How come is that?<br>here is my code:</p>
<p>app.js:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> VARS = <span class="hljs-built_in">require</span> (<span class="hljs-string">'globals'</span>);

<span class="hljs-keyword">var</span> tableview = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tableview'</span>);
tableview.showTableview();
</code></pre><p>tableview.js:</p>
<pre><code class="hljs">exports.showTableview = function(url) {
        <span class="hljs-comment">//<span class="hljs-doctag">TODO:</span> Add params like images/icons</span>

    var tableviewWindow = Titanium.UI.createWindow({
<span class="hljs-label">        height:</span><span class="hljs-string">"100%"</span>,
<span class="hljs-label">        top:</span><span class="hljs-number">0</span>,
<span class="hljs-label">        bottom:</span><span class="hljs-number">107</span>,
    });





   var TheTable = Titanium.UI.createTableView({<span class="hljs-string">top:</span><span class="hljs-number">0</span>,<span class="hljs-string">bottom:</span><span class="hljs-number">107</span>, <span class="hljs-string">backgroundColor:</span>VARS.rowColor,<span class="hljs-string">separatorColor:</span><span class="hljs-string">"black"</span>});

var searchbutton = Titanium.UI.createButton({ <span class="hljs-string">systemButton :</span> Titanium.UI.iPhone.SystemButton.ADD }); tableviewWindow.setRightNavButton(searchbutton);
searchbutton.addEventListener(<span class="hljs-string">'click'</span>, function() {TheTable.top=<span class="hljs-number">50</span>; });

searchbutton.addEventListener(<span class="hljs-string">'return'</span>, function(e)
{
    alert(<span class="hljs-string">'Search button pressed'</span>);
});

var CustomData = [
{<span class="hljs-string">url:</span><span class="hljs-string">"jukebox_lib/mysongs.js"</span>, <span class="hljs-string">flag:</span><span class="hljs-string">'light_heart@2x.png'</span>, <span class="hljs-string">country:</span><span class="hljs-string">"My songs"</span>},
{<span class="hljs-string">url:</span><span class="hljs-string">"jukebox_lib/jukebox.js"</span>, <span class="hljs-string">flag:</span><span class="hljs-string">'light_heart@2x.png'</span>, <span class="hljs-string">country:</span><span class="hljs-string">"Jukebox"</span>},
{<span class="hljs-string">url:</span><span class="hljs-string">"webzine_lib/tumblr.js"</span>, <span class="hljs-string">flag:</span><span class="hljs-string">'light_heart@2x.png'</span>, <span class="hljs-string">country:</span><span class="hljs-string">"Webzine"</span>},
{<span class="hljs-string">url:</span><span class="hljs-string">"label.js"</span>, <span class="hljs-string">flag:</span><span class="hljs-string">'light_heart@2x.png'</span>, <span class="hljs-string">country:</span><span class="hljs-string">"Label"</span>},
{<span class="hljs-string">url:</span><span class="hljs-string">"autres.js"</span>, <span class="hljs-string">flag:</span><span class="hljs-string">'light_more...@2x.png'</span>, <span class="hljs-string">country:</span><span class="hljs-string">"Autres"</span>},


];




var data=[];

    <span class="hljs-keyword">for</span> (var i=<span class="hljs-number">0</span>;i&lt;CustomData.length; i++){

<span class="hljs-keyword">if</span>(i % <span class="hljs-number">2</span> == <span class="hljs-number">0</span>){bgColor= VARS.rowColor}
<span class="hljs-keyword">else</span>{bgColor= VARS.rowOddColor}

    var row = Titanium.UI.createTableViewRow({<span class="hljs-string">height:</span><span class="hljs-number">71</span>, <span class="hljs-string">backgroundColor:</span> bgColor,});

    var flag =  Titanium.UI.createImageView({
<span class="hljs-label">        image:</span>CustomData[i].flag,
<span class="hljs-label">        height:</span><span class="hljs-number">30</span>,
<span class="hljs-label">        left:</span><span class="hljs-number">20</span>,
    });


    var country = Titanium.UI.createLabel({
        <span class="hljs-string">text :</span> CustomData[i].country,
        <span class="hljs-string">color :</span> <span class="hljs-string">'white'</span>,
        <span class="hljs-string">left :</span> <span class="hljs-string">'80'</span>,
        <span class="hljs-string">font :</span> {<span class="hljs-string">fontSize:</span><span class="hljs-number">20</span>,<span class="hljs-string">fontWeight:</span><span class="hljs-string">'bold'</span>},
        <span class="hljs-string">textAlign :</span> <span class="hljs-string">'center'</span>
    });


    row.add(flag);
    row.add(country);
    row.hasChild=<span class="hljs-literal">true</span>;

row.url = CustomData[i].url;
row.titles = CustomData[i].country;

    data.push(row);
};


TheTable.setData(data);

tableviewWindow.add(TheTable);

    TheTable.addEventListener(<span class="hljs-string">'click'</span>, function(e)
{

var MyWindow = require(<span class="hljs-string">'MyWindow'</span>);
MyWindow.showInfo(e.row.titles, { <span class="hljs-string">duration :</span> <span class="hljs-number">500</span> });


var Player = require(<span class="hljs-string">'player'</span>);
Player.player(<span class="hljs-string">"0"</span>);



});



    tableviewWindow.open();



};
</code></pre><p>player.js:</p>
<pre><code class="hljs">exports.player = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">index</span>) </span>{
        <span class="hljs-comment">//<span class="hljs-doctag">TODO:</span> Add params like images/icons</span>

    <span class="hljs-keyword">var</span> playerWindow = Titanium.UI.createWindow({
        height:<span class="hljs-number">107</span>,
        bottom:<span class="hljs-number">0</span>,
        backgroundColor:<span class="hljs-string">"white"</span>
    });


<span class="hljs-keyword">var</span> url = <span class="hljs-string">"http://appstesting.fr/json.txt"</span>;
<span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient({
    onload: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> data=[];
    <span class="hljs-keyword">var</span> images=[];
    <span class="hljs-keyword">var</span> tableData = [];

   json = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.responseText);

        <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; json.database.length; i++) {
<span class="hljs-comment">//        Ti.API.debug(json.database.length);</span>

            one_song = json.database[i];
            Ti.API.info(one_song.MusicId);



        <span class="hljs-keyword">if</span> (one_song.Image || one_song.Titre) {
        images.push(one_song.Image);
         data.push(one_song.MusicId);
        }                   

    }



<span class="hljs-keyword">var</span> leftalbum = Ti.UI.createImageView({width : Titanium.Platform.displayCaps.platformWidth /  <span class="hljs-number">3</span>,height : Titanium.Platform.displayCaps.platformWidth /  <span class="hljs-number">3</span>,bottom : <span class="hljs-number">0</span>,left : <span class="hljs-number">0</span>});
<span class="hljs-keyword">var</span> centeralbum = Ti.UI.createImageView({width : Titanium.Platform.displayCaps.platformWidth /  <span class="hljs-number">3</span>,height : Titanium.Platform.displayCaps.platformWidth /  <span class="hljs-number">3</span>,bottom : <span class="hljs-number">0</span>});
<span class="hljs-keyword">var</span> rightalbum = Ti.UI.createImageView({width : Titanium.Platform.displayCaps.platformWidth /  <span class="hljs-number">3</span>,height : Titanium.Platform.displayCaps.platformWidth /  <span class="hljs-number">3</span>,bottom : <span class="hljs-number">0</span>,right : <span class="hljs-number">0</span>});

playerWindow.add(leftalbum);
playerWindow.add(centeralbum);
playerWindow.add(rightalbum);

<span class="hljs-keyword">var</span> sound = Titanium.Media.createVideoPlayer({ allowBackground: <span class="hljs-literal">true</span>, height:<span class="hljs-number">10</span>, autoplay:<span class="hljs-literal">true</span>, bottom:<span class="hljs-number">0</span>,     left:<span class="hljs-string">"-30dp"</span>, right:<span class="hljs-string">"-10dp"</span> }); 
playerWindow.add(sound);

<span class="hljs-keyword">var</span> startButton = Titanium.UI.createImageView({title:<span class="hljs-string">'Start'</span>, bottom:<span class="hljs-number">18</span>, width:<span class="hljs-number">70</span>, height:<span class="hljs-number">70</span>, visible:<span class="hljs-literal">true</span>, image:<span class="hljs-string">'../images/play.png'</span> });
<span class="hljs-keyword">var</span> pauseButton = Titanium.UI.createImageView({ title:<span class="hljs-string">'Pause'</span>, bottom:<span class="hljs-number">18</span>, width:<span class="hljs-number">70</span>, height:<span class="hljs-number">70</span>, visible:<span class="hljs-literal">false</span>, image:<span class="hljs-string">'../images/pause.png'</span> });
<span class="hljs-keyword">var</span> nextButton = Titanium.UI.createImageView({ title:<span class="hljs-string">'next'</span>, bottom:<span class="hljs-number">18</span>, width:<span class="hljs-number">70</span>, height:<span class="hljs-number">70</span>, visible:<span class="hljs-literal">true</span>, right: <span class="hljs-number">20</span>, image:<span class="hljs-string">'../images/next.png'</span> });
<span class="hljs-keyword">var</span> backButton = Titanium.UI.createImageView({ title:<span class="hljs-string">'back'</span>, bottom:<span class="hljs-number">18</span>, width:<span class="hljs-number">70</span>, height:<span class="hljs-number">70</span>, visible:<span class="hljs-literal">true</span>, left: <span class="hljs-number">20</span>, image:<span class="hljs-string">'../images/back.png'</span> });

playerWindow.add(startButton);
playerWindow.add(pauseButton);
playerWindow.add(nextButton);
<span class="hljs-comment">//win.add(backButton);</span>

startButton.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        sound.play();
startButton.visible =<span class="hljs-literal">false</span>;
pauseButton.visible =<span class="hljs-literal">true</span>;
<span class="hljs-comment">//fourth.title = 'Now Playing.';</span>
});

pauseButton.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        sound.pause();
pauseButton.visible =<span class="hljs-literal">false</span>;
startButton.visible =<span class="hljs-literal">true</span>;
<span class="hljs-comment">//fourth.title = e.row.post;</span>
    });


<span class="hljs-keyword">var</span> current_index = index;

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">playSound</span>(<span class="hljs-params">index</span>)</span>{

    sound.url = <span class="hljs-string">"https://api.soundcloud.com/tracks/"</span> + data[index] + <span class="hljs-string">"/stream?client_id=3551f4d4dfebbea0bafbdcb3f04d1d25"</span>;

    leftalbum.image = images[index - <span class="hljs-number">1</span>];
    centeralbum.image = images[index];
    rightalbum.image = images[index + <span class="hljs-number">1</span>];

    Ti.API.info(sound.url);
    sound.play();

}


sound.addEventListener(<span class="hljs-string">'complete'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

    <span class="hljs-comment">// increment the array index</span>
    current_index++;

    <span class="hljs-keyword">if</span>(current_index &lt; data.length){

        <span class="hljs-comment">// play the next mp3 in the array </span>
        playSound(current_index);
    } <span class="hljs-keyword">else</span> {
          Ti.API.info(<span class="hljs-string">'all sounds complete!'</span>);
            playSound(<span class="hljs-number">0</span>);
            current_index=-<span class="hljs-number">1</span>;
            current_index++;
        }

    <span class="hljs-keyword">if</span>(current_index - <span class="hljs-number">1</span>&lt; <span class="hljs-number">0</span>){
playerWindow.remove(backButton);
    } 
    <span class="hljs-keyword">else</span>{
playerWindow.add(backButton);
    }            

});

backButton.addEventListener(<span class="hljs-string">'click'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    playSound(current_index -<span class="hljs-number">1</span>);
    current_index=current_index-<span class="hljs-number">1</span>;
    current_index--;    
});

nextButton.addEventListener(<span class="hljs-string">'click'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
    sound.stop();
});

<span class="hljs-comment">// play the first mp3 in the array @ index 0</span>
playSound(current_index);   

<span class="hljs-comment">//        alert('success');</span>


    },
    onerror: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        Ti.API.debug(e.error);
        alert(<span class="hljs-string">'error'</span>);
    },
    timeout:<span class="hljs-number">5000000</span>
});

xhr.open(<span class="hljs-string">"GET"</span>, url);
xhr.send();    







    playerWindow.open();



};
</code></pre><p>thanks in advance for any help.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="March 27th 2013, 3:03:23 pm">March 27th 2013</span>
				by <span class='authorname'>Julien Gattegno</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>3.0 mobilesdk</span></li>
					
						<li><span class='tagname'>commonjs</span></li>
					
						<li><span class='tagname'>iphone</span></li>
					
						<li><span class='tagname'>musicplayer</span></li>
					
				</ul>
			

			<section>
				<h5>7 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Hello,</p>
<p>I can&#39;t find the code where if you clicked another row, you should be calling &quot;stop&quot; in the current track, and then change the url of the media and play it again. </p>
<p>Best,</p>
<p>Mauro</p>
</div>
							<div class="author">
								&mdash; commented <span title="March 27th 2013, 3:14:34 pm">March 27th 2013</span>
								by <span class='authorname'>Mauro Parra</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>TheTable.addEventListener(&#39;click&#39;, function(e)<br>…<br>…<br>Also I&#39;m not quite sure of understanding what you advised?</p>
</div>
							<div class="author">
								&mdash; commented <span title="March 27th 2013, 3:22:57 pm">March 27th 2013</span>
								by <span class='authorname'>Julien Gattegno</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>the problem is coming from the sound.addEventListener(&#39;complete&#39;,function()<br>What should I do?</p>
</div>
							<div class="author">
								&mdash; commented <span title="March 27th 2013, 4:49:23 pm">March 27th 2013</span>
								by <span class='authorname'>Julien Gattegno</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>please help me Mauro Parra</p>
</div>
							<div class="author">
								&mdash; commented <span title="March 29th 2013, 4:54:57 pm">March 29th 2013</span>
								by <span class='authorname'>Julien Gattegno</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>@Julien Gattegno : when you click on other row you need to stop that previous sound . you are not stop that thats while the player is going crazy.</p>
</div>
							<div class="author">
								&mdash; commented <span title="April 1st 2013, 3:09:44 am">April 1st 2013</span>
								by <span class='authorname'>Dharmik Patel</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p><a href="http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;latest&#x2F;#!&#x2F;api&#x2F;Titanium.Media.Sound-method-stop">stop</a></p>
<p>Hope it helps you.</p>
<p>Thanx</p>
</div>
							<div class="author">
								&mdash; commented <span title="April 1st 2013, 3:10:32 am">April 1st 2013</span>
								by <span class='authorname'>Dharmik Patel</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>unfortunately just calling stop or release doesnt work, I had tried this already.</p>
</div>
							<div class="author">
								&mdash; commented <span title="April 1st 2013, 11:11:29 am">April 1st 2013</span>
								by <span class='authorname'>Julien Gattegno</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>0</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>0 Answers</h3>

	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
