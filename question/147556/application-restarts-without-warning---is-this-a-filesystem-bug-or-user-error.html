<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Application restarts without warning - Is this a Filesystem bug or user error? » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Application restarts without warning - Is this a Filesystem bug or user error?</h1>
		</header>
		<section>
			<p>Hi guys,</p>
<p>I&#39;ve been writing a game in 2 halves - the actual &#39;game playing&#39; part and then a Menu &#x2F; Facebook &#x2F; ACS &#x2F; Multiplayer handling part.</p>
<p>Instead of &#39;including &#x2F; requiring&#39; etc I have now literally just pasted the 2 halves together.</p>
<p>Code that worked perfectly in one half now fails!</p>
<p>Just for immediate clarity - No, There are NO duplicate variable names! :)</p>
<p>Is this code correct? It fails the moment I try to <code>write()</code> to the <code>pictureFile</code>.</p>
<p>If I <code>alert(JSON.stringify(this);</code> it correctly displays the response from Facebook, a JPG, the other data etc :) (Also if I just call the url directly to an imageView.image then the picture loads and displays correctly.</p>
<p>If I comment out the line <code>pictureFile.write(xhr.responseData);</code> then this function executes without fail.</p>
<p>WITH that line and the application dies instantly. It doesn&#39;t give me a Red Screen Of Death, it just restarts the app without warning!</p>
<p>This WAS working perfectly when exectuing as the original program! Are there permissions or anything I should have set (or not) that are causing it to crash?</p>
<p>I am running directly on an Android handset (I copy the APK across and install) I don&#39;t run via USB.</p>
<pre><code class="hljs">getProfilePicture = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(FBID)</span></span>{

    <span class="hljs-keyword">var</span> pictureFile = Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory, FBID+<span class="hljs-string">'.jpg'</span>);

    <span class="hljs-keyword">if</span> (!pictureFile.exists()){

    <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();

        xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
            pictureFile.write(xhr.responseData);
        };

        xhr.open(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://graph.facebook.com/'</span> + FBID + <span class="hljs-string">'/picture'</span>);
        xhr.send();    

    } <span class="hljs-keyword">else</span> {  <span class="hljs-comment">//  End If Exists</span>

        <span class="hljs-comment">//return pictureFile.read();</span>
    };  <span class="hljs-comment">// End Else</span>

};
</code></pre><p>Titanium Studio, build: 3.0.1.201212181159<br>(c) Copyright 2012 by Appcelerator, Inc.  All rights reserved.</p>
<p>Build: jenkins-titanium-rcp-master-350 (origin&#x2F;master)<br>Date: 18 December 2012, 12:04:42</p>
<p>Running on Android 2.3.4 on a Sony Ericsson Xperia Arc S LT18i.</p>
<p>Windows 7</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="January 29th 2013, 5:43:25 am">January 29th 2013</span>
				by <span class='authorname'>Robin Williams</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>bug</span></li>
					
						<li><span class='tagname'>filesystem</span></li>
					
						<li><span class='tagname'>mobile</span></li>
					
						<li><span class='tagname'>restart</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Despite this code working perfectly previously, I have tried changing the case of the filename to be all lower case but it had no change in outcome.</p>
<p>Just in case, I tried simplifying the filename to just &quot;f&quot; but no change.</p>
</div>
							<div class="author">
								&mdash; commented <span title="January 29th 2013, 6:32:40 am">January 29th 2013</span>
								by <span class='authorname'>Robin Williams</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Additionally I have just tried to write a simple &quot;String&quot; to the file and it still kills the program stone dead. Immediate Restart!</p>
</div>
							<div class="author">
								&mdash; commented <span title="January 29th 2013, 7:38:01 am">January 29th 2013</span>
								by <span class='authorname'>Robin Williams</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-255627">
				
						<section>
							<p>are you sure that the return data is a JPG image data?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 29th 2013, 7:11:58 am">January 29th 2013</span>
								by <span class='authorname'>Ashish Nigam</span><br>
								<a class="icon-bg icon-link" href="question/147556/application-restarts-without-warning---is-this-a-filesystem-bug-or-user-error#answer-255627" rel="permalink">permalink</a>
							</div>

							<h5>11 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>ok, are you doing this on app launch or after some button click event or some. can you provide some more code?</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 29th 2013, 7:41:01 am">January 29th 2013</span>
											by <span class='authorname'>Ashish Nigam</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Ashish, Thanks for your time.</p>
<p>Yes, it&#39;s after a button click event to log in to FB and ACS and then Cloud Push. It then gets Facebook data via a GraphPath request.</p>
<p>I have an array of &#39;players&#39; (facebook IDs) and then display the user&#39;s friends who are playing the same game. The program displays the facebook profile picture and the friend&#39;s name allowing the user to play &#39;with&#39; &#x2F; &#39;against&#39; their friends.</p>
<p>It gets the friend&#39;s facebook ID, then gets their ACS Cloud Object ID and then gets their ACS Cloud Object (which contains all their public &quot;player data&quot;) and then fetches their profile picture via the function shown in my initial post.</p>
<p>This function is the only use of &#x2F; reference to Filesystem in the entire game!</p>
<p>The problem is very much with the write command.</p>
<p>As I mentioned in the comment above, I have tried writing a simple &quot;string&quot; to the file and it restarts then too!</p>
<p>It worked perfectly before!</p>
<p>Thanks!</p>
<p>Robin</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 29th 2013, 7:52:22 am">January 29th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Okay I&#39;ve been trying this and it still results in an immediate restart of the application!</p>
<p>(Directory related code taken from the Ti docs.)</p>
<pre><code class="hljs">getProfilePicture = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(FBID)</span></span>{

    <span class="hljs-keyword">var</span> directory = Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory, <span class="hljs-string">'profile_pictures'</span>);
    <span class="hljs-keyword">if</span> (!directory.exists()) directory.createDirectory();

    <span class="hljs-keyword">var</span> picturefile = Ti.Filesystem.getFile(directory.resolve(), FBID+<span class="hljs-string">'.jpg'</span>);

    <span class="hljs-keyword">if</span> (!picturefile.exists()){

    <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();

        xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
            <span class="hljs-comment">//picturefile.write(xhr.responseData);</span>
            picturefile.write(<span class="hljs-string">"Test String"</span>);
<span class="hljs-comment">//alert(JSON.stringify(this));</span>

        };

        xhr.open(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://graph.facebook.com/'</span> + FBID + <span class="hljs-string">'/picture'</span>);
        xhr.send();    

    } <span class="hljs-keyword">else</span> {  <span class="hljs-comment">//  End If Exists</span>

        <span class="hljs-comment">//return pictureFile.read();</span>
    };  <span class="hljs-comment">// End Else</span>

};
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="January 29th 2013, 8:25:39 am">January 29th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Interstingly,</p>
<p><code>picturefile.write();</code> with no &#39;write data&#39;</p>
<p>Does NOT cause a restart.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 29th 2013, 8:39:21 am">January 29th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>The original data I was trying to write - the facebook graph &#x2F; profile picture request displays perfectly in this imageView:</p>
<pre><code class="hljs"><span class="hljs-label">piccieView</span> = Ti.UI.createImageView({
<span class="hljs-label">            left:</span> <span class="hljs-keyword">buttonGap,
</span><span class="hljs-label">            top:</span> <span class="hljs-keyword">buttonGap,
</span><span class="hljs-label">            width:</span> ((<span class="hljs-keyword">buttonHeight </span>*<span class="hljs-number">1</span>.<span class="hljs-number">166</span>) - (<span class="hljs-keyword">buttonGap*2)),
</span><span class="hljs-label">            height:</span> ((<span class="hljs-keyword">buttonHeight </span>*<span class="hljs-number">1</span>.<span class="hljs-number">166</span>) - (<span class="hljs-keyword">buttonGap*2)),
</span><span class="hljs-label">            image:</span> <span class="hljs-string">'https://graph.facebook.com/'</span> + friendsArray[i].FBID + <span class="hljs-string">'/picture'</span>
        })<span class="hljs-comment">;</span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="January 29th 2013, 8:49:05 am">January 29th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>got it…</p>
<p><strong>this works</strong></p>
<p><strong>Ti.Filesystem.getFile(Ti.Filesystem.externalStorageDirectory + Ti.Filesystem.getSeparator() + &#39;myfile.png&#39;);</strong></p>
<p><strong>this does not work</strong></p>
<p><strong>Ti.Filesystem.getFile(Ti.Filesystem.externalStorageDirectory,&#39;myfile.png&#39;);</strong></p>
<p>so</p>
<p>hope you understand the problem, so change the way you access <strong>getFile()</strong> function and i will work.</p>
<p>created the same restart problem at my end with your approach.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 29th 2013, 10:18:29 am">January 29th 2013</span>
											by <span class='authorname'>Ashish Nigam</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Ashish,</p>
<p>Thank you so much for your response. Unfortunately it&#39;s still doing it here - both when writing to the <code>externalStorageDirectory</code> and to the <code>applicationDataDirectory</code>.</p>
<p>I have now found the problem to be &#39;intermittent&#39; - sometimes (rarely) it will run succesfully and other times it will restart.</p>
<p>Could it be to do with responses from facebook arriving after the function has been called again for a different facebook friend?</p>
<p>What would happen if there were multiple instances of &#39;xhr&#39; active at once?</p>
<p>I am cycling through an array of facebook friend ID&#39;s and calling their ACS object and so forth and also calling their facebook profile picture. Could I have called for the picture of the next friend before this one has returned?</p>
<p>Thanks again!</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 29th 2013, 10:50:03 am">January 29th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Nope - I guess it&#39;s not that!</p>
<p>I&#39;ve just completely rewritten the function so it won&#39;t call for the next picture until the previous one has returned and it still restarts!</p>
<pre><code class="hljs">
getAllProfilePictures = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(friendCount)</span></span>{

alert(<span class="hljs-string">"FriendCount =\n"</span> + friendCount + <span class="hljs-string">"FBID:\n"</span> + friendsArray[friendCount].id);

    <span class="hljs-keyword">var</span> picturefile = Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory + Ti.Filesystem.getSeparator() + friendsArray[friendCount].id+<span class="hljs-string">'.jpg'</span>);

    <span class="hljs-keyword">if</span> (!picturefile.exists()){

        <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();

        xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
alert(<span class="hljs-string">"onload"</span>);
            picturefile.write(xhr.responseData);
            friendsArray[friendCount].picturePath = picturefile.nativePath();        
            picturefile = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">if</span>(friendCount &gt; <span class="hljs-number">0</span> ) {
                friendCount-=<span class="hljs-number">1</span>;
                getAllProfilePictures(friendCount);
            } <span class="hljs-keyword">else</span> {
alert(<span class="hljs-string">"End 1"</span>);
                <span class="hljs-keyword">return</span>;
            };
        };

        xhr.open(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://graph.facebook.com/'</span> + friendsArray[friendCount].id + <span class="hljs-string">'/picture'</span>);
        xhr.send();    

    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(friendCount &gt; <span class="hljs-number">0</span> ) {
                picturefile = <span class="hljs-literal">null</span>;
                friendCount-=<span class="hljs-number">1</span>;
                getAllProfilePictures(friendCount);
            } <span class="hljs-keyword">else</span> {
alert(<span class="hljs-string">"End2"</span>);
                <span class="hljs-keyword">return</span>;
            };

};  <span class="hljs-comment">//  End Get All Profile Pictures Function</span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="January 29th 2013, 1:41:19 pm">January 29th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>It&#39;s definitely an intermittent problem!</p>
<p>This time it took about 4 or 5 cycles and eventually it stored 2 profile pictures to the phone&#39;s storage.<br>Reading them back works as expected and it&#39;s as fast as anything now!</p>
<p>…but it really does not &#39;want&#39; to write the files to the phone reliably!</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 29th 2013, 2:45:36 pm">January 29th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>…and now it seems to be working reliably! It hasn&#39;t crashed in half an hour!</p>
<p>If anyone can tell me how this code below is materially different, I&#39;d be very grateful!</p>
<pre><code class="hljs">
getAllProfilePictures = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(friendCount)</span></span>{

<span class="hljs-comment">//alert("FriendCount =\n" + friendCount + "\nFBID:\n" + friendsArray[friendCount].id);</span>

    <span class="hljs-keyword">var</span> picturefile = Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory + Ti.Filesystem.getSeparator() + friendsArray[friendCount].id+<span class="hljs-string">'.jpg'</span>);

    <span class="hljs-keyword">if</span> (!picturefile.exists()){

        <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();

        xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
<span class="hljs-comment">//alert("onload");</span>
            picturefile.write(<span class="hljs-keyword">this</span>.responseData);
            picturefile = <span class="hljs-literal">null</span>;
            <span class="hljs-keyword">if</span>(friendCount &gt; <span class="hljs-number">0</span> ) {
                friendCount-=<span class="hljs-number">1</span>;
                getAllProfilePictures(friendCount);
            } <span class="hljs-keyword">else</span> {
<span class="hljs-comment">//alert("End 1");</span>
                <span class="hljs-keyword">return</span>;
            };
        };

        xhr.open(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'https://graph.facebook.com/'</span> + friendsArray[friendCount].id + <span class="hljs-string">'/picture'</span>);
        xhr.send();    

    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(friendCount &gt; <span class="hljs-number">0</span> ) {
                picturefile = <span class="hljs-literal">null</span>;
                friendCount-=<span class="hljs-number">1</span>;
                getAllProfilePictures(friendCount);
            } <span class="hljs-keyword">else</span> {
<span class="hljs-comment">//alert("End2");</span>
                <span class="hljs-keyword">return</span>;
            };

};  <span class="hljs-comment">//  End Get All Profile Pictures Function</span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="January 29th 2013, 3:39:14 pm">January 29th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>HI Robin, just clean your project and it should work without any pain. Also make sure this kind of this is not anywhere else too.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 30th 2013, 6:30:40 am">January 30th 2013</span>
											by <span class='authorname'>Ashish Nigam</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-255630">
				
						<section>
							<p>Hi there,</p>
<p>Yes, 100% sure. My certainty is threefold (as pointed out in my original post) :-</p>
<p>1) <code>alert(JSON.stringify(this));</code> displays correctly returned data from Facebook - status 200 &amp; okay and a jpg embedded at resonseText &#x2F; responseData</p>
<p>2) When I call <code>image: https:&amp;#x2F;&amp;#x2F;graph.facebook.com&amp;#x2F;&amp;#39; + FBID + &amp;#39;&amp;#x2F;picture,</code> in an ImageView, it correctly displays the expected profile picture.</p>
<p>3) It worked perfectly in its original incarnation as just the Menu &#x2F; ACS program - all I did was Copy &amp; Paste the code across!</p>
<p>There are no other file system calls or references in the entire code and the variable names are unique.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 29th 2013, 7:26:53 am">January 29th 2013</span>
								by <span class='authorname'>Robin Williams</span><br>
								<a class="icon-bg icon-link" href="question/147556/application-restarts-without-warning---is-this-a-filesystem-bug-or-user-error#answer-255630" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Oops sorry! - this was meant to be a comment to Ashish, not a separate &#39;answer&#39;</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 29th 2013, 7:38:38 am">January 29th 2013</span>
											by <span class='authorname'>Robin Williams</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
