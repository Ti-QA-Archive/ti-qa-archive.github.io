<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Image sharing on twitter Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Image sharing on twitter</h1>
		</header>
		<section>
			<p>I am trying to share image on twitter using social.js, with Twitter rest api 1.1 but unable. I get an error saying with message saying &#39;Bad Authentication data&#39; and error code 215. If anybody has done some such thing, his&#x2F;her suggestions are required.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="June 19th 2013, 5:39:20 am">June 19th 2013</span>
				by <span class='authorname'>Ammar Asim</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>iphone</span></li>
					
						<li><span class='tagname'>titanium</span></li>
					
						<li><span class='tagname'>titanium studio</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p><a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;141428&#x2F;tweet-photo-using-titanium-appcelerator">http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;141428&#x2F;tweet-photo-using-titanium-appcelerator</a></p>
<p>Prefer this link</p>
<p>Thanx,</p>
<p>dharmik</p>
</div>
							<div class="author">
								&mdash; commented <span title="June 19th 2013, 5:43:47 am">June 19th 2013</span>
								by <span class='authorname'>Dharmik Patel</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Hi,  Ammar Asim</p>
<p> As far I know, we can not upload an image on twitter as like facebook. Whenever we upload any pic on twitter it shares a link of that image and when we click on that link we can see that image. And ofcourse we can share an image on twitter. Using Birdhouse easily we can do that easily.</p>
</div>
							<div class="author">
								&mdash; commented <span title="June 19th 2013, 5:45:13 am">June 19th 2013</span>
								by <span class='authorname'>Dharmik Patel</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-264490">
				
						<section>
							<p>From a published app, works fine:</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">shareTwitter</span>(<span class="hljs-params">data</span>)</span>{
    <span class="hljs-keyword">var</span> social = <span class="hljs-built_in">require</span>(<span class="hljs-string">'/lib/social_plus'</span>);
    <span class="hljs-keyword">var</span> twitter = social.create({
        consumerSecret : <span class="hljs-string">'twitter.consumerSecret'</span>,
        consumerKey : <span class="hljs-string">'twitter.consumerKey'</span>
    });

    <span class="hljs-keyword">if</span> (data.imageBlob !== <span class="hljs-literal">null</span>){
        <span class="hljs-comment">// If this is an image share</span>
        <span class="hljs-comment">//shareMessage = shareMessage + ' ['+sharephoto+']';</span>
        twitter.shareImage({
            message : data.shareMessage,
            image : data.imageBlob,
            success : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                tracker.trackSocial({network: <span class="hljs-string">"twitter"</span>, action: <span class="hljs-string">"Tweet"</span>, target: data.shareType});
                alert(<span class="hljs-string">'Tweeted!'</span>);
            },
            error : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                alert(<span class="hljs-string">'ERROR Tweeted!'</span>);
            }
        });
    } <span class="hljs-keyword">else</span> {
        twitter.share({
            message : data.shareMessage,
            success : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                tracker.trackSocial({network: <span class="hljs-string">"twitter"</span>, action: <span class="hljs-string">"Tweet"</span>, target: data.shareType});
                alert(<span class="hljs-string">'Tweeted!'</span>);
            },
            error : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                alert(<span class="hljs-string">'ERROR Tweeted!'</span>);
            }
        });
    }
}
</code></pre><p>Check @aaron&#39;s link: http:&#x2F;&#x2F;www.clearlyinnovative.com&#x2F;blog&#x2F;post&#x2F;33810421717&#x2F;titanium-appcelerator-quickie-posting-images-to-twitter-with-social_plus-js#.UcF0YPY4V0M</p>
<p>the tracker is the new google analytics module, remove if you arent using it.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 19th 2013, 7:08:16 am">June 19th 2013</span>
								by <span class='authorname'>Stephen Feather</span><br>
								<a class="icon-bg icon-link" href="question/153811/image-sharing-on-twitter.html#answer-264490" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>3</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-264524">
				
						<section>
							<p>I&#39;ve managed to make it work using Aaron&#39;s solution with a little tweak. I based this solution on <a href="https:&#x2F;&#x2F;github.com&#x2F;aaronksaunders&#x2F;test_social&#x2F;blob&#x2F;master&#x2F;Resources&#x2F;social_plus.js">GITHUB Social_plus</a></p>
<p>Here&#39;s how I use it (i.e. from app.js):</p>
<pre><code class="hljs"><span class="hljs-comment">// TWITTER v.1.1</span>
<span class="hljs-keyword">var</span> social = <span class="hljs-built_in">require</span>(<span class="hljs-string">'/programs/social_plus'</span>);
<span class="hljs-comment">//Create a Twitter client for this module</span>
<span class="hljs-keyword">var</span> twitter = social.create({
    consumerSecret : config.twitterConsumerSecret,
    consumerKey : config.twitterConsumerKey
});

post_on_twitter = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">image</span>)</span>{
    <span class="hljs-comment">// image is a blob</span>

    <span class="hljs-keyword">var</span> tweetText = L(<span class="hljs-string">'twitter_share_text'</span>);    
    twitter.shareImage({
        message : tweetText,
        image : image,
        success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
            Ti.UI.createAlertDialog({title: L(<span class="hljs-string">'picturesavedtitle'</span>),message: L(<span class="hljs-string">'twitter_share_success'</span>)}).show();            },
        error: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
            Ti.UI.createAlertDialog({title: L(<span class="hljs-string">'errortitle'</span>),message: L(<span class="hljs-string">'twitter_share_error'</span>)}).show();
        }
    });    
}

post_on_twitter( send_any_blob_here );
</code></pre><p>and here&#39;s what I had to tweak in order to make it work, find function authorizeUICallback and replaced with this one:</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authorizeUICallback</span>(<span class="hljs-params">e</span>) </span>{

    <span class="hljs-keyword">var</span> name = <span class="hljs-string">'oauth_verifier'</span>;
       <span class="hljs-keyword">var</span> regex = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">"[\\?&amp;]"</span> + name + <span class="hljs-string">"=([^&amp;#]*)"</span>),
        results = regex.exec(e.url);

        pin = results == <span class="hljs-literal">null</span> ? <span class="hljs-string">""</span> : <span class="hljs-built_in">decodeURIComponent</span>(results[<span class="hljs-number">1</span>].replace(<span class="hljs-regexp">/\+/g</span>, <span class="hljs-string">" "</span>));        

    <span class="hljs-keyword">if</span> (pin!=<span class="hljs-string">''</span>){
        destroyAuthorizeUI();
            receivePinCallback();
    }<span class="hljs-keyword">else</span>{
        (loadingView &amp;&amp; loadingView.hide(), loadingContainer &amp;&amp; loadingContainer.hide(), webView &amp;&amp; webView.show()), loading = !<span class="hljs-number">1</span>, clearInterval(intervalID), estimates[estimateID] = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>).getTime() - startTime, Ti.App.Properties.setString(<span class="hljs-string">"Social-LoadingEstimates"</span>, <span class="hljs-built_in">JSON</span>.stringify(estimates));
    }

}
</code></pre><p>For some reason it was not returning the PIN (oauth_pin), so it always ended up on the callback url and never posted the pic.</p>
<p>Hope this helps.</p>
<p>Here&#39;s the full modified social_plus.js in case you don&#39;t want to go through its code:</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hex_sha1</span>(<span class="hljs-params">s</span>) </span>{
    <span class="hljs-keyword">return</span> binb2hex(core_sha1(str2binb(s), s.length * chrsz));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">b64_sha1</span>(<span class="hljs-params">s</span>) </span>{
    <span class="hljs-keyword">return</span> binb2b64(core_sha1(str2binb(s), s.length * chrsz));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str_sha1</span>(<span class="hljs-params">s</span>) </span>{
    <span class="hljs-keyword">return</span> binb2str(core_sha1(str2binb(s), s.length * chrsz));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">hex_hmac_sha1</span>(<span class="hljs-params">key, data</span>) </span>{
    <span class="hljs-keyword">return</span> binb2hex(core_hmac_sha1(key, data));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">b64_hmac_sha1</span>(<span class="hljs-params">key, data</span>) </span>{
    <span class="hljs-keyword">return</span> binb2b64(core_hmac_sha1(key, data));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str_hmac_sha1</span>(<span class="hljs-params">key, data</span>) </span>{
    <span class="hljs-keyword">return</span> binb2str(core_hmac_sha1(key, data));
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sha1_vm_test</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">return</span> hex_sha1(<span class="hljs-string">"abc"</span>) == <span class="hljs-string">"a9993e364706816aba3e25717850c26c9cd0d89d"</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">core_sha1</span>(<span class="hljs-params">x, len</span>) </span>{
    x[len &gt;&gt; <span class="hljs-number">5</span>] |= <span class="hljs-number">128</span> &lt;&lt; <span class="hljs-number">24</span> - len % <span class="hljs-number">32</span>, x[(len + <span class="hljs-number">64</span> &gt;&gt; <span class="hljs-number">9</span> &lt;&lt; <span class="hljs-number">4</span>) + <span class="hljs-number">15</span>] = len;
    <span class="hljs-keyword">var</span> w = <span class="hljs-built_in">Array</span>(<span class="hljs-number">80</span>), a = <span class="hljs-number">1732584193</span>, b = -<span class="hljs-number">271733879</span>, c = -<span class="hljs-number">1732584194</span>, d = <span class="hljs-number">271733878</span>, e = -<span class="hljs-number">1009589776</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; x.length; i += <span class="hljs-number">16</span>) {
        <span class="hljs-keyword">var</span> olda = a, oldb = b, oldc = c, oldd = d, olde = e;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">80</span>; j++) {
            j &lt; <span class="hljs-number">16</span> ? w[j] = x[i + j] : w[j] = rol(w[j - <span class="hljs-number">3</span>] ^ w[j - <span class="hljs-number">8</span>] ^ w[j - <span class="hljs-number">14</span>] ^ w[j - <span class="hljs-number">16</span>], <span class="hljs-number">1</span>);
            <span class="hljs-keyword">var</span> t = safe_add(safe_add(rol(a, <span class="hljs-number">5</span>), sha1_ft(j, b, c, d)), safe_add(safe_add(e, w[j]), sha1_kt(j)));
            e = d, d = c, c = rol(b, <span class="hljs-number">30</span>), b = a, a = t;
        }
        a = safe_add(a, olda), b = safe_add(b, oldb), c = safe_add(c, oldc), d = safe_add(d, oldd), e = safe_add(e, olde);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-built_in">Array</span>(a, b, c, d, e);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sha1_ft</span>(<span class="hljs-params">t, b, c, d</span>) </span>{
    <span class="hljs-keyword">return</span> t &lt; <span class="hljs-number">20</span> ? b &amp; c | ~b &amp; d : t &lt; <span class="hljs-number">40</span> ? b ^ c ^ d : t &lt; <span class="hljs-number">60</span> ? b &amp; c | b &amp; d | c &amp; d : b ^ c ^ d;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">sha1_kt</span>(<span class="hljs-params">t</span>) </span>{
    <span class="hljs-keyword">return</span> t &lt; <span class="hljs-number">20</span> ? <span class="hljs-number">1518500249</span> : t &lt; <span class="hljs-number">40</span> ? <span class="hljs-number">1859775393</span> : t &lt; <span class="hljs-number">60</span> ? -<span class="hljs-number">1894007588</span> : -<span class="hljs-number">899497514</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">core_hmac_sha1</span>(<span class="hljs-params">key, data</span>) </span>{
    <span class="hljs-keyword">var</span> bkey = str2binb(key);
    bkey.length &gt; <span class="hljs-number">16</span> &amp;&amp; ( bkey = core_sha1(bkey, key.length * chrsz));
    <span class="hljs-keyword">var</span> ipad = <span class="hljs-built_in">Array</span>(<span class="hljs-number">16</span>), opad = <span class="hljs-built_in">Array</span>(<span class="hljs-number">16</span>);
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">16</span>; i++)
        ipad[i] = bkey[i] ^ <span class="hljs-number">909522486</span>, opad[i] = bkey[i] ^ <span class="hljs-number">1549556828</span>;
    <span class="hljs-keyword">var</span> hash = core_sha1(ipad.concat(str2binb(data)), <span class="hljs-number">512</span> + data.length * chrsz);
    <span class="hljs-keyword">return</span> core_sha1(opad.concat(hash), <span class="hljs-number">672</span>);
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">safe_add</span>(<span class="hljs-params">x, y</span>) </span>{
    <span class="hljs-keyword">var</span> lsw = (x &amp; <span class="hljs-number">65535</span>) + (y &amp; <span class="hljs-number">65535</span>), msw = (x &gt;&gt; <span class="hljs-number">16</span>) + (y &gt;&gt; <span class="hljs-number">16</span>) + (lsw &gt;&gt; <span class="hljs-number">16</span>);
    <span class="hljs-keyword">return</span> msw &lt;&lt; <span class="hljs-number">16</span> | lsw &amp; <span class="hljs-number">65535</span>;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">rol</span>(<span class="hljs-params">num, cnt</span>) </span>{
    <span class="hljs-keyword">return</span> num &lt;&lt; cnt | num &gt;&gt;&gt; <span class="hljs-number">32</span> - cnt;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">str2binb</span>(<span class="hljs-params">str</span>) </span>{
    <span class="hljs-keyword">var</span> bin = <span class="hljs-built_in">Array</span>(), mask = (<span class="hljs-number">1</span> &lt;&lt; chrsz) - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; str.length * chrsz; i += chrsz)
        bin[i &gt;&gt; <span class="hljs-number">5</span>] |= (str.charCodeAt(i / chrsz) &amp; mask) &lt;&lt; <span class="hljs-number">32</span> - chrsz - i % <span class="hljs-number">32</span>;
    <span class="hljs-keyword">return</span> bin;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">binb2str</span>(<span class="hljs-params">bin</span>) </span>{
    <span class="hljs-keyword">var</span> str = <span class="hljs-string">""</span>, mask = (<span class="hljs-number">1</span> &lt;&lt; chrsz) - <span class="hljs-number">1</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; bin.length * <span class="hljs-number">32</span>; i += chrsz)
        str += <span class="hljs-built_in">String</span>.fromCharCode(bin[i &gt;&gt; <span class="hljs-number">5</span>] &gt;&gt;&gt; <span class="hljs-number">32</span> - chrsz - i % <span class="hljs-number">32</span> &amp; mask);
    <span class="hljs-keyword">return</span> str;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">binb2hex</span>(<span class="hljs-params">binarray</span>) </span>{
    <span class="hljs-keyword">var</span> hex_tab = hexcase ? <span class="hljs-string">"0123456789ABCDEF"</span> : <span class="hljs-string">"0123456789abcdef"</span>, str = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; binarray.length * <span class="hljs-number">4</span>; i++)
        str += hex_tab.charAt(binarray[i &gt;&gt; <span class="hljs-number">2</span>] &gt;&gt; (<span class="hljs-number">3</span> - i % <span class="hljs-number">4</span>) * <span class="hljs-number">8</span> + <span class="hljs-number">4</span> &amp; <span class="hljs-number">15</span>) + hex_tab.charAt(binarray[i &gt;&gt; <span class="hljs-number">2</span>] &gt;&gt; (<span class="hljs-number">3</span> - i % <span class="hljs-number">4</span>) * <span class="hljs-number">8</span> &amp; <span class="hljs-number">15</span>);
    <span class="hljs-keyword">return</span> str;
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">binb2b64</span>(<span class="hljs-params">binarray</span>) </span>{
    <span class="hljs-keyword">var</span> tab = <span class="hljs-string">"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/"</span>, str = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; binarray.length * <span class="hljs-number">4</span>; i += <span class="hljs-number">3</span>) {
        <span class="hljs-keyword">var</span> triplet = (binarray[i &gt;&gt; <span class="hljs-number">2</span>] &gt;&gt; <span class="hljs-number">8</span> * (<span class="hljs-number">3</span> - i % <span class="hljs-number">4</span>) &amp; <span class="hljs-number">255</span>) &lt;&lt; <span class="hljs-number">16</span> | (binarray[i + <span class="hljs-number">1</span> &gt;&gt; <span class="hljs-number">2</span>] &gt;&gt; <span class="hljs-number">8</span> * (<span class="hljs-number">3</span> - (i + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span>) &amp; <span class="hljs-number">255</span>) &lt;&lt; <span class="hljs-number">8</span> | binarray[i + <span class="hljs-number">2</span> &gt;&gt; <span class="hljs-number">2</span>] &gt;&gt; <span class="hljs-number">8</span> * (<span class="hljs-number">3</span> - (i + <span class="hljs-number">2</span>) % <span class="hljs-number">4</span>) &amp; <span class="hljs-number">255</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; <span class="hljs-number">4</span>; j++)
            i * <span class="hljs-number">8</span> + j * <span class="hljs-number">6</span> &gt; binarray.length * <span class="hljs-number">32</span> ? str += b64pad : str += tab.charAt(triplet &gt;&gt; <span class="hljs-number">6</span> * (<span class="hljs-number">3</span> - j) &amp; <span class="hljs-number">63</span>);
    }
    <span class="hljs-keyword">return</span> str;
}

<span class="hljs-keyword">var</span> hexcase = <span class="hljs-number">0</span>, b64pad = <span class="hljs-string">""</span>, chrsz = <span class="hljs-number">8</span>, OAuth;

OAuth == <span class="hljs-literal">null</span> &amp;&amp; ( OAuth = {}), OAuth.setProperties = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">into, from</span>) </span>{
    <span class="hljs-keyword">if</span> (into != <span class="hljs-literal">null</span> &amp;&amp; from != <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> from)
        into[key] = from[key];
    <span class="hljs-keyword">return</span> into;
}, OAuth.setProperties(OAuth, {
    percentEncode : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">s</span>) </span>{
        <span class="hljs-keyword">if</span> (s == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        <span class="hljs-keyword">if</span> ( s <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
            <span class="hljs-keyword">var</span> e = <span class="hljs-string">""</span>;
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; s.length; ++s)
                e != <span class="hljs-string">""</span> &amp;&amp; (e += <span class="hljs-string">"&amp;"</span>), e += OAuth.percentEncode(s[i]);
            <span class="hljs-keyword">return</span> e;
        }
        <span class="hljs-keyword">return</span> s = <span class="hljs-built_in">encodeURIComponent</span>(s), s = s.replace(<span class="hljs-regexp">/\!/g</span>, <span class="hljs-string">"%21"</span>), s = s.replace(<span class="hljs-regexp">/\*/g</span>, <span class="hljs-string">"%2A"</span>), s = s.replace(<span class="hljs-regexp">/\'/g</span>, <span class="hljs-string">"%27"</span>), s = s.replace(<span class="hljs-regexp">/\(/g</span>, <span class="hljs-string">"%28"</span>), s = s.replace(<span class="hljs-regexp">/\)/g</span>, <span class="hljs-string">"%29"</span>), s;
    },
    decodePercent : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">s</span>) </span>{
        <span class="hljs-keyword">return</span> s != <span class="hljs-literal">null</span> &amp;&amp; ( s = s.replace(<span class="hljs-regexp">/\+/g</span>, <span class="hljs-string">" "</span>)), <span class="hljs-built_in">decodeURIComponent</span>(s);
    },
    getParameterList : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parameters</span>) </span>{
        <span class="hljs-keyword">if</span> (parameters == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">return</span> [];
        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> parameters != <span class="hljs-string">"object"</span>)
            <span class="hljs-keyword">return</span> OAuth.decodeForm(parameters + <span class="hljs-string">""</span>);
        <span class="hljs-keyword">if</span> ( parameters <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>)
            <span class="hljs-keyword">return</span> parameters;
        <span class="hljs-keyword">var</span> list = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p <span class="hljs-keyword">in</span> parameters)
        list.push([p, parameters[p]]);
        <span class="hljs-keyword">return</span> list;
    },
    getParameterMap : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parameters</span>) </span>{
        <span class="hljs-keyword">if</span> (parameters == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">return</span> {};
        <span class="hljs-keyword">if</span> ( <span class="hljs-keyword">typeof</span> parameters != <span class="hljs-string">"object"</span>)
            <span class="hljs-keyword">return</span> OAuth.getParameterMap(OAuth.decodeForm(parameters + <span class="hljs-string">""</span>));
        <span class="hljs-keyword">if</span> ( parameters <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
            <span class="hljs-keyword">var</span> map = {};
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p = <span class="hljs-number">0</span>; p &lt; parameters.length; ++p) {
                <span class="hljs-keyword">var</span> key = parameters[p][<span class="hljs-number">0</span>];
                map[key] === <span class="hljs-literal">undefined</span> &amp;&amp; (map[key] = parameters[p][<span class="hljs-number">1</span>]);
            }
            <span class="hljs-keyword">return</span> map;
        }
        <span class="hljs-keyword">return</span> parameters;
    },
    getParameter : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parameters, name</span>) </span>{
        <span class="hljs-keyword">if</span> ( parameters <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p = <span class="hljs-number">0</span>; p &lt; parameters.length; ++p)
                <span class="hljs-keyword">if</span> (parameters[p][<span class="hljs-number">0</span>] == name)
                    <span class="hljs-keyword">return</span> parameters[p][<span class="hljs-number">1</span>];
            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
        }
        <span class="hljs-keyword">return</span> OAuth.getParameterMap(parameters)[name];
    },
    formEncode : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parameters</span>) </span>{
        <span class="hljs-keyword">var</span> form = <span class="hljs-string">""</span>, list = OAuth.getParameterList(parameters);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p = <span class="hljs-number">0</span>; p &lt; list.length; ++p) {
            <span class="hljs-keyword">var</span> value = list[p][<span class="hljs-number">1</span>];
            value == <span class="hljs-literal">null</span> &amp;&amp; ( value = <span class="hljs-string">""</span>), form != <span class="hljs-string">""</span> &amp;&amp; (form += <span class="hljs-string">"&amp;"</span>), form += OAuth.percentEncode(list[p][<span class="hljs-number">0</span>]) + <span class="hljs-string">"="</span> + OAuth.percentEncode(value);
        }
        <span class="hljs-keyword">return</span> form;
    },
    decodeForm : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">form</span>) </span>{
        <span class="hljs-keyword">var</span> list = [], nvps = form.split(<span class="hljs-string">"&amp;"</span>);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; nvps.length; ++n) {
            <span class="hljs-keyword">var</span> nvp = nvps[n];
            <span class="hljs-keyword">if</span> (nvp == <span class="hljs-string">""</span>)
                <span class="hljs-keyword">continue</span>;
            <span class="hljs-keyword">var</span> equals = nvp.indexOf(<span class="hljs-string">"="</span>), name, value;
            equals &lt; <span class="hljs-number">0</span> ? ( name = OAuth.decodePercent(nvp), value = <span class="hljs-literal">null</span>) : ( name = OAuth.decodePercent(nvp.substring(<span class="hljs-number">0</span>, equals)), value = OAuth.decodePercent(nvp.substring(equals + <span class="hljs-number">1</span>))), list.push([name, value]);
        }
        <span class="hljs-keyword">return</span> list;
    },
    setParameter : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message, name, value</span>) </span>{
        <span class="hljs-keyword">var</span> parameters = message.parameters;
        <span class="hljs-keyword">if</span> ( parameters <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Array</span>) {
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p = <span class="hljs-number">0</span>; p &lt; parameters.length; ++p)
                parameters[p][<span class="hljs-number">0</span>] == name &amp;&amp; (value === <span class="hljs-literal">undefined</span> ? parameters.splice(p, <span class="hljs-number">1</span>) : (parameters[p][<span class="hljs-number">1</span>] = value, value = <span class="hljs-literal">undefined</span>));
            value !== <span class="hljs-literal">undefined</span> &amp;&amp; parameters.push([name, value]);
        } <span class="hljs-keyword">else</span>
            parameters = OAuth.getParameterMap(parameters), parameters[name] = value, message.parameters = parameters;
    },
    setParameters : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message, parameters</span>) </span>{
        <span class="hljs-keyword">var</span> list = OAuth.getParameterList(parameters);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; list.length; ++i)
            OAuth.setParameter(message, list[i][<span class="hljs-number">0</span>], list[i][<span class="hljs-number">1</span>]);
    },
    completeRequest : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message, accessor</span>) </span>{
        message.method == <span class="hljs-literal">null</span> &amp;&amp; (message.method = <span class="hljs-string">"GET"</span>);
        <span class="hljs-keyword">var</span> map = OAuth.getParameterMap(message.parameters);
        map.oauth_consumer_key == <span class="hljs-literal">null</span> &amp;&amp; OAuth.setParameter(message, <span class="hljs-string">"oauth_consumer_key"</span>, accessor.consumerKey || <span class="hljs-string">""</span>), map.oauth_token == <span class="hljs-literal">null</span> &amp;&amp; accessor.token != <span class="hljs-literal">null</span> &amp;&amp; OAuth.setParameter(message, <span class="hljs-string">"oauth_token"</span>, accessor.token), map.oauth_version == <span class="hljs-literal">null</span> &amp;&amp; OAuth.setParameter(message, <span class="hljs-string">"oauth_version"</span>, <span class="hljs-string">"1.0"</span>), map.oauth_timestamp == <span class="hljs-literal">null</span> &amp;&amp; OAuth.setParameter(message, <span class="hljs-string">"oauth_timestamp"</span>, OAuth.timestamp()), map.oauth_nonce == <span class="hljs-literal">null</span> &amp;&amp; OAuth.setParameter(message, <span class="hljs-string">"oauth_nonce"</span>, OAuth.nonce(<span class="hljs-number">6</span>)), OAuth.SignatureMethod.sign(message, accessor);
    },
    setTimestampAndNonce : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
        OAuth.setParameter(message, <span class="hljs-string">"oauth_timestamp"</span>, OAuth.timestamp()), OAuth.setParameter(message, <span class="hljs-string">"oauth_nonce"</span>, OAuth.nonce(<span class="hljs-number">6</span>));
    },
    addToURL : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">url, parameters</span>) </span>{
        newURL = url;
        <span class="hljs-keyword">if</span> (parameters != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">var</span> toAdd = OAuth.formEncode(parameters);
            <span class="hljs-keyword">if</span> (toAdd.length &gt; <span class="hljs-number">0</span>) {
                <span class="hljs-keyword">var</span> q = url.indexOf(<span class="hljs-string">"?"</span>);
                q &lt; <span class="hljs-number">0</span> ? newURL += <span class="hljs-string">"?"</span> : newURL += <span class="hljs-string">"&amp;"</span>, newURL += toAdd;
            }
        }
        <span class="hljs-keyword">return</span> newURL;
    },
    getAuthorizationHeader : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">realm, parameters</span>) </span>{
        <span class="hljs-keyword">var</span> header = <span class="hljs-string">"OAuth realm=\""</span> + OAuth.percentEncode(realm) + <span class="hljs-string">"\""</span>, list = OAuth.getParameterList(parameters);
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p = <span class="hljs-number">0</span>; p &lt; list.length; ++p) {
            <span class="hljs-keyword">var</span> parameter = list[p], name = parameter[<span class="hljs-number">0</span>];
            name.indexOf(<span class="hljs-string">"oauth_"</span>) == <span class="hljs-number">0</span> &amp;&amp; (header += <span class="hljs-string">","</span> + OAuth.percentEncode(name) + <span class="hljs-string">"=\""</span> + OAuth.percentEncode(parameter[<span class="hljs-number">1</span>]) + <span class="hljs-string">"\""</span>);
        }
        <span class="hljs-keyword">return</span> header;
    },
    correctTimestampFromSrc : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parameterName</span>) </span>{
        parameterName = parameterName || <span class="hljs-string">"oauth_timestamp"</span>;
        <span class="hljs-keyword">var</span> scripts = <span class="hljs-built_in">document</span>.getElementsByTagName(<span class="hljs-string">"script"</span>);
        <span class="hljs-keyword">if</span> (scripts == <span class="hljs-literal">null</span> || !scripts.length)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">var</span> src = scripts[scripts.length - <span class="hljs-number">1</span>].src;
        <span class="hljs-keyword">if</span> (!src)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">var</span> q = src.indexOf(<span class="hljs-string">"?"</span>);
        <span class="hljs-keyword">if</span> (q &lt; <span class="hljs-number">0</span>)
            <span class="hljs-keyword">return</span>;
        parameters = OAuth.getParameterMap(OAuth.decodeForm(src.substring(q + <span class="hljs-number">1</span>)));
        <span class="hljs-keyword">var</span> t = parameters[parameterName];
        <span class="hljs-keyword">if</span> (t == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">return</span>;
        OAuth.correctTimestamp(t);
    },
    correctTimestamp : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">timestamp</span>) </span>{
        OAuth.timeCorrectionMsec = timestamp * <span class="hljs-number">1000</span> - (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>).getTime();
    },
    timeCorrectionMsec : <span class="hljs-number">0</span>,
    timestamp : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> t = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>).getTime() + OAuth.timeCorrectionMsec;
        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span> + <span class="hljs-built_in">Math</span>.floor(t / <span class="hljs-number">1000</span>);
    },
    nonce : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">length</span>) </span>{
        <span class="hljs-keyword">var</span> chars = OAuth.nonce.CHARS, result = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; length; ++i) {
            <span class="hljs-keyword">var</span> rnum = <span class="hljs-built_in">Math</span>.floor(<span class="hljs-built_in">Math</span>.random() * chars.length);
            result += chars.substring(rnum, rnum + <span class="hljs-number">1</span>);
        }
        <span class="hljs-keyword">return</span> result;
    }
}), OAuth.nonce.CHARS = <span class="hljs-string">"0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz"</span>, OAuth.declareClass = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parent, name, newConstructor</span>) </span>{
    <span class="hljs-keyword">var</span> previous = parent[name];
    parent[name] = newConstructor;
    <span class="hljs-keyword">if</span> (newConstructor != <span class="hljs-literal">null</span> &amp;&amp; previous != <span class="hljs-literal">null</span>)
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> key <span class="hljs-keyword">in</span> previous)key != <span class="hljs-string">"prototype"</span> &amp;&amp; (newConstructor[key] = previous[key]);
    <span class="hljs-keyword">return</span> newConstructor;
}, OAuth.declareClass(OAuth, <span class="hljs-string">"SignatureMethod"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
}), OAuth.setProperties(OAuth.SignatureMethod.prototype, {
    sign : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
        <span class="hljs-keyword">var</span> baseString = OAuth.SignatureMethod.getBaseString(message), signature = <span class="hljs-keyword">this</span>.getSignature(baseString);
        <span class="hljs-keyword">return</span> OAuth.setParameter(message, <span class="hljs-string">"oauth_signature"</span>, signature), signature;
    },
    initialize : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, accessor</span>) </span>{
        <span class="hljs-keyword">var</span> consumerSecret;
        accessor.accessorSecret != <span class="hljs-literal">null</span> &amp;&amp; name.length &gt; <span class="hljs-number">9</span> &amp;&amp; name.substring(name.length - <span class="hljs-number">9</span>) == <span class="hljs-string">"-Accessor"</span> ? consumerSecret = accessor.accessorSecret : consumerSecret = accessor.consumerSecret, <span class="hljs-keyword">this</span>.key = OAuth.percentEncode(consumerSecret) + <span class="hljs-string">"&amp;"</span> + OAuth.percentEncode(accessor.tokenSecret);
    }
}), OAuth.setProperties(OAuth.SignatureMethod, {
    sign : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message, accessor</span>) </span>{
        <span class="hljs-keyword">var</span> name = OAuth.getParameterMap(message.parameters).oauth_signature_method;
        <span class="hljs-keyword">if</span> (name == <span class="hljs-literal">null</span> || name == <span class="hljs-string">""</span>)
            name = <span class="hljs-string">"HMAC-SHA1"</span>, OAuth.setParameter(message, <span class="hljs-string">"oauth_signature_method"</span>, name);
        OAuth.SignatureMethod.newMethod(name, accessor).sign(message);
    },
    newMethod : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">name, accessor</span>) </span>{
        <span class="hljs-keyword">var</span> impl = OAuth.SignatureMethod.REGISTERED[name];
        <span class="hljs-keyword">if</span> (impl != <span class="hljs-literal">null</span>) {
            <span class="hljs-keyword">var</span> method = <span class="hljs-keyword">new</span> impl;
            <span class="hljs-keyword">return</span> method.initialize(name, accessor), method;
        }
        <span class="hljs-keyword">var</span> err = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"signature_method_rejected"</span>), acceptable = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> r <span class="hljs-keyword">in</span> OAuth.SignatureMethod.REGISTERED)acceptable != <span class="hljs-string">""</span> &amp;&amp; (acceptable += <span class="hljs-string">"&amp;"</span>), acceptable += OAuth.percentEncode(r);
        <span class="hljs-keyword">throw</span> err.oauth_acceptable_signature_methods = acceptable, err;
    },
    REGISTERED : {},
    registerMethodClass : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">names, classConstructor</span>) </span>{
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> n = <span class="hljs-number">0</span>; n &lt; names.length; ++n)
            OAuth.SignatureMethod.REGISTERED[names[n]] = classConstructor;
    },
    makeSubclass : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">getSignatureFunction</span>) </span>{
        <span class="hljs-keyword">var</span> superClass = OAuth.SignatureMethod, subClass = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            superClass.call(<span class="hljs-keyword">this</span>);
        };
        <span class="hljs-keyword">return</span> subClass.prototype = <span class="hljs-keyword">new</span> superClass, subClass.prototype.getSignature = getSignatureFunction, subClass.prototype.constructor = subClass, subClass;
    },
    getBaseString : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">message</span>) </span>{
        <span class="hljs-keyword">var</span> URL = message.action, q = URL.indexOf(<span class="hljs-string">"?"</span>), parameters;
        <span class="hljs-keyword">if</span> (q &lt; <span class="hljs-number">0</span>)
            parameters = message.parameters;
        <span class="hljs-keyword">else</span> {
            parameters = OAuth.decodeForm(URL.substring(q + <span class="hljs-number">1</span>));
            <span class="hljs-keyword">var</span> toAdd = OAuth.getParameterList(message.parameters);
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> a = <span class="hljs-number">0</span>; a &lt; toAdd.length; ++a)
                parameters.push(toAdd[a]);
        }
        <span class="hljs-keyword">return</span> OAuth.percentEncode(message.method.toUpperCase()) + <span class="hljs-string">"&amp;"</span> + OAuth.percentEncode(OAuth.SignatureMethod.normalizeUrl(URL)) + <span class="hljs-string">"&amp;"</span> + OAuth.percentEncode(OAuth.SignatureMethod.normalizeParameters(parameters));
    },
    normalizeUrl : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">url</span>) </span>{
        <span class="hljs-keyword">var</span> uri = OAuth.SignatureMethod.parseUri(url), scheme = uri.protocol.toLowerCase(), authority = uri.authority.toLowerCase(), dropPort = scheme == <span class="hljs-string">"http"</span> &amp;&amp; uri.port == <span class="hljs-number">80</span> || scheme == <span class="hljs-string">"https"</span> &amp;&amp; uri.port == <span class="hljs-number">443</span>;
        <span class="hljs-keyword">if</span> (dropPort) {
            <span class="hljs-keyword">var</span> index = authority.lastIndexOf(<span class="hljs-string">":"</span>);
            index &gt;= <span class="hljs-number">0</span> &amp;&amp; ( authority = authority.substring(<span class="hljs-number">0</span>, index));
        }
        <span class="hljs-keyword">var</span> path = uri.path;
        <span class="hljs-keyword">return</span> path || ( path = <span class="hljs-string">"/"</span>), scheme + <span class="hljs-string">"://"</span> + authority + path;
    },
    parseUri : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">str</span>) </span>{
        <span class="hljs-keyword">var</span> o = {
            key : [<span class="hljs-string">"source"</span>, <span class="hljs-string">"protocol"</span>, <span class="hljs-string">"authority"</span>, <span class="hljs-string">"userInfo"</span>, <span class="hljs-string">"user"</span>, <span class="hljs-string">"password"</span>, <span class="hljs-string">"host"</span>, <span class="hljs-string">"port"</span>, <span class="hljs-string">"relative"</span>, <span class="hljs-string">"path"</span>, <span class="hljs-string">"directory"</span>, <span class="hljs-string">"file"</span>, <span class="hljs-string">"query"</span>, <span class="hljs-string">"anchor"</span>],
            parser : {
                strict : <span class="hljs-regexp">/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@\/]*):?([^:@\/]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/</span>
            }
        }, m = o.parser.strict.exec(str), uri = {}, i = <span class="hljs-number">14</span>;
        <span class="hljs-keyword">while</span> (i--)
        uri[o.key[i]] = m[i] || <span class="hljs-string">""</span>;
        <span class="hljs-keyword">return</span> uri;
    },
    normalizeParameters : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">parameters</span>) </span>{
        <span class="hljs-keyword">if</span> (parameters == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        <span class="hljs-keyword">var</span> list = OAuth.getParameterList(parameters), sortable = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> p = <span class="hljs-number">0</span>; p &lt; list.length; ++p) {
            <span class="hljs-keyword">var</span> nvp = list[p];
            nvp[<span class="hljs-number">0</span>] != <span class="hljs-string">"oauth_signature"</span> &amp;&amp; sortable.push([OAuth.percentEncode(nvp[<span class="hljs-number">0</span>]) + <span class="hljs-string">" "</span> + OAuth.percentEncode(nvp[<span class="hljs-number">1</span>]), nvp]);
        }
        sortable.sort(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">a, b</span>) </span>{
            <span class="hljs-keyword">return</span> a[<span class="hljs-number">0</span>] &lt; b[<span class="hljs-number">0</span>] ? -<span class="hljs-number">1</span> : a[<span class="hljs-number">0</span>] &gt; b[<span class="hljs-number">0</span>] ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;
        });
        <span class="hljs-keyword">var</span> sorted = [];
        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> s = <span class="hljs-number">0</span>; s &lt; sortable.length; ++s)
            sorted.push(sortable[s][<span class="hljs-number">1</span>]);
        <span class="hljs-keyword">return</span> OAuth.formEncode(sorted);
    }
}), OAuth.SignatureMethod.registerMethodClass([<span class="hljs-string">"PLAINTEXT"</span>, <span class="hljs-string">"PLAINTEXT-Accessor"</span>], OAuth.SignatureMethod.makeSubclass(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">baseString</span>) </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.key;
})), OAuth.SignatureMethod.registerMethodClass([<span class="hljs-string">"HMAC-SHA1"</span>, <span class="hljs-string">"HMAC-SHA1-Accessor"</span>], OAuth.SignatureMethod.makeSubclass(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">baseString</span>) </span>{
    b64pad = <span class="hljs-string">"="</span>;
    <span class="hljs-keyword">var</span> signature = b64_hmac_sha1(<span class="hljs-keyword">this</span>.key, baseString);
    <span class="hljs-keyword">return</span> signature;
}));

<span class="hljs-keyword">try</span> {
    OAuth.correctTimestampFromSrc();
} <span class="hljs-keyword">catch</span> (e) {
}

<span class="hljs-keyword">var</span> OAuthAdapter = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pConsumerSecret, pConsumerKey, pSignatureMethod</span>) </span>{
    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">showLoading</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (loading)
            <span class="hljs-keyword">return</span>;
        loading = !<span class="hljs-number">0</span>, 
        loadingView.value = <span class="hljs-number">0</span>, 
        estimateID = firstLoad ? <span class="hljs-string">"tokenRequest"</span> : <span class="hljs-string">"pageLoad"</span>, 
        estimates[estimateID] || (estimates[estimateID] = firstLoad ? <span class="hljs-number">2000</span> : <span class="hljs-number">1000</span>), 
        firstLoad = !<span class="hljs-number">1</span>, 
        startTime = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>).getTime(), 
        intervalID = setInterval(updateProgress, <span class="hljs-number">30</span>), 
        webView &amp;&amp; webView.hide(), 
        loadingView &amp;&amp; loadingView.show(), 
        loadingContainer &amp;&amp; loadingContainer.show();
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">updateProgress</span>(<span class="hljs-params"></span>) </span>{
        loadingView &amp;&amp; (loadingView.value = ((<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>).getTime() - startTime) / estimates[estimateID]);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authorizeUICallback</span>(<span class="hljs-params">e</span>) </span>{

        <span class="hljs-keyword">var</span> name = <span class="hljs-string">'oauth_verifier'</span>;
           <span class="hljs-keyword">var</span> regex = <span class="hljs-keyword">new</span> <span class="hljs-built_in">RegExp</span>(<span class="hljs-string">"[\\?&amp;]"</span> + name + <span class="hljs-string">"=([^&amp;#]*)"</span>),
        results = regex.exec(e.url);

        pin = results == <span class="hljs-literal">null</span> ? <span class="hljs-string">""</span> : <span class="hljs-built_in">decodeURIComponent</span>(results[<span class="hljs-number">1</span>].replace(<span class="hljs-regexp">/\+/g</span>, <span class="hljs-string">" "</span>));        

        <span class="hljs-keyword">if</span> (pin!=<span class="hljs-string">''</span>){
            destroyAuthorizeUI();
            receivePinCallback();
        }<span class="hljs-keyword">else</span>{
            (loadingView &amp;&amp; loadingView.hide(), loadingContainer &amp;&amp; loadingContainer.hide(), webView &amp;&amp; webView.show()), loading = !<span class="hljs-number">1</span>, clearInterval(intervalID), estimates[estimateID] = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>).getTime() - startTime, Ti.App.Properties.setString(<span class="hljs-string">"Social-LoadingEstimates"</span>, <span class="hljs-built_in">JSON</span>.stringify(estimates));
        }

    }


    <span class="hljs-keyword">var</span> consumerSecret = pConsumerSecret, consumerKey = pConsumerKey, signatureMethod = pSignatureMethod, pin = <span class="hljs-literal">null</span>, requestToken = <span class="hljs-literal">null</span>, requestTokenSecret = <span class="hljs-literal">null</span>, accessToken = <span class="hljs-literal">null</span>, accessTokenSecret = <span class="hljs-literal">null</span>, accessor = {
        consumerSecret : consumerSecret,
        tokenSecret : <span class="hljs-string">""</span>
    }, <span class="hljs-built_in">window</span> = <span class="hljs-literal">null</span>, view = <span class="hljs-literal">null</span>, webView = <span class="hljs-literal">null</span>, loadingView = <span class="hljs-literal">null</span>, loadingContainer = <span class="hljs-literal">null</span>, receivePinCallback = <span class="hljs-literal">null</span>, accessTokenStore = {};
    <span class="hljs-keyword">this</span>.sendTwitterImage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
        <span class="hljs-keyword">var</span> pUrl = <span class="hljs-string">"https://api.twitter.com/1.1/statuses/update_with_media.json"</span>;
        <span class="hljs-keyword">var</span> pTitle = options.title;
        <span class="hljs-keyword">var</span> pSuccessMessage = options.onSuccess, pErrorMessage = options.onError;
        <span class="hljs-keyword">if</span> (accessToken == <span class="hljs-literal">null</span> || accessTokenSecret == <span class="hljs-literal">null</span>) {
            Ti.API.debug(<span class="hljs-string">"The send status cannot be processed as the client doesn't have an access token. Authorize before trying to send."</span>);
            <span class="hljs-keyword">return</span>;
        }
        accessor.tokenSecret = accessTokenSecret;
        <span class="hljs-keyword">var</span> message = createMessage(pUrl);

        message.parameters.push([<span class="hljs-string">"oauth_token"</span>, accessToken]);
        message.parameters.push([<span class="hljs-string">"oauth_timestamp"</span>, OAuth.timestamp()]);
        message.parameters.push([<span class="hljs-string">"oauth_nonce"</span>, OAuth.nonce(<span class="hljs-number">42</span>)]);
        message.parameters.push([<span class="hljs-string">"oauth_version"</span>, <span class="hljs-string">"1.0"</span>]);

        OAuth.SignatureMethod.sign(message, accessor);
        <span class="hljs-keyword">var</span> parameterMap = OAuth.getParameterMap(message.parameters);
        client = Ti.Network.createHTTPClient({
            onload : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

                <span class="hljs-keyword">if</span> (client.status == <span class="hljs-number">200</span>) {
                    pSuccessMessage &amp;&amp; pSuccessMessage(<span class="hljs-keyword">this</span>.responseText)
                } <span class="hljs-keyword">else</span> {
                    pErrorMessage &amp;&amp; pErrorMessage(<span class="hljs-keyword">this</span>.responseText);
                }
            },
            onerror : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                Ti.API.error(<span class="hljs-string">"Social.js: FAILED to send a request!"</span>);
                Ti.API.error(<span class="hljs-keyword">this</span>.responseText);
                pErrorMessage &amp;&amp; pErrorMessage(<span class="hljs-keyword">this</span>.responseText);
            }
        });


        client.open(<span class="hljs-string">"POST"</span>, pUrl);

        header = OAuth.getAuthorizationHeader(<span class="hljs-string">""</span>, message.parameters);
        client.setRequestHeader(<span class="hljs-string">"Authorization"</span>, header);
        <span class="hljs-keyword">if</span> (!Ti.Android) {
            client.setRequestHeader(<span class="hljs-string">"Content-Type"</span>, <span class="hljs-string">"multipart/form-data"</span>);
        }
        client.send(options.params);
    }, <span class="hljs-keyword">this</span>.loadAccessToken = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pService</span>) </span>{
        <span class="hljs-keyword">var</span> token;
        <span class="hljs-keyword">if</span> (accessTokenStore[pService])
            token = accessTokenStore[pService];
        <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">var</span> raw = Ti.App.Properties.getString(<span class="hljs-string">"Social.js-AccessToken-"</span> + pService, <span class="hljs-string">""</span>);
            <span class="hljs-keyword">if</span> (!raw)
                <span class="hljs-keyword">return</span>;
            <span class="hljs-keyword">try</span> {
                token = accessTokenStore[pService] = <span class="hljs-built_in">JSON</span>.parse(raw);
            } <span class="hljs-keyword">catch</span> (err) {
                Ti.API.error(<span class="hljs-string">"Failed to parse stored access token for "</span> + pService + <span class="hljs-string">"!"</span>), Ti.API.error(err);
                <span class="hljs-keyword">return</span>;
            }
        }
        token.accessToken &amp;&amp; ( accessToken = token.accessToken), token.accessTokenSecret &amp;&amp; ( accessTokenSecret = token.accessTokenSecret);
    }, <span class="hljs-keyword">this</span>.saveAccessToken = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pService</span>) </span>{
        accessTokenStore[pService] = {
            accessToken : accessToken,
            accessTokenSecret : accessTokenSecret
        }, Ti.App.Properties.setString(<span class="hljs-string">"Social.js-AccessToken-"</span> + pService, <span class="hljs-built_in">JSON</span>.stringify(accessTokenStore[pService]));
    }, <span class="hljs-keyword">this</span>.clearAccessToken = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pService</span>) </span>{
        <span class="hljs-keyword">delete</span> accessTokenStore[pService], Ti.App.Properties.setString(<span class="hljs-string">"Social.js-AccessToken-"</span> + pService, <span class="hljs-literal">null</span>), accessToken = <span class="hljs-literal">null</span>, accessTokenSecret = <span class="hljs-literal">null</span>;
    }, <span class="hljs-keyword">this</span>.isAuthorized = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> accessToken != <span class="hljs-literal">null</span> &amp;&amp; accessTokenSecret != <span class="hljs-literal">null</span>;
    };
    <span class="hljs-keyword">var</span> createMessage = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pUrl</span>) </span>{
        <span class="hljs-keyword">var</span> message = {
            action : pUrl,
            method : <span class="hljs-string">"POST"</span>,
            parameters : []
        };
        <span class="hljs-keyword">return</span> message.parameters.push([<span class="hljs-string">"oauth_consumer_key"</span>, consumerKey]), message.parameters.push([<span class="hljs-string">"oauth_signature_method"</span>, signatureMethod]), message;
    };
    <span class="hljs-keyword">this</span>.getPin = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">return</span> pin;
    }, <span class="hljs-keyword">this</span>.getRequestToken = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pUrl, callback</span>) </span>{
        accessor.tokenSecret = <span class="hljs-string">""</span>;
        <span class="hljs-keyword">var</span> message = createMessage(pUrl);
        OAuth.setTimestampAndNonce(message), OAuth.SignatureMethod.sign(message, accessor);
        <span class="hljs-keyword">var</span> done = !<span class="hljs-number">1</span>, client = Ti.Network.createHTTPClient({
            onload : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> responseParams = OAuth.getParameterMap(<span class="hljs-keyword">this</span>.responseText);
                requestToken = responseParams.oauth_token, requestTokenSecret = responseParams.oauth_token_secret, callback({
                    success : !<span class="hljs-number">0</span>,
                    token : <span class="hljs-keyword">this</span>.responseText
                }), done = !<span class="hljs-number">0</span>;
            },
            onerror : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                Ti.API.error(<span class="hljs-string">"Social.js: FAILED to getRequestToken!"</span>), Ti.API.error(<span class="hljs-keyword">this</span>.responseText), callback({
                    success : !<span class="hljs-number">1</span>
                }), done = !<span class="hljs-number">0</span>;
            }
        });
        client.open(<span class="hljs-string">"POST"</span>, pUrl), client.send(OAuth.getParameterMap(message.parameters));
    };
    <span class="hljs-keyword">var</span> destroyAuthorizeUI = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">window</span> == <span class="hljs-literal">null</span>)
            <span class="hljs-keyword">return</span>;
        <span class="hljs-keyword">try</span> {
            webView.removeEventListener(<span class="hljs-string">"load"</span>, authorizeUICallback), webView.removeEventListener(<span class="hljs-string">"beforeload"</span>, showLoading), loadingView.hide(), <span class="hljs-built_in">window</span>.close(), loading = <span class="hljs-literal">null</span>, webView = <span class="hljs-literal">null</span>, loadingView = <span class="hljs-literal">null</span>, loading = !<span class="hljs-number">1</span>, firstLoad = !<span class="hljs-number">0</span>, view = <span class="hljs-literal">null</span>, <span class="hljs-built_in">window</span> = <span class="hljs-literal">null</span>;
        } <span class="hljs-keyword">catch</span> (ex) {
            Ti.API.debug(<span class="hljs-string">"Cannot destroy the authorize UI. Ignoring."</span>);
        }
    }, firstLoad = !<span class="hljs-number">0</span>, loading = !<span class="hljs-number">1</span>, estimates = <span class="hljs-built_in">JSON</span>.parse(Ti.App.Properties.getString(<span class="hljs-string">"Social-LoadingEstimates"</span>, <span class="hljs-string">"{}"</span>)), estimateID, startTime, intervalID = <span class="hljs-number">0</span>;
    <span class="hljs-keyword">this</span>.showLoadingUI = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
        <span class="hljs-built_in">window</span> = Ti.UI.createWindow({
            backgroundColor : <span class="hljs-string">"transparent"</span>,
            zIndex : <span class="hljs-number">1000</span>
        }), Ti.Android || (<span class="hljs-built_in">window</span>.opacity = <span class="hljs-number">0</span>, <span class="hljs-built_in">window</span>.transform = Ti.UI.create2DMatrix().scale(<span class="hljs-number">0</span>)), view = Ti.UI.createView({
            top : <span class="hljs-number">10</span>,
            right : <span class="hljs-number">10</span>,
            bottom : <span class="hljs-number">10</span>,
            left : <span class="hljs-number">10</span>,
            backgroundColor : <span class="hljs-string">"#aa256e"</span>,
            border : <span class="hljs-number">10</span>,
            borderColor : <span class="hljs-string">"#aa256e"</span>,
            borderRadius : <span class="hljs-number">10</span>,
            borderWidth : <span class="hljs-number">4</span>,
            zIndex : -<span class="hljs-number">1</span>
        });
        <span class="hljs-keyword">var</span> closeLabel = Ti.UI.createButton({
            font : {
                fontSize : <span class="hljs-number">11</span>,
                fontWeight : <span class="hljs-string">"bold"</span>
            },
            backgroundColor : <span class="hljs-string">"#aa256e"</span>,
            borderColor : <span class="hljs-string">"#aa256e"</span>,
            color : <span class="hljs-string">"#fff"</span>,
            style : <span class="hljs-number">0</span>,
            borderRadius : <span class="hljs-number">6</span>,
            title : <span class="hljs-string">"X"</span>,
            top : <span class="hljs-number">8</span>,
            right : <span class="hljs-number">8</span>,
            width : <span class="hljs-number">30</span>,
            height : <span class="hljs-number">30</span>
        });
        closeLabel.addEventListener(<span class="hljs-string">"click"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{destroyAuthorizeUI();}), <span class="hljs-built_in">window</span>.open();
        <span class="hljs-keyword">var</span> offset = <span class="hljs-number">0</span>;
        Ti.Android &amp;&amp; ( offset = <span class="hljs-string">"10dp"</span>), loadingContainer = Ti.UI.createView({
            top : offset,
            right : offset,
            bottom : offset,
            left : offset,
            backgroundColor : <span class="hljs-string">"#fff"</span>
        }), loadingView = Ti.UI.createProgressBar({
            top : <span class="hljs-number">10</span>,
            right : <span class="hljs-number">10</span>,
            bottom : <span class="hljs-number">10</span>,
            left : <span class="hljs-number">10</span>,
            min : <span class="hljs-number">0</span>,
            max : <span class="hljs-number">1</span>,
            value : <span class="hljs-number">0.5</span>,
            message : <span class="hljs-string">"Loading, please wait."</span>,
            backgroundColor : <span class="hljs-string">"#fff"</span>,
            font : {
                fontSize : <span class="hljs-number">14</span>,
                fontWeight : <span class="hljs-string">"bold"</span>
            },
            style : <span class="hljs-number">0</span>
        }), view.add(loadingContainer), loadingContainer.add(loadingView), loadingView.show(), <span class="hljs-built_in">window</span>.add(view), <span class="hljs-built_in">window</span>.add(closeLabel);
        <span class="hljs-keyword">if</span> (!Ti.Android) {
            <span class="hljs-keyword">var</span> tooBig = Ti.UI.createAnimation({
                transform : Ti.UI.create2DMatrix().scale(<span class="hljs-number">1.1</span>),
                opacity : <span class="hljs-number">1</span>,
                duration : <span class="hljs-number">350</span>
            }), shrinkBack = Ti.UI.createAnimation({
                transform : Ti.UI.create2DMatrix(),
                duration : <span class="hljs-number">400</span>
            });
            tooBig.addEventListener(<span class="hljs-string">"complete"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-built_in">window</span>.animate(shrinkBack);
            }), <span class="hljs-built_in">window</span>.animate(tooBig);
        }
        showLoading();
    }, <span class="hljs-keyword">this</span>.showAuthorizeUI = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pUrl, pReceivePinCallback</span>) </span>{
        receivePinCallback = pReceivePinCallback;
        <span class="hljs-keyword">var</span> offset = <span class="hljs-number">0</span>;
        Ti.Android &amp;&amp; ( offset = <span class="hljs-string">"10dp"</span>), webView = Ti.UI.createWebView({
            url : pUrl,
            top : offset,
            right : offset,
            bottom : offset,
            left : offset,
            autoDetect : [Ti.UI.AUTOLINK_NONE]
        }), webView.addEventListener(<span class="hljs-string">"beforeload"</span>, showLoading), webView.addEventListener(<span class="hljs-string">"load"</span>, authorizeUICallback), view.add(webView);
    }, <span class="hljs-keyword">this</span>.getAccessToken = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">pUrl, callback</span>) </span>{
        accessor.tokenSecret = requestTokenSecret;
        <span class="hljs-keyword">var</span> message = createMessage(pUrl);
        message.parameters.push([<span class="hljs-string">"oauth_token"</span>, requestToken]), message.parameters.push([<span class="hljs-string">"oauth_verifier"</span>, pin]), OAuth.setTimestampAndNonce(message), OAuth.SignatureMethod.sign(message, accessor);
        <span class="hljs-keyword">var</span> parameterMap = OAuth.getParameterMap(message.parameters), client = Ti.Network.createHTTPClient({
            onload : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-keyword">var</span> responseParams = OAuth.getParameterMap(<span class="hljs-keyword">this</span>.responseText);
                accessToken = responseParams.oauth_token, accessTokenSecret = responseParams.oauth_token_secret, callback({
                    success : !<span class="hljs-number">0</span>
                });
            },
            onerror : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                Ti.API.error(<span class="hljs-string">"Social.js: FAILED to getAccessToken!"</span>), Ti.API.error(<span class="hljs-keyword">this</span>.responseText), callback({
                    success : !<span class="hljs-number">1</span>
                });
            }
        });
        client.open(<span class="hljs-string">"POST"</span>, pUrl), client.send(parameterMap);
    }, <span class="hljs-keyword">this</span>.send = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options, callback</span>) </span>{
        <span class="hljs-keyword">var</span> pUrl = options.url, pParameters = options.parameters, pTitle = options.title, pSuccessMessage = options.onSuccess, pErrorMessage = options.onError;
        <span class="hljs-keyword">if</span> (accessToken == <span class="hljs-literal">null</span> || accessTokenSecret == <span class="hljs-literal">null</span>) {
            Ti.API.debug(<span class="hljs-string">"The send status cannot be processed as the client doesn't have an access token. Authorize before trying to send."</span>);
            <span class="hljs-keyword">return</span>;
        }
        accessor.tokenSecret = accessTokenSecret;
        <span class="hljs-keyword">var</span> message = createMessage(pUrl);
        message.parameters.push([<span class="hljs-string">"oauth_token"</span>, accessToken]);
        <span class="hljs-keyword">for</span> (p <span class="hljs-keyword">in</span> pParameters)
        message.parameters.push(pParameters[p]);
        OAuth.setTimestampAndNonce(message), OAuth.SignatureMethod.sign(message, accessor);
        <span class="hljs-keyword">var</span> parameterMap = OAuth.getParameterMap(message.parameters), client = Ti.Network.createHTTPClient({
            onload : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                client.status == <span class="hljs-number">200</span> ? pSuccessMessage &amp;&amp; pSuccessMessage(<span class="hljs-keyword">this</span>.responseText) : pErrorMessage &amp;&amp; pErrorMessage(<span class="hljs-keyword">this</span>.responseText);
            },
            onerror : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                Ti.API.error(<span class="hljs-string">"Social.js: FAILED to send a request!"</span>), pErrorMessage &amp;&amp; pErrorMessage(<span class="hljs-keyword">this</span>.responseText);
            }
        });
        client.open(<span class="hljs-string">"POST"</span>, pUrl), client.send(parameterMap);
    };
}, supportedSites = {
    twitter : {
        accessToken : <span class="hljs-string">"https://api.twitter.com/oauth/access_token"</span>,
        requestToken : <span class="hljs-string">"https://api.twitter.com/oauth/request_token"</span>,
        authorize : <span class="hljs-string">"https://api.twitter.com/oauth/authorize?"</span>,
        update : <span class="hljs-string">"https://api.twitter.com/1.1/statuses/update.json"</span>
    }
};

exports.create = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">settings</span>) </span>{
    <span class="hljs-keyword">var</span> site = (settings.site || <span class="hljs-string">"twitter"</span>).toLowerCase(), adapter = <span class="hljs-keyword">new</span> OAuthAdapter(settings.consumerSecret, settings.consumerKey, <span class="hljs-string">"HMAC-SHA1"</span>);
    adapter.loadAccessToken(site);
    <span class="hljs-keyword">var</span> urls = supportedSites[site];
    <span class="hljs-keyword">return</span> urls == <span class="hljs-literal">null</span> ? (alert(<span class="hljs-string">"The Social.js module does not support "</span> + site + <span class="hljs-string">" yet!"</span>), <span class="hljs-literal">null</span>) : {
        isAuthorized : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> adapter.isAuthorized();
        },
        deauthorize : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            adapter.clearAccessToken(site);
        },
        authorize : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">callback</span>) </span>{
            <span class="hljs-keyword">if</span> (!adapter.isAuthorized()) {
                <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">receivePin</span>(<span class="hljs-params"></span>) </span>{
                    adapter.getAccessToken(urls.accessToken, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                        evt.success ? (adapter.saveAccessToken(site), callback &amp;&amp; callback()) : alert(<span class="hljs-string">"Twitter did not give us an access token!"</span>);
                    });
                }


                adapter.showLoadingUI(), adapter.getRequestToken(urls.requestToken, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">evt</span>) </span>{
                    evt.success ? adapter.showAuthorizeUI(urls.authorize + evt.token, receivePin) : alert(<span class="hljs-string">"Twitter did not give us a request token!"</span>);
                });
            } <span class="hljs-keyword">else</span>
                callback &amp;&amp; callback();
        },
        shareImage : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
            <span class="hljs-keyword">this</span>.authorize(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                adapter.sendTwitterImage({
                    params : {
                        media : options.image,
                        status : options.message,
                    },
                    title : <span class="hljs-string">"Twitter"</span>,
                    onSuccess : options.success,
                    onError : options.error
                });
            });
        },
        share : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
            <span class="hljs-keyword">this</span>.authorize(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                adapter.send({
                    url : urls.update,
                    parameters : [[<span class="hljs-string">"status"</span>, options.message]],
                    title : <span class="hljs-string">"Twitter"</span>,
                    onSuccess : options.success,
                    onError : options.error
                });
            });
        }
    };
};
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="June 19th 2013, 4:25:45 pm">June 19th 2013</span>
								by <span class='authorname'>Inzori DevTeam</span><br>
								<a class="icon-bg icon-link" href="question/153811/image-sharing-on-twitter.html#answer-264524" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>-3</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
