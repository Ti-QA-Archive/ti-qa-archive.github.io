<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>app crash after 5 shoots of photos Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>app crash after 5 shoots of photos</h1>
		</header>
		<section>
			<p>someone can help me with that?</p>
<p>The app Crashs after I took 5 photos and display them</p>
<pre><code class="hljs">var salvaFoto = function( row ){

        var filename = row.nome;

        var f = <span class="hljs-constant">Ti</span>.<span class="hljs-constant">Filesystem</span>.getFile( <span class="hljs-constant">Ti</span>.<span class="hljs-constant">Filesystem</span>.applicationDataDirectory, filename );
        f.write( row.foto );

        var newRow = {
            <span class="hljs-symbol">nome:</span> filename,
            <span class="hljs-symbol">path:</span> f.nativePath
        };

        console.log( <span class="hljs-string">'nativePath: '</span> + f.nativePath );


        var array = arrayImovel[<span class="hljs-number">0</span>].imagens;

        console.log( <span class="hljs-string">'array( imagens ): '</span> + array );

        array.push( newRow );

        console.log( <span class="hljs-string">'arrayImovel[0].imagens: '</span> + array );


        var img = <span class="hljs-constant">Ti</span>.<span class="hljs-constant">UI</span>.createImageView({
            <span class="hljs-symbol">image:</span> f.nativePath,
            <span class="hljs-symbol">height:</span> <span class="hljs-number">96</span>,
            <span class="hljs-symbol">left:</span> <span class="hljs-number">8</span>,
            <span class="hljs-symbol">top:</span> <span class="hljs-number">8</span>,
            <span class="hljs-symbol">width:</span> <span class="hljs-number">96</span>,
            <span class="hljs-symbol">foto:</span> f.nativePath
        });

        img.addEventListener( <span class="hljs-string">'click'</span>, function(e){

            var viewFoto = <span class="hljs-constant">Ti</span>.<span class="hljs-constant">UI</span>.createView();

            var imgFoto = <span class="hljs-constant">Ti</span>.<span class="hljs-constant">UI</span>.createImageView({
                <span class="hljs-symbol">image:</span> e.source.foto
            });

            imgFoto.addEventListener( <span class="hljs-string">'click'</span>, function(){
                win4View.remove( viewFoto );    
            });

            viewFoto.add( imgFoto );

            win4View.add( viewFoto );
        });

        view.add( img );
    };
    <span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span>
    /<span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">/
    /</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">/
    var populaScrollView = function(imagem){

        var nomeFoto = ID() + ".png";

        console.log( 'nomeFoto: ' + nomeFoto );

        var row = {
            nome : nomeFoto,
            foto: imagem
        };

        salvaFoto( row );
    };

/</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">/
    /</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">/
    /</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">//</span><span class="hljs-regexp">/
    var tirarFotoBtn = Ti.UI.createButton({
        backgroundColor: 'transparent',
        backgroundImage: '/imagens</span><span class="hljs-regexp">/tela1/entrar</span>Btn.png<span class="hljs-string">',
        backgroundSelectedImage: '</span>/imagens/tela1/entrarBtn_over.png<span class="hljs-string">',
        width: 180,
        height: 43,
        bottom: 5,
        title: L('</span><span class="hljs-constant">Trad_Tirar_foto</span><span class="hljs-string">', '</span><span class="hljs-constant">Tirar</span> <span class="hljs-constant">Foto</span><span class="hljs-string">'),
        font: {
            fontFamily: '</span><span class="hljs-constant">Helvetica</span>-bold<span class="hljs-string">',
            fontSize: 16
        },
        color: '</span><span class="hljs-comment">#fff'</span>
    });
    win4View.add( tirarFotoBtn );

    tirarFotoBtn.addEventListener( <span class="hljs-string">'click'</span>, function(){

        <span class="hljs-regexp">//console</span>.log( <span class="hljs-string">'arrayImovel[0].imagens: '</span> + arrayImovel[<span class="hljs-number">0</span>].imagens );

        setTimeout( function(){

                <span class="hljs-constant">Titanium</span>.<span class="hljs-constant">Media</span>.showCamera({

                <span class="hljs-symbol">success:</span>function(event) {
                    <span class="hljs-regexp">//</span> called <span class="hljs-keyword">when</span> media returned from the camera
                    <span class="hljs-constant">Ti</span>.<span class="hljs-constant">API</span>.debug(<span class="hljs-string">'Our type was: '</span>+event.mediaType);

                    populaScrollView( event.media );

                },
                <span class="hljs-symbol">cancel:</span>function() {
                    <span class="hljs-regexp">//</span> called <span class="hljs-keyword">when</span> user cancels taking a picture
                },
                <span class="hljs-symbol">error:</span>function(error) {
                    <span class="hljs-regexp">//</span> called <span class="hljs-keyword">when</span> there<span class="hljs-string">'s an error
                    var a = Titanium.UI.createAlertDialog({title:'</span><span class="hljs-constant">Camera</span><span class="hljs-string">'});
                    if (error.code == Titanium.Media.NO_CAMERA) {
                        a.setMessage('</span><span class="hljs-constant">Please</span> run this test on device<span class="hljs-string">');
                    } else {
                        a.setMessage('</span><span class="hljs-constant">Unexpected</span> <span class="hljs-symbol">error:</span> <span class="hljs-string">' + error.code);
                    }
                    a.show();
                },
                //saveToPhotoGallery:true,
                // allowEditing and mediaTypes are iOS-only settings
                allowEditing: false,
                mediaTypes: [Ti.Media.MEDIA_TYPE_PHOTO]

            });


        }, 700 );
    });</span>
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="April 18th 2014, 1:49:56 am">April 18th 2014</span>
				by <span class='authorname'>Douglas Hennrich</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>camera</span></li>
					
						<li><span class='tagname'>ios</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>happen to have a useful error log?</p>
<p>maybe even tooling versions?</p>
<p>simulator or device?</p>
</div>
							<div class="author">
								&mdash; commented <span title="April 18th 2014, 12:37:50 pm">April 18th 2014</span>
								by <span class='authorname'>Stephen Feather</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>only show Memory Warning on Xcode and them &quot;Unexpected Error&quot;â¦ nothing else =&#x2F;</p>
<p>I&#39;m running on my device ( iPhone 4 ) and I&#39;m using 3.2.2GA version</p>
</div>
							<div class="author">
								&mdash; commented <span title="April 18th 2014, 1:09:07 pm">April 18th 2014</span>
								by <span class='authorname'>Douglas Hennrich</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-277944">
				
						<section>
							<p>Looking at your code, its no wonder.  You are passing the blob around all over the place.  Whats the camera on an iphone 4? 5mp.  iphone 5? 8mp.  Immediately save the blob to a file, null the variables you use, then pass around a url&#x2F;path instead.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 19th 2014, 4:41:15 pm">April 19th 2014</span>
								by <span class='authorname'>Stephen Feather</span><br>
								<a class="icon-bg icon-link" href="../../question/165787/app-crash-after-5-shoots-of-photos.html#answer-277944" rel="permalink">permalink</a>
							</div>

							<h5>8 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>run the app in the xcode instruments, bet you see the leak.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 19th 2014, 4:42:51 pm">April 19th 2014</span>
											by <span class='authorname'>Stephen Feather</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I change the code to:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> populaScrollView = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">imagem</span>)</span>{

        <span class="hljs-keyword">var</span> nomeFoto = ID() + <span class="hljs-string">".png"</span>;

        <span class="hljs-built_in">console</span>.log( <span class="hljs-string">'nomeFoto: '</span> + nomeFoto );

        <span class="hljs-keyword">var</span> f = Ti.Filesystem.getFile( Ti.Filesystem.applicationDataDirectory, nomeFoto );
        f.write( imagem );

        <span class="hljs-keyword">var</span> newRow = {
            nome: nomeFoto,
            path: f.nativePath
        };

        <span class="hljs-built_in">console</span>.log( <span class="hljs-string">'nativePath: '</span> + f.nativePath );

        arrayImovel[<span class="hljs-number">0</span>].imagens.push( newRow );

        <span class="hljs-built_in">console</span>.log( <span class="hljs-string">'arrayImovel[0].imagens: '</span> + arrayImovel[<span class="hljs-number">0</span>].imagens );


        <span class="hljs-keyword">var</span> img = Ti.UI.createImageView({
            image: f.nativePath,
            height: <span class="hljs-number">96</span>,
            left: <span class="hljs-number">8</span>,
            top: <span class="hljs-number">8</span>,
            width: <span class="hljs-number">96</span>,
            foto: f.nativePath
        });

        img.addEventListener( <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{

            <span class="hljs-keyword">var</span> viewFoto = Ti.UI.createView();

            <span class="hljs-keyword">var</span> imgFoto = Ti.UI.createImageView({
                image: e.source.foto
            });

            imgFoto.addEventListener( <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{
                win4View.remove( viewFoto );    
            });

            viewFoto.add( imgFoto );

            win4View.add( viewFoto );
        });

        view.add( img );

        imagem = <span class="hljs-literal">null</span>;
        f = <span class="hljs-literal">null</span>;
        nomeFoto = <span class="hljs-literal">null</span>;
    };
    <span class="hljs-comment">////////////////////</span>
    <span class="hljs-comment">////////////////////////////////////////////////////////</span>
    <span class="hljs-comment">////////////////////</span>
    <span class="hljs-keyword">var</span> tirarFotoBtn = Ti.UI.createButton({
        backgroundColor: <span class="hljs-string">'transparent'</span>,
        backgroundImage: <span class="hljs-string">'/imagens/tela1/entrarBtn.png'</span>,
        backgroundSelectedImage: <span class="hljs-string">'/imagens/tela1/entrarBtn_over.png'</span>,
        width: <span class="hljs-number">180</span>,
        height: <span class="hljs-number">43</span>,
        bottom: <span class="hljs-number">5</span>,
        title: L(<span class="hljs-string">'Trad_Tirar_foto'</span>, <span class="hljs-string">'Tirar Foto'</span>),
        font: {
            fontFamily: <span class="hljs-string">'Helvetica-bold'</span>,
            fontSize: <span class="hljs-number">16</span>
        },
        color: <span class="hljs-string">'#fff'</span>
    });
    win4View.add( tirarFotoBtn );

    tirarFotoBtn.addEventListener( <span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

        <span class="hljs-comment">//console.log( 'arrayImovel[0].imagens: ' + arrayImovel[0].imagens );</span>

        setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

                Titanium.Media.showCamera({

                success:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                    <span class="hljs-comment">// called when media returned from the camera</span>
                    Ti.API.debug(<span class="hljs-string">'Our type was: '</span>+event.mediaType);

                    populaScrollView( event.media );

                },
                cancel:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                    <span class="hljs-comment">// called when user cancels taking a picture</span>
                },
                error:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
                    <span class="hljs-comment">// called when there's an error</span>
                    <span class="hljs-keyword">var</span> a = Titanium.UI.createAlertDialog({title:<span class="hljs-string">'Camera'</span>});
                    <span class="hljs-keyword">if</span> (error.code == Titanium.Media.NO_CAMERA) {
                        a.setMessage(<span class="hljs-string">'Please run this test on device'</span>);
                    } <span class="hljs-keyword">else</span> {
                        a.setMessage(<span class="hljs-string">'Unexpected error: '</span> + error.code);
                    }
                    a.show();
                },
                <span class="hljs-comment">//saveToPhotoGallery:true,</span>
                <span class="hljs-comment">// allowEditing and mediaTypes are iOS-only settings</span>
                allowEditing: <span class="hljs-literal">false</span>,
                mediaTypes: [Ti.Media.MEDIA_TYPE_PHOTO]

            });


        }, <span class="hljs-number">700</span> );
    });
</code></pre><p>and still crashing after 5 photos =&#x2F;</p>
<p>I start to receive the memory warning alert on xcode on the 4th photo.</p>
<p>I&#39;m running on my iPhone 4</p>
<p>should I change the populaScrollView function to do all inside camera&#39;s function?</p>
<p>Thanks</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 19th 2014, 6:33:29 pm">April 19th 2014</span>
											by <span class='authorname'>Douglas Hennrich</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Why are you delaying the opening of the camera?</p>
<pre><code class="hljs">setTimeout( <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{})
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="April 19th 2014, 6:53:02 pm">April 19th 2014</span>
											by <span class='authorname'>Stephen Feather</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>You are loading the full sized image in to only show 96x96?</p>
<pre><code class="hljs">var img = Ti.UI.createImageView({
            image: f.nativePath,
            height: <span class="hljs-number">96</span>,
            left: <span class="hljs-number">8</span>,
            top: <span class="hljs-number">8</span>,
            width: <span class="hljs-number">96</span>,
            foto: f.nativePath
        });
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="April 19th 2014, 6:54:52 pm">April 19th 2014</span>
											by <span class='authorname'>Stephen Feather</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Keep in mind, that when you load that image it, in the view it is uncompressed.  PNG&#x2F;JPG doesn&#39;t matter, its raw and has a huge memory footprint.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 19th 2014, 6:55:48 pm">April 19th 2014</span>
											by <span class='authorname'>Stephen Feather</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I&#39;m using the setTimeout just to make button over effectâ¦ and I think I&#39;m using the full size imageâ¦ don&#39;t know how to scale their sizeâ¦ I need the original size and the &quot;thumbnail&quot; size to show on the screen like an instagram thumbnail&#39;s photo</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 19th 2014, 6:56:36 pm">April 19th 2014</span>
											by <span class='authorname'>Douglas Hennrich</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>getting this error when app crash<br><code>Terminated due to Memory Pressure</code></p>
</p>
										<div class="author">
											&mdash; commented <span title="April 19th 2014, 7:17:21 pm">April 19th 2014</span>
											by <span class='authorname'>Douglas Hennrich</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Ok, that sounds about right.  I&#39;d take a look through <a href="http:&#x2F;&#x2F;gitt.io&#x2F;">http:&#x2F;&#x2F;gitt.io&#x2F;</a> and see if there are any image manipulation&#x2F;resizing modules that might work to generate your thumbnails for you.</p>
<p>I&#39;d suggest the ti.imagefactory, but have a note on it.  Seems since recent ios updates, it does resize the images, but doesn&#39;t change the file size.  Now, in your case, that might be ok.</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 19th 2014, 9:13:46 pm">April 19th 2014</span>
											by <span class='authorname'>Stephen Feather</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-277959">
				
						<section>
							<p>Got it</p>
<p>As you said @Stephen</p>
<p>the problem was in the resize the imageâ¦</p>
<p>I make an imageView and them make an toImage() and save it as my thumbnail. In my populaScrollView function I display my thumbnail instead my full size image.</p>
<p>Thanks for lighting the way =)</p>
<pre><code class="hljs"><span class="hljs-variable"><span class="hljs-keyword">var</span> resize</span> = Ti.UI.createImageView({
    image: f.nativePath,
    width: <span class="hljs-number">96</span>,
    height: <span class="hljs-number">96</span>
});

<span class="hljs-variable"><span class="hljs-keyword">var</span> resize2</span> = resize.toImage();

<span class="hljs-variable"><span class="hljs-keyword">var</span> f2</span> = Ti.Filesystem.getFile( Ti.Filesystem.applicationDataDirectory, nomeFoto + '_96x96.jpg' );
f2.write( resize2 );
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 20th 2014, 2:05:28 pm">April 20th 2014</span>
								by <span class='authorname'>Douglas Hennrich</span><br>
								<a class="icon-bg icon-link" href="../../question/165787/app-crash-after-5-shoots-of-photos.html#answer-277959" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
