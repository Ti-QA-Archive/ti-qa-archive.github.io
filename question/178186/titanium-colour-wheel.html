<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Titanium Colour Wheel Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Titanium Colour Wheel</h1>
		</header>
		<section>
			<p>Hi All,</p>
<p>I am trying to create a colour wheel using titanium i have been using this great module as a starting point </p>
<p><a href="https:&#x2F;&#x2F;github.com&#x2F;t3hi3x&#x2F;Appcelerator-Titanium-Mobile-Color-Picker&#x2F;blob&#x2F;master&#x2F;Resources&#x2F;color_picker.js">Colour picker</a></p>
<p>But i am really in need of a colour wheel so far the best way i can think to do this is to use one of the canvas modules here.<br><a href="https:&#x2F;&#x2F;marketplace.appcelerator.com&#x2F;listing?q=canvas#!&#x2F;list&#x2F;page&#x2F;1&#x2F;search=canvas">Canvas Modules</a></p>
<p>Now i am trying to recreate this <a href="http:&#x2F;&#x2F;ariya.ofilabs.com&#x2F;2011&#x2F;02&#x2F;color-wheel-on-canvas.html">WHEEL CANVAS</a> and they use a image like this one.</p>
<p>The down point that i cant figure out is this is the code from the jquery version both using this colourwheel graphic.<br><a href="https:&#x2F;&#x2F;s3bubble.com&#x2F;share&#x2F;?file=kHYeLLFSO">COLOUR WHEEL</a></p>
<pre><code class="hljs">$(<span class="hljs-string">'#picker'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{ <span class="hljs-comment">// mouse move handler</span>
<span class="hljs-comment">// get coordinates of current position</span>
            <span class="hljs-keyword">var</span> canvasOffset = $(canvas).offset();
            <span class="hljs-keyword">var</span> canvasX = <span class="hljs-built_in">Math</span>.floor(e.pageX - canvasOffset.left);
            <span class="hljs-keyword">var</span> canvasY = <span class="hljs-built_in">Math</span>.floor(e.pageY - canvasOffset.top);

            alert(<span class="hljs-string">"canvasX "</span> + canvasX + <span class="hljs-string">" canvasY "</span> + canvasY);

            <span class="hljs-comment">// get current pixel</span>
            <span class="hljs-keyword">var</span> imageData = ctx.getImageData(canvasX, canvasY, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
            <span class="hljs-keyword">var</span> pixel = imageData.data;
            alert(<span class="hljs-built_in">JSON</span>.stringify(pixel));
});
</code></pre><p>ctx being the image and then it grabs the image data getImageData how do i recreate this with titanium.</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> HSImage = Titanium.UI.createImageView({
        borderColor : <span class="hljs-string">'#000'</span>,
        borderWidth : <span class="hljs-number">1</span>,
        image : <span class="hljs-string">'images/colorwheel2.png'</span>,
        height : <span class="hljs-number">300</span>,
        width : <span class="hljs-number">300</span>,
        top : <span class="hljs-number">0</span>,
        left : <span class="hljs-number">0</span>
    });

    colourPicker.add(HSImage);

HSImage.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> canvasX = <span class="hljs-built_in">Math</span>.floor(x - HSImage.left);
        <span class="hljs-keyword">var</span> canvasY = <span class="hljs-built_in">Math</span>.floor(y - HSImage.top);


        alert(<span class="hljs-string">"canvasX "</span> + canvasX + <span class="hljs-string">" canvasY "</span> + canvasY);

       <span class="hljs-comment">// NOT SURE HOW TO getImageData SIMILAR TO CANVAS</span>

        <span class="hljs-comment">//var data = HSImage.getRect(canvasX, canvasY, 1, 1);</span>

        <span class="hljs-comment">//Ti.API.info(JSON.stringify(data));</span>

        <span class="hljs-comment">//var blob = HSImage.toBlob();</span>

        <span class="hljs-comment">//Ti.API.info(JSON.stringify(blob));</span>
});
</code></pre><p>Would love some help on this? Has anyone achieved this.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="October 5th 2014, 7:30:36 am">October 5th 2014</span>
				by <span class='authorname'>Samuel East</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>canvas</span></li>
					
						<li><span class='tagname'>colour</span></li>
					
						<li><span class='tagname'>picker</span></li>
					
						<li><span class='tagname'>ui</span></li>
					
						<li><span class='tagname'>wheel</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-282889">
				
						<section>
							<p>app.js</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> i = Ti.UI.createImageView();

Ti.App.addEventListener(<span class="hljs-string">'app:returnImage'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(b)</span> </span>{

    <span class="hljs-keyword">var</span> img = b.image;
    <span class="hljs-keyword">var</span> index = img.indexOf(<span class="hljs-string">'base64,'</span>);
    img = img.substring(index + <span class="hljs-string">'base64,'</span>.length);

    i.image = Ti.Utils.base64decode(img);
});

<span class="hljs-keyword">var</span> w = Ti.UI.createWindow({
    backgroundColor : <span class="hljs-string">'black'</span>
});

<span class="hljs-keyword">var</span> wv = Ti.UI.createWebView({
    url : <span class="hljs-string">'/content.html'</span>,
    visible : <span class="hljs-literal">false</span>
});

w.add(i);

w.add(wv);

<span class="hljs-keyword">var</span> b = Ti.UI.createButton({
    title : <span class="hljs-string">'Click'</span>,
    height : <span class="hljs-number">50</span>,
    width : Ti.UI.FILL,
    bottom : <span class="hljs-number">0</span>
});

b.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    Ti.App.fireEvent(<span class="hljs-string">'pageReady'</span>);
});

w.add(b);
w.open();
</code></pre><p>&#x2F;content.html</p>
<pre><code class="hljs">&lt;html&gt;
    &lt;head&gt;
        &lt;script&gt;
            var img = <span class="hljs-keyword">new</span> Image();
            Ti.App.addEventListener(<span class="hljs-string">'pageReady'</span>, function(e) {

                <span class="hljs-keyword">try</span> {

                    var el = document.getElementById(<span class="hljs-string">'surface'</span>),

                        context = el.getContext(<span class="hljs-string">'2d'</span>),
                        <span class="hljs-variable">width</span> = window.innerWidth,
                        <span class="hljs-variable">height</span> = window.innerHeight,
                        cx = <span class="hljs-variable">width</span> / <span class="hljs-number">2</span>,
                        cy = <span class="hljs-variable">height</span> / <span class="hljs-number">2</span>,
                        radius = <span class="hljs-variable">width</span> / <span class="hljs-number">2.3</span>,
                        imageData,
                        <span class="hljs-variable">pixels</span>,
                        <span class="hljs-built_in">hue</span>,
                        sat,
                        value,
                        i = <span class="hljs-number">0</span>,
                        x,
                        y,
                        rx,
                        ry,
                        d,
                        f,
                        g,
                        p,
                        u,
                        v,
                        w,
                        rgb;

                    el.<span class="hljs-variable">width</span> = <span class="hljs-variable">width</span>;
                    el.<span class="hljs-variable">height</span> = <span class="hljs-variable">height</span>;
                    imageData = context.createImageData(<span class="hljs-variable">width</span>, <span class="hljs-variable">height</span>);
                    <span class="hljs-variable">pixels</span> = imageData.data;

                    <span class="hljs-keyword">for</span> ( y = <span class="hljs-number">0</span>; y &lt; <span class="hljs-variable">height</span>; y = y + <span class="hljs-number">1</span>) {
                        <span class="hljs-keyword">for</span> ( x = <span class="hljs-number">0</span>; x &lt; <span class="hljs-variable">width</span>; x = x + <span class="hljs-number">1</span>,
                        i = i + <span class="hljs-number">4</span>) {
                            rx = x - cx;
                            ry = y - cy;
                            d = rx * rx + ry * ry;
                            <span class="hljs-keyword">if</span> (d &lt; radius * radius) {
                                <span class="hljs-built_in">hue</span> = <span class="hljs-number">6</span> * (Math.<span class="hljs-built_in">atan2</span>(ry, rx) + Math.<span class="hljs-constant">PI</span>) / (<span class="hljs-number">2</span> * Math.<span class="hljs-constant">PI</span>);
                                sat = Math.<span class="hljs-built_in">sqrt</span>(d) / radius;
                                g = Math.<span class="hljs-built_in">floor</span>(<span class="hljs-built_in">hue</span>);
                                f = <span class="hljs-built_in">hue</span> - g;
                                u = <span class="hljs-number">255</span> * (<span class="hljs-number">1</span> - sat);
                                v = <span class="hljs-number">255</span> * (<span class="hljs-number">1</span> - sat * f);
                                w = <span class="hljs-number">255</span> * (<span class="hljs-number">1</span> - sat * (<span class="hljs-number">1</span> - f));
                                <span class="hljs-variable">pixels</span>[i] = [<span class="hljs-number">255</span>, v, u, u, w, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>][g];
                                <span class="hljs-variable">pixels</span>[i + <span class="hljs-number">1</span>] = [w, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, v, u, u, w][g];
                                <span class="hljs-variable">pixels</span>[i + <span class="hljs-number">2</span>] = [u, u, w, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, v, u][g];
                                <span class="hljs-variable">pixels</span>[i + <span class="hljs-number">3</span>] = <span class="hljs-number">255</span>;
                            }
                        }
                    }

                    context.putImageData(imageData, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);
                    document.body.style.backgroundColor = <span class="hljs-string">'transparent'</span>;
                    document.body.style.margin = <span class="hljs-string">'0px'</span>;

                    var retImg = el.toDataURL(<span class="hljs-string">'image/png'</span>);

                    Ti.App.fireEvent(<span class="hljs-string">"app:returnImage"</span>, {
                        <span class="hljs-built_in">image</span> : retImg
                    });
                } <span class="hljs-keyword">catch</span> (e) {
                    Ti.API.info(e);
                }

            });

        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;canvas id=<span class="hljs-string">"surface"</span>&gt;&lt;/canvas&gt;
    &lt;/body&gt;
&lt;/html&gt;
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="October 5th 2014, 1:28:00 pm">October 5th 2014</span>
								by <span class='authorname'>Nick Milner</span><br>
								<a class="icon-bg icon-link" href="question/178186/titanium-colour-wheel.html#answer-282889" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Nick thanks for the response i tried something similar using a webview but it still remained difficult also using a webview was really slow and not very responsive</p>
</p>
										<div class="author">
											&mdash; commented <span title="October 5th 2014, 2:10:07 pm">October 5th 2014</span>
											by <span class='authorname'>Samuel East</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Here is what i tried<br>app.js</p>
<pre><code class="hljs">Ti.App.addEventListener(<span class="hljs-string">'app:returnRGB'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(evt)</span> </span>{

    Ti.API.info(evt);

    w.backgroundColor = <span class="hljs-string">"rgba("</span> + evt.r + <span class="hljs-string">","</span> + evt.g + <span class="hljs-string">","</span> + evt.b + <span class="hljs-string">",1)"</span>;
});

<span class="hljs-keyword">var</span> w = Ti.UI.createWindow({
    backgroundColor : <span class="hljs-string">'#white'</span>
});

<span class="hljs-keyword">var</span> wv = Ti.UI.createWebView({
    backgroundColor:<span class="hljs-string">'transparent'</span>,
    width : <span class="hljs-number">300</span>,
    height : <span class="hljs-number">300</span>,
    url : <span class="hljs-string">'/local.html'</span>,
    <span class="hljs-comment">//visible : false</span>
});

w.add(wv);

w.open();
</code></pre><p>local,html</p>
<pre><code class="hljs"><span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>Colour Picker<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">link</span> <span class="hljs-attribute">rel</span>=<span class="hljs-value">"stylesheet"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/css"</span> <span class="hljs-attribute">href</span>=<span class="hljs-value">"local.css"</span>/&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"jquery.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">src</span>=<span class="hljs-value">"local.js"</span>&gt;</span><span class="undefined"></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">canvas</span> <span class="hljs-attribute">id</span>=<span class="hljs-value">"picker"</span> <span class="hljs-attribute">var</span>=<span class="hljs-value">"2"</span> <span class="hljs-attribute">width</span>=<span class="hljs-value">"300"</span> <span class="hljs-attribute">height</span>=<span class="hljs-value">"300"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">canvas</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre><p>local.js</p>
<pre><code class="hljs">$(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

    <span class="hljs-comment">// create canvas and context objects</span>
    <span class="hljs-built_in">document</span>.body.style.backgroundColor = <span class="hljs-string">'transparent'</span>;
    <span class="hljs-built_in">document</span>.body.style.margin = <span class="hljs-string">'0px'</span>;
    <span class="hljs-keyword">var</span> canvas = <span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">'picker'</span>);
    canvas.style.backgroundColor = <span class="hljs-string">'transparent'</span>;
    <span class="hljs-keyword">var</span> ctx = canvas.getContext(<span class="hljs-string">'2d'</span>);

    <span class="hljs-comment">// drawing active image</span>
    <span class="hljs-keyword">var</span> image = <span class="hljs-keyword">new</span> Image();
    image.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        ctx.drawImage(image, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, image.width, image.height); <span class="hljs-comment">// draw the image on the canvas</span>
    };

    <span class="hljs-comment">// select desired colorwheel</span>
    <span class="hljs-keyword">var</span> imageSrc = <span class="hljs-string">'images/colorwheel1.png'</span>;

    image.src = imageSrc;

    $(<span class="hljs-string">'#picker'</span>).click(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{ <span class="hljs-comment">// mouse move handler</span>

            <span class="hljs-comment">// get coordinates of current position</span>
            <span class="hljs-keyword">var</span> canvasOffset = $(canvas).offset();
            <span class="hljs-keyword">var</span> canvasX = <span class="hljs-built_in">Math</span>.floor(e.pageX - canvasOffset.left);
            <span class="hljs-keyword">var</span> canvasY = <span class="hljs-built_in">Math</span>.floor(e.pageY - canvasOffset.top);
            <span class="hljs-comment">// get current pixel</span>
            <span class="hljs-keyword">var</span> imageData = ctx.getImageData(canvasX, canvasY, <span class="hljs-number">1</span>, <span class="hljs-number">1</span>);
            <span class="hljs-keyword">var</span> pixel = imageData.data;
            Ti.App.fireEvent(<span class="hljs-string">'app:returnRGB'</span>, { r: pixel[<span class="hljs-number">0</span>], g: pixel[<span class="hljs-number">1</span>], b: pixel[<span class="hljs-number">2</span>] });


    });
});
</code></pre><p>It works but its so slow i am really looking for something that will work with touchevents like this but a wheel.</p>
<p><a href="https:&#x2F;&#x2F;marketplace.appcelerator.com&#x2F;apps&#x2F;11032?restoreSearch=true#!overview">COLOUR WHEEL MODULE</a> </p>
<p>even that is not very responsive with the touch event firing really slow and has to catch up.</p>
</p>
										<div class="author">
											&mdash; commented <span title="October 5th 2014, 2:29:03 pm">October 5th 2014</span>
											by <span class='authorname'>Samuel East</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
