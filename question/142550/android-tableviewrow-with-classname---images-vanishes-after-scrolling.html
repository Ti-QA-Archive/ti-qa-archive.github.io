<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Android TableViewRow with className - images vanishes after scrolling! » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Android TableViewRow with className - images vanishes after scrolling!</h1>
		</header>
		<section>
			<p>Hi all,</p>
<p>I have an app that uses tableViewRow, with an imageView (external URL) and text label - with a className.</p>
<p>When it first load, the images appear fine but when I scroll down and then up again, the loaded images disappears??</p>
<p>I noticed if I remove className, the images stay but I need the className for performance. Or else it is just way too laggy.</p>
<p>Anyone faced this before? Really appreciate any help!</p>
<p>Code section that does this:</p>
<pre><code class="hljs">...

var imagelabel = Ti.UI.createView({
                <span class="hljs-variable">height</span>: <span class="hljs-number">75</span>,
                backgroundColor:<span class="hljs-string">'#000'</span>,
                left:<span class="hljs-number">0</span>,
                <span class="hljs-variable">width</span>:<span class="hljs-number">98</span>,    
            });

            bandThumbnail[c] =  Titanium.UI.createImageView({
                <span class="hljs-built_in">image</span>: <span class="hljs-string">'images/image-na-large.png'</span>,
                <span class="hljs-variable">width</span>:<span class="hljs-number">98</span>,    
                   backgroundColor:<span class="hljs-string">'#000'</span>

            });
            imagelabel.<span class="hljs-built_in">add</span>(bandThumbnail[c]);
            getExternalImage(title, <span class="hljs-string">'large'</span>,bandThumbnail[c]);


            var label = Ti.UI.createLabel({
                <span class="hljs-built_in">text</span>:title,

                font:{fontSize:<span class="hljs-number">16</span>,fontWeight:<span class="hljs-string">'bold'</span>},
                <span class="hljs-built_in">color</span>:<span class="hljs-string">'#FFFFFF'</span>,
                <span class="hljs-built_in">textAlign</span>:<span class="hljs-string">'left'</span>,
                top:<span class="hljs-number">5</span>,
                left:<span class="hljs-number">110</span>,
                <span class="hljs-variable">width</span>:<span class="hljs-number">185</span>,
                <span class="hljs-variable">height</span>:<span class="hljs-number">25</span>    
            });

            <span class="hljs-keyword">if</span>(isAndroid){
                label.wordWrap = <span class="hljs-keyword">false</span>;
            }

            var gigVenueLabel =  Titanium.UI.createLabel({

                <span class="hljs-built_in">text</span>:venueTown + <span class="hljs-string">", "</span> + venueName,
                font:{fontSize:<span class="hljs-number">12</span>,fontWeight:<span class="hljs-string">'bold'</span>},
                <span class="hljs-variable">width</span>:<span class="hljs-string">'auto'</span>,
                <span class="hljs-built_in">color</span>:<span class="hljs-string">'#ff0000'</span>,
                <span class="hljs-built_in">textAlign</span>:<span class="hljs-string">'left'</span>,
                top:<span class="hljs-number">30</span>,
                left:<span class="hljs-number">110</span>,
                <span class="hljs-variable">width</span>:<span class="hljs-number">180</span>,
                <span class="hljs-variable">height</span>:<span class="hljs-number">20</span>
            });

            var gigDate =  Titanium.UI.createLabel({
                <span class="hljs-built_in">text</span>:gigDate,
                font:{fontSize:<span class="hljs-number">12</span>,fontWeight:<span class="hljs-string">'bold'</span>},
                <span class="hljs-built_in">color</span>:<span class="hljs-string">'#FFFFFF'</span>,
                <span class="hljs-built_in">textAlign</span>:<span class="hljs-string">'left'</span>,
                top:<span class="hljs-number">48</span>,
                left:<span class="hljs-number">110</span>,
                <span class="hljs-variable">width</span>:<span class="hljs-number">190</span>,
                <span class="hljs-variable">height</span>:<span class="hljs-number">20</span>
            });

            var row = Ti.UI.createTableViewRow({index:c, <span class="hljs-variable">height</span>:<span class="hljs-number">75</span>,top:<span class="hljs-number">0</span>,backgroundImage: <span class="hljs-string">'./images/640x960/itemrow.png'</span>,selectedBackgroundColor:<span class="hljs-string">'#000'</span>});
...
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="September 22nd 2012, 8:50:18 am">September 22nd 2012</span>
				by <span class='authorname'>Terenze Yuen</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>classname</span></li>
					
						<li><span class='tagname'>imageview</span></li>
					
						<li><span class='tagname'>tableviewrow</span></li>
					
				</ul>
			

			<section>
				<h5>7 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>I&#39;ve noticed the same exact problem…!</p>
</div>
							<div class="author">
								&mdash; commented <span title="September 22nd 2012, 6:41:44 pm">September 22nd 2012</span>
								by <span class='authorname'>Michael Belkin</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Still no help??</p>
</div>
							<div class="author">
								&mdash; commented <span title="September 22nd 2012, 9:07:51 pm">September 22nd 2012</span>
								by <span class='authorname'>Terenze Yuen</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Hm…anyone guys?</p>
</div>
							<div class="author">
								&mdash; commented <span title="September 23rd 2012, 5:31:03 pm">September 23rd 2012</span>
								by <span class='authorname'>Terenze Yuen</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>i have the same problem but hehaves in different way: when use classname, the image will not vanish, even after scroll back, if not using the classname, the image will vanish after scrll</p>
</div>
							<div class="author">
								&mdash; commented <span title="October 18th 2012, 10:17:04 am">October 18th 2012</span>
								by <span class='authorname'>kent hao</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>so weird. the issue happens to me in totally opposite way. use className, the image will not vanish, but without classname, the image vanished.</p>
</div>
							<div class="author">
								&mdash; commented <span title="October 18th 2012, 11:34:14 pm">October 18th 2012</span>
								by <span class='authorname'>kent hao</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>I&#39;m using a custom TableViewRow with an ImageView, and on Android I notice the image frequently doesn&#39;t update properly when scrolling into view.  I am not updating the rows at all after initial creation, just scrolling back and forth causes the wrong image to appear in some cells.</p>
</div>
							<div class="author">
								&mdash; commented <span title="April 3rd 2013, 12:31:18 pm">April 3rd 2013</span>
								by <span class='authorname'>Tim Hingston</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Same problem here. :(</p>
</div>
							<div class="author">
								&mdash; commented <span title="April 9th 2013, 9:45:37 am">April 9th 2013</span>
								by <span class='authorname'>Miguel Ángel Castaño Fajardo</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>3</span> Votes</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-247870">
				
						<section>
							<p>Still no help?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 23rd 2012, 2:08:39 pm">September 23rd 2012</span>
								by <span class='authorname'>Terenze Yuen</span><br>
								<a class="icon-bg icon-link" href="question/142550/android-tableviewrow-with-classname---images-vanishes-after-scrolling#answer-247870" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-259961">
				
						<section>
							<p>So… this was a tough one.  Digging into the Ti core I found that iOS has remote image caching built in, but not for Android.  I used this as a reference to some luck: <a href="http:&#x2F;&#x2F;favo.net&#x2F;post&#x2F;19051471285&#x2F;solving-memory-issues-in-titanium-for-remote-images">inline link text</a>.  I changed the logic to require and not include, then made module commonJS style.  Be careful with your eventlisteners and watch your logcat.  </p>
<pre><code class="hljs"><span class="hljs-comment">/**
 * download remote images in a single thread
 *
 * @category   Titanium
 * @package    Snippets
 * @copyright  Copyright (c) 2011 Mario Micklisch
 * @license    http://framework.zend.com/license/new-bsd     New BSD License
 */</span>
Ti.API.debug(<span class="hljs-string">'PENTON - RemoteImageView.js'</span>);

exports.createRemoteImageView = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">options</span>) </span>{
    Ti.API.debug(<span class="hljs-string">'RemoteImageView.js::createRemoteImageView'</span>);
    <span class="hljs-comment">// check for cached local file</span>
    <span class="hljs-keyword">var</span> imageUrl = options.image;
    <span class="hljs-keyword">var</span> cacheFilename = imageUrl.replace(<span class="hljs-regexp">/[^a-zA-Z0-9\.]/ig</span>, <span class="hljs-string">'_'</span>);
    <span class="hljs-keyword">var</span> cacheFile = Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory, cacheFilename);

    <span class="hljs-comment">// create the basic object without image url</span>
    <span class="hljs-keyword">delete</span> (options.image);
    <span class="hljs-keyword">var</span> remoteImage = Titanium.UI.createImageView(options);

    <span class="hljs-comment">// check for cached version</span>
    <span class="hljs-keyword">var</span> cacheFileModDate = cacheFile.modificationTimestamp();
    <span class="hljs-keyword">var</span> dateToCompare = (<span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>()).getTime() - <span class="hljs-number">86400</span>;

    <span class="hljs-keyword">if</span> (cacheFile.exists() &amp;&amp; cacheFileModDate &lt; dateToCompare) {
        remoteImage.image = cacheFile.nativePath;
        Ti.API.debug(<span class="hljs-string">'RemoteImageView.js - Cached image!!'</span>);
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">if</span> (cacheFile.exists()) {
           Ti.API.debug(<span class="hljs-string">'RemoteImageView.js - Did NOT cache image! Cache File DOES exist'</span>);
           Ti.API.debug(<span class="hljs-string">'RemoteImageView.js - cacheFileModDate = '</span> + cacheFileModDate);
            Ti.API.debug(<span class="hljs-string">'RemoteImageView.js - dateToCompare = '</span> + dateToCompare);    
        } <span class="hljs-keyword">else</span> {
            Ti.API.debug(<span class="hljs-string">'RemoteImageView.js - Did NOT cache image!!'</span>);
        }


        <span class="hljs-keyword">if</span> (options.defaultImage) {
            remoteImage.image = options.defaultImage;
        }

        <span class="hljs-keyword">var</span> cacheListener = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
            remoteImage.image = e.filename;
            Ti.App.removeEventListener(<span class="hljs-string">"dl_"</span> + cacheFilename, cacheListener);
            Ti.API.debug(<span class="hljs-string">'RemoteImageView.js - Removed event listener'</span>);
        };

        Ti.App.addEventListener(<span class="hljs-string">"dl_"</span> + cacheFilename, cacheListener);

        Ti.App.fireEvent(<span class="hljs-string">"dl_image"</span>, {
            imageUrl : imageUrl,
            eventId : <span class="hljs-string">"dl_"</span> + cacheFilename
        });
    }

    <span class="hljs-keyword">return</span> remoteImage;
}
<span class="hljs-comment">/**
 * for easier use:
 * Ti.UI.createRemoteImageView
 * Titamium.UI.createRemoteImageView
 * points to createRemoteImageView
 */</span>
<span class="hljs-comment">//Ti.UI.createRemoteImageView = Titanium.UI.createRemoteImageView = createRemoteImageView;</span>

<span class="hljs-comment">/**
 * create imageview listener on first include
 */</span>

<span class="hljs-comment">//exports.addRemoteImageViewListener = function() {</span>

    <span class="hljs-comment">//if (!Ti.App.hasRemoteImageViewListener) {</span>
    <span class="hljs-keyword">if</span> (!Ti.App._has_remote_image_view_listener) {
        Ti.API.info(<span class="hljs-string">'RemoteImageView.js::addRemoteImageViewListner - adding event listener for remote images'</span>);
        Ti.App.cacheLifetime = <span class="hljs-number">86400</span>;
        Ti.App.addEventListener(<span class="hljs-string">"dl_image"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
            <span class="hljs-keyword">var</span> imageUrl = e.imageUrl;
            <span class="hljs-keyword">var</span> eventId = e.eventId;
            <span class="hljs-keyword">var</span> cacheFilename = imageUrl.replace(<span class="hljs-regexp">/[^a-zA-Z0-9\.]/ig</span>, <span class="hljs-string">'_'</span>);
            <span class="hljs-keyword">var</span> cacheFile = Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory, cacheFilename);

            <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient({
                onload : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                    Ti.API.debug(<span class="hljs-string">'RemoteImageView.js: - xhr.onload'</span>);
                    <span class="hljs-keyword">if</span> (xhr.status == <span class="hljs-number">200</span>) {
                        <span class="hljs-keyword">try</span> {
                            Ti.API.info(<span class="hljs-string">'RemoteImageView.js: - xhr.status == 200'</span>);
                            Ti.API.info(<span class="hljs-string">"RemoteImageView.js: - xhr.responseData: "</span> + xhr.responseData);
                            Ti.API.info(<span class="hljs-string">"RemoteImageView.js: - xhr.readyState: "</span> + xhr.readyState);
                            <span class="hljs-comment">// cache the file</span>
                            cacheFile.write(xhr.responseData);

                            <span class="hljs-comment">// assign the image</span>
                            Ti.App.fireEvent(eventId, {
                                filename : cacheFile.nativePath
                            });
                        } <span class="hljs-keyword">catch</span> (e) {
                            Ti.API.warn(<span class="hljs-string">'RemoteImageView.js::adRemoteImageViewListener - XHR Status != 200.  Error: '</span> + e);
                        }
                    };
                },
                onerror : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                    Ti.API.info(<span class="hljs-string">'RemoteImageView.js: XHR error - image retireval not successful'</span>);
                },
                timeout : <span class="hljs-number">1000</span>,
            });

            <span class="hljs-comment">// cache overwrite</span>
            <span class="hljs-keyword">if</span> (imageUrl.indexOf(<span class="hljs-string">'?'</span>) &gt; <span class="hljs-number">0</span>) {
                imageUrl += <span class="hljs-string">'&amp;'</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();
            } <span class="hljs-keyword">else</span> {
                imageUrl += <span class="hljs-string">'?'</span> + <span class="hljs-keyword">new</span> <span class="hljs-built_in">Date</span>().getTime();
            }

            <span class="hljs-comment">// send the request</span>
            xhr.open(<span class="hljs-string">'GET'</span>, imageUrl);
            <span class="hljs-keyword">if</span> (Ti.Network.online) {
              xhr.send();    
            }

            Ti.App._has_remote_image_view_listener = <span class="hljs-literal">true</span>;

        });
    }
<span class="hljs-comment">//}</span>
</code></pre><p>then I called it like this: </p>
<pre><code class="hljs">
<span class="hljs-keyword">if</span> (OS_ANDROID) {
    var remoteImage = require(<span class="hljs-string">'RemoteImageView'</span>);
        <span class="hljs-comment">//var mainView = Ti.UI.createImageView({ // origonal before using remote caching</span>
        var mainView = remoteImage.createRemoteImageView({
            <span class="hljs-string">image :</span> theImageLink,
            <span class="hljs-string">width :</span> Ti.UI.FILL,
            <span class="hljs-string">height :</span> Ti.UI.FILL,
    });
}
</code></pre><p>I think this should work, or at least get you far.  Check out the link above.  I might not be back to this thread for awhile, so good luck!</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 3rd 2013, 3:44:38 pm">April 3rd 2013</span>
								by <span class='authorname'>Steven House</span><br>
								<a class="icon-bg icon-link" href="question/142550/android-tableviewrow-with-classname---images-vanishes-after-scrolling#answer-259961" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Steven,<br>Your code work perfectly for me on an android device. Thank you for sharing !!!</p>
</p>
										<div class="author">
											&mdash; commented <span title="April 16th 2013, 5:48:52 am">April 16th 2013</span>
											by <span class='authorname'>Goh Ten Fatt</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-260448">
				
						<section>
							<p>I&#39;m removed classname property and my problem is solved. </p>
<p>But now the images refreshs when I scroll the table view or I add a new columns dinamicaly.</p>
<p>This is a new error. With previous SDK&#39;s it didn&#39;t happen.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="April 10th 2013, 10:31:31 am">April 10th 2013</span>
								by <span class='authorname'>Miguel Ángel Castaño Fajardo</span><br>
								<a class="icon-bg icon-link" href="question/142550/android-tableviewrow-with-classname---images-vanishes-after-scrolling#answer-260448" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
