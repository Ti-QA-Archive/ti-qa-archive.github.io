<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Urban Airship 1.4 push notifications on Android with c2dm » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Urban Airship 1.4 push notifications on Android with c2dm</h1>
		</header>
		<section>
			<p>I&#39;m trying to setup the UA on android. I&#39;ve downloaded needed modules, went through numerous resources and configured the project. The device succesfully registers with UA and the ti.urbanairship module seems to be working OK, except one tiny detail - the events are not being triggered and the device is not receiving any pushes, despite UA test push says it has been sent OK.</p>
<p>Currently I have these things in place:</p>
<ul>
<li>Emulator Android 2.2, WVGA800, latest GoogleAPIs installed</li>
<li>SDK 1.7.6</li>
<li>ti.urbanairship 1.4</li>
<li>custom AndroidManifest.xml with all the required permissions set</li>
<li>update tiapp.xml to include the UA module with &lt;module platform=&quot;android&quot; version=&quot;1.4&quot;&gt;ti.urbanairship&lt;&#x2F;module&gt;</li>
<li>I have correct UA setup in &#x2F;platform&#x2F;android&#x2F;bin&#x2F;assets&#x2F;airshipconfig.properties</li>
</ul>
<p>Here is a sample extract from the log:</p>
<pre><code class="hljs">W/<span class="hljs-function"><span class="hljs-title">PackageManager</span><span class="hljs-params">(   <span class="hljs-number">60</span>)</span></span>: Unknown permission android<span class="hljs-class">.permission</span><span class="hljs-class">.ADD_SYSTEM_SERVICE</span> <span class="hljs-keyword">in</span> package com<span class="hljs-class">.android</span><span class="hljs-class">.phone</span>
W/<span class="hljs-function"><span class="hljs-title">PackageManager</span><span class="hljs-params">(   <span class="hljs-number">60</span>)</span></span>: Not granting permission android<span class="hljs-class">.permission</span><span class="hljs-class">.SEND_DOWNLOAD_COMPLETED_INTENTS</span> to package com<span class="hljs-class">.android</span><span class="hljs-class">.browser</span> (protectionLevel=<span class="hljs-number">2</span> flags=<span class="hljs-number">0</span>x1be45)
W/<span class="hljs-function"><span class="hljs-title">PackageManager</span><span class="hljs-params">(   <span class="hljs-number">60</span>)</span></span>: Unknown permission com<span class="hljs-class">.google</span><span class="hljs-class">.android</span><span class="hljs-class">.gm</span><span class="hljs-class">.permission</span><span class="hljs-class">.WRITE_GMAIL</span> <span class="hljs-keyword">in</span> package com<span class="hljs-class">.android</span><span class="hljs-class">.settings</span>
W/<span class="hljs-function"><span class="hljs-title">PackageManager</span><span class="hljs-params">(   <span class="hljs-number">60</span>)</span></span>: Unknown permission com<span class="hljs-class">.google</span><span class="hljs-class">.android</span><span class="hljs-class">.gm</span><span class="hljs-class">.permission</span><span class="hljs-class">.READ_GMAIL</span> <span class="hljs-keyword">in</span> package com<span class="hljs-class">.android</span><span class="hljs-class">.settings</span>
W/<span class="hljs-function"><span class="hljs-title">PackageManager</span><span class="hljs-params">(   <span class="hljs-number">60</span>)</span></span>: Unknown permission com<span class="hljs-class">.android</span><span class="hljs-class">.providers</span><span class="hljs-class">.im</span><span class="hljs-class">.permission</span><span class="hljs-class">.READ_ONLY</span> <span class="hljs-keyword">in</span> package com<span class="hljs-class">.google</span><span class="hljs-class">.android</span><span class="hljs-class">.apps</span><span class="hljs-class">.maps</span>
I/<span class="hljs-function"><span class="hljs-title">TitaniumModule</span><span class="hljs-params">(  <span class="hljs-number">464</span>)</span></span>: (kroll$<span class="hljs-number">1</span>: app:<span class="hljs-comment">//app.js) [43,3440] Succesfully loaded module: urbanairship/1.4</span>
I/TiAPI   (  <span class="hljs-number">464</span>): (kroll$<span class="hljs-number">1</span>: app:<span class="hljs-comment">//app.js) [2,3442] UrbanAirship: module is =&gt; [Ti.UrbanAirship]</span>
E/<span class="hljs-function"><span class="hljs-title">C2DMRegistrar</span><span class="hljs-params">(  <span class="hljs-number">180</span>)</span></span>: [C2DMReg] handleRequest caught java<span class="hljs-class">.io</span><span class="hljs-class">.IOException</span>: SSL shutdown failed: I/O error during system call, Broken pipe
E/V Festival - <span class="hljs-function"><span class="hljs-title">UALib</span><span class="hljs-params">(  <span class="hljs-number">464</span>)</span></span>: Got error:SERVICE_NOT_AVAILABLE
E/V Festival - <span class="hljs-function"><span class="hljs-title">UALib</span><span class="hljs-params">(  <span class="hljs-number">464</span>)</span></span>: C2DM Failure: SERVICE_NOT_AVAILABLE
E/<span class="hljs-function"><span class="hljs-title">KrollEventManager</span><span class="hljs-params">(  <span class="hljs-number">464</span>)</span></span>: (main) [<span class="hljs-number">5</span>,<span class="hljs-number">900098</span>] Error invoking listener with id <span class="hljs-number">2</span> on eventName <span class="hljs-string">'UrbanAirship_Error'</span>
</code></pre><p>The code used for ua testing in app.js:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> ua = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ti.urbanairship'</span>);
ua.addEventListener(ua.EVENT_URBAN_AIRSHIP_CALLBACK, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{
    Ti.API.info(<span class="hljs-string">'UrbanAirship: Received message '</span> + e.message);
});
ua.addEventListener(ua.EVENT_URBAN_AIRSHIP_SUCCESS, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{
    Ti.API.info(<span class="hljs-string">'UrbanAirship: Received device token '</span> + e.deviceToken);
});
ua.addEventListener(ua.EVENT_URBAN_AIRSHIP_ERROR, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>)</span>{
    Ti.API.info(<span class="hljs-string">'UrbanAirship: Error '</span> + e.error);
});
ua.pushEnabled = <span class="hljs-literal">true</span>;
</code></pre><p>None of the above events - EVENT_URBAN_AIRSHIP_CALLBACK, EVENT_URBAN_AIRSHIP_SUCCESS or EVENT_URBAN_AIRSHIP_ERROR - gets fired at all.</p>
<p>Does anybody have an idea what might be the issue here?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="February 29th 2012, 9:54:45 am">February 29th 2012</span>
				by <span class='authorname'>Ondrej Urik</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>push notifications</span></li>
					
						<li><span class='tagname'>ti.urbanairship</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-231886">
				
						<section>
							<p>Have you tried the debug mode in Urban Airship to see if it gives more diagnostic info ?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 29th 2012, 9:56:22 am">February 29th 2012</span>
								by <span class='authorname'>Nick Milner</span><br>
								<a class="icon-bg icon-link" href="question/132933/urban-airship-14-push-notifications-on-android-with-c2dm#answer-231886" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Thanks for the quick response. With the test push UA is reporting &quot;Okay, we sent that message.&quot; and the error log is not stating anything. I believe that the message gets pushed to the device. For testing I use APPID returned by ua.pushId since the events do not get triggered. I can see this device registered in UA too, so I believe the ti.urbanairship module does its job OK.</p>
<p>Now I have been able to track down one issue - for some reason if a window has <code>exitOnClose=true</code>, the app keeps throwing this:</p>
<pre><code class="hljs">E/KrollEventManager (<span class="hljs-number">464</span>): (main) [<span class="hljs-number">5</span>,<span class="hljs-number">900098</span>] Error invoking listener <span class="hljs-keyword">with</span> <span class="hljs-property">id</span> <span class="hljs-number">2</span> <span class="hljs-function_start"><span class="hljs-keyword">on</span></span> eventName 'UrbanAirship_Error'
</code></pre><p>After I removed that exitOnClose statement, the EVENT_URBAN_AIRSHIP_ERROR event gets triggered. Steps to reproduce:</p>
<ul>
<li>ua.pushEnabled is set to true</li>
<li>wait 5-10 min</li>
<li>set ua.pushEnabled back to false</li>
</ul>
<p>After performing these steps, I get the following error message:</p>
<pre><code class="hljs">I/TiAPI (<span class="hljs-number">464</span>): (kroll<span class="hljs-variable">$7</span>: app://app.js) [<span class="hljs-number">3</span>,<span class="hljs-number">102704</span>] UrbanAirship: Error Error occurred registering device
</code></pre><p>With no additional information.</p>
<p>Other two events still do not get fired by the module. Any ideas? Is it possible to setup a verbose log for the ti.urbanairship module so I can see if the receiver&#x2F;c2dm and other activities are working?</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 1st 2012, 6:02:45 am">March 1st 2012</span>
											by <span class='authorname'>Ondrej Urik</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-233038">
				
						<section>
							<p>I&#39;ve finally managed to solve this problem. Turns out to be a more complex issue with how the app windows are managed - specifically if the root widow is closed at some point later in the app, it is indirectly causing the invoking error described above plus the app event handling is totally broken.</p>
<p>For those of you having similar problems as me, let me review the points you should be aware of (on SDK 1.7.3+):</p>
<ul>
<li>Read the ti.urbanairship manual.</li>
<li>Make sure you have the ti.urbanairship module in correct dir.</li>
<li>Make sure you have correct details in AndroidManifest.xml if using c2dm.</li>
<li>Make sure you have correct details in airshipconfig.properties file, in my case using inProduction = false for some reason works better than choosing &#39;true&#39;. If you use wrong details, the module is not reporting any error (don&#39;t know why!) and you can spend hours trying to figure out what&#39;s wrong!</li>
<li><strong>Make sure that the root window (the first one that is opened in app)  stays opened all the time.</strong></li>
</ul>
<p>That&#39;s about all. Happy coding ;)</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 12th 2012, 10:26:16 am">March 12th 2012</span>
								by <span class='authorname'>Ondrej Urik</span><br>
								<a class="icon-bg icon-link" href="question/132933/urban-airship-14-push-notifications-on-android-with-c2dm#answer-233038" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p><strong>Make sure that the root window (the first one that is opened in app) stays opened all the time.</strong></p>
<p>I did not get this point..<br>I am also facing the same problem..<br>Guide me how to solve this..</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 11th 2012, 7:44:21 am">June 11th 2012</span>
											by <span class='authorname'>Soutom Dhara</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Typical problem is that the first heavyweight window is used as additional animated splashscreen or counter or loading window and after the animation is done it is closed (using <code>wnd.close()</code>) and another window is then opened and used as the main window. This was the reason of the problem I had. After I changed the strategy and only moved the first window off the screen (didn&#39;t call close()) then all worked like charm.</p>
<p>You could additionaly turn on debugging in tiapp.xml: &lt;property name=&quot;ti.android.debug&quot; type=&quot;bool&quot;&gt;true&lt;&#x2F;property&gt; or in your custom manifest file: &lt;application android:debuggable=&quot;true&quot; …&gt; and run ddms and watch for UA module log messages.</p>
</p>
										<div class="author">
											&mdash; commented <span title="June 11th 2012, 8:06:13 am">June 11th 2012</span>
											by <span class='authorname'>Ondrej Urik</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
