<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Out of Memory when taking picture » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Out of Memory when taking picture</h1>
		</header>
		<section>
			<p>Hi, my app lets a user take a picture (actually multiple), it needs to auto rotate it to be in portrait and then save it to disk.  This functionally works but more often than not crashes with memory errors even when I have my camera set to a low resolution:</p>
<pre><code class="hljs">02-02 14:35:46.147: E/dalvikvm-heap(26053): 1843200-byte external allocation too large for this process.
02-02 14:35:46.147: E/dalvikvm(26053): Out of memory: Heap Size=16967KB, Allocated=9943KB, Bitmap Size=17954KB, Limit=32768KB
02-02 14:35:46.147: E/dalvikvm(26053): Trim info: Footprint=16967KB, Allowed Footprint=16967KB, Trimmed=3444KB
02-02 14:35:46.147: E/GraphicsJNI(26053): VM won't let us allocate 1843200 bytes
02-02 14:35:46.197: W/dalvikvm(26053): threadid=1: thread exiting with uncaught exception (group=0x4001d648)
02-02 14:35:46.207: E/TiApplication(26053): (main) [46976,729834] Sending event: exception on thread: main msg:java.lang.OutOfMemoryError: bitmap size exceeds VM budget(Heap Size=16967KB, Allocated=9943KB, Bitmap Size=17954KB); Titanium 1.9.0,2012/01/21 22:31,88820ff
02-02 14:35:46.207: E/TiApplication(26053): java.lang.OutOfMemoryError: bitmap size exceeds VM budget(Heap Size=16967KB, Allocated=9943KB, Bitmap Size=17954KB)
02-02 14:35:46.207: E/TiApplication(26053):     at android.graphics.Bitmap.nativeCreate(Native Method)
02-02 14:35:46.207: E/TiApplication(26053):     at android.graphics.Bitmap.createBitmap(Bitmap.java:695)
02-02 14:35:46.207: E/TiApplication(26053):     at org.appcelerator.titanium.util.TiUIHelper.viewToImage(TiUIHelper.java:616)
02-02 14:35:46.207: E/TiApplication(26053):     at org.appcelerator.titanium.view.TiUIView.toImage(TiUIView.java:946)
02-02 14:35:46.207: E/TiApplication(26053):     at org.appcelerator.titanium.proxy.TiViewProxy.handleToImage(TiViewProxy.java:719)
02-02 14:35:46.207: E/TiApplication(26053):     at org.appcelerator.titanium.proxy.TiViewProxy.handleMessage(TiViewProxy.java:303)
02-02 14:35:46.207: E/TiApplication(26053):     at android.os.Handler.dispatchMessage(<span class="hljs-operator"><span class="hljs-keyword">Handler</span>.<span class="hljs-keyword">java</span>:<span class="hljs-number">95</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> org.appcelerator.kroll.common.TiMessenger.dispatchMessage(TiMessenger.<span class="hljs-keyword">java</span>:<span class="hljs-number">318</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> org.appcelerator.kroll.common.TiMessenger.dispatchPendingMessages(TiMessenger.<span class="hljs-keyword">java</span>:<span class="hljs-number">303</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> org.appcelerator.kroll.common.TiMessenger$<span class="hljs-number">2.</span>getResult(TiMessenger.<span class="hljs-keyword">java</span>:<span class="hljs-number">188</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> org.appcelerator.kroll.common.TiMessenger.sendBlockingMessage(TiMessenger.<span class="hljs-keyword">java</span>:<span class="hljs-number">215</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> org.appcelerator.kroll.common.TiMessenger.sendBlockingRuntimeMessage(TiMessenger.<span class="hljs-keyword">java</span>:<span class="hljs-number">143</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> org.appcelerator.kroll.KrollProxy.fireSyncEvent(KrollProxy.<span class="hljs-keyword">java</span>:<span class="hljs-number">417</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> org.appcelerator.titanium.TiBaseActivity.onRestart(TiBaseActivity.<span class="hljs-keyword">java</span>:<span class="hljs-number">736</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> android.app.Instrumentation.callActivityOnRestart(Instrumentation.<span class="hljs-keyword">java</span>:<span class="hljs-number">1221</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> android.app.Activity.performRestart(Activity.<span class="hljs-keyword">java</span>:<span class="hljs-number">3979</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> android.app.Activity.performResume(Activity.<span class="hljs-keyword">java</span>:<span class="hljs-number">3998</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> android.app.ActivityThread.performResumeActivity(ActivityThread.<span class="hljs-keyword">java</span>:<span class="hljs-number">2475</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> android.app.ActivityThread.handleResumeActivity(ActivityThread.<span class="hljs-keyword">java</span>:<span class="hljs-number">2506</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> android.app.ActivityThread$H.handleMessage(ActivityThread.<span class="hljs-keyword">java</span>:<span class="hljs-number">1064</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> android.os.<span class="hljs-keyword">Handler</span>.dispatchMessage(<span class="hljs-keyword">Handler</span>.<span class="hljs-keyword">java</span>:<span class="hljs-number">99</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> android.os.Looper.<span class="hljs-keyword">loop</span>(Looper.<span class="hljs-keyword">java</span>:<span class="hljs-number">150</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> android.app.ActivityThread.<span class="hljs-keyword">main</span>(ActivityThread.<span class="hljs-keyword">java</span>:<span class="hljs-number">4293</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> <span class="hljs-keyword">java</span>.lang.reflect.Method.invokeNative(<span class="hljs-keyword">Native</span> Method)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> <span class="hljs-keyword">java</span>.lang.reflect.Method.invoke(Method.<span class="hljs-keyword">java</span>:<span class="hljs-number">507</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.<span class="hljs-keyword">java</span>:<span class="hljs-number">849</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> com.android.internal.os.ZygoteInit.<span class="hljs-keyword">main</span>(ZygoteInit.<span class="hljs-keyword">java</span>:<span class="hljs-number">607</span>)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.207</span>: <span class="hljs-keyword">E</span>/TiApplication(<span class="hljs-number">26053</span>):     <span class="hljs-keyword">at</span> dalvik.<span class="hljs-keyword">system</span>.NativeStart.<span class="hljs-keyword">main</span>(<span class="hljs-keyword">Native</span> Method)
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.237</span>: <span class="hljs-keyword">E</span>/AndroidRuntime(<span class="hljs-number">26053</span>): FATAL <span class="hljs-keyword">EXCEPTION</span>: <span class="hljs-keyword">main</span>
<span class="hljs-number">02</span>-<span class="hljs-number">02</span> <span class="hljs-number">14</span>:<span class="hljs-number">35</span>:<span class="hljs-number">46.237</span>: <span class="hljs-keyword">E</span>/AndroidRuntime(<span class="hljs-number">26053</span>): <span class="hljs-keyword">java</span>.lang.OutOfMemoryError: <span class="hljs-keyword">bitmap</span> <span class="hljs-keyword">size</span> exceeds VM budget(<span class="hljs-keyword">Heap</span> <span class="hljs-keyword">Size</span>=<span class="hljs-number">16967</span>KB, Allocated=<span class="hljs-number">9943</span>KB, <span class="hljs-keyword">Bitmap</span> <span class="hljs-keyword">Size</span>=<span class="hljs-number">17954</span>KB)</span>
</code></pre><p>The basic code is:</p>
<pre><code class="hljs">    var iView = Ti.UI.createImageView({
                    <span class="hljs-built_in">image</span>:event.media,
                    visible:<span class="hljs-keyword">false</span>,
                    <span class="hljs-variable">height</span>:<span class="hljs-string">'auto'</span>,
                    <span class="hljs-variable">width</span>:<span class="hljs-string">'auto'</span>
                });    
                parentWin.<span class="hljs-built_in">add</span>(iView);
                Ti.API.info(<span class="hljs-string">"Size "</span>+iView.toImage().<span class="hljs-variable">height</span>+<span class="hljs-string">' '</span>+iView.toImage().<span class="hljs-variable">width</span>);
                <span class="hljs-keyword">if</span> (iView.toImage().<span class="hljs-variable">width</span>&gt;iView.toImage().<span class="hljs-variable">height</span>){
                    var t = Ti.UI.create2DMatrix(); 
                      t = t.<span class="hljs-built_in">rotate</span>(<span class="hljs-number">90</span>);
                      iView.transform=t;
                }


                    var f = Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory,fname);
                    <span class="hljs-keyword">if</span> (AppUtil.isAndroid()){
                        ImageFactory.compressToFile(iView.toBlob(),<span class="hljs-number">.5</span>,f.getNativePath());
                    } <span class="hljs-keyword">else</span> {
                        newImg = ImageFactory.compress(iView.toBlob(),<span class="hljs-number">.5</span>);
                        f.write(newImg);
                    }
</code></pre><p>So far this only happens on android.  Would this be improved if install the app to SD?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="February 2nd 2012, 5:41:54 pm">February 2nd 2012</span>
				by <span class='authorname'>Frank A</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>images</span></li>
					
				</ul>
			

			<section>
				<h5>3 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>This issue doesn&#39;t appear to be only related to memory, I see a lot of crashes around the image processing that dont result in out of memory.</p>
</div>
							<div class="author">
								&mdash; commented <span title="February 2nd 2012, 6:38:42 pm">February 2nd 2012</span>
								by <span class='authorname'>Frank A</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>I think you are getting <a href="http:&#x2F;&#x2F;code.google.com&#x2F;p&#x2F;android&#x2F;issues&#x2F;detail?id=8488">this issue</a>.</p>
<p>IF you can provide a small test case (with an image example, would be awesome!)</p>
<p>Best,<br>Mauro</p>
</div>
							<div class="author">
								&mdash; commented <span title="February 2nd 2012, 10:53:40 pm">February 2nd 2012</span>
								by <span class='authorname'>Mauro Parra</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>I posted some sample code on this related thread.  http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;132004&#x2F;preventing-out-of-memory-with-high-res-photo#answer-230103</p>
</div>
							<div class="author">
								&mdash; commented <span title="February 12th 2012, 6:26:29 pm">February 12th 2012</span>
								by <span class='authorname'>Frank A</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>0</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>0 Answers</h3>

	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
