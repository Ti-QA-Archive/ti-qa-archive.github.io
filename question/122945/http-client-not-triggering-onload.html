<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>HTTP Client not triggering onload() » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>HTTP Client not triggering onload()</h1>
		</header>
		<section>
			<p>Hi,</p>
<p>I have developped an application for the mobile SDK, firstly on Android, and the application works fine.</p>
<p>In it, I do a call to some HTTP servers that send me back JSON or XML. I then parse it for display.</p>
<p>The problem I have here, is that the HTTP call that worked fine on Android is bugging on the iPad. Out of the 3 servers that I connect to, only one still goes through the onload() to send me data.</p>
<p>I don&#39;t know what could cause this, and I really need help figuring it out.</p>
<p>Thanks in advance.<br>Clement</p>
<p>PS: Titanium SDK is 1.7.1, xCode is version 3.2.6</p>
<p><a href="http:&#x2F;&#x2F;pastie.org&#x2F;2247502">Code for the call class used to connect to the server</a></p>
<p><a href="http:&#x2F;&#x2F;pastie.org&#x2F;2247536">Code used in the app to initiate the connection</a> The only server call that works there is the AIS server call (the second one in the button onClickListener).</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="July 21st 2011, 7:12:12 am">July 21st 2011</span>
				by <span class='authorname'>Clement Covemaeker</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>httpclient</span></li>
					
						<li><span class='tagname'>ios</span></li>
					
						<li><span class='tagname'>ipad</span></li>
					
						<li><span class='tagname'>json</span></li>
					
						<li><span class='tagname'>xml</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-213902">
				
						<section>
							<p>having had a quick look, it could be a number of reasons. It maybe that the connecton is timing out or being refused from the iPhone. Put some try catches in around the open and send and see if it does actually do those correctly first.</p>
<p>hope this helps.</p>
<p>T</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 21st 2011, 8:06:00 am">July 21st 2011</span>
								by <span class='authorname'>Trevor Ward</span><br>
								<a class="icon-bg icon-link" href="../../question/122945/http-client-not-triggering-onload.html#answer-213902" rel="permalink">permalink</a>
							</div>

							<h5>10 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>The open() and send() methods don&#39;t throw any error, so it&#39;s a dead end there.<br>Although now I have done as Romain said and put the onload before the open, and it now passes through the onload for all calls. Unfortunately, I now have problems acquiring the data, as one of the servers gives me a 405 Method not allowed error, while the other sends me back nothing.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 21st 2011, 8:24:23 am">July 21st 2011</span>
											by <span class='authorname'>Clement Covemaeker</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>&gt; 405: This code is given with the Allow header and indicates that the method used by the client is not supported for this URI.</p>
<p>Maybe it&#39;s because your method is a <strong>GET</strong>. You have to know that when you define <em>param</em> there <code>httpClient.send(param)</code> your method is changed into a <strong>POST</strong></p>
</p>
										<div class="author">
											&mdash; commented <span title="July 21st 2011, 8:43:12 am">July 21st 2011</span>
											by <span class='authorname'>Romain Salles</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>&gt; 405: This code is given with the Allow header and indicates that the method used by the client is not supported for this URI.</p>
<p>Maybe it&#39;s because your method is a <strong>GET</strong>. You have to know that when you define <em>param</em> there <code>httpClient.send(param)</code> your method is changed into a <strong>POST</strong></p>
</p>
										<div class="author">
											&mdash; commented <span title="July 21st 2011, 8:43:13 am">July 21st 2011</span>
											by <span class='authorname'>Romain Salles</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Is there any way to avoid having the request being changed to a POST ?</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 21st 2011, 8:48:53 am">July 21st 2011</span>
											by <span class='authorname'>Clement Covemaeker</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>If you place your parameters directly in the url with a function like this one:</p>
<pre><code class="hljs">function encodeQueryData(data) {
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">ret</span> = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> <span class="hljs-keyword">d</span> <span class="hljs-keyword">in</span> data) {
        <span class="hljs-keyword">if</span> (data[<span class="hljs-keyword">d</span>] !== undefined &amp;&amp; data[<span class="hljs-keyword">d</span>] !== null) {
            <span class="hljs-keyword">ret</span>.push(Ti.Network.encodeURIComponent(<span class="hljs-keyword">d</span>) + '=' + Ti.Network.encodeURIComponent(data[<span class="hljs-keyword">d</span>]));
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">ret</span>.join('&amp;');
}
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="July 21st 2011, 8:51:57 am">July 21st 2011</span>
											by <span class='authorname'>Romain Salles</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I have tried this but haven&#39;t been able to make it work, unfortunately. I have tried simply connecting to the server with the address + the encoded string, but then there is no trigger of the onload(). I&#39;ve tried connecting to the server with the address + the encoded string and then use send() without parameters or with &#39;&#39;, but the server doesnt accept it. I&#39;ve also tried sending the encoded string in place of param but it still doesn&#39;t work.</p>
<p>Did I not do it as you had it in mind, or is it just that it doesn&#39;t work ?</p>
<p>Thanks,</p>
<p>Clement</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 21st 2011, 11:54:02 am">July 21st 2011</span>
											by <span class='authorname'>Clement Covemaeker</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I have tried this but haven&#39;t been able to make it work, unfortunately. I have tried simply connecting to the server with the address + the encoded string, but then there is no trigger of the onload(). I&#39;ve tried connecting to the server with the address + the encoded string and then use send() without parameters or with &#39;&#39;, but the server doesnt accept it. I&#39;ve also tried sending the encoded string in place of param but it still doesn&#39;t work.</p>
<p>Did I not do it as you had it in mind, or is it just that it doesn&#39;t work ?</p>
<p>Thanks,</p>
<p>Clement</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 21st 2011, 11:54:03 am">July 21st 2011</span>
											by <span class='authorname'>Clement Covemaeker</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Not sure I understand…</p>
<p>In my mind, if you did</p>
<pre><code class="hljs">open(<span class="hljs-string">'GET'</span>, url);
send({<span class="hljs-string">foo:</span> <span class="hljs-string">'toto'</span>, <span class="hljs-string">foo2:</span> <span class="hljs-string">'toto2'</span>});
</code></pre><p>you should do:</p>
<pre><code class="hljs"><span class="hljs-keyword">open</span>(<span class="hljs-string">'GET'</span>, url + <span class="hljs-string">'?foo=toto&amp;foo2=toto2'</span>);
<span class="hljs-keyword">send</span>();
</code></pre><p>Where the <strong> encodeQueryData</strong> function help you to generate the <code>foo=toto&amp;amp;foo2=toto2</code></p>
<p>Other solution: use a <strong>POST</strong> and not a <strong>GET</strong> :P</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 21st 2011, 12:02:35 pm">July 21st 2011</span>
											by <span class='authorname'>Romain Salles</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Unfortunately, no, doing it like that doesn&#39;t work. I suspect the send() function adds a &#39;?&#39; at the end of the address, whether or not there is a parameter.</p>
<p>And I don&#39;t have control over the web services, so I have to use a GET =]</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 21st 2011, 12:50:49 pm">July 21st 2011</span>
											by <span class='authorname'>Clement Covemaeker</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I use this function and it works for me.</p>
<p>Your request is now sent has a GET request? (to check that, you can use a sniffer like wireshark)</p>
<p>If not, have you overridden your <code>param</code> into <code>undefined</code>?</p>
<p>Maybe you can try to not use by your little framework and hard code your request (just to check that it is not the issue).</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 21st 2011, 12:57:30 pm">July 21st 2011</span>
											by <span class='authorname'>Romain Salles</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-213894">
				
						<section>
							<p>I don&#39;t know if it helps, but you have to define your <strong>onload</strong> function before the <strong>open</strong> one. See the relative <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;apidoc&#x2F;mobile&#x2F;latest&#x2F;Titanium.Network.HTTPClient-object">API</a>.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 21st 2011, 7:17:02 am">July 21st 2011</span>
								by <span class='authorname'>Romain Salles</span><br>
								<a class="icon-bg icon-link" href="../../question/122945/http-client-not-triggering-onload.html#answer-213894" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>I have done as you say and put the onload before the open, and it now passes through the onload for all calls. Unfortunately, I now have problems acquiring the data, as one of the servers gives me a 405 Method not allowed error, while the other sends me back nothing.</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 21st 2011, 8:22:00 am">July 21st 2011</span>
											by <span class='authorname'>Clement Covemaeker</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-214030">
				
						<section>
							<p>I have used Romain Salle&#39;s method to avoid my send() transforming GET into POST and it now works wonder. Thank you Romain.</p>
<pre><code class="hljs">function encodeQueryData(data) {
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">ret</span> = [];
    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> <span class="hljs-keyword">d</span> <span class="hljs-keyword">in</span> data) {
        <span class="hljs-keyword">if</span> (data[<span class="hljs-keyword">d</span>] !== undefined &amp;&amp; data[<span class="hljs-keyword">d</span>] !== null) {
            <span class="hljs-keyword">ret</span>.push(Ti.Network.encodeURIComponent(<span class="hljs-keyword">d</span>) + '=' + Ti.Network.encodeURIComponent(data[<span class="hljs-keyword">d</span>]));
        }
    }
    <span class="hljs-keyword">return</span> <span class="hljs-keyword">ret</span>.join('&amp;');
}
</code></pre><pre><code class="hljs">paramEncoded = <span class="hljs-string">'?'</span> + encodeQueryData(param);
<span class="hljs-keyword">open</span>(<span class="hljs-string">'GET'</span>, url + paramEncoded);
<span class="hljs-keyword">send</span>();
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 22nd 2011, 8:12:45 am">July 22nd 2011</span>
								by <span class='authorname'>Clement Covemaeker</span><br>
								<a class="icon-bg icon-link" href="../../question/122945/http-client-not-triggering-onload.html#answer-214030" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>You&#39;re welcome ;)</p>
<p>Just mark as solved</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 22nd 2011, 8:24:41 am">July 22nd 2011</span>
											by <span class='authorname'>Romain Salles</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
