<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>App gets device token but doesn&#39;t get the notification, last message and payload Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>App gets device token but doesn&#39;t get the notification, last message and payload</h1>
		</header>
		<section>
			<p>Hi,<br>I created an sample alloy app to check push notification with urbanairship.I am able to get only device id but not the last message, payload and notification. I run this app in iPhone6. Below is the code which I wrote in index.js file. and added AirshipConfig.plist under Platform&gt;iPhone&gt;AirshipConfog.plist with my app key and app secret key. I don&#39;t see any errors as well in console.</p>
<p>&#x2F;*</p>
<ul>
<li>Demonstrates how to set up your UA Airmail Mailbox,</li>
<li>and how to receive notifications from UA<br>*&#x2F;</li>
</ul>
<p>&#x2F;&#x2F; open a single window<br>&#x2F;&#x2F; var window = Ti.UI.createWindow({backgroundColor: &#39;white&#39;, layout: &#39;vertical&#39;});</p>
<p>var btnOpen = Ti.UI.createButton({<br>    title: &#39;Open UA Inbox&#39;,<br>    width: 200, height: 40, top: 100<br>});<br>btnOpen.addEventListener(&#39;click&#39;, function() {<br>    &#x2F;&#x2F; Open default mailbox<br>    UrbanAirship.displayInbox({ animated:true });<br>});<br>$.index.add(btnOpen);</p>
<p>$.index.add(Ti.UI.createLabel({<br>    text: &#39;DeviceID:&#39;,<br>    top: 200,<br>    left: 10,<br>    textAlign: &#39;left&#39;,<br>    color: &#39;black&#39;,<br>    font: {fontSize: 18, fontStyle: &#39;bold&#39;},<br>    height: Ti.UI.SIZE || &#39;auto&#39;<br>}));</p>
<p>var labelID = Ti.UI.createLabel({<br>    text: &#39;&#39;,<br>    top: 200,<br>    left: 150,<br>    textAlign: &#39;left&#39;,<br>    color: &#39;black&#39;,<br>    height: Ti.UI.SIZE || &#39;auto&#39;<br>});<br>$.index.add(labelID);</p>
<p>$.index.add(Ti.UI.createLabel({<br>    text: &#39;Last Message:&#39;,<br>    top: 300,<br>    left: 10,<br>    textAlign: &#39;left&#39;,<br>    color: &#39;black&#39;,<br>    font: {fontSize: 18, fontStyle: &#39;bold&#39;},<br>    height: Ti.UI.SIZE || &#39;auto&#39;<br>}));</p>
<p>var labelMessage = Ti.UI.createLabel({<br>    text: &#39;&#39;,<br>    top: 300,<br>    left: 150,<br>    textAlign: &#39;left&#39;,<br>    color: &#39;black&#39;,<br>    height: Ti.UI.SIZE || &#39;auto&#39;<br>});<br>$.index.add(labelMessage);</p>
<p>$.index.add(Ti.UI.createLabel({<br>    text: &#39;Payload:&#39;,<br>    top: 400,<br>    left: 10,<br>    textAlign: &#39;left&#39;,<br>    color: &#39;black&#39;,<br>    font: {fontSize: 18, fontStyle: &#39;bold&#39;},<br>    height: Ti.UI.SIZE || &#39;auto&#39;<br>}));</p>
<p>var labelPayload = Ti.UI.createLabel({<br>    text: &#39; &#39;,<br>    top: 400,<br>    left: 150,<br>    textAlign: &#39;left&#39;,<br>    color: &#39;black&#39;,<br>    height: Ti.UI.SIZE || &#39;auto&#39;<br>});<br>$.index.add(labelPayload);</p>
<p>&#x2F;&#x2F; window.open();</p>
<p>var UrbanAirship = require(&#39;ti.urbanairship&#39;);<br>Ti.API.info(&quot;module is =&gt; &quot; + UrbanAirship);</p>
<p>&#x2F;*</p>
<ul>
<li>Urban Airship will load the options from an AirshipConfig.plist file that</li>
<li>should be stored in the application bundle. You will find an example</li>
<li>AirshipConfig.plist file in the &#39;example&#x2F;platform&#x2F;iphone&#39; folder of the module.<br>*&#x2F;</li>
</ul>
<p>&#x2F;&#x2F; UrbanAirship.options = {<br>        &#x2F;&#x2F; APP_STORE_OR_AD_HOC_BUILD : false,<br>        &#x2F;&#x2F; &#x2F;&#x2F; PRODUCTION_APP_KEY: &#39;=== YOUR PROD APP KEY ===&#39;,<br>        &#x2F;&#x2F; &#x2F;&#x2F; PRODUCTION_APP_SECRET: &#39;=== YOUR PROD APP SECRET ===&#39;,<br>        &#x2F;&#x2F; DEVELOPMENT_APP_KEY : &#39;8UfVmJojRtmUl6l61yBPag&#39;,<br>        &#x2F;&#x2F; DEVELOPMENT_APP_SECRET : &#39;zfi2IBayT72IAPUmlGTCvA&#39;,<br>        &#x2F;&#x2F; LOGGING_ENABLED : true<br>    &#x2F;&#x2F; };</p>
<pre><code class="hljs">// Ti.API.<span class="hljs-keyword">info</span>(<span class="hljs-string">"UrbanAirship : "</span>+UrbanAirship.options.DEVELOPMENT_APP_KEY);
</code></pre><p>&#x2F;&#x2F; Set UA options<br>UrbanAirship.tags = [ &#39;testingtesting&#39;, &#39;appcelerator&#39;, &#39;my-tags&#39; ];<br>UrbanAirship.alias = &#39;testDevice&#39;;<br>UrbanAirship.autoBadge = true;<br>UrbanAirship.autoResetBadge = true;</p>
<p>function eventCallback(e) {<br>    &#x2F;&#x2F; Pass the notification to the module<br>    UrbanAirship.handleNotification(e.data);</p>
<pre><code class="hljs">  <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info('<span class="hljs-type">Push</span> message received');
  <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info('  <span class="hljs-type">Message</span>: ' + e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.alert);</span>
  <span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info('  <span class="hljs-type">Payload</span>: ' + e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.aps);</span>

<span class="hljs-title">labelMessage</span>.text = e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.alert;</span>
<span class="hljs-title">labelPayload</span>.text = <span class="hljs-type">JSON</span>.stringify(e.<span class="hljs-typedef"><span class="hljs-keyword">data</span>.aps);    </span>
</code></pre><p>}</p>
<p>function eventSuccess(e) {<br>    &#x2F;&#x2F; <em>MUST</em> pass the received token to the module<br>    UrbanAirship.registerDevice(e.deviceToken);<br>    Ti.API.info(&#39;Received device token: &#39; + e.deviceToken);<br>    labelID.text = e.deviceToken;<br>    btnOpen.enabled = true;<br>}</p>
<p>function eventError(e) {<br>    Ti.API.info(&#39;Error:&#39; + e.error);<br>    var alert = Ti.UI.createAlertDialog({<br>        title: &#39;Error&#39;,<br>        message: e.error<br>    });<br>    alert.show();<br>}</p>
<p>if(parseInt(Titanium.Platform.version) === 8 &amp;&amp; parseFloat(Ti.version) &gt; 3.3) {<br>          Ti.API.info(&quot;==== iOS8 detected ====&quot;);<br>        Ti.App.iOS.addEventListener(&#39;usernotificationsettings&#39;, e = function() {<br>          Ti.App.iOS.removeEventListener(&#39;usernotificationsettings&#39;, e);</p>
<pre><code class="hljs">      <span class="hljs-tag">Ti</span><span class="hljs-class">.Network</span><span class="hljs-class">.registerForPushNotifications</span>(<span class="hljs-rules">{
        <span class="hljs-rule"><span class="hljs-attribute">success </span>:<span class="hljs-value"> eventSuccess,
        error : eventError,
        callback : eventCallback
      </span></span></span>});
    });

    <span class="hljs-tag">Ti</span><span class="hljs-class">.App</span><span class="hljs-class">.iOS</span><span class="hljs-class">.registerUserNotificationSettings</span>(<span class="hljs-rules">{
      <span class="hljs-rule"><span class="hljs-attribute">types </span>:<span class="hljs-value"> [Ti.App.iOS.USER_NOTIFICATION_TYPE_ALERT, Ti.App.iOS.USER_NOTIFICATION_TYPE_SOUND, Ti.App.iOS.USER_NOTIFICATION_TYPE_BADGE],
    </span></span></span>});
</code></pre><p>}else{</p>
<p>Ti.Network.registerForPushNotifications({<br>    types:[<br>        Ti.Network.NOTIFICATION_TYPE_BADGE,<br>        Ti.Network.NOTIFICATION_TYPE_ALERT,<br>        Ti.Network.NOTIFICATION_TYPE_SOUND<br>    ],<br>    success: eventSuccess,<br>    error: eventError,<br>    callback: eventCallback<br>});<br>}<br>$.index.open();</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="January 15th 2015, 8:14:26 am">January 15th 2015</span>
				by <span class='authorname'>Bhargav B K S</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>ios</span></li>
					
						<li><span class='tagname'>push notification</span></li>
					
						<li><span class='tagname'>urbanairship</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>0</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>0 Answers</h3>

	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
