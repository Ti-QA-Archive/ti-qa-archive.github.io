<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Rotating Images obtained from the gallery or Camera » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Rotating Images obtained from the gallery or Camera</h1>
		</header>
		<section>
			<p>Hi all,</p>
<p>Is it possible to do what i wrote in the title in android? I can get an image from the gallery or the camera, then i set that image to an imageview, and i try to rotate that image with a slider, and it rotates if i just touch the slider ( touch just a position of the slider, without moving my finger), but if i try to move the finger in the slider (from one point to another, to increase or decrease the value) the App crashes…</p>
<p>Here i post my code:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> win = Titanium.UI.currentWindow;


<span class="hljs-keyword">var</span> FotoUsu;
<span class="hljs-keyword">var</span> tmat = Ti.UI.create2DMatrix();
<span class="hljs-keyword">var</span> rot = <span class="hljs-number">0</span>;
imageUser = Titanium.UI.createImageView({
  top:<span class="hljs-number">50</span>,
  anchorPoint:{x:<span class="hljs-number">0.5</span>,y:<span class="hljs-number">0.5</span>},
  left:<span class="hljs-number">5</span>,
  width:<span class="hljs-number">200</span>,
  height:<span class="hljs-number">200</span>,
  canScale:<span class="hljs-literal">true</span>,
  zIndex:<span class="hljs-number">15</span>
});


Titanium.Media.showCamera({
success:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(event)</span>
</span>{
    <span class="hljs-keyword">var</span> cropRect = event.cropRect;
    <span class="hljs-keyword">var</span> imageCam = event.media;
    <span class="hljs-comment">//Ti.API.debug('Our type was: '+event.mediaType);</span>
    <span class="hljs-keyword">if</span>(event.mediaType == Ti.Media.MEDIA_TYPE_PHOTO)
    {
        imageUser.image = imageCam;
    }
    <span class="hljs-keyword">else</span>
    {
        alert(<span class="hljs-string">"got the wrong type back ="</span>+event.mediaType);
    }
},
cancel:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>
</span>{},
error:<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(error)</span>
</span>{
    <span class="hljs-keyword">var</span> a = Titanium.UI.createAlertDialog({title:<span class="hljs-string">'Camera'</span>});
    <span class="hljs-keyword">if</span> (error.code == Titanium.Media.NO_CAMERA)
    {
        a.setMessage(<span class="hljs-string">'Please run this test on device'</span>);
    }
    <span class="hljs-keyword">else</span>
    {
        a.setMessage(<span class="hljs-string">'Unexpected error: '</span> + error.code);
        }
        a.show();
        win.close();
    },
    saveToPhotoGallery:<span class="hljs-literal">true</span>,
    allowEditing:<span class="hljs-literal">true</span>,
    mediaTypes:[Ti.Media.MEDIA_TYPE_PHOTO]
});

<span class="hljs-keyword">var</span> SliderRotar = Titanium.UI.createSlider({
    min:-<span class="hljs-number">500</span>,
    max:<span class="hljs-number">500</span>,
    value:<span class="hljs-number">0</span>,
    width:<span class="hljs-number">240</span>,
    top:<span class="hljs-number">340</span>,
    left:<span class="hljs-number">10</span>,
    height:<span class="hljs-number">30</span>,
    zIndex:<span class="hljs-number">20</span>
});

SliderRotar.addEventListener(<span class="hljs-string">'change'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
</span>{

    rot=(e.value);
    imageUser.transform = tmat.rotate(e.value);
    imageUser.duration = <span class="hljs-number">2</span>;
});

win.add(imageUser);
win.add(SliderRotar);
</code></pre><p>Any solution?</p>
<p>thanks in advance!!</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="August 23rd 2011, 9:58:42 am">August 23rd 2011</span>
				by <span class='authorname'>Luis Cañamares</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>crash</span></li>
					
						<li><span class='tagname'>imageview</span></li>
					
						<li><span class='tagname'>rotate</span></li>
					
						<li><span class='tagname'>slider</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-217217">
				
						<section>
							<p>Hi Luis,</p>
<p>first, I think the line <code>imageUser.duration = 2;</code> has not sense here, since there is no animation, only a transformation.</p>
<p>Appart of this, this kind of function can overflow the memory very quickly, because a lot of events can be fired in a very short time and image manipulation requires lot of memory and cpu.</p>
<p>I suggest you to do a pair of things:</p>
<ul>
<li><p>First, reduce the image size to handle by the user. I mean the &quot;real&quot; size, not the imageUSer component size. You can do that resizing imageUser to the desired size and assign toImage() to a new imageView component and let the user rotate this new imageView. If you want to save the rotated image at full size, apply the transformation at the end, before saving, to imageUser (should be as easy as <code>imageUser.transformation = smallImageView.transformation</code>)</p>
</li>
<li><p>Second, limit the number of possible transformations per second. Use a timerInterval and call transform only if a minimum of (for example) 500 ms. has passed since last call.</p>
</li>
</ul>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="August 23rd 2011, 10:22:19 am">August 23rd 2011</span>
								by <span class='authorname'>Javier Rayon</span><br>
								<a class="icon-bg icon-link" href="question/124634/rotating-images-obtained-from-the-gallery-or-camera#answer-217217" rel="permalink">permalink</a>
							</div>

							<h5>7 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Thank you for the answer, it has helped me to improve it a little bit, but it continue to crash after you trash with it for 3 sec…is there any other way to rotate or scale an imageview that does not consume so much memory?</p>
<p>And sorry for the code <code>imageUser.duration = 2;</code> i put it there for other things and forgot to delete it…</p>
<p>Thank you!</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 23rd 2011, 10:53:23 am">August 23rd 2011</span>
											by <span class='authorname'>Luis Cañamares</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>what image size are you using? Testing on device or emulator?</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 23rd 2011, 11:45:25 am">August 23rd 2011</span>
											by <span class='authorname'>Javier Rayon</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Both, and i have tried from a width and height of 50 to 200. My problem maybe that i have a very heavyweight window (more images, labels,sliders and buttons…)</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 23rd 2011, 11:54:19 am">August 23rd 2011</span>
											by <span class='authorname'>Luis Cañamares</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>another small optimization… maybe you can limit slider values from -180 to 180 instead of -500, 500.</p>
<p>Do you have any error log when app crashes?</p>
<p>Can you put the code inside a try-catch block and see what happens?</p>
<p>Have you tried limit number of events fired per second?</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 23rd 2011, 12:55:03 pm">August 23rd 2011</span>
											by <span class='authorname'>Javier Rayon</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>The messages show by the console are these:</p>
<pre><code class="hljs">D/AndroidRuntime(  483): Shutting down VM
W/dalvikvm(  483): threadid=1: thread exiting with uncaught exception (group=0x40015560)
E/TiUncaughtHandler(  483): (main) [205,148697] Sending event: exception on thread: main msg:java.lang.NullPointerException; Titanium 1.7.2,2011/07/21 09:36,97c3689
E/TiUncaughtHandler(  483): java.lang.NullPointerException
E/TiUncaughtHandler(  483):     at org.appcelerator.titanium.view.Ti2DMatrix.interpolate(Ti2DMatrix.java:189)
E/TiUncaughtHandler(  483):     at org.appcelerator.titanium.util.TiAnimationBuilder$TiMatrixAnimation.getFinalMatrix(TiAnimationBuilder.java:374)
E/TiUncaughtHandler(  483):     at org.appcelerator.titanium.util.TiAnimationBuilder$TiMatrixAnimation.applyTransformation(TiAnimationBuilder.java:368)
E/TiUncaughtHandler(  483):     at android.view.animation.Animation.getTransformation(Animation.java:773)
E/TiUncaughtHandler(  483):     at android.view.ViewGroup.drawChild(ViewGroup.java:1511)

//And much more messages.....

E/TiUncaughtHandler(  483):     at android.view.ViewRoot.performTraversals(ViewRoot.java:1258)
E/TiUncaughtHandler(  483):     at android.view.ViewRoot.handleMessage(ViewRoot.java:1859)
E/TiUncaughtHandler(  483):     at android.os.Handler.dispatchMessage(<span class="hljs-operator"><span class="hljs-keyword">Handler</span>.<span class="hljs-keyword">java</span>:<span class="hljs-number">99</span>)
<span class="hljs-keyword">E</span>/TiUncaughtHandler(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> android.os.Looper.<span class="hljs-keyword">loop</span>(Looper.<span class="hljs-keyword">java</span>:<span class="hljs-number">130</span>)
<span class="hljs-keyword">E</span>/TiUncaughtHandler(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> android.app.ActivityThread.<span class="hljs-keyword">main</span>(ActivityThread.<span class="hljs-keyword">java</span>:<span class="hljs-number">3683</span>)
<span class="hljs-keyword">E</span>/TiUncaughtHandler(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> <span class="hljs-keyword">java</span>.lang.reflect.Method.invokeNative(<span class="hljs-keyword">Native</span> Method)
<span class="hljs-keyword">E</span>/TiUncaughtHandler(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> <span class="hljs-keyword">java</span>.lang.reflect.Method.invoke(Method.<span class="hljs-keyword">java</span>:<span class="hljs-number">507</span>)
<span class="hljs-keyword">E</span>/TiUncaughtHandler(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.<span class="hljs-keyword">java</span>:<span class="hljs-number">839</span>)
<span class="hljs-keyword">E</span>/TiUncaughtHandler(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> com.android.internal.os.ZygoteInit.<span class="hljs-keyword">main</span>(ZygoteInit.<span class="hljs-keyword">java</span>:<span class="hljs-number">597</span>)
<span class="hljs-keyword">E</span>/TiUncaughtHandler(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> dalvik.<span class="hljs-keyword">system</span>.NativeStart.<span class="hljs-keyword">main</span>(<span class="hljs-keyword">Native</span> Method)
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>): FATAL <span class="hljs-keyword">EXCEPTION</span>: <span class="hljs-keyword">main</span>
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>): <span class="hljs-keyword">java</span>.lang.NullPointerException
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> org.appcelerator.titanium.<span class="hljs-keyword">view</span>.Ti2DMatrix.interpolate(Ti2DMatrix.<span class="hljs-keyword">java</span>:<span class="hljs-number">189</span>)
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> org.appcelerator.titanium.util.TiAnimationBuilder$TiMatrixAnimation.getFinalMatrix(TiAnimationBuilder.<span class="hljs-keyword">java</span>:<span class="hljs-number">374</span>)
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> org.appcelerator.titanium.util.TiAnimationBuilder$TiMatrixAnimation.applyTransformation(TiAnimationBuilder.<span class="hljs-keyword">java</span>:<span class="hljs-number">368</span>)
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> android.<span class="hljs-keyword">view</span>.animation.Animation.getTransformation(Animation.<span class="hljs-keyword">java</span>:<span class="hljs-number">773</span>)
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> android.<span class="hljs-keyword">view</span>.ViewGroup.drawChild(ViewGroup.<span class="hljs-keyword">java</span>:<span class="hljs-number">1511</span>)
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> android.<span class="hljs-keyword">view</span>.ViewGroup.dispatchDraw(ViewGroup.<span class="hljs-keyword">java</span>:<span class="hljs-number">1373</span>)
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> android.<span class="hljs-keyword">view</span>.<span class="hljs-keyword">View</span>.draw(<span class="hljs-keyword">View</span>.<span class="hljs-keyword">java</span>:<span class="hljs-number">6883</span>)
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> android.<span class="hljs-keyword">view</span>.ViewGroup.drawChild(ViewGroup.<span class="hljs-keyword">java</span>:<span class="hljs-number">1646</span>)

//another batch...

<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> android.os.Looper.<span class="hljs-keyword">loop</span>(Looper.<span class="hljs-keyword">java</span>:<span class="hljs-number">130</span>)
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> android.app.ActivityThread.<span class="hljs-keyword">main</span>(ActivityThread.<span class="hljs-keyword">java</span>:<span class="hljs-number">3683</span>)
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> <span class="hljs-keyword">java</span>.lang.reflect.Method.invokeNative(<span class="hljs-keyword">Native</span> Method)
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> <span class="hljs-keyword">java</span>.lang.reflect.Method.invoke(Method.<span class="hljs-keyword">java</span>:<span class="hljs-number">507</span>)
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> com.android.internal.os.ZygoteInit$MethodAndArgsCaller.run(ZygoteInit.<span class="hljs-keyword">java</span>:<span class="hljs-number">839</span>)
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> com.android.internal.os.ZygoteInit.<span class="hljs-keyword">main</span>(ZygoteInit.<span class="hljs-keyword">java</span>:<span class="hljs-number">597</span>)
<span class="hljs-keyword">E</span>/AndroidRuntime(  <span class="hljs-number">483</span>):     <span class="hljs-keyword">at</span> dalvik.<span class="hljs-keyword">system</span>.NativeStart.<span class="hljs-keyword">main</span>(<span class="hljs-keyword">Native</span> Method)
W/ActivityManager(  <span class="hljs-number">103</span>):   <span class="hljs-keyword">Force</span> finishing activity com.estudioalfa.feriab/ti.modules.titanium.ui.TiTabActivity</span>
</code></pre><p>I&#39;m sorry for the noob question but where can i find the log? i have search in &#x2F;Library&#x2F;Application Support&#x2F;…&#x2F;My_App&#x2F;Documents&#x2F;&quot;lots_of_numbers_and_letters&quot;.log.   Is that the one? if it&#39;s that it doesn&#39;t say anything about the error…</p>
<p>I have placed a try&#x2F;catch where i think it might happen ( when i touch and move the slider…), like this:</p>
<pre><code class="hljs">SliderZoom.addEventListener(<span class="hljs-string">'change'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
</span>{
    <span class="hljs-keyword">try</span>
    {
        escala = sca + ((e.value));
        ftoUser2.transform = tmat.scale(escala);
        setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span>
        </span>{
             FotoUsu.transform = ftoUser2.transform;
        },<span class="hljs-number">1000</span>);
    }
    <span class="hljs-keyword">catch</span>(err)
    {
        Ti.API.info(err);
    }
});
</code></pre><p>But it doesn&#39;t show nothing… is it incorrectly placed?? And i have tried to limit the number of transformations with the time out… but it continue to crash…</p>
<p>Thanks a lot Javier for your help!!</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 23rd 2011, 1:23:25 pm">August 23rd 2011</span>
											by <span class='authorname'>Luis Cañamares</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>try&#x2F;catch is ok, but timer is not. This is a bit &quot;experimental&quot;, but give it a chance…</p>
<pre><code class="hljs">
<span class="hljs-keyword">var</span> _wait = <span class="hljs-literal">false</span>; <span class="hljs-comment">//Use this var to avoid fire lot of events at the same time</span>

SliderZoom.addEventListener(<span class="hljs-string">'change'</span>,<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span>
</span>{
    <span class="hljs-keyword">try</span> {

        <span class="hljs-keyword">if</span>(!_wait){
            escala = sca + ((e.value));
             FotoUsu.transform = tmat.scale(escala);
                 _wait = <span class="hljs-literal">true</span>;
                setTimeout(<span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
                    _wait = <span class="hljs-literal">false</span>;
             },<span class="hljs-number">500</span>);
        }
    }
    <span class="hljs-keyword">catch</span>(err)
    {
        Ti.API.info(err);
    }
});
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="August 23rd 2011, 1:46:41 pm">August 23rd 2011</span>
											by <span class='authorname'>Javier Rayon</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I have tried this &quot;experimental&quot; solution, but without success…tomorrow i will continue.</p>
<p>Thank you!!</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 23rd 2011, 4:04:34 pm">August 23rd 2011</span>
											by <span class='authorname'>Luis Cañamares</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
