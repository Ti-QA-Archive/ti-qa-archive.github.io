<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>A problem with my database Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>A problem with my database</h1>
		</header>
		<section>
			<p>var db = Ti.Database.open(&#39;plandb&#39;);<br>createDatabase();<br>function createDatabase()<br>{<br>    db.execute(&#39;CREATE TABLE IF NOT EXISTS plan(title TEXT, image1 TEXT, image2 TEXT, description TEXT, reps TEXT, sets TEXT)&#39;);<br>    var result = db.execute(&#39;SELECT <em> FROM plan&#39;);<br>    if (result.rowCount == 0)<br>    {<br>        db.execute(&#39;INSERT INTO plan(title, image1, image2, description, reps, sets) values (&quot;a&quot;,&quot;b&quot;,&quot;c&quot;,&quot;d&quot;,&quot;c&quot;,&quot;d&quot;)&#39;);<br>        db.execute(&#39;INSERT INTO plan(title, image1, image2, description, reps, sets) values (&quot;d&quot;,&quot;c&quot;,&quot;2&quot;,&quot;44&quot;,&quot;2&quot;,&quot;44&quot;)&#39;);<br>    }<br>result = db.execute(&#39;SELECT rowid, </em> FROM plan&#39;);<br>console.log(&quot;Table contents(rowid, title, image1, image2, description, reps, sets):&quot;);<br>while (result.isValidRow())<br>{<br>    var rowid = result.fieldByName(&#39;rowid&#39;);<br>    var title = result.fieldByName(&#39;title&#39;);<br>    var image1 = result.fieldByName(&#39;image1&#39;);<br>    var image2 = result.fieldByName(&#39;image2&#39;);<br>    var description = result.fieldByName(&#39;description&#39;);<br>    var reps = result.fieldByName(&#39;reps&#39;);<br>    var sets = result.fieldByName(&#39;sets&#39;);<br>    console.log(rowid + &#39;&#39; + tile + &#39;&#39; + imaget1 +&#39;&#39; + image2+&#39; &#39;+ description + &#39; &#39; + reps + &#39; &#39; + sets);<br>    result.next();<br>}<br>}</p>
<p>function getPlan2()<br>{<br>    var plan = [];<br>    var result = db.execute(&#39;SELECT rowid, * FROM plan&#39;);<br>    while (result.isValidRow())<br>    {<br>        var rowid = result.fieldByName(&#39;rowid&#39;);<br>        var title = result.fieldByName(&#39;title&#39;);<br>        var image1 = result.fieldByName(&#39;image1&#39;);<br>        var image2 = result.fieldByName(&#39;image2&#39;);<br>        var description = result.fieldByName(&#39;description&#39;);<br>        var reps = result.fieldByName(&#39;reps&#39;);<br>        var sets = result.fieldByName(&#39;sets&#39;);<br>        plan.push({<br>            rowid: rowid,<br>            title: title,<br>            image1: image1,<br>            image2: image2,<br>            description: description,<br>            reps:reps,<br>            sets:sets,<br>        });<br>        result.next();<br>    }<br>    return plan;<br>}<br>function insertPlan(plan)<br>{<br>    db.execute(&quot;INSERT INTO plan (title, image1, image2, descriptio, reps, sets) VALUES (?, ?, ?, ?, ?, ?,)&quot;, plan.title, plan.image1, plan.image2, plan.description, plan.reps, plan.sets);<br>}<br>function updatePlan(plan)<br>{<br>    db.execute(&quot;UPDATE plan SET title = ?, image1 = ?, image2 = ?, description = ?, reps = ?, sets = ? WHERE rowid = ?&quot;,  plan.title, plan.image1, plan.image2, plan.description, plan.reps, plan.sets, plan.rowid);</p>
<p>}<br>function deletePlan(plan)<br>{<br>    db.execute(&quot;DELETE FROM plan WHERE title = ?&quot;, plan.title);<br>}</p>
<p>This is my database, but it always display a problem when opening like this:<br>&quot;&quot;Attempted to access unknown result column reps at Plan2WindowModel.js(line21)&quot;</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="October 12th 2014, 10:50:13 am">October 12th 2014</span>
				by <span class='authorname'>Xu Chen</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>database</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-283045">
				
						<section>
							<p>Hi Xu,</p>
<p>i have tried your code and it was working so far.</p>
<p>There where some typos inside your console.log, which i fixed.</p>
<p>I assume that you where running your App on simulator&#x2F;emulator or on device when the column <strong>reps</strong> was not yet present inside your CREATE TABLE statement. So if you where running the App next time with CREATE TABLE statement including column <strong>reps</strong>, this one was not added because the table exists already.</p>
<p>So simply delete&#x2F;uninstall the App from your deployment target to get rid of the old database.</p>
<p>Then redeploy your app.</p>
<p>And i have some more suggestions for you:</p>
<ul>
<li>please post your code with correct formatting next time. Use three <strong>~~~</strong> on a single line before and after your code. ( use the <strong>Preview Answer</strong> Button to check your post.)</li>
<li>Give more information about your environment. Please read <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;ask">Ask a Question</a></li>
<li>Close your resultset and db after using it. I have added a new function for opening the db and code for closing resultsets and db after each usage. Closing database and resultsets help you to deal better with performance, memory usage and data consistency. Please read <a href="http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;latest&#x2F;#!&#x2F;guide&#x2F;Working_with_a_SQLite_Database">Working with a SQLite Database</a> for more details about database usage.</li>
</ul>
<p>This is the slightly modified code:</p>
<pre><code class="hljs">function openDatabase() {
    <span class="hljs-keyword">var</span> db = <span class="hljs-type">Ti</span>.<span class="hljs-type">Database</span>.open('plandb');
    <span class="hljs-keyword">return</span> db;
}

function createDatabase() {
    <span class="hljs-keyword">var</span> db = openDatabase();
    db.execute('<span class="hljs-type">CREATE</span> <span class="hljs-type">TABLE</span> <span class="hljs-type">IF</span> <span class="hljs-type">NOT</span> <span class="hljs-type">EXISTS</span> plan(title <span class="hljs-type">TEXT</span>, image1 <span class="hljs-type">TEXT</span>, image2 <span class="hljs-type">TEXT</span>, description <span class="hljs-type">TEXT</span>, reps <span class="hljs-type">TEXT</span>, sets <span class="hljs-type">TEXT</span>)');
    <span class="hljs-keyword">var</span> <span class="hljs-literal">result</span> = db.execute('<span class="hljs-type">SELECT</span> * <span class="hljs-type">FROM</span> plan');
    <span class="hljs-keyword">if</span> (<span class="hljs-literal">result</span>.rowCount == <span class="hljs-number">0</span>) {
        db.execute('<span class="hljs-type">INSERT</span> <span class="hljs-type">INTO</span> plan(title, image1, image2, description, reps, sets) values (<span class="hljs-string">"a"</span>,<span class="hljs-string">"b"</span>,<span class="hljs-string">"c"</span>,<span class="hljs-string">"d"</span>,<span class="hljs-string">"c"</span>,<span class="hljs-string">"d"</span>)');
        db.execute('<span class="hljs-type">INSERT</span> <span class="hljs-type">INTO</span> plan(title, image1, image2, description, reps, sets) values (<span class="hljs-string">"d"</span>,<span class="hljs-string">"c"</span>,<span class="hljs-string">"2"</span>,<span class="hljs-string">"44"</span>,<span class="hljs-string">"2"</span>,<span class="hljs-string">"44"</span>)');
    }
    <span class="hljs-literal">result</span>.close();

    <span class="hljs-literal">result</span> = db.execute('<span class="hljs-type">SELECT</span> rowid, * <span class="hljs-type">FROM</span> plan');
    console.log(<span class="hljs-string">"Table contents(rowid, title, image1, image2, description, reps, sets):"</span>);
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">result</span>.isValidRow()) {
        <span class="hljs-keyword">var</span> rowid = <span class="hljs-literal">result</span>.fieldByName('rowid');
        <span class="hljs-keyword">var</span> title = <span class="hljs-literal">result</span>.fieldByName('title');
        <span class="hljs-keyword">var</span> image1 = <span class="hljs-literal">result</span>.fieldByName('image1');
        <span class="hljs-keyword">var</span> image2 = <span class="hljs-literal">result</span>.fieldByName('image2');
        <span class="hljs-keyword">var</span> description = <span class="hljs-literal">result</span>.fieldByName('description');
        <span class="hljs-keyword">var</span> reps = <span class="hljs-literal">result</span>.fieldByName('reps');
        <span class="hljs-keyword">var</span> sets = <span class="hljs-literal">result</span>.fieldByName('sets');
        //console.log(rowid + '' + tile + '' + imaget1 + '' + image2 + ' ' + description + ' ' + reps + ' ' + sets);
        // must be title <span class="hljs-keyword">not</span> tile <span class="hljs-keyword">and</span> image1 <span class="hljs-keyword">not</span> imaget1
        console.log(rowid + ' ' + title + ' ' + image1 + ' ' + image2 + ' ' + description + ' ' + reps + ' ' + sets);
        <span class="hljs-literal">result</span>.next();
    }
    <span class="hljs-literal">result</span>.close();
    db.close();
}

function getPlan2() {
    <span class="hljs-keyword">var</span> plan = [];
    <span class="hljs-keyword">var</span> db = openDatabase();
    <span class="hljs-keyword">var</span> <span class="hljs-literal">result</span> = db.execute('<span class="hljs-type">SELECT</span> rowid, * <span class="hljs-type">FROM</span> plan');
    <span class="hljs-keyword">while</span> (<span class="hljs-literal">result</span>.isValidRow()) {
        <span class="hljs-keyword">var</span> rowid = <span class="hljs-literal">result</span>.fieldByName('rowid');
        <span class="hljs-keyword">var</span> title = <span class="hljs-literal">result</span>.fieldByName('title');
        <span class="hljs-keyword">var</span> image1 = <span class="hljs-literal">result</span>.fieldByName('image1');
        <span class="hljs-keyword">var</span> image2 = <span class="hljs-literal">result</span>.fieldByName('image2');
        <span class="hljs-keyword">var</span> description = <span class="hljs-literal">result</span>.fieldByName('description');
        <span class="hljs-keyword">var</span> reps = <span class="hljs-literal">result</span>.fieldByName('reps');
        <span class="hljs-keyword">var</span> sets = <span class="hljs-literal">result</span>.fieldByName('sets');
        plan.push({
            rowid : rowid,
            title : title,
            image1 : image1,
            image2 : image2,
            description : description,
            reps : reps,
            sets : sets,
        });
        <span class="hljs-literal">result</span>.next();
    }
    <span class="hljs-literal">result</span>.close();
    db.close();
    <span class="hljs-keyword">return</span> plan;
}

function insertPlan(plan) {
    <span class="hljs-keyword">var</span> db = openDatabase();
    db.execute(<span class="hljs-string">"INSERT INTO plan (title, image1, image2, descriptio, reps, sets) VALUES (?, ?, ?, ?, ?, ?,)"</span>, plan.title, plan.image1, plan.image2, plan.description, plan.reps, plan.sets);
    db.close();
}

function updatePlan(plan) {
    <span class="hljs-keyword">var</span> db = openDatabase();
    db.execute(<span class="hljs-string">"UPDATE plan SET title = ?, image1 = ?, image2 = ?, description = ?, reps = ?, sets = ? WHERE rowid = ?"</span>, plan.title, plan.image1, plan.image2, plan.description, plan.reps, plan.sets, plan.rowid);
    db.close();
}

function deletePlan(plan) {
    <span class="hljs-keyword">var</span> db = openDatabase();
    db.execute(<span class="hljs-string">"DELETE FROM plan WHERE title = ?"</span>, plan.title);
    db.close();
}

//
// calling functions
//
createDatabase();

// get all rows <span class="hljs-keyword">from</span> database
<span class="hljs-keyword">var</span> plan = getPlan2();
<span class="hljs-type">Ti</span>.<span class="hljs-type">API</span>.info('rows <span class="hljs-keyword">from</span> getPlan2(): ' + <span class="hljs-type">JSON</span>.stringify(plan));
</code></pre><p>Hope this helps.</p>
<p>Greetings,</p>
<p>Matthias</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="October 13th 2014, 6:46:12 am">October 13th 2014</span>
								by <span class='authorname'>Matthias Kroeger</span><br>
								<a class="icon-bg icon-link" href="../../question/178357/a-problem-with-my-database.html#answer-283045" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Xu,</p>
<p>did it work for you?</p>
<p>Any feedback would be nice.</p>
<p>Greetings,</p>
<p>Matthias</p>
</p>
										<div class="author">
											&mdash; commented <span title="October 16th 2014, 6:11:05 am">October 16th 2014</span>
											by <span class='authorname'>Matthias Kroeger</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
