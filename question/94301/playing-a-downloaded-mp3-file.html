<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Playing a downloaded mp3 file » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Playing a downloaded mp3 file</h1>
		</header>
		<section>
			<p>Hi,</p>
<p>I am using the mobile sdk to download an m3 file. I then  use the sound object to play the mp3. Unfortunately this does not work under android for me. The file downloads fine, and vlc and others can play the file. however the titanium.media.sound object cannot play it. It creates the sound object fine from a file reference to the existing mp3 file, but fails on the Prepare() native method as follows:</p>
<pre><code class="hljs"><span class="hljs-number">12</span>-<span class="hljs-number">27</span> <span class="hljs-number">21</span>:<span class="hljs-number">54</span>:<span class="hljs-number">43.368</span>: INFO/<span class="hljs-function"><span class="hljs-title">StagefrightPlayer</span><span class="hljs-params">(<span class="hljs-number">34</span>)</span></span>: <span class="hljs-function"><span class="hljs-title">setDataSource</span><span class="hljs-params">(<span class="hljs-string">'/data/data/ie.amberhand.jgtest2/app_appdata/en_oktest.mp3'</span>)</span></span>
<span class="hljs-number">12</span>-<span class="hljs-number">27</span> <span class="hljs-number">21</span>:<span class="hljs-number">54</span>:<span class="hljs-number">43.388</span>: ERROR/<span class="hljs-function"><span class="hljs-title">MediaPlayer</span><span class="hljs-params">(<span class="hljs-number">454</span>)</span></span>: error (<span class="hljs-number">1</span>, -<span class="hljs-number">2147483648</span>)
<span class="hljs-number">12</span>-<span class="hljs-number">27</span> <span class="hljs-number">21</span>:<span class="hljs-number">54</span>:<span class="hljs-number">43.448</span>: WARN/<span class="hljs-function"><span class="hljs-title">TiSound</span><span class="hljs-params">(<span class="hljs-number">454</span>)</span></span>: (kroll$<span class="hljs-number">6</span>) [<span class="hljs-number">43</span>,<span class="hljs-number">2423730</span>] Issue while initializing : 
<span class="hljs-number">12</span>-<span class="hljs-number">27</span> <span class="hljs-number">21</span>:<span class="hljs-number">54</span>:<span class="hljs-number">43.448</span>: WARN/<span class="hljs-function"><span class="hljs-title">TiSound</span><span class="hljs-params">(<span class="hljs-number">454</span>)</span></span>: java<span class="hljs-class">.io</span><span class="hljs-class">.IOException</span>: Prepare failed.: status=<span class="hljs-number">0</span>x1
<span class="hljs-number">12</span>-<span class="hljs-number">27</span> <span class="hljs-number">21</span>:<span class="hljs-number">54</span>:<span class="hljs-number">43.448</span>: WARN/<span class="hljs-function"><span class="hljs-title">TiSound</span><span class="hljs-params">(<span class="hljs-number">454</span>)</span></span>:     at android<span class="hljs-class">.media</span><span class="hljs-class">.MediaPlayer</span><span class="hljs-class">.prepare</span>(Native Method)
<span class="hljs-number">12</span>-<span class="hljs-number">27</span> <span class="hljs-number">21</span>:<span class="hljs-number">54</span>:<span class="hljs-number">43.448</span>: WARN/<span class="hljs-function"><span class="hljs-title">TiSound</span><span class="hljs-params">(<span class="hljs-number">454</span>)</span></span>:     at ti<span class="hljs-class">.modules</span><span class="hljs-class">.titanium</span><span class="hljs-class">.media</span><span class="hljs-class">.TiSound</span><span class="hljs-class">.initialize</span>(TiSound<span class="hljs-class">.java</span>:<span class="hljs-number">119</span>)
<span class="hljs-number">12</span>-<span class="hljs-number">27</span> <span class="hljs-number">21</span>:<span class="hljs-number">54</span>:<span class="hljs-number">43.448</span>: WARN/<span class="hljs-function"><span class="hljs-title">TiSound</span><span class="hljs-params">(<span class="hljs-number">454</span>)</span></span>:     at ti<span class="hljs-class">.modules</span><span class="hljs-class">.titanium</span><span class="hljs-class">.media</span><span class="hljs-class">.TiSound</span><span class="hljs-class">.play</span>(TiSound<span class="hljs-class">.java</span>:<span class="hljs-number">172</span>)
<span class="hljs-number">12</span>-<span class="hljs-number">27</span> <span class="hljs-number">21</span>:<span class="hljs-number">54</span>:<span class="hljs-number">43.448</span>: WARN/<span class="hljs-function"><span class="hljs-title">TiSound</span><span class="hljs-params">(<span class="hljs-number">454</span>)</span></span>:     at ti<span class="hljs-class">.modules</span><span class="hljs-class">.titanium</span><span class="hljs-class">.media</span><span class="hljs-class">.SoundProxy</span><span class="hljs-class">.play</span>(SoundProxy<span class="hljs-class">.java</span>:<span class="hljs-number">116</span>)
</code></pre><p>What I figured so far is that it appears to be a file permissions issue. I am using the Filesystem.File.Write method on a blob I get back from a HTTPClient responsedata blob object. The file writes fine and can be played outside of titanium app.</p>
<p>Playing directly does not work from the application data folder (&#x2F;data&#x2F;data&#x2F;my.namespace.com&#x2F;app_appdata&#x2F;my.mp3)</p>
<p>when I perform the following linux file permission altering command directly on the file in this location via an adb shell: &quot;chmod 444 &#x2F;data&#x2F;data&#x2F;my.namespace.com&#x2F;app_appdata&#x2F;my.mp3&quot;, then the file can be played (i.e. this gives user, group and world read permission on the file, original file from file.write had users r,w permissions)</p>
<p>I tried to use the fileSystem.file.setReadonly to simulate the above &quot;chmod&quot; command from code before the file is played, but the api command does not exist and throws a javascript error (even though the docs say it exists)</p>
<p>Please, any help would be great, I&#39;ve been battling with this issue for some time.</p>
<p>Thanks,</p>
<p>J.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="December 27th 2010, 8:32:43 pm">December 27th 2010</span>
				by <span class='authorname'>john gorman</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>error</span></li>
					
						<li><span class='tagname'>filesystem.write</span></li>
					
						<li><span class='tagname'>mobile</span></li>
					
						<li><span class='tagname'>permissions</span></li>
					
						<li><span class='tagname'>prepare()</span></li>
					
						<li><span class='tagname'>sound</span></li>
					
						<li><span class='tagname'>win32</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-169501">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>try saving the file to Ti.Filesystem.externalStorageDirectory and see if that solves the problem</p>
<p>FYI: it is not included in the documentation, it is in the <a href="https:&#x2F;&#x2F;github.com&#x2F;appcelerator&#x2F;KitchenSink&#x2F;blob&#x2F;master&#x2F;KitchenSink&#x2F;Resources&#x2F;examples&#x2F;filesystem.js">kitchenSink code</a></p>
<pre><code class="hljs"><span class="hljs-comment">// SD Card</span>
<span class="hljs-keyword">var</span> <span class="hljs-keyword">dir</span> = Ti.Filesystem.getFile(Ti.Filesystem.externalStorageDirectory);
Ti.API.info('directoryListing = ' + <span class="hljs-keyword">dir</span>.getParent().getDirectoryListing());
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 27th 2010, 9:51:37 pm">December 27th 2010</span>
								by <span class='authorname'>Aaron Saunders</span><br>
								<a class="icon-bg icon-link" href="question/94301/playing-a-downloaded-mp3-file#answer-169501" rel="permalink">permalink</a>
							</div>

							<h5>7 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>OK, thanks again for the answer Aaron, I tried this and my code works fine when writing to the externalStorageDirectory as you suggested. </p>
<p>Is there a bug here in the titanium code, or why does this not work on the applicationDataDirectory ? </p>
<p>Are there some android permissions required (i.e. via manifest etc.) to write and read successfully from the applicationDataDirectory folder ? </p>
<p>I am porting an iphone app to android and the applicationDataDirectory appears to be working fine on the iphone. </p>
<p>Appreciate any help in getting to the bottom of this. J</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 27th 2010, 11:01:40 pm">December 27th 2010</span>
											by <span class='authorname'>john gorman</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>it might just be a permission thing on the android, I would check it out in the android developer group.. I usually check for platform and then execute different code when I run into problems like this.</p>
<pre><code class="hljs"><span class="hljs-keyword">if</span> (Ti.Platform.name == <span class="hljs-string">'android'</span>) {
} <span class="hljs-keyword">else</span> {
}
</code></pre><p>Also it is good practice to mark the answer as accepted so others know it was resolved by the start icon.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 28th 2010, 1:48:25 am">December 28th 2010</span>
											by <span class='authorname'>Aaron Saunders</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Yes, I do the same per platform, but usually only where the namespace is platform specific. I don&#39;t want to set this as solved yet, as it is not really solved. For mobiles with no external storage this solution does not work. I need to know why this platform agnostic API call does not work on a specific platform.<br>I looks more like a lack of API capability combined with a lack in documentation on Appcelerator&#39;s perspective. If android security requirements are required, then the titanium SDK should take care of this, or the documentation should indicate the permissions required for Android specific builds (these woould be real solutions).</p>
<p>Seeing the code in the KitchenSink examples where they check the platform for android only in the filesystem example really makes me fearful for the survival of this platform as differing phone capabilities and versions expand.</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 28th 2010, 7:25:10 am">December 28th 2010</span>
											by <span class='authorname'>john gorman</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>@john I understand your perspective, but I also noticed that you are new to the platform… I strongly suggest you adjust your expectations because you will find there are many situations such as this when working with Titanium… take a look at the bug list and you will see what I mean.</p>
<p>Also if you want some additional assistance, I would suggest you post code… you should provide a small app.js excerpt that duplicates the problem. It is impossible to know what you have coded up without it.</p>
<p>IMHO…The purpose of this forum is to provide free community based support for people using this Open Source Framework, I dont think this is where you are going to get Appcelerator to respond to your concerns about how the API is documented or issues with specific calls.</p>
<p>If you are truly concerned then I suggest you <a href="https:&#x2F;&#x2F;appcelerator.lighthouseapp.com&#x2F;projects&#x2F;32238-titanium-mobile">log a bug</a> and hope for the best… Good Luck!</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 28th 2010, 12:47:57 pm">December 28th 2010</span>
											by <span class='authorname'>Aaron Saunders</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>im facing the same problem in android in this topic : <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;137470&#x2F;play-mp3-file-from-appdatadir">play Mp3 file from AppDataDir</a> , and still didn&#39;t find solution , i don&#39;t prefer <strong>externalStorageDirectory</strong> any helps are welcome</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 28th 2012, 8:12:35 am">May 28th 2012</span>
											by <span class='authorname'>abdulmajeed h</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Any update about this issue? Is there any android permission to ask in order to execute a sound from application directory?</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 13th 2012, 9:47:30 am">September 13th 2012</span>
											by <span class='authorname'>alessandro la rocca</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I think it is indeed a permission issue on Android. files in the applicationDataDirectory can only be accessed by your app, and when you attempt to play an audio (or video) file, you are actually passing it to the Android system&#39;s audio or video player, which it does not have permission to access. I think using externalStorageDirectory is the way to go for the time being.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 16th 2013, 10:21:29 pm">January 16th 2013</span>
											by <span class='authorname'>Luke Bartolomeo</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>5</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
