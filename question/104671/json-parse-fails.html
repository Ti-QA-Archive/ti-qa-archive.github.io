<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>JSON parse fails » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>JSON parse fails</h1>
		</header>
		<section>
			<p>Hi,<br>Further to this question<br><code>http:&amp;#x2F;&amp;#x2F;developer.appcelerator.com&amp;#x2F;question&amp;#x2F;104551&amp;#x2F;postzip-code-from-lat-long</code></p>
<p>I get a parse error on JSON string from the google geolocation API.</p>
<p>My code to get it is </p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> postCodeData = getPostCodeData(retType , apiStr);
<span class="hljs-keyword">function</span> getPostCodeData(retType,apiStr){
    <span class="hljs-keyword">var</span> xhr = Titanium.Network.createHTTPClient();

    xhr.timeout = <span class="hljs-number">1000000</span>;    
    xhr.open(<span class="hljs-string">"GET"</span>, apiStr);
    xhr.onload = <span class="hljs-keyword">function</span>(){
    <span class="hljs-keyword">try</span>{
            <span class="hljs-keyword">if</span>(retType == <span class="hljs-string">'raw'</span>){
                Titanium.API.warn(retType);
                Titanium.API.warn(<span class="hljs-string">'firing postcode event'</span>);
                Titanium.App.fireEvent(<span class="hljs-string">"rawDataReturned"</span>);
                Titanium.API.warn(xhr.responseData);
                <span class="hljs-keyword">return</span> xhr.responseData;
...
the <span class="hljs-keyword">function</span> carries <span class="hljs-literal">on</span>, but <span class="hljs-literal">it</span> does <span class="hljs-keyword">return</span> a correct looking value so <span class="hljs-keyword">this</span> <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> where i think the problem <span class="hljs-keyword">is</span>.
</code></pre><p>This shows the entire JSON data in the Titanium debug window and to save space you can see the data returned here;-<br><code>http:&amp;#x2F;&amp;#x2F;maps.google.com&amp;#x2F;maps&amp;#x2F;api&amp;#x2F;geocode&amp;#x2F;json?latlng=37.32,-122&amp;amp;sensor=true</code></p>
<p>Then i use <code>postCodeData</code> as the variable for my return obj from the XHR request which i pass straight to JSON.parse and get an error.</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> jsonReplyObj = <span class="hljs-built_in">JSON</span>.parse(postCodeData);
</code></pre><p>I have searched the forum and there seems to be many questions about whether JSON parse works or not but most seem to point to the data that is in error, in this case the data comes from google and am there is no changing it.</p>
<p>Anyone have any tips for parsing JSON,</p>
<p>Thanks,</p>
<p>Jeremy</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="January 25th 2011, 1:59:30 pm">January 25th 2011</span>
				by <span class='authorname'>Jez Manser</span>
			</div>

			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-184921">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>Jeremy</p>
<p>You can paste the URL (that returns json) directly into <a href="http:&#x2F;&#x2F;jsonformatter.curiousconcept.com&#x2F;">this JSON validator</a>. Hence the data returned from the google URL in your post is certainly valid.</p>
<p>Parsing json has been covered many times in this Q&amp;A. See <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;questions&#x2F;search&#x2F;json">this</a> list for help.</p>
<p>Cheers</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 25th 2011, 2:06:36 pm">January 25th 2011</span>
								by <span class='authorname'>Paul Dowsett</span><br>
								<a class="icon-bg icon-link" href="question/104671/json-parse-fails#answer-184921" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-185021">
				
						<section>
							<p>I never had issues with json data.</p>
<p>This is the code I use to make a reusable &quot;ajax&quot; request.</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> r_ajax =  function(url,on_ok, on_err, <span class="hljs-keyword">method</span>, async) {
    <span class="hljs-keyword">var</span> async = (async === <span class="hljs-literal">false</span>) ? <span class="hljs-literal">false</span> : <span class="hljs-literal">true</span>;
    <span class="hljs-keyword">var</span> <span class="hljs-keyword">method</span> = !!<span class="hljs-keyword">method</span> ? <span class="hljs-keyword">method</span> : '<span class="hljs-type">POST</span>';
    <span class="hljs-keyword">var</span> xhr = <span class="hljs-type">Titanium</span>.<span class="hljs-type">Network</span>.createHTTPClient();

    xhr.open(<span class="hljs-keyword">method</span>,url,async);

    xhr.onload = function(){
        on_ok(this);
        xhr.abort();
    };

    xhr.onerror = function(e){
        on_err(e);
        xhr.abort();
    };    

    xhr.onsendstream = function(e){
        log(e);
    };

    <span class="hljs-keyword">return</span> {
        xhr:xhr,
        <span class="hljs-keyword">method</span>:<span class="hljs-keyword">method</span>,
        send:function(data) {
            (this.<span class="hljs-keyword">method</span> == '<span class="hljs-type">GET</span>') ? xhr.send() : xhr.send(data);
            <span class="hljs-keyword">return</span> this;
        },
        setRequestHeader: function(header,value){
            xhr.setRequestHeader(header,value);
            <span class="hljs-keyword">return</span> this;
        },
        abort:function() { 
            xhr.abort();
            <span class="hljs-keyword">return</span> this;
        }
    };
};
</code></pre><p>you will use it something like:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> gps =  <span class="hljs-keyword">new</span> ajax(
   <span class="hljs-string">'http://maps.google.com/maps/api/geocode/json?latlng=37.32,-122&amp;sensor=true'</span>,

   <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">res</span>) </span>{
      <span class="hljs-keyword">var</span> json_reply =  <span class="hljs-built_in">JSON</span>.parse( res.responseText) <span class="hljs-comment">// you might want a try catch here to be sure</span>
   },

   <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">err</span>) </span>{
      <span class="hljs-comment">// we have an httpclient err</span>
   },

   <span class="hljs-string">'GET'</span>

 ).send()
</code></pre><p>Let me know :)</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 25th 2011, 2:55:43 pm">January 25th 2011</span>
								by <span class='authorname'>Dan Tamas</span><br>
								<a class="icon-bg icon-link" href="question/104671/json-parse-fails#answer-185021" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-185111">
				
						<section>
							<p>Thanks to both of you for your answers, i used both of them!</p>
<p>I have moved my xhr functions to a dedicated JSON function.<br>I also used a validator to find the data i needed.</p>
<p>Thank you very much!</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 25th 2011, 4:48:50 pm">January 25th 2011</span>
								by <span class='authorname'>Jez Manser</span><br>
								<a class="icon-bg icon-link" href="question/104671/json-parse-fails#answer-185111" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
