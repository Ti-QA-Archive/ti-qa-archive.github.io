<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>SQLite multiple INSERT Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>SQLite multiple INSERT</h1>
		</header>
		<section>
			<p>Hi all !</p>
<p>I need to insert a lot of lines into a SQLite database.<br>I currently do this :</p>
<pre><code class="hljs">for <span class="hljs-list">(<span class="hljs-keyword">var</span> i=0<span class="hljs-comment">; i&lt;xml_length; i++) {</span>
    db.execute<span class="hljs-list">(<span class="hljs-quoted">'INSERT</span> INTO myTable <span class="hljs-list">(<span class="hljs-string">"id"</span>, <span class="hljs-string">"value"</span>)</span> VALUES <span class="hljs-list">(<span class="hljs-string">"'+xml.id+'"</span>, <span class="hljs-string">"'+xml.value+'"</span>)</span>'<span class="hljs-comment">;</span>
}</span></span>
</code></pre><p>It works, but it could be much faster to execute multiple inserts at a time.</p>
<p>I tried queries such as:</p>
<pre><code class="hljs"><span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> myTable (<span class="hljs-string">"id"</span>, <span class="hljs-string">"values"</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">"1"</span>, <span class="hljs-string">"test"</span>), (<span class="hljs-string">"2"</span>, <span class="hljs-string">"test"</span>), (<span class="hljs-string">"3"</span>, <span class="hljs-string">"test"</span>);</span>
</code></pre><p>or:</p>
<pre><code class="hljs"><span class="hljs-operator"><span class="hljs-keyword">BEGIN</span>;</span>
<span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> myTable (<span class="hljs-string">"id"</span>, <span class="hljs-string">"values"</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">"1"</span>, <span class="hljs-string">"test"</span>)
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> myTable (<span class="hljs-string">"id"</span>, <span class="hljs-string">"values"</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">"2"</span>, <span class="hljs-string">"test"</span>)
<span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> myTable (<span class="hljs-string">"id"</span>, <span class="hljs-string">"values"</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">"3"</span>, <span class="hljs-string">"test"</span>)
<span class="hljs-keyword">COMMIT</span>;</span>
</code></pre><p>or even:</p>
<pre><code class="hljs"><span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> myTable (<span class="hljs-string">"id"</span>, <span class="hljs-string">"values"</span>) <span class="hljs-keyword">VALUES</span> (<span class="hljs-string">"1"</span>, <span class="hljs-string">"test"</span>, <span class="hljs-string">"2"</span>, <span class="hljs-string">"test"</span>, <span class="hljs-string">"3"</span>, <span class="hljs-string">"test"</span>);</span>
</code></pre><p>It seems to me like a basic database feature, but I can&#39;t find the right syntax to use.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="January 25th 2011, 7:47:38 am">January 25th 2011</span>
				by <span class='authorname'>Adrien Mas</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>insert</span></li>
					
						<li><span class='tagname'>iphone</span></li>
					
						<li><span class='tagname'>multiple</span></li>
					
						<li><span class='tagname'>sqlite</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-184571">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>Appcelerator uses a standard sqlite3 database engine.  I&#39;d suggest you start by looking at its online documentation for the <a href="http:&#x2F;&#x2F;www.sqlite.org&#x2F;lang_insert.html">insert</a> statement.  Each INSERT will create a single row unless you are using a SELECT clause instead of VALUES().</p>
<p>To wrap several inserts within a transaction, I use this syntax:</p>
<pre><code class="hljs">db.<span class="hljs-keyword">execute</span>(<span class="hljs-string">"BEGIN IMMEDIATE TRANSACTION"</span>);
db.<span class="hljs-keyword">execute</span>(sql);   // <span class="hljs-built_in">repeat</span> <span class="hljs-keyword">as</span> necessary
db.<span class="hljs-keyword">execute</span>(sql);
db.<span class="hljs-keyword">execute</span>(sql);
db.<span class="hljs-keyword">execute</span>(<span class="hljs-string">"COMMIT TRANSACTION"</span>);
</code></pre><p>You may want to peruse the syntax for various sqlite3 commands <a href="http:&#x2F;&#x2F;www.sqlite.org&#x2F;lang.html">here</a>.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 25th 2011, 8:01:16 am">January 25th 2011</span>
								by <span class='authorname'>Doug Handy</span><br>
								<a class="icon-bg icon-link" href="../../question/104531/sqlite-multiple-insert.html#answer-184571" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>You&#39;ve kind of missed the point of the original post. Calling the same sql statement multiple times like that is inefficient, since the statement needs to be prepared again for every item of data. Wrapping the inserts in a transaction is faster than relying on autocommit, but many sqlite wrappers also provide a bulk insert feature, and that&#39;s what the OP seems to be asking for. Unfortunately I don&#39;t believe Ti has such a feature at this time.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 25th 2011, 8:36:56 am">January 25th 2011</span>
											by <span class='authorname'>Damien Elmes</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>(that said, the suggestion to wrap the inserts in an outer transaction is probably going to save a lot more time than removing redundant statement preparations)</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 25th 2011, 8:40:48 am">January 25th 2011</span>
											by <span class='authorname'>Damien Elmes</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I didn&#39;t so much miss the point of the OP as not realize there are any wrappers for sqlite3 which provide a bulk insert.  I did intentionally point out multiple rows can be inserted at once using a SELECT variant although it wasn&#39;t clear from the OP&#39;s example that would be practical.  Just in case, I tried to point him to the sqlite3 documentation.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 25th 2011, 8:43:01 am">January 25th 2011</span>
											by <span class='authorname'>Doug Handy</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Sorry, I could have chosen my words better. I just meant to say &quot;I think the OP was actually asking about X.&quot;</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 25th 2011, 8:49:40 am">January 25th 2011</span>
											by <span class='authorname'>Damien Elmes</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>5</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-184581">
				
						<section>
							<p>Thanks for your answer Doug.<br>Your way to do it is really clean. And it&#39;s much faster than what I did before.</p>
<p>While waiting for an answer, I found another way to do it. It&#39;s not as clean as yours but it seems a bit faster.<br>The goal is to create a query such as :</p>
<pre><code class="hljs"><span class="hljs-operator"><span class="hljs-keyword">INSERT</span> <span class="hljs-keyword">INTO</span> myTable
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">"1"</span>, <span class="hljs-string">"test"</span>
<span class="hljs-keyword">UNION</span>
<span class="hljs-keyword">SELECT</span> <span class="hljs-string">"2"</span>, <span class="hljs-string">"test"</span>
...</span>
</code></pre><p>It works, there seems to be a limit around 500 lines inserted, but it works.</p>
<p>So I did a little Benchmark for inserting 1544 lines with the same datas (I did the test 5 times for each methods) :</p>
<ul>
<li>Multiples INSERTs : 2500ms</li>
<li>Using BEGIN and COMMIT : 90ms</li>
<li>Using SELECT and UNION : 40ms</li>
</ul>
<p>Anyway, I think I&#39;ll use your method because your code is cleaner and much easier to maintain. Here is what I had to do :</p>
<pre><code class="hljs">var newQuery = <span class="hljs-literal">true</span>, query = <span class="hljs-string">''</span><span class="hljs-comment">;</span>
<span class="hljs-keyword">for</span> (i=<span class="hljs-number">0</span><span class="hljs-comment">; i&lt;locations_length; i++) {</span>
    <span class="hljs-keyword">if</span> (newQuery) {
        query = <span class="hljs-string">'INSERT INTO myTable (id, name, code)'</span><span class="hljs-comment">;</span>
        newQuery = <span class="hljs-literal">false</span><span class="hljs-comment">;</span>
    }
    <span class="hljs-keyword">else</span> {
        query += <span class="hljs-string">' UNION'</span><span class="hljs-comment">;</span>
    }

    query += <span class="hljs-string">' SELECT "'</span>+values[i][<span class="hljs-number">0</span>]+<span class="hljs-string">'", "'</span>+values[i][<span class="hljs-number">1</span>]+<span class="hljs-string">'", "'</span>+values[i][<span class="hljs-number">2</span>]+<span class="hljs-string">'"'</span><span class="hljs-comment">;</span>

    <span class="hljs-keyword">if</span> (i!=<span class="hljs-number">0</span> &amp;&amp; i%<span class="hljs-number">499</span>==<span class="hljs-number">0</span>) {
        db.<span class="hljs-built_in">execute</span>(query)<span class="hljs-comment">;</span>
        newQuery = <span class="hljs-literal">true</span><span class="hljs-comment">;</span>
    }
}

//executing remaining lines
<span class="hljs-keyword">if</span> (i%<span class="hljs-number">499</span>!=<span class="hljs-number">0</span>) {
    db.<span class="hljs-built_in">execute</span>(query)<span class="hljs-comment">;</span>
}
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 25th 2011, 8:36:07 am">January 25th 2011</span>
								by <span class='authorname'>Adrien Mas</span><br>
								<a class="icon-bg icon-link" href="../../question/104531/sqlite-multiple-insert.html#answer-184581" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Thank you Adrien</p>
<p>This is very helpful for me for Inserting the multiple data in sqlite</p>
<p>can you help me for updating multiple data same as this?</p>
<p>Thanks :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="August 1st 2012, 11:52:38 am">August 1st 2012</span>
											by <span class='authorname'>Dhaval Kumar</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
