<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>ImageView ClassCastException while setting remote URL Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>ImageView ClassCastException while setting remote URL</h1>
		</header>
		<section>
			<p>hello,my android project runs ok in emulator but in some real devices it pops an exception. After searching for the problem I found that the exception thrown while setting image to imageView with remote URL.</p>
<p><code>$.radioImage.image = &amp;#39;http:&amp;#x2F;&amp;#x2F;myimage.com&amp;#39;;</code></p>
<p>if i change it with a local image, it runs ok:</p>
<p><code>$.radioImage.image = &amp;#39;&amp;#x2F;images&amp;#x2F;ic_action_play.png&amp;#39;</code></p>
<p>Here is the logcat:</p>
<pre><code class="hljs"><span class="hljs-list">[<span class="hljs-keyword">DEBUG</span>] :  AndroidRuntime: Shutting down VM
<span class="hljs-list">[<span class="hljs-keyword">WARN</span>] :   dalvikvm: threadid=1: thread exiting with uncaught exception <span class="hljs-list">(<span class="hljs-keyword">group=0x415aa898</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication: <span class="hljs-list">(<span class="hljs-keyword">main</span>)</span> <span class="hljs-list">[<span class="hljs-keyword">13847</span>,<span class="hljs-number">15825</span>] Sending event: exception on thread: main msg:java.lang.ClassCastException: android.net.http.HttpResponseCache cannot be cast to org.appcelerator.titanium.util.TiResponseCache<span class="hljs-comment">; Titanium 3.3.0,2014/07/11 12:36,787cd39</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication: java.lang.ClassCastException: android.net.http.HttpResponseCache cannot be cast to org.appcelerator.titanium.util.TiResponseCache
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at org.appcelerator.titanium.util.TiResponseCache.peek<span class="hljs-list">(<span class="hljs-keyword">TiResponseCache.java:187</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at ti.modules.titanium.ui.widget.TiUIImageView.setImageInternal<span class="hljs-list">(<span class="hljs-keyword">TiUIImageView.java:715</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at ti.modules.titanium.ui.widget.TiUIImageView.processProperties<span class="hljs-list">(<span class="hljs-keyword">TiUIImageView.java:802</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at org.appcelerator.kroll.KrollProxy.setModelListener<span class="hljs-list">(<span class="hljs-keyword">KrollProxy.java:1185</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at org.appcelerator.titanium.proxy.TiViewProxy.realizeViews<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:500</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at org.appcelerator.titanium.proxy.TiViewProxy.handleGetView<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:491</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at org.appcelerator.titanium.proxy.TiViewProxy.getOrCreateView<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:469</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at org.appcelerator.titanium.proxy.TiViewProxy.realizeViews<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:507</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at org.appcelerator.titanium.proxy.TiViewProxy.handleGetView<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:491</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at org.appcelerator.titanium.proxy.TiViewProxy.getOrCreateView<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:469</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at org.appcelerator.titanium.proxy.TiViewProxy.forceCreateView<span class="hljs-list">(<span class="hljs-keyword">TiViewProxy.java:437</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at ti.modules.titanium.ui.widget.tableview.TiTableViewRowProxyItem.createControls<span class="hljs-list">(<span class="hljs-keyword">TiTableViewRowProxyItem.java:247</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at ti.modules.titanium.ui.widget.tableview.TiTableViewRowProxyItem.setRowData<span class="hljs-list">(<span class="hljs-keyword">TiTableViewRowProxyItem.java:428</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at ti.modules.titanium.ui.widget.tableview.TiTableViewRowProxyItem.setRowData<span class="hljs-list">(<span class="hljs-keyword">TiTableViewRowProxyItem.java:91</span>)</span>
<span class="hljs-list">[<span class="hljs-keyword">ERROR</span>] :  TiApplication:     at ti.modules.titanium.ui.widget.tableview.TiTableView$TTVListAdapter.getView<span class="hljs-list">(<span class="hljs-keyword">TiTableView.java:237</span>)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>
</code></pre><p>NOTE: There are more images that i set. It is a tableView and when i click in a row, it opens another tableview which has an imageview and a label in every row. When it tries to set the images to the rows, it throws an exception.<br>It is very weird because the app works ok in EVERY emulator but in ALCATEL onetouch 5050y (android 4.3) and samsung galaxy s2 (android 4.1.2) it throws that.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="September 29th 2014, 11:56:31 am">September 29th 2014</span>
				by <span class='authorname'>Teo Xant</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>classcastexception</span></li>
					
						<li><span class='tagname'>imageview</span></li>
					
						<li><span class='tagname'>remote url</span></li>
					
						<li><span class='tagname'>runtime exception</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Are you running Admob? I just started having the same issue and when I removed Admob from the app the error stopped. Now I just wish I could figure out why this is happening.</p>
</div>
							<div class="author">
								&mdash; commented <span title="September 29th 2014, 10:20:02 pm">September 29th 2014</span>
								by <span class='authorname'>Chris Adzima</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Lol man yes i remove admob and it runs ok.. :)</p>
</div>
							<div class="author">
								&mdash; commented <span title="September 30th 2014, 9:00:57 am">September 30th 2014</span>
								by <span class='authorname'>Teo Xant</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-282753">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>This is a conflict between Titanium and a recently pushed update to Google Play Services (6.1.09, which came out last week).</p>
<p>More details: https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TIMOB-17798</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 29th 2014, 11:20:10 pm">September 29th 2014</span>
								by <span class='authorname'>Jason Priebe</span><br>
								<a class="icon-bg icon-link" href="question/178037/imageview-classcastexception-while-setting-remote-url.html#answer-282753" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>So what&#39;s the solution for this now? How can I implement ads in my app?</p>
</p>
										<div class="author">
											&mdash; commented <span title="October 1st 2014, 11:06:16 am">October 1st 2014</span>
											by <span class='authorname'>Teo Xant</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>It looks like Google will be issuing an update to Google Play Services very soon (within a week?) that will revert some of the caching changes that are causing the conflict.  They will reintroduce the caching at a later date, at which point, Titanium will need to handle it better.</p>
<p>Appcelerator is working on fixes to Titanium for just that situation.  Those changes look like they will make it into 3.4.1, or at least 3.5.0.</p>
<p>So the short answer is that if you wait a week for the Google Play Services update, your app will work again with no changes on your part.  Unfortunately, the Play Services update will probably not roll out to all users at the same time; it may take a couple of weeks (months?) for it to get to most of your users.  Hopefully the same users who got the 6.1.09 update will quickly adopt the new update.</p>
<p>Once Appcelerator&#39;s fix is in place, your app will even work on those devices that stick with 6.1.09.</p>
</p>
										<div class="author">
											&mdash; commented <span title="October 1st 2014, 11:13:17 am">October 1st 2014</span>
											by <span class='authorname'>Jason Priebe</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Thnx for the quick answer Jason! so the only solution is to wait.. Is there any site&#x2F;blog where i can watch for updates&#x2F;announcements etc about that issue?</p>
</p>
										<div class="author">
											&mdash; commented <span title="October 1st 2014, 11:32:28 am">October 1st 2014</span>
											by <span class='authorname'>Teo Xant</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I think the only communication you&#39;re going to get will be on the JIRA issue I linked up in my initial answer.  Eric from Google has been very helpful with some &quot;inside information&quot;.  I have looked elsewhere, but I haven&#39;t seen any official communication from Google about those changes.</p>
</p>
										<div class="author">
											&mdash; commented <span title="October 1st 2014, 11:45:17 am">October 1st 2014</span>
											by <span class='authorname'>Jason Priebe</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-282848">
				
						<section>
							<p>Teo,</p>
<p>try caching these images yourself.</p>
<pre><code class="hljs">var remoteImage = Titanium.UI.createView({
    top: <span class="hljs-string">'16'</span>,
    <span class="hljs-variable">height</span>: Titanium.UI.SIZE,
    <span class="hljs-variable">width</span>: Titanium.UI.SIZE
});
cacheImageAndLoad(<span class="hljs-string">'http://myimage.com'</span>, remoteImage);
window.<span class="hljs-built_in">add</span>(remoteImage);
</code></pre><pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">cacheImageAndLoad</span><span class="hljs-params">(url, imageView)</span></span>{
    <span class="hljs-keyword">var</span> fileName = url.substring(url.lastIndexOf(<span class="hljs-string">'/'</span>) + <span class="hljs-number">1</span>);

    <span class="hljs-keyword">var</span> fileCopy = Ti.Filesystem.getFile(Ti.Filesystem.applicationDataDirectory, fileName);
    <span class="hljs-keyword">if</span> (!fileCopy.exists()) {
        <span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient({
            onload : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
                fileCopy.write(xhr.responseData);
                imageView.backgroundImage = fileCopy.nativePath;
            },
            onerror : <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
                 <span class="hljs-comment">// show your default image</span>
                 remoteImage.setImage(<span class="hljs-string">'/myDefaultImages/myDefault.png'</span>);
            },
            timeout : <span class="hljs-number">20000</span>
        });

        xhr.open(<span class="hljs-string">'GET'</span>, url);
        xhr.send();
    }
    <span class="hljs-keyword">else</span> {
        imageView.backgroundImage = fileCopy.nativePath;
    }
}
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="October 2nd 2014, 5:37:01 pm">October 2nd 2014</span>
								by <span class='authorname'>Douglas Alves</span><br>
								<a class="icon-bg icon-link" href="question/178037/imageview-classcastexception-while-setting-remote-url.html#answer-282848" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
