<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Android Background Service » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Android Background Service</h1>
		</header>
		<section>
			<p>I&#39;ve been trying to get my head around this and struggling for days! I have a countdown timer running in my app that shows an alert when the time is up.</p>
<p>The problem is when the app goes to sleep or the device is shut down.</p>
<p>My timer code is situated in app.js which fires an event to update the label text in another file. I have managed to get this working on IoS using background services that re kickstarts the timer - but having no joy with Android.</p>
<p>Ideally I&#39;d like to get the timer running again so when the user re-opens the app the timer text is correct, but struggling with this. </p>
<p>I&#39;ve tried to play around with services and intents, but I am really struggling to understand how this works. Is it possible to create something that will ensure the timer text is correct when the user re-opens the app; or failign this create an alert at the very least when the timer is finished?</p>
<p>Any help, as always, is massively appreciated. I&#39;ve read the wiki guide on simple services and explored the kitchen sink, but I&#39;m not even sure if that&#39;s the way I need to go as I don&#39;t really understand the concept that well.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="October 20th 2011, 9:38:35 am">October 20th 2011</span>
				by <span class='authorname'>Chris Leyton</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>background</span></li>
					
						<li><span class='tagname'>intent</span></li>
					
						<li><span class='tagname'>services</span></li>
					
						<li><span class='tagname'>timer</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-221550">
				
						<section>
							<p>Check out the wiki for <a href="http:&#x2F;&#x2F;wiki.appcelerator.org&#x2F;display&#x2F;guides&#x2F;Android+Notifications#AndroidNotifications-Futurenotifications">Scheduling Future Notifications</a>. This has a complete example for Android.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="October 21st 2011, 7:07:43 pm">October 21st 2011</span>
								by <span class='authorname'>Adam Paxton</span><br>
								<a class="icon-bg icon-link" href="question/127128/android-background-service#answer-221550" rel="permalink">permalink</a>
							</div>

							<h5>3 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Adam, thanks for the response. I&#39;m slowly getting my head around this, but could you perhaps confirm one thing for me.</p>
<p>I can schedule a notification to occur when the timer is due to be finished using the above guide, but it seems whenever the app goes to sleep&#x2F;phone turned off that my setInterval timer is paused. </p>
<p>As a result, when the user switches the app back on the timer text is completely out of sync - is there anyway to keep this timer maintained, as it&#39;s a little misleading. For example, the user puts a 10 minute timer on, the phone hibernates after several minutes, yet when the user switches back to the app the time displayed is relative to when the app goes to sleep because the timer appears to pause.</p>
<p>Is there anyway around this - otherwise I guess my plan B is to remove the timer text if the app sleeps and just rely on the future notification?</p>
<p>Many thanks for all of your help…</p>
</p>
										<div class="author">
											&mdash; commented <span title="October 23rd 2011, 9:10:38 am">October 23rd 2011</span>
											by <span class='authorname'>Chris Leyton</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I guess to summarise my dilemma - is it even possible to keep a timer running in the background with Android?</p>
</p>
										<div class="author">
											&mdash; commented <span title="October 23rd 2011, 1:27:20 pm">October 23rd 2011</span>
											by <span class='authorname'>Chris Leyton</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hello Chris, I think that when Android apps go in to background, you don&#39;t have a guarantee that things will continue to run as expected, as the OS can stop it when it needs resources, etc.</p>
<p>I think your best bet is to just schedule the notification(s) for the time you want them to run instead of using the setInterval, and if you only want it to show when in background, then look in tracking when the app goes in to background using the <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;apidoc&#x2F;mobile&#x2F;latest&#x2F;Titanium.Android.Activity-object.html">pause</a> or resume events.  Or, you could use the setInterval, and when the app goes to background, use the pause event to schedule the notification with the time remaining in your timer.  I&quot;m just not sure how much android will process in the pause event since the app is being paused, but you might give it a try.</p>
</p>
										<div class="author">
											&mdash; commented <span title="October 24th 2011, 11:43:11 am">October 24th 2011</span>
											by <span class='authorname'>Adam Paxton</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-227635">
				
						<section>
							<h3 id="android-timer-even-when-the-phone-goes-to-sleep-">Android Timer (even when the phone goes to sleep)</h3>
<p>When the phone goes to sleep, the app is “paused” and therefore, the timer is paused. To solve this issue on Android, I added the WAKE_LOCK permission to tiapp.xml:</p>
<pre><code class="hljs">(…)
    <span class="hljs-tag">&lt;<span class="hljs-title">android</span> <span class="hljs-attribute">xmlns:android</span>=<span class="hljs-value">"http://schemas.android.com/apk/res/android"</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">manifest</span> <span class="hljs-attribute">android:versionName</span>=<span class="hljs-value">"1.0.0"</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">uses-permission</span> <span class="hljs-attribute">android:name</span>=<span class="hljs-value">"android.permission.WAKE_LOCK"</span> /&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">manifest</span>&gt;</span>
        <span class="hljs-tag">&lt;<span class="hljs-title">services</span>&gt;</span>
            <span class="hljs-tag">&lt;<span class="hljs-title">service</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"interval"</span> <span class="hljs-attribute">url</span>=<span class="hljs-value">"myservice.js"</span>/&gt;</span>
        <span class="hljs-tag">&lt;/<span class="hljs-title">services</span>&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">android</span>&gt;</span>
(…)
</code></pre><p>I am using an interval service that updates a progress bar; for an example, please look at ‘examples&#x2F;android_services.js’ in the Kitchen Sink.</p>
<h3 id="iphone-timer">Iphone Timer</h3>
<p>I use the ildeTimerDisabled</p>
<pre><code class="hljs"><span class="hljs-constant">Ti.App.idleTimerDisabled</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">// to disable going to sleep (iPhone only) </span>
<span class="hljs-constant">Ti.App.idleTimerDisabled</span> = <span class="hljs-literal">false</span>; <span class="hljs-comment">// to re-enable it</span>
</code></pre><p>Hope this helps.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 16th 2012, 2:15:21 pm">January 16th 2012</span>
								by <span class='authorname'>Gregori Faroux</span><br>
								<a class="icon-bg icon-link" href="question/127128/android-background-service#answer-227635" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
