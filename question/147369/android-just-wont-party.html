<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Android Just Won&#39;t Party » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Android Just Won&#39;t Party</h1>
		</header>
		<section>
			<p>Running Titanium SDK 3.0.1, minimum Android level, level 8 (2.2 API), targets of iOS and Android on Mac OSX box.<br>I am trying to play some youtube videos that have been retrieved from a channel. Everything plays fine on iOS but getting this annoying error on Android.</p>
<p>&quot;setRequestHeader can only be called before invoking send.&quot;  </p>
<p>As you can see in the code below, send is not even called until way after the offending line (Referrer) which confuses me on what to do.  Unless android wants me to place the line after the request.open (&#39;GET&#39;, line.</p>
<pre><code class="hljs">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">youtube</span>(<span class="hljs-params">obj</span>) </span>{ <span class="hljs-comment">//_youtubeId, _callbackOk, _callbackError) { //http://www.youtube.com/watch?v=soos3rN31Gw</span>
    <span class="hljs-keyword">var</span> request = Titanium.Network.createHTTPClient({
        timeout : <span class="hljs-number">10000</span> <span class="hljs-comment">/* in milliseconds */</span>
    });
    request.setRequestHeader(<span class="hljs-string">"Referer"</span>, <span class="hljs-string">"http://www.youtube.com/watch?v="</span> + obj.id);
    request.open(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"http://m.youtube.com/watch?ajax=1&amp;feature=related&amp;layout=mobile&amp;tsp=1&amp;&amp;v="</span> + obj.id);
    request.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">if</span> (obj.error) {
            obj.error(e);
        }
    };
    request.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">var</span> qualities = {};
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">var</span> fmtarray = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-keyword">this</span>.responseText.substring(<span class="hljs-number">4</span>, <span class="hljs-keyword">this</span>.responseText.length))).content.video[<span class="hljs-string">'fmt_stream_map'</span>];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, j = fmtarray.length; i &lt; j; i++) {
                <span class="hljs-keyword">var</span> data = fmtarray[i];
                <span class="hljs-keyword">var</span> type = <span class="hljs-built_in">decodeURIComponent</span>(data[<span class="hljs-string">'type'</span>]);
                <span class="hljs-keyword">if</span> (type.indexOf(<span class="hljs-string">'mp4'</span>) &gt;= <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">var</span> url = <span class="hljs-built_in">decodeURIComponent</span>(data[<span class="hljs-string">'url'</span>]);
                    <span class="hljs-keyword">var</span> quality = <span class="hljs-built_in">decodeURIComponent</span>(data[<span class="hljs-string">'quality'</span>]);
                    qualities[quality] = url;
                }
            }
            <span class="hljs-keyword">if</span> (obj.success) {
                obj.success(qualities);
            }
        } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-keyword">if</span> (obj.problem) {
                obj.problem();
            }
        }
    }
    request.send(); 
}
</code></pre><p>thx for your insight and help</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="January 24th 2013, 6:32:54 pm">January 24th 2013</span>
				by <span class='authorname'>adebisi oladipupo</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>setrequestheader</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>I tried my suggestion of moving the setRequestHeader line to after the request.open line and was able to go a step further where the videoplayer window was displayed (past the previous error).  The only issue now is that I only get an alert dialog with no text and no video loaded.</p>
<p>I am suspecting that no youtube video url was processed (essentially the getYoutubeId function) due to the relocation of the setRequestHeader code.  Can someone please assist ? IThanks.</p>
</div>
							<div class="author">
								&mdash; commented <span title="January 24th 2013, 6:42:32 pm">January 24th 2013</span>
								by <span class='authorname'>adebisi oladipupo</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-263128">
				
						<section>
							<p>Here is a version that works for both Android and iOS:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> lib = Alloy.Globals;

exports.play = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">win, id</span>) </span>{
    getVideo(id);
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getVideo</span>(<span class="hljs-params">id</span>) </span>{
    <span class="hljs-keyword">var</span> client = Ti.Network.createHTTPClient();
    client.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> json = <span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-keyword">this</span>.responseText.substring(<span class="hljs-number">4</span>, <span class="hljs-keyword">this</span>.responseText.length)))));
        <span class="hljs-keyword">var</span> response = <span class="hljs-built_in">JSON</span>.parse(json);
        <span class="hljs-keyword">var</span> video = response.content.video;
        <span class="hljs-keyword">var</span> streamUrl = video[<span class="hljs-string">'fmt_stream_map'</span>] ? video[<span class="hljs-string">'fmt_stream_map'</span>][<span class="hljs-number">0</span>].url : video.stream_url;
        Ti.API.info(<span class="hljs-string">"stream url: "</span> + streamUrl);
        playVideo(streamUrl);
    };
    client.setRequestHeader(<span class="hljs-string">'Referer'</span>, <span class="hljs-string">'http://www.youtube.com/watch?v='</span> + id);
    client.setRequestHeader(<span class="hljs-string">'User-Agent'</span>, <span class="hljs-string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/536.26.14 (KHTML, like Gecko) Version/6.0.1 Safari/536.26.14'</span>);
    client.open(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'http://m.youtube.com/watch?ajax=1&amp;feature=related&amp;layout=mobile&amp;tsp=1&amp;&amp;v='</span> + id);
    client.send();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">playVideo</span>(<span class="hljs-params">url</span>) </span>{
    <span class="hljs-keyword">var</span> win = Ti.UI.createWindow({
        title: <span class="hljs-string">'Video Player'</span>,
        backButtonTitle: <span class="hljs-string">'Videos'</span>,
        barColor: <span class="hljs-string">'#000'</span>,
        backgroundColor: <span class="hljs-string">'#000'</span>
    });
    videoPlayer = Ti.Media.createVideoPlayer({
        backgroundColor: <span class="hljs-string">'#000'</span>,
        fullscreen: <span class="hljs-literal">true</span>,
        url: url,
        autoplay: <span class="hljs-literal">true</span>,
        scalingMode: Ti.Media.VIDEO_SCALING_ASPECT_FIT,
        mediaControlMode: Ti.Media.VIDEO_CONTROL_NONE
    });
    <span class="hljs-comment">/*videoPlayer.addEventListener('complete', function(e) { 
        if (e.reason === 0) {
            Ti.API.info('complete exit');
            win.close();
        };
    });*/</span>
    videoPlayer.addEventListener(<span class="hljs-string">'fullscreen'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">if</span> (!e.entering) {
            Ti.API.info(<span class="hljs-string">'fullscreen exit'</span>);
            win.close();
        }
    });
    <span class="hljs-keyword">if</span>(!lib.constants.IS_ANDROID) {
        win.add(videoPlayer);
    }
    win.open();
}
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 21st 2013, 5:20:45 pm">May 21st 2013</span>
								by <span class='authorname'>Justin Toth</span><br>
								<a class="icon-bg icon-link" href="../../question/147369/android-just-wont-party.html#answer-263128" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Here is an updated version that handles: (1.) High quality videos now shown on Android (2.) Handle Android back button exiting video player (3.) Auto-close video player after video completes.</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> lib = Alloy.Globals;

<span class="hljs-keyword">var</span> win = <span class="hljs-literal">null</span>,
    videoPlayer = <span class="hljs-literal">null</span>;

exports.isPlaying = <span class="hljs-literal">false</span>;

exports.play = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">id</span>) </span>{
    exports.isPlaying = <span class="hljs-literal">true</span>;
    getVideo(id);
};

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getVideo</span>(<span class="hljs-params">id</span>) </span>{
    <span class="hljs-keyword">var</span> client = Ti.Network.createHTTPClient();
    client.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
        <span class="hljs-keyword">var</span> json = <span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-keyword">this</span>.responseText.substring(<span class="hljs-number">4</span>, <span class="hljs-keyword">this</span>.responseText.length)))));
        <span class="hljs-keyword">var</span> response = <span class="hljs-built_in">JSON</span>.parse(json);
        <span class="hljs-keyword">var</span> video = response.content.video;
        <span class="hljs-keyword">var</span> isHighQuality = video[<span class="hljs-string">'fmt_stream_map'</span>] != <span class="hljs-literal">null</span>;
        <span class="hljs-keyword">var</span> streamUrl = isHighQuality ? video[<span class="hljs-string">'fmt_stream_map'</span>][<span class="hljs-number">0</span>].url : video.stream_url;
        <span class="hljs-keyword">if</span>(!isHighQuality) {
            Ti.API.info(<span class="hljs-string">'using low quality video because fmt_stream_map does not exist in json response, User-Agent probably is not being sent correctly'</span>);
        }
        Ti.API.info(<span class="hljs-string">'stream url: '</span> + streamUrl);
        playVideo(streamUrl);
    };
    <span class="hljs-keyword">if</span>(lib.constants.IS_IOS) {
        client.setRequestHeader(<span class="hljs-string">'Referer'</span>, <span class="hljs-string">'http://www.youtube.com/watch?v='</span> + id);
        client.setRequestHeader(<span class="hljs-string">'User-Agent'</span>, <span class="hljs-string">'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_8_2) AppleWebKit/536.26.14 (KHTML, like Gecko) Version/6.0.1 Safari/536.26.14'</span>);
    }
    client.open(<span class="hljs-string">'GET'</span>, <span class="hljs-string">'http://m.youtube.com/watch?ajax=1&amp;layout=mobile&amp;tsp=1&amp;utcoffset=330&amp;v='</span> + id);
    <span class="hljs-keyword">if</span>(lib.constants.IS_ANDROID) {
        client.setRequestHeader(<span class="hljs-string">'Referer'</span>, <span class="hljs-string">'http://www.youtube.com/watch?v='</span> + id);
        client.setRequestHeader(<span class="hljs-string">'User-Agent'</span>, <span class="hljs-string">'Mozilla/5.0 (Linux; U; Android 2.2.1; en-gb; GT-I9003 Build/FROYO) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1'</span>);
    }
    client.send();
}

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">playVideo</span>(<span class="hljs-params">url</span>) </span>{
    <span class="hljs-keyword">if</span>(lib.constants.IS_IOS) {
        win = Ti.UI.createWindow({
            title: <span class="hljs-string">'View Training Video'</span>,
            backgroundColor: <span class="hljs-string">'#000'</span>
        });
    }
    videoPlayer = Ti.Media.createVideoPlayer({
        backgroundColor: <span class="hljs-string">'#000'</span>,
        url: url,
        fullscreen: <span class="hljs-literal">true</span>,
        autoplay: <span class="hljs-literal">true</span>,
        scalingMode: Ti.Media.VIDEO_SCALING_ASPECT_FIT,
        mediaControlMode: Ti.Media.VIDEO_CONTROL_DEFAULT   
    });
    videoPlayer.addEventListener(<span class="hljs-string">'complete'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{ 
        Ti.API.info(<span class="hljs-string">'video player complete'</span>);
        exports.close();
    });
    videoPlayer.addEventListener(<span class="hljs-string">'fullscreen'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">if</span> (!e.entering) {
            Ti.API.info(<span class="hljs-string">'video player fullscreen exit'</span>);
            exports.close();
        }
    });
    <span class="hljs-keyword">if</span>(lib.constants.IS_IOS) {
        win.add(videoPlayer);
        win.open();
    }
}

exports.close = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    Ti.API.info(<span class="hljs-string">'closing video player'</span>);
    <span class="hljs-keyword">if</span>(lib.constants.IS_IOS) {
        videoPlayer.fullscreen = <span class="hljs-literal">false</span>;
        win.close();
    }
    <span class="hljs-keyword">else</span> {
        videoPlayer.hide();
        videoPlayer.release();
        videoPlayer = <span class="hljs-literal">null</span>;
    }
    exports.isPlaying = <span class="hljs-literal">false</span>;
};
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="May 22nd 2013, 1:54:27 pm">May 22nd 2013</span>
											by <span class='authorname'>Justin Toth</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-255292">
				
						<section>
							<p>Hi</p>
<p>Try it this way round;</p>
<pre><code class="hljs">
<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">youtube</span>(<span class="hljs-params">obj</span>) </span>{ <span class="hljs-comment">//_youtubeId, _callbackOk, _callbackError) { //http://www.youtube.com/watch?v=soos3rN31Gw</span>
    <span class="hljs-keyword">var</span> request = Titanium.Network.createHTTPClient({
        timeout : <span class="hljs-number">10000</span> <span class="hljs-comment">/* in milliseconds */</span>
    });
    request.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">if</span> (obj.error) {
            obj.error(e);
        }
    };
    request.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
        <span class="hljs-keyword">var</span> qualities = {};
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">var</span> fmtarray = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-built_in">decodeURIComponent</span>(<span class="hljs-keyword">this</span>.responseText.substring(<span class="hljs-number">4</span>, <span class="hljs-keyword">this</span>.responseText.length))).content.video[<span class="hljs-string">'fmt_stream_map'</span>];
            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>, j = fmtarray.length; i &lt; j; i++) {
                <span class="hljs-keyword">var</span> data = fmtarray[i];
                <span class="hljs-keyword">var</span> type = <span class="hljs-built_in">decodeURIComponent</span>(data[<span class="hljs-string">'type'</span>]);
                <span class="hljs-keyword">if</span> (type.indexOf(<span class="hljs-string">'mp4'</span>) &gt;= <span class="hljs-number">0</span>) {
                    <span class="hljs-keyword">var</span> url = <span class="hljs-built_in">decodeURIComponent</span>(data[<span class="hljs-string">'url'</span>]);
                    <span class="hljs-keyword">var</span> quality = <span class="hljs-built_in">decodeURIComponent</span>(data[<span class="hljs-string">'quality'</span>]);
                    qualities[quality] = url;
                }
            }
            <span class="hljs-keyword">if</span> (obj.success) {
                obj.success(qualities);
            }
        } <span class="hljs-keyword">catch</span> (e) {
            <span class="hljs-keyword">if</span> (obj.problem) {
                obj.problem();
            }
        }
    }
    request.open(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"http://m.youtube.com/watch?ajax=1&amp;feature=related&amp;layout=mobile&amp;tsp=1&amp;&amp;v="</span> + obj.id);
    request.setRequestHeader(<span class="hljs-string">"Referer"</span>, <span class="hljs-string">"http://www.youtube.com/watch?v="</span> + obj.id);
    request.send(); 
}
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 24th 2013, 9:35:18 pm">January 24th 2013</span>
								by <span class='authorname'>Malcolm Hollingsworth</span><br>
								<a class="icon-bg icon-link" href="../../question/147369/android-just-wont-party.html#answer-255292" rel="permalink">permalink</a>
							</div>

							<h5>18 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hey partner, thx for checking in and trying to help.  Your revised code still doesn&#39;t pull in video on android. I get an alert dialog that is blank probably indicating there was a problem but not sure what that problem could be. Am I correct to suspect that the display of an alert dialog window is because the video couldn&#39;t be pulled or url issue?  SInce the videos play in iOS and pulled in via the same code, it couldn&#39;t be because video does not exist or url being invalid.</p>
<p>Please note that on android I changed your original code to load video by calling a function loadVideo() instead of via clicking a button that is attached to the navbar as is the case in iOS .  (see code posted earlier in this thread).  Android has too much idiosyncrasies that I thought I have taken care of e.g. not adding the videoplayer to the containing window as we do in iOS but still a disconnect somewhere.</p>
<p>Thanks Malcolm for the help and as always, this problem can and will be solved as well because I&#39;ve got an expert working with me on it (smile).</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 25th 2013, 2:19:15 am">January 25th 2013</span>
											by <span class='authorname'>adebisi oladipupo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I have taken a look at the code - which looks fine, but when I went to check the data coming back from YouTube against your loop - I found the code coming back from YouTube is not JSON, or at least badly formatted JSON.</p>
<p>Because of this the app cannot parse the results.  This is not a problem with your code or Titanium this is the actual data returned by YouTube, you can see from the returned data if you try it in a browser that it is wrong.</p>
<p><a href="http:&#x2F;&#x2F;m.youtube.com&#x2F;watch?ajax=1&amp;feature=related&amp;layout=mobile&amp;tsp=1&amp;&amp;v=soos3rN31Gw">http:&#x2F;&#x2F;m.youtube.com&#x2F;watch?ajax=1&amp;feature=related&amp;layout=mobile&amp;tsp=1&amp;&amp;v=soos3rN31Gw</a></p>
<p>To be JSON it would need to start with a <strong>{</strong> or <strong>[</strong> and a test of the data in <a href="http:&#x2F;&#x2F;jsonlint.com&#x2F;">jsonlint.com</a> shows that it will not validate.</p>
<p>Have you had success with this URL before?</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 25th 2013, 1:22:11 pm">January 25th 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Yes.  The same code and url play fine on the iPhone platform and therein lies my confusion.  Even the first error of calling setRequestHeader before open&#x2F;send was not a problem in iPhone version.  Only Android is giving all these errors.<br>None of the youtube videos plays and all of them play on iOS with the same code. </p>
<p>Is there something special that needs to be addressed when it comes to android playing youtube videos different from how ios treats and plays them?  The only thing I knew to take care of was not adding the videoplayer with a win.add(video player) as done in iOS but instead do a video player.play(). </p>
<p>On the validity of the youtube url, I have pasted the urls in a web browser and got the videos to be played and verified the rss feed in YQL.  However, if the return is not a valid JSON, is there another way to do this say with XML (even though that is crude)?  I am sure there are apps on android playing youtube or remote videos.  </p>
<p>Thx for assisting and not giving up.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 25th 2013, 2:20:25 pm">January 25th 2013</span>
											by <span class='authorname'>adebisi oladipupo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I have played with your routine and found that I can get it to work on Android but the node you are looking for <strong>fmt_stream_map</strong> does not exist in the response.</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">youtube</span><span class="hljs-params">(obj)</span></span> { //_youtubeId, _callbackOk, _callbackError) { //http://www.youtube.com/watch?v=soos3rN31Gw
    var request = Titanium.Network.createHTTPClient({
        timeout : <span class="hljs-number">10000</span> /* <span class="hljs-keyword">in</span> milliseconds */
    });
    request.onerror = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span></span> {
        <span class="hljs-keyword">if</span> (obj.<span class="hljs-built_in">error</span>) {
            obj.<span class="hljs-built_in">error</span>(e);
        }
    };
    request.onload = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">(e)</span></span> {
        var json = JSON.parse(decodeURIComponent(this.responseText.substring(<span class="hljs-number">4</span>, this.responseText.length)));
        alert(json.content.video.user_image_url)
        /*
        var qualities = {};
        try {
            var fmtarray = JSON.parse(decodeURIComponent(this.responseText.substring(<span class="hljs-number">4</span>, this.responseText.length))).content.video[<span class="hljs-string">'fmt_stream_map'</span>];
            <span class="hljs-keyword">for</span> (var i = <span class="hljs-number">0</span>, j = fmtarray.length; i &lt; j; i++) {
                var data = fmtarray[i];
                var <span class="hljs-built_in">type</span> = decodeURIComponent(data[<span class="hljs-string">'type'</span>]);
                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">type</span>.indexOf(<span class="hljs-string">'mp4'</span>) &gt;= <span class="hljs-number">0</span>) {
                    var url = decodeURIComponent(data[<span class="hljs-string">'url'</span>]);
                    var quality = decodeURIComponent(data[<span class="hljs-string">'quality'</span>]);
                    qualities[quality] = url;
                }
            }
            <span class="hljs-keyword">if</span> (obj.success) {
                obj.success(qualities);
            }
        } catch (e) {
            <span class="hljs-keyword">if</span> (obj.problem) {
                obj.problem();
            }
        }
        */
    }
    request.open(<span class="hljs-string">"GET"</span>, <span class="hljs-string">"http://m.youtube.com/watch?ajax=1&amp;feature=related&amp;layout=mobile&amp;tsp=1&amp;&amp;v="</span> + obj.id);
    request.setRequestHeader(<span class="hljs-string">"Referer"</span>, <span class="hljs-string">"http://www.youtube.com/watch?v="</span> + obj.id);
    request.send(); 
}
</code></pre><p>This works on Android and iPhone.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 25th 2013, 3:30:16 pm">January 25th 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Sorry Malcolm, I copied your revised function code as is and replaced same in the app. Now I get an alert with text similar to &#x2F;&#x2F;i2.ything.com&#x2F;…..&#x2F;filename.jpg?v=d39b83 for all the youtube videos on android. The only difference is the url to an image file but the alert is about an image file on all of them. </p>
<p>Is there another part of the JS file I need to modify to make it work as it does for you? I have your exact revised code.  One thing is clear though, your code has advanced me closer to the working solution, we are past an alert display with empty dialog&#x2F;data.   Thanks my friend for your unwavering assistance.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 25th 2013, 5:54:13 pm">January 25th 2013</span>
											by <span class='authorname'>adebisi oladipupo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I think the alert is coming from this new statement in the code:  alert(json.content.video.user_image_url).  Not sure what that is supposed to do.  After dismissing the alert box, shouldn&#39;t the video then be loaded or is that alert indicating why the videoplayer is blank?</p>
<p>I called a loadVideo function in the code which is what triggers a call to the function youtube(obj)<br>and results in the alert display. I placed videoPlayer.play() statement after the loadVideo() statement so as to open the android video player and play selected video.  Is this where I am missing it, no video is loaded or no video is played bcos of wrong function call? Almost there, please hang with me on this as I need expert advice and help.  Thx</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 25th 2013, 6:07:36 pm">January 25th 2013</span>
											by <span class='authorname'>adebisi oladipupo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I added the alert to show you a node that did work as the node that your loop is dependant on <strong>fmt_stream_map</strong> does not actually exist in the YouTube returned code.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 25th 2013, 6:59:19 pm">January 25th 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>ok. so how do I make the video play now that the cause of earlier error has been identified and code commented out? I am getting a video window with no video loaded to be played. How did you play&#x2F;load desired video as I tired to call the player with videoPlayer.play() statement after the loadVideo() function call but before the return win statement of the constructor?</p>
<p>I did it so because there&#39;s no screen position to put a button to load video onClickEvent that will not take away from available space to display video (unlike in iOS where I can use the navBar for same). I am assuming that is the problem but may not be.  Your advice and guide is appreciated. Thx</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 26th 2013, 12:27:52 am">January 26th 2013</span>
											by <span class='authorname'>adebisi oladipupo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Just additional thoughts. When I look at the code snippet for loading the video, I see that the JSON call must have  succeeded bcos data returned (shown in console) is:   data {&quot;small&quot;:&quot;http:&#x2F;&#x2F;r6—sn-p5qlsn7e.c.youtube.com&#x2F;videoplayback?mt=1359173471&amp;mv=m&amp;dnc=1&amp;itag=36&amp;sparams=cp,id,ip,ipbits,itag,ratebypass,source,upn,expire&amp;fexp=904448,916611,920704,912806,922403,922405,929901,913605,925710,929104,906938,920201,913302,919009,911116,926403,910221,901451&amp;id=b28a2cdeb377d46c&amp;yms=T0uYvvFb-kk&amp;sver=3&amp;ipbits=8&amp;ip=70.161.212.176&amp;el=watch&amp;app=youtube_mobile&amp;ms=au&amp;key=yt1&amp;source=youtube&amp;cp=U0hUTlFUVF9IUkNONF9JTlhDOlg5dFphc0tkLWpv&amp;upn=EdDuErZHvZA&amp;signature=7422E813F69E44B7FC34152A46DF7A238253F236.4981C4EF443FC59D1E78B02A6B2261865AA01B7E&amp;ratebypass=yes&amp;expire=1359196238&amp;newshard=yes&quot;}</p>
<p>when loadVideo() is called as obtained from the statement: Ti.API.info(&#39;data&#39;, JSON.stringify(e));</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">loadVideo</span> (<span class="hljs-params">e</span>) </span>{

    <span class="hljs-keyword">var</span> youtubeId = getYoutubeID(strLink);
<span class="hljs-comment">//    Ti.API.info('Extracted youTubeId is:' + youtubeId);</span>

    youtube({
        id: youtubeId,
        success: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
            Ti.API.info(<span class="hljs-string">'data'</span>, <span class="hljs-built_in">JSON</span>.stringify(e));
<span class="hljs-comment">//            videoPlayer.setUrl(e.small);</span>
            videoPlayer.setUrl(getBestResolution(e));
        },
        problem: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
            alert(<span class="hljs-built_in">JSON</span>.stringify(e));
        },
        error: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
            alert(<span class="hljs-built_in">JSON</span>.stringify(e));
        }
    });
}
 loadVideo();
 videoPlayer.play();
</code></pre><p>Not sure why the same code is returning needed data successfully and playing video in iOS but not so in android.<br>Nevertheless, I will take any code that enables me to play youtube videos in android and very much interested to get Malcolm&#39;s implementation since he said his code works on both iOS and android. Using what is posted, I am just getting a blank screen even when I have now included a button for loading the video.</p>
<p>Thanks</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 26th 2013, 2:22:52 am">January 26th 2013</span>
											by <span class='authorname'>adebisi oladipupo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hey Malcolm partner,  can you please share your code and its implementation that got it working to play youtube videos on android? I hope I read your response right that you got it working on both platforms but I have not succeeded using your code that commented out a segment of code.</p>
<p>Thanks for your usual insights.  I am lost given that data is being returned from the same youtube queried content and video displayed when on iOS platform but not so on android.  As I said beofore I owon&#39;t belabour the point of why so long I can have a code that works on android. The whys can be researched later.  Thanks a bunch.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 28th 2013, 3:05:52 am">January 28th 2013</span>
											by <span class='authorname'>adebisi oladipupo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I will take another look later on today for you.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 28th 2013, 5:44:37 am">January 28th 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hey partner Malcolm, just checking if you have had any luck with this issue?  Thanks my friend.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 29th 2013, 4:09:24 pm">January 29th 2013</span>
											by <span class='authorname'>adebisi oladipupo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Malcolm. Hope all is well with you and yours. Just checking to see if you have had a moment to take a look at this issue of playing youtube video on android. I appreciate your assistance as I have tried all I know how to especially when the same url and youtubeID are valid and play ok on iOS.  Thx</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 1st 2013, 2:16:35 pm">February 1st 2013</span>
											by <span class='authorname'>adebisi oladipupo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hello Malcolm.  Good evening.  I am just checking to see if you have had a moment to take a look at this issue of youtube video not loading on android even though the same URL returns playable content in iOS.  Thanks for your assistance as I also continue to wrestle with a solution.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 5th 2013, 4:28:27 pm">February 5th 2013</span>
											by <span class='authorname'>adebisi oladipupo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hey partner Malcolm. Hope you&#39;re doing great.  Just checking if you have had another look at the issue of playing youtube video on Android vis-a-vis your code.  I keep on trying to make your code work but it is not working for me on android. Will appreciate if you can share the version of the code that works for you or if it just won&#39;t be possible to play youtube videos on android.  Thx my friend and sorry if I appear to be demanding on your time.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 10th 2013, 2:05:14 am">February 10th 2013</span>
											by <span class='authorname'>adebisi oladipupo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi Malcolm partner. Hate to be a bother but just checking if you have had a chance to take a look at this issue again?  Thanks for your help.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 15th 2013, 2:29:39 am">February 15th 2013</span>
											by <span class='authorname'>adebisi oladipupo</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hi, I&#39;m using SDK 3.0.2GA.  I&#39;m attempting to do a similar thing as the original poster and am seeing the same error, &quot;Uncaught Error: setRequestHeader can only be called before invoking send.&quot;  on Android.  The code I&#39;m using works fine on iOS.   I also tried moving the setRequestHeader() past the open() call in my code.  This eliminated the above error, but resulted in no video on Android or iOS.</p>
<p>I&#39;m trying to do things this way after failing to play the video in a webview on Android.</p>
<p>Is there any hope???  Thanks!</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 28th 2013, 7:32:49 pm">February 28th 2013</span>
											by <span class='authorname'>Kevin Coffman</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Figure it out? Same issue here…</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 21st 2013, 5:09:03 pm">May 21st 2013</span>
											by <span class='authorname'>Justin Toth</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
