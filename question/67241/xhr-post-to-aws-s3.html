<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>xhr POST to AWS S3 » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>xhr POST to AWS S3</h1>
		</header>
		<section>
			<p>This weekend, I tried to implement the AWS Simple Storage Service (s3) &quot;<a href="http:&#x2F;&#x2F;docs.amazonwebservices.com&#x2F;AmazonS3&#x2F;2006-03-01&#x2F;dev&#x2F;index.html?UsingHTTPPOST.html">POST object</a>&quot; method to put files in S3.</p>
<p>Posting to S3 requires you to submit an HTML form. It was designed for directly uploading files from a browser to S3 without having to go through an intermediate application server. This use case would apply well to Mobile apps, but it seems that it may not work for the Titanium HTTP client.</p>
<p>The problem is that in a web form, you most browsers prevent setting a value for a <code>&amp;lt;INPUT type=&amp;quot;file&amp;quot; name=&amp;quot;file&amp;quot; value=&amp;quot;{path&amp;#x2F;filename}&amp;gt;</code>. (It&#39;s a very important browser security precaution to prevent web pages from silently nabbing local files.) Consequently, it appears that the file never gets uploaded with the POST action, and S3 responds with an inappropriate &quot;specified method not allowed&quot; error. (I posted from a browser to determine it really was.)</p>
<p>So the question is: Can Titanium programatically POST a file as part of a web form without ever presenting the form to the end user?</p>
<p><strong>Note</strong> A <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;8471&#x2F;upload-images-to-a-server#19021">related Q&amp;A item</a> falls short of providing an actual answer.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="October 4th 2010, 4:24:10 pm">October 4th 2010</span>
				by <span class='authorname'>Ted Haeger</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>aws</span></li>
					
						<li><span class='tagname'>forms</span></li>
					
						<li><span class='tagname'>html</span></li>
					
						<li><span class='tagname'>httpclient</span></li>
					
						<li><span class='tagname'>post</span></li>
					
						<li><span class='tagname'>s3</span></li>
					
						<li><span class='tagname'>xhr</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>4</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>4 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-208860">
				
						<section>
							<p>Ted is right, you cannot POST, but you can use a REST PUT.  I have just posted a question about getting this working for Android, but if you or anybody else would like the source code, I&#39;ve posted it as a pastie at the bottom of my <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;120366&#x2F;rest-put-to-aws-s3----works-on-ios-not-android">question</a>.</p>
<p>Any help getting the code to also work on Android would be appreciated.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="May 31st 2011, 3:23:29 am">May 31st 2011</span>
								by <span class='authorname'>Matthew Taylor</span><br>
								<a class="icon-bg icon-link" href="question/67241/xhr-post-to-aws-s3.html#answer-208860" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-123141">
				
						<section>
							<p>I&#39;m inclined to say Titanium can&#39;t. </p>
<p>However, there&#39;s a decent workaround. Create your own server-side script that accepts data from your Titanium app, then simply add the additional parameters you need and complete the POST to the S3 (in PHP, you could use <code>curl</code>, for example). </p>
<p>Yes, it&#39;s a redundant step, but it should still be fast, and may be your only option. Good luck! :)</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="October 4th 2010, 11:43:42 pm">October 4th 2010</span>
								by <span class='authorname'>Clifton Labrum</span><br>
								<a class="icon-bg icon-link" href="question/67241/xhr-post-to-aws-s3.html#answer-123141" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-123161">
				
						<section>
							<p>Yep, you need to do the upload to S3 on the server-side. But that’s not too tricky if you use the new &amp; official PHP-framework by AWS (formerly Cloudfusion).</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="October 5th 2010, 3:13:13 am">October 5th 2010</span>
								by <span class='authorname'>Sebastian</span><br>
								<a class="icon-bg icon-link" href="question/67241/xhr-post-to-aws-s3.html#answer-123161" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-135591">
				
						<section>
							<p>The basic answer is, &quot;No. The AWS S3 POST API was designed for direct-from-browser html form upload.&quot;</p>
<p>However, you do not need to upload to your own web application first and then send the file from the web server to S3 (which incurs bandwidth costs). You can still upload <em>directly</em> to S3 using a PUT with their REST API.</p>
<p>Doing this securely requires that you off-load the AWS authentication step from your Titanium app. As pointed out in <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;16951&#x2F;is-it-safe-to-store-cryptographic-passwords-in-my-app">another thread</a>, storing your AWS secret access key in your app leaves it vulnerable to hackers. So, to use the S3 PUT API, I implemented a &quot;signing service&quot; that my Ti app could call to sign each PUT action.</p>
<p>The resulting workflow goes something like this:</p>
<ol>
<li>The app has a picture to send to AWS, so it uses xhr to send the target &quot;key&quot; (path on AWS) to my signing service (along with any other necessary parameters.</li>
<li>The signing service uses the path and parameters to assemble a &quot;String to Sign&quot; (AWS&#39;s term), and hashes it using my AWS secret key.</li>
<li>The signing service responds to the Ti app&#39;s request with a JSON document containing the authorization and the date string it used in the string to sign.</li>
<li>The Ti app inserts the date and authorization as headers into a new xhr instance, and then PUTs the file onto S3.</li>
</ol>
<p>That&#39;s all it took. There is still a minor vulnerability doing it this way: someone could crack the app, learn about the signing service, and then start calling it for their own nefarious purposes. However, although they could upload, they could not access the files they upload–the signing service signs only for a simple PUT call.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 1st 2010, 12:06:50 pm">November 1st 2010</span>
								by <span class='authorname'>Ted Haeger</span><br>
								<a class="icon-bg icon-link" href="question/67241/xhr-post-to-aws-s3.html#answer-135591" rel="permalink">permalink</a>
							</div>

							<h5>5 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Signed queries is a great way to upload to S3 without sharing your keys in the app bundle, but it involves knowing the content-md5. I&#39;m wondering how you computed the md5 hash of the file in Titanium in order to be able to avoid uploading the entire file to your signing service. Care to share?</p>
</p>
										<div class="author">
											&mdash; commented <span title="December 25th 2010, 1:14:24 pm">December 25th 2010</span>
											by <span class='authorname'>Jonathan Harlap</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Ti has an MD5 method: http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;apidoc&#x2F;mobile&#x2F;latest&#x2F;Titanium.Utils.md5HexDigest-method.html</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 13th 2011, 6:16:38 pm">February 13th 2011</span>
											by <span class='authorname'>Ken-ichi Ueda</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Ken-ichi: Thanks, but I&#39;m quite aware of Ti.Utils. Unfortunately, that method only consumes strings so would not be able to compute the md5 hash of a file. Furthermore, even if you forced an entire file into a string to feed it to that method (which would give a different and incorrect result) its implementation would be terribly inefficient. I ended up writing a simple Titanium module to compute the hash of a file efficiently which works quite nicely.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 13th 2011, 7:12:48 pm">February 13th 2011</span>
											by <span class='authorname'>Jonathan Harlap</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Jonathan, yeah, I just tried to do what I recommended and it crashed the app.  Care to share your module for those of us who don&#39;t know ObjC?</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 14th 2011, 3:42:24 am">February 14th 2011</span>
											by <span class='authorname'>Ken-ichi Ueda</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Were you able to get your S3 code working on Android?  We&#39;re having an authorization header error–only on Android.  Same exact code works flawlessly to upload a file on iOS.  Any help would be greatly appreciated!</p>
</p>
										<div class="author">
											&mdash; commented <span title="May 27th 2011, 11:51:25 pm">May 27th 2011</span>
											by <span class='authorname'>Matthew Taylor</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
