<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>MobileWeb: HTTPClient/XMLHttpRequest sends OPTIONS instead of POST » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>MobileWeb: HTTPClient/XMLHttpRequest sends OPTIONS instead of POST</h1>
		</header>
		<section>
			<p>Hello,</p>
<p>I have a strange problem with calling an asmx webservice via a titanium app in mobileweb. For android and ios, everything works fine. The problem with mobileweb is that only OPTIONS is sent to the server, but never POST and xml data is never retrieved.</p>
<p>I have read that browsers &quot;preflight&quot; the request, and afterwards upon &quot;approval&quot; from the server, send the actual request with the actual HTTP request method. But this never happens. The app sends OPTIONS, the server returns &quot;200 OK&quot; with the needed response headers and that was it.</p>
<p>So I tried putting the javascript from the app in a simple test.html with the following content:</p>
<pre><code class="hljs"><span class="xml"><span class="hljs-tag">&lt;<span class="hljs-title">script</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"text/javascript"</span>&gt;</span><span class="actionscript">
    <span class="hljs-keyword">var</span> xhr = <span class="hljs-keyword">new</span> XMLHttpRequest();

    xhr.open(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'http://myasmxwebservice.com/TestMethod'</span>);
    xhr.onreadystatechange = <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-params">()</span> </span></span></span><span class="hljs-expression">{
        <span class="hljs-variable"><span class="hljs-keyword">if</span></span> (<span class="hljs-variable">xhr.readyState</span> == 4) {
          <span class="hljs-variable">alert</span>(<span class="hljs-variable">xhr.responseText</span>);
        }</span><span class="xml"><span class="handlebars"><span class="xml">
      };

    xhr.setRequestHeader('Content-Type', 'text/xml; charset=utf-8');
    xhr.setRequestHeader('SOAPAction', 'http://myasmxwebservice.com/TestMethod');
    xhr.setRequestHeader('Accept', 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8');
    xhr.send('<span class="hljs-pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">soap:Envelope</span> <span class="hljs-attribute">xmlns:xsi</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="hljs-attribute">xmlns:xsd</span>=<span class="hljs-value">"http://www.w3.org/2001/XMLSchema"</span> <span class="hljs-attribute">xmlns:soap</span>=<span class="hljs-value">"http://schemas.xmlsoap.org/soap/envelope/"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">soap:Body</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-title">TestMethod</span> <span class="hljs-attribute">xmlns</span>=<span class="hljs-value">"http://myasmxwebservice.com/"</span> /&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">soap:Body</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-title">soap:Envelope</span>&gt;</span>');
 </span></span><span class="hljs-tag">&lt;/<span class="hljs-title">script</span>&gt;</span></span>
</code></pre><p>and it works!!! The test html page sends POST to the webservice, retrieves the xml response and shows it in the alert dialog.</p>
<p>So what am I doing wrong?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="July 19th 2013, 5:41:16 am">July 19th 2013</span>
				by <span class='authorname'>Markus Schießl</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>asmx webservice</span></li>
					
						<li><span class='tagname'>asp.net webservice</span></li>
					
						<li><span class='tagname'>calling webservice</span></li>
					
						<li><span class='tagname'>http post</span></li>
					
						<li><span class='tagname'>mobileweb httpclient</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-266129">
				
						<section>
							<p>Hi,</p>
<p>Refer this link for http call over the mobile web,</p>
<p><a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;149900&#x2F;tinetworkhttpurlformatter-for-web-app">mobileweb httpclient call</a></p>
<p>and read this Appc docs for more detail,</p>
<p><a href="http:&#x2F;&#x2F;docs.appcelerator.com&#x2F;titanium&#x2F;2.1&#x2F;#!&#x2F;api&#x2F;Titanium.Network.HTTPClient">Appc HTTPClient docs</a></p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 19th 2013, 5:55:44 am">July 19th 2013</span>
								by <span class='authorname'>Prakash M</span><br>
								<a class="icon-bg icon-link" href="question/155041/mobileweb-httpclientxmlhttprequest-sends-options-instead-of-post#answer-266129" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>You need to use <strong>Ti.Network.httpURLFormatter</strong> instead of <strong>HttpClient</strong> for MobileWeb</p>
</p>
										<div class="author">
											&mdash; commented <span title="July 19th 2013, 5:57:17 am">July 19th 2013</span>
											by <span class='authorname'>Prakash M</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>1</span> Vote</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-266136">
				
						<section>
							<p>I inserted the following assignment before inititalizing the HttpClient:</p>
<pre><code class="hljs">        Ti.Network.httpURLFormatter = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(url)</span> </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-string">'http://myasmxwebservice.com/MyAsmxWebService.asmx'</span>;
</code></pre><p>Now the Content-Length of the http response is greater than 0, but Wireshark protocols the following error:</p>
<pre><code class="hljs"><span class="hljs-label">Content</span>-encoded entity <span class="hljs-keyword">body </span>(gzip): <span class="hljs-number">119</span> <span class="hljs-keyword">bytes </span>[Error: Decompression failed]
</code></pre><p>Can you tell me what&#39;s wrong here?</p>
<p>Thanks in advance.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 19th 2013, 8:32:24 am">July 19th 2013</span>
								by <span class='authorname'>Markus Schießl</span><br>
								<a class="icon-bg icon-link" href="question/155041/mobileweb-httpclientxmlhttprequest-sends-options-instead-of-post#answer-266136" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hi Markus,<br>Sending request from mobile web is called as cross-domain-request,</p>
<p>For this, server side you need to add some headers. For more detail read this link <a href="http:&#x2F;&#x2F;www.eriwen.com&#x2F;javascript&#x2F;how-to-cors&#x2F;">cross-domail-request</a></p>
<p>You should configure in serverside, then try like this,</p>
<pre><code class="hljs"><span class="hljs-keyword">if</span> (Ti.Platform.osname == <span class="hljs-string">"mobileweb"</span>) {
    Ti.Network.httpURLFormatter = function(url) {
        <span class="hljs-keyword">var</span> <span class="hljs-keyword">m</span>,
            <span class="hljs-keyword">loc</span> = <span class="hljs-keyword">window</span>.location,
            newPrefix = <span class="hljs-keyword">loc</span>.protocol + <span class="hljs-string">"//"</span> + <span class="hljs-keyword">loc</span>.hostname,
            ports = {
                <span class="hljs-string">"www.appcelerator.com"</span>: <span class="hljs-string">":8000"</span> <span class="hljs-comment">// leave blank for port 80</span>
            };

        <span class="hljs-keyword">if</span> (url.indexOf(newPrefix) == -1 &amp;&amp; url.indexOf(<span class="hljs-string">"://"</span>) != -1) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">m</span> = url.<span class="hljs-literal">match</span>(/(https?)\:\/\/([^\:\/]*):?(\<span class="hljs-keyword">d</span>*)(.*)/)) {
                <span class="hljs-keyword">return</span> newPrefix + ports[<span class="hljs-keyword">m</span>[2]] + <span class="hljs-keyword">m</span>[4];
            }
        }
    };
}
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="July 19th 2013, 9:12:56 am">July 19th 2013</span>
											by <span class='authorname'>Prakash M</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-266140">
				
						<section>
							<p>Hi Prakash,</p>
<p>the server currently contains the following headers:</p>
<pre><code class="hljs"><span class="hljs-attribute">Access-Control-Allow-Headers</span>: <span class="hljs-string">*</span>
<span class="hljs-attribute">Access-Control-Allow-Methods</span>: <span class="hljs-string">GET, POST, OPTIONS</span>
<span class="hljs-attribute">Access-Control-Allow-Origin</span>: <span class="hljs-string">*</span>
<span class="hljs-attribute">Access-Control-Max-Age</span>: <span class="hljs-string">1728000</span>
</code></pre><p>If I assign the httpURLFormatter, it still does not work. The result of &quot;newPrefix+ports[m[2]]+m[4]&quot; would be &quot;http:&#x2F;&#x2F;127.0.0.1undefined&#x2F;myWebService.asmx&quot;</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="July 19th 2013, 10:06:26 am">July 19th 2013</span>
								by <span class='authorname'>Markus Schießl</span><br>
								<a class="icon-bg icon-link" href="question/155041/mobileweb-httpclientxmlhttprequest-sends-options-instead-of-post#answer-266140" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
