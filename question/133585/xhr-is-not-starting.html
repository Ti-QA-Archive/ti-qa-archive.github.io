<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>xhr is not starting » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>xhr is not starting</h1>
		</header>
		<section>
			<p>I&#39;m trying to get information from a mySQL database by using xhr and getting data through a php service in JSON.</p>
<p>This is my code but not sure what is wrong. Can someone please help me?</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();
        <span class="hljs-comment">//    xhr.onload = function(){ alert(xhr.responseText); }</span>
            xhr.open(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'http://192.168.118.108:8888/test/submitdata2.php'</span>);

            <span class="hljs-comment">//var data_send = {</span>

            <span class="hljs-comment">// searchby: 'all'</span>
            <span class="hljs-comment">//}</span>
            xhr.send({<span class="hljs-string">'searchby'</span>:<span class="hljs-string">'all'</span>});


xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> myData = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.responseText);

Ti.API.log(myData.id);
};
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="March 10th 2012, 5:34:33 pm">March 10th 2012</span>
				by <span class='authorname'>Raul Ochoa</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>database</span></li>
					
						<li><span class='tagname'>json</span></li>
					
						<li><span class='tagname'>mysql</span></li>
					
						<li><span class='tagname'>xhr</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>6</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>6 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-232944">
				
						<section>
							<p>Try putting the onload before the send but after the open. </p>
<pre><code class="hljs">
<span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();
xhr.open(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'http://192.168.118.108:8888/test/submitdata2.php'</span>);

xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">var</span> myData = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.responseText);
    Ti.API.log(myData.id);
};

<span class="hljs-comment">//var data_send = {</span>

<span class="hljs-comment">// searchby: 'all'</span>
<span class="hljs-comment">//}</span>

xhr.send({<span class="hljs-string">'searchby'</span>:<span class="hljs-string">'all'</span>});
</code></pre><p>hth</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 10th 2012, 5:57:32 pm">March 10th 2012</span>
								by <span class='authorname'>Kosso</span><br>
								<a class="icon-bg icon-link" href="question/133585/xhr-is-not-starting#answer-232944" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>3</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-232945">
				
						<section>
							<p>You probably need to set a json header with the output:</p>
<p>Header(&#39;Content-type: application&#x2F;json&#39;)</p>
<p>somewhere in your PHP file should do the trick</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 10th 2012, 7:34:52 pm">March 10th 2012</span>
								by <span class='authorname'>Esben Maaløe</span><br>
								<a class="icon-bg icon-link" href="question/133585/xhr-is-not-starting#answer-232945" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-232951">
				
						<section>
							<p>I tried placing the xhr.onload before the xhr.send and it still doesn&#39;t do anything.</p>
<p>her is the code again:</p>
<pre><code class="hljs"><span class="hljs-comment">// ROW 1</span>
<span class="hljs-keyword">var</span> row1 = Ti.UI.createTableViewRow();
row1.backgroundColor = <span class="hljs-string">'black'</span>;
row1.selectedBackgroundColor = <span class="hljs-string">'black'</span>;
row1.height = <span class="hljs-number">140</span>;
row1.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
    Ti.API.log(e.source+<span class="hljs-string">" click at ("</span>+e.x+<span class="hljs-string">","</span>+e.y+<span class="hljs-string">")"</span>);


    <span class="hljs-comment">//network pull</span>

<span class="hljs-keyword">var</span> xhr = Ti.Network.createHTTPClient();

xhr.open(<span class="hljs-string">'POST'</span>, <span class="hljs-string">'http://192.168.1.102:8888/test/submitdata2.php'</span>);

    xhr.onload = <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> myData = <span class="hljs-built_in">JSON</span>.parse(<span class="hljs-keyword">this</span>.responseText);
    Ti.API.log(myData.id);
    };

    xhr.send({<span class="hljs-string">'searchby'</span>:<span class="hljs-string">'all'</span>});

<span class="hljs-comment">///////////</span>

    companyWin.open({modal:<span class="hljs-literal">true</span>});
});
</code></pre><p>Here is my php as well so you guys can see if I&#39;m missing anything.<br>Thank you guys for your help.</p>
<pre><code class="hljs">&lt;?php
<span class="hljs-variable">$con</span> = mysql_connect(<span class="hljs-string">"192.168.1.102"</span>,<span class="hljs-string">"root"</span>,<span class="hljs-string">"root"</span>);
<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$con</span>)
  {
  die(<span class="hljs-string">'Could not connect: '</span> . mysql_error());
  }

mysql_select_db(<span class="hljs-string">"testdata"</span>, <span class="hljs-variable">$con</span>);


<span class="hljs-variable">$query5</span> = mysql_query(<span class="hljs-string">"SELECT * FROM information"</span>);

        <span class="hljs-variable">$numrows5</span> = mysql_num_rows(<span class="hljs-variable">$query5</span>);




        <span class="hljs-keyword">while</span> (<span class="hljs-variable">$row5</span> = mysql_fetch_assoc(<span class="hljs-variable">$query5</span>))
    {
        <span class="hljs-variable">$id</span> = <span class="hljs-variable">$row5</span>[<span class="hljs-string">'id'</span>];
        <span class="hljs-variable">$name</span> = <span class="hljs-variable">$row5</span>[<span class="hljs-string">'company_name'</span>];
        <span class="hljs-variable">$number</span> = <span class="hljs-variable">$row5</span>[<span class="hljs-string">'company_number'</span>];


        <span class="hljs-variable">$test</span> = array(<span class="hljs-string">'id'</span> =&gt; <span class="hljs-variable">$id</span>, <span class="hljs-string">'name'</span> =&gt; <span class="hljs-variable">$name</span>, <span class="hljs-string">'number'</span> =&gt; <span class="hljs-variable">$number</span>);

    header(<span class="hljs-string">'Content-type: application/json'</span>);
    echo json_encode(<span class="hljs-variable">$test</span>);

    }

mysql_close(<span class="hljs-variable">$con</span>);


?&gt;
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 10th 2012, 11:19:23 pm">March 10th 2012</span>
								by <span class='authorname'>Raul Ochoa</span><br>
								<a class="icon-bg icon-link" href="question/133585/xhr-is-not-starting#answer-232951" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>You are sending that header everytime you fetch a row, try putting it as the very first line in your php?</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 10th 2012, 11:22:53 pm">March 10th 2012</span>
											by <span class='authorname'>Esben Maaløe</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I tried it. I put the header() right under &lt;?php and it still didn&#39;t work.</p>
<p>the <code>var xhr</code> should get created as the eventListener for the click is executed and I placed a <code>Ti.API.log()</code> in there so I can see if the eventListener was executing something and it does log that on the console for Titanium Studio but I don&#39;t get anything for the <code>Ti.API.log(myData.id);</code> Not even something saying that the variable can&#39;t be fined or something. This is what I get on the console.</p>
<p>[INFO] One moment, building …</p>
<p>[INFO] Titanium SDK version: 1.8.2 (02&#x2F;23&#x2F;12 17:46 59b3a90)</p>
<p>[INFO] iPhone Device family: universal</p>
<p>[INFO] iPhone SDK version: 4.3</p>
<p>[INFO] iPhone simulated device: iphone</p>
<p>[INFO] Launching application in Simulator</p>
<p>[INFO] Launched application in Simulator (3.52 seconds)</p>
<p>[INFO] Application started</p>
<p>[INFO] RGV Food&#x2F;1.0 (1.8.2.59b3a90)</p>
<p>[INFO] [object TiUITableViewRow] click at (116,109)</p>
<p>The last [INFO] line on here is the result of <code>Ti.API.log(e.source+&amp;quot; click at (&amp;quot;+e.x+&amp;quot;,&amp;quot;+e.y+&amp;quot;)&amp;quot;);</code></p>
<p>Do you have any other suggestions?</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 10th 2012, 11:32:43 pm">March 10th 2012</span>
											by <span class='authorname'>Raul Ochoa</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>If your json is otherwise good, you won&#39;t have anything called myData.id, but perhaps something called myData[0].id</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 10th 2012, 11:41:01 pm">March 10th 2012</span>
											by <span class='authorname'>Esben Maaløe</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>btw: Check that your json is valid - you can do it here: http:&#x2F;&#x2F;jsonlint.com&#x2F;</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 10th 2012, 11:41:32 pm">March 10th 2012</span>
											by <span class='authorname'>Esben Maaløe</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-232953">
				
						<section>
							<p>Check your PHP loop. You need to move the header and echo below that brace. Preferably after closing the database connection. </p>
<p>There&#39;s nothing wrong with the Titanium code at all. It&#39;s your PHP web service. ;)</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 10th 2012, 11:25:28 pm">March 10th 2012</span>
								by <span class='authorname'>Kosso</span><br>
								<a class="icon-bg icon-link" href="question/133585/xhr-is-not-starting#answer-232953" rel="permalink">permalink</a>
							</div>

							<h5>2 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>only move the header statement, if you move the echo, you will only output the last row :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 10th 2012, 11:26:48 pm">March 10th 2012</span>
											by <span class='authorname'>Esben Maaløe</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I tried moving it below like you guys said and it still doesn&#39;t show anything.</p>
<p>PHP Code:</p>
<pre><code class="hljs">&lt;?php

<span class="hljs-variable">$searchby</span> = $_REQUEST[<span class="hljs-string">'searchby'</span>];




<span class="hljs-variable">$con</span> = mysql_connect(<span class="hljs-string">"192.168.1.102"</span>,<span class="hljs-string">"root"</span>,<span class="hljs-string">"root"</span>);
<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$con</span>)
  {
  die(<span class="hljs-string">'Could not connect: '</span> . mysql_error());
  }

mysql_select_db(<span class="hljs-string">"testdata"</span>, <span class="hljs-variable">$con</span>);


<span class="hljs-variable">$query5</span> = mysql_query(<span class="hljs-string">"SELECT * FROM information"</span>);

        <span class="hljs-variable">$numrows5</span> = mysql_num_rows(<span class="hljs-variable">$query5</span>);




        <span class="hljs-keyword">while</span> (<span class="hljs-variable">$row5</span> = mysql_fetch_assoc(<span class="hljs-variable">$query5</span>))
    {
        <span class="hljs-variable">$id</span> = <span class="hljs-variable">$row5</span>[<span class="hljs-string">'id'</span>];
        <span class="hljs-variable">$name</span> = <span class="hljs-variable">$row5</span>[<span class="hljs-string">'company_name'</span>];
        <span class="hljs-variable">$number</span> = <span class="hljs-variable">$row5</span>[<span class="hljs-string">'company_number'</span>];


        <span class="hljs-variable">$test</span> = array(<span class="hljs-string">'id'</span> =&gt; <span class="hljs-variable">$id</span>, <span class="hljs-string">'name'</span> =&gt; <span class="hljs-variable">$name</span>, <span class="hljs-string">'number'</span> =&gt; <span class="hljs-variable">$number</span>);


    echo json_encode(<span class="hljs-variable">$test</span>);

    }
    header(<span class="hljs-string">'Content-type: application/json'</span>);






mysql_close(<span class="hljs-variable">$con</span>);


?&gt;
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 10th 2012, 11:38:33 pm">March 10th 2012</span>
											by <span class='authorname'>Raul Ochoa</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-232954">
				
						<section>
							<p>Try this for your PHP : </p>
<pre><code class="hljs">
&lt;?php
<span class="hljs-variable">$con</span> = mysql_connect(<span class="hljs-string">"192.168.1.102"</span>,<span class="hljs-string">"root"</span>,<span class="hljs-string">"root"</span>);
<span class="hljs-keyword">if</span> (!<span class="hljs-variable">$con</span>)
{
    die(<span class="hljs-string">'Could not connect: '</span> . mysql_error());
}

mysql_select_db(<span class="hljs-string">"testdata"</span>, <span class="hljs-variable">$con</span>);
<span class="hljs-variable">$query5</span> = mysql_query(<span class="hljs-string">"SELECT * FROM information"</span>);
<span class="hljs-variable">$numrows5</span> = mysql_num_rows(<span class="hljs-variable">$query5</span>);

<span class="hljs-variable">$response</span> = Array();

<span class="hljs-keyword">while</span> (<span class="hljs-variable">$row5</span> = mysql_fetch_assoc(<span class="hljs-variable">$query5</span>))
{
    <span class="hljs-variable">$id</span> = <span class="hljs-variable">$row5</span>[<span class="hljs-string">'id'</span>];
    <span class="hljs-variable">$name</span> = <span class="hljs-variable">$row5</span>[<span class="hljs-string">'company_name'</span>];
    <span class="hljs-variable">$number</span> = <span class="hljs-variable">$row5</span>[<span class="hljs-string">'company_number'</span>];

     array_push(<span class="hljs-variable">$test</span>, <span class="hljs-string">'id'</span> =&gt; <span class="hljs-variable">$id</span>, <span class="hljs-string">'name'</span> =&gt; <span class="hljs-variable">$name</span>, <span class="hljs-string">'number'</span> =&gt; <span class="hljs-variable">$number</span>);


}

mysql_close(<span class="hljs-variable">$con</span>);

header(<span class="hljs-string">'Content-type: application/json'</span>);
echo json_encode(<span class="hljs-variable">$test</span>);
exit;

?&gt;
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 10th 2012, 11:39:24 pm">March 10th 2012</span>
								by <span class='authorname'>Kosso</span><br>
								<a class="icon-bg icon-link" href="question/133585/xhr-is-not-starting#answer-232954" rel="permalink">permalink</a>
							</div>

							<h5>3 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Sorry. Swat $response for $test </p>
<p>(Man, I wish we could edit posts here)</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 10th 2012, 11:41:26 pm">March 10th 2012</span>
											by <span class='authorname'>Kosso</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I&#39;m getting an error on this line:</p>
<pre><code class="hljs">array_push(<span class="hljs-variable">$test</span>, <span class="hljs-string">'id'</span> =&gt; <span class="hljs-variable">$id</span>, <span class="hljs-string">'name'</span> =&gt; <span class="hljs-variable">$name</span>, <span class="hljs-string">'number'</span> =&gt; <span class="hljs-variable">$number</span>);
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="March 10th 2012, 11:47:55 pm">March 10th 2012</span>
											by <span class='authorname'>Raul Ochoa</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Kosso is trying to tell you to use $response in place of $test, within your array_push.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 11th 2012, 12:37:50 am">March 11th 2012</span>
											by <span class='authorname'>Darren Adams</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-232957">
				
						<section>
							<p>Well, where it said</p>
<pre><code class="hljs"><span class="hljs-variable">$response</span> = Array();
</code></pre><p>I put:</p>
<pre><code class="hljs"> <span class="hljs-variable">$test</span> = Array();
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="March 11th 2012, 1:34:08 am">March 11th 2012</span>
								by <span class='authorname'>Raul Ochoa</span><br>
								<a class="icon-bg icon-link" href="question/133585/xhr-is-not-starting#answer-232957" rel="permalink">permalink</a>
							</div>

							<h5>3 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>You shouldn&#39;t be providing new answers as responses to our comments. It will confuse people when coming to the thread. Try using double quotes around your keys instead of single quotes.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 11th 2012, 2:20:17 am">March 11th 2012</span>
											by <span class='authorname'>Darren Adams</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>If you have anything to add in response to my comment, comment below.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 11th 2012, 2:20:55 am">March 11th 2012</span>
											by <span class='authorname'>Darren Adams</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I tried using the double quotes and didn&#39;t work either.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 11th 2012, 4:07:41 am">March 11th 2012</span>
											by <span class='authorname'>Raul Ochoa</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
