<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Saving Photo to Logged In User ACS Cloud » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Saving Photo to Logged In User ACS Cloud</h1>
		</header>
		<section>
			<p>I am running into an issue when I am trying to upload a picture from my iphone album and save it to the current logged in user. While I feel like I am saving the image correctly to the cloud, I can&#39;t really seem to debug the issue correctly from my phone. It appears to be using the POST method correctly from my logs, but doesn&#39;t appear to be saving the image at all.</p>
<p>Here is my iPhone log:</p>
<pre><code class="hljs">Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">47</span>:<span class="hljs-number">28</span> TEST-iPhone camera_app[<span class="hljs-number">1949</span>] &lt;Warning&gt;: [DEBUG] Our type was: <span class="hljs-keyword">public</span>.image
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">47</span>:<span class="hljs-number">28</span> TEST-iPhone camera_app[<span class="hljs-number">1949</span>] &lt;Warning&gt;: [INFO] ACS Request: { url: <span class="hljs-string">"photos/create.json"</span>, verb: <span class="hljs-string">"POST"</span>, data: {<span class="hljs-string">"photo"</span>:{}} })
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">47</span>:<span class="hljs-number">28</span> TEST-iPhone camera_app[<span class="hljs-number">1949</span>] &lt;Warning&gt;: [INFO] POST: https:<span class="hljs-comment">//api.cloud.appcelerator.com/v1/photos/create.json?key=ISXt63TM6LfsdadasfsdfsdfsdfsdfsNo1b19vjGdsfsdftIzuKY0htMlx&amp;_session_id=9Dkz2xx_yLtv7KZqsfsdfdsfIgNq8</span>
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">47</span>:<span class="hljs-number">28</span> TEST-iPhone camera_app[<span class="hljs-number">1949</span>] &lt;Warning&gt;: [INFO] header: {}
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">47</span>:<span class="hljs-number">28</span> TEST-iPhone camera_app[<span class="hljs-number">1949</span>] &lt;Warning&gt;: [INFO] data: {<span class="hljs-string">"suppress_response_codes"</span>:<span class="hljs-string">"true"</span>,<span class="hljs-string">"ti_analytics"</span>:<span class="hljs-string">"{\"mid\":\"4298ACC2-521E-42ED-dfsdfsdf-BD1DCEAACBCB\",\"app_version\":\"1.0\",\"platform\":\"ios\",\"sid\":\"D12CC607-916C-4357-A41D-A7D867CF6757\"}"</span>,<span class="hljs-string">"photo"</span>:{}}
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">47</span>:<span class="hljs-number">45</span> TEST-iPhone mstreamd[<span class="hljs-number">1950</span>] &lt;Notice&gt;: (Note ) mstreamd: Not monitoring <span class="hljs-keyword">for</span> external power.
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">47</span>:<span class="hljs-number">45</span> TEST-iPhone mstreamd[<span class="hljs-number">1950</span>] &lt;Notice&gt;: (Note ) PS: Media stream daemon stopping.
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">47</span>:<span class="hljs-number">45</span> TEST-iPhone mstreamd[<span class="hljs-number">1950</span>] &lt;Notice&gt;: (Note ) AS: &lt;MSIOSAlbumSharingDaemon: <span class="hljs-number">0x14fd5f260</span>&gt;: Shared Streams daemon has shut down.
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">47</span>:<span class="hljs-number">45</span> TEST-iPhone mstreamd[<span class="hljs-number">1950</span>] &lt;Notice&gt;: (Warn ) mstreamd: mstreamd shutting down.
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">47</span>:<span class="hljs-number">45</span> TEST-iPhone mstreamd[<span class="hljs-number">1951</span>] &lt;Notice&gt;: (Note ) mstreamd: mstreamd starting up.
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">47</span>:<span class="hljs-number">45</span> TEST-iPhone mstreamd[<span class="hljs-number">1951</span>] &lt;Notice&gt;: (Note ) PS: Media stream daemon starting...
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">48</span>:<span class="hljs-number">14</span> TEST-iPhone backboardd[<span class="hljs-number">31</span>] &lt;Notice&gt;: ALS: SetDisplayFactor: factor=<span class="hljs-number">0.0500</span>
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">48</span>:<span class="hljs-number">15</span> TEST-iPhone backboardd[<span class="hljs-number">31</span>] &lt;Notice&gt;: ALS: SetDisplayFactor: factor=<span class="hljs-number">1.0000</span>
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">48</span>:<span class="hljs-number">25</span> TEST-iPhone mstreamd[<span class="hljs-number">1951</span>] &lt;Notice&gt;: (Note ) mstreamd: Not monitoring <span class="hljs-keyword">for</span> external power.
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">48</span>:<span class="hljs-number">25</span> TEST-iPhone mstreamd[<span class="hljs-number">1951</span>] &lt;Notice&gt;: (Note ) PS: Media stream daemon stopping.
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">48</span>:<span class="hljs-number">25</span> TEST-iPhone mstreamd[<span class="hljs-number">1951</span>] &lt;Notice&gt;: (Note ) AS: &lt;MSIOSAlbumSharingDaemon: <span class="hljs-number">0x14ed3c8e0</span>&gt;: Shared Streams daemon has shut down.
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">48</span>:<span class="hljs-number">25</span> TEST-iPhone mstreamd[<span class="hljs-number">1951</span>] &lt;Notice&gt;: (Warn ) mstreamd: mstreamd shutting down.
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">48</span>:<span class="hljs-number">25</span> TEST-iPhone mstreamd[<span class="hljs-number">1952</span>] &lt;Notice&gt;: (Note ) mstreamd: mstreamd starting up.
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">48</span>:<span class="hljs-number">26</span> TEST-iPhone mstreamd[<span class="hljs-number">1952</span>] &lt;Notice&gt;: (Note ) PS: Media stream daemon starting...
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">48</span>:<span class="hljs-number">44</span> TEST-iPhone locationd[<span class="hljs-number">60</span>] &lt;Warning&gt;: Launch Services: Registering unknown app identifier com.apple.AssistantServices failed
Sep  <span class="hljs-number">2</span> <span class="hljs-number">20</span>:<span class="hljs-number">48</span>:<span class="hljs-number">44</span> TEST-iPhone locationd[<span class="hljs-number">60</span>] &lt;Warning&gt;: Launch Services: Unable to find app identifier com.apple.AssistantServices
</code></pre><p>editProfile.js</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">editProfile</span>(<span class="hljs-params"></span>)</span>{

    <span class="hljs-keyword">var</span> Cloud = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ti.cloud'</span>);

    <span class="hljs-keyword">var</span> editProfile = Ti.UI.createWindow({
         barColor:<span class="hljs-string">'#e67e22'</span>,
         backgroundColor: <span class="hljs-string">'#fff'</span>,
         navTintColor : <span class="hljs-string">'#fff'</span>,
         translucent: <span class="hljs-literal">false</span>
    });

    <span class="hljs-keyword">var</span> userThumbnail =  Ti.UI.createImageView({
        backgroundColor: <span class="hljs-string">'#000'</span>,
        width: <span class="hljs-number">100</span>,
        height: <span class="hljs-number">100</span>,
        top:<span class="hljs-number">20</span>,
        left:<span class="hljs-number">20</span>
    });

    editProfile.add(userThumbnail);

    <span class="hljs-keyword">var</span> changeProfilePicture = Ti.UI.createButton({
        title: <span class="hljs-string">'Change Profile Picture'</span>,
        backgroundColor: <span class="hljs-string">'#000'</span>,
        width: <span class="hljs-number">200</span>,
        height: <span class="hljs-number">75</span>,
        top:<span class="hljs-number">20</span>,
        left: <span class="hljs-number">130</span>
    });

    editProfile.add(changeProfilePicture);

    changeProfilePicture.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

        Titanium.Media.openPhotoGallery({
            success:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                <span class="hljs-comment">// called when media returned from the camera</span>
                Ti.API.debug(<span class="hljs-string">'Our type was: '</span>+event.mediaType);
                    <span class="hljs-keyword">if</span>(event.mediaType == Ti.Media.MEDIA_TYPE_PHOTO) {

                    userThumbnail.setImage(event.media);

                    Cloud.Photos.create({
                        photo: event.media
                        }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                            <span class="hljs-keyword">if</span> (e.success) {
                                <span class="hljs-keyword">var</span> photo = e.photos[<span class="hljs-number">0</span>];
                                Ti.App.Properties.getString(<span class="hljs-string">'username'</span>);
                                alert(<span class="hljs-string">'Success'</span> + <span class="hljs-string">'id:'</span> + photo.id + <span class="hljs-string">'filename:'</span> + photo.filename + <span class="hljs-string">'username:'</span> + username);
                            }
                    });

                    }     <span class="hljs-keyword">else</span> {
                    alert(<span class="hljs-string">"got the wrong type back ="</span>+event.mediaType);
                    }
            },

            cancel:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-comment">// called when user cancels taking a picture</span>
            },

            error:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
                <span class="hljs-comment">// called when there's an error</span>
                <span class="hljs-keyword">var</span> a = Titanium.UI.createAlertDialog({title:<span class="hljs-string">'Camera'</span>});
                <span class="hljs-keyword">if</span> (error.code == Titanium.Media.NO_CAMERA) {
                    a.setMessage(<span class="hljs-string">'Please run this test on device'</span>);
                } <span class="hljs-keyword">else</span> {
                    a.setMessage(<span class="hljs-string">'Unexpected error: '</span> + error.code);
                }
                a.show();
            },

            saveToPhotoGallery:<span class="hljs-literal">true</span>,
            allowEditing:<span class="hljs-literal">true</span>,
            mediaTypes:[Ti.Media.MEDIA_TYPE_VIDEO,Ti.Media.MEDIA_TYPE_PHOTO]

        }); <span class="hljs-comment">//END Open photo gallery function</span>

    }); <span class="hljs-comment">//END Change profile picture event listenet</span>

    <span class="hljs-keyword">return</span> editProfile;    
}

<span class="hljs-built_in">module</span>.exports = editProfile;
</code></pre><p>login.js (Where I&#39;m setting the &#39;Ti.App.Properties.getString(&#39;username&#39;);`):</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">login</span>(<span class="hljs-params"></span>)</span>{

<span class="hljs-keyword">var</span> Cloud = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ti.cloud'</span>);


<span class="hljs-keyword">var</span> createUserWin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'createUser'</span>);
<span class="hljs-keyword">var</span> pictureFeedWin = <span class="hljs-built_in">require</span>(<span class="hljs-string">'pictureFeed'</span>);
<span class="hljs-keyword">var</span> ApplicationTabGroup = <span class="hljs-built_in">require</span>(<span class="hljs-string">'tabGroup'</span>);

<span class="hljs-keyword">var</span> loginWindow = Ti.UI.createWindow({
    backgroundColor: <span class="hljs-string">'#e67e22'</span>,
    modal: <span class="hljs-literal">false</span>
});



<span class="hljs-keyword">var</span> usernameView = Ti.UI.createView({
    top:<span class="hljs-number">180</span>,
    width: <span class="hljs-number">235</span>,
    height: <span class="hljs-number">35</span>,
});

loginWindow.add(usernameView);



<span class="hljs-keyword">var</span> usernameTextField = Ti.UI.createTextField({
     HintText: <span class="hljs-string">'Username'</span>,
     borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
     width: <span class="hljs-number">235</span>,
     height: <span class="hljs-number">35</span>
});

usernameView.add(usernameTextField);


<span class="hljs-keyword">var</span> passwordView = Ti.UI.createView({
    top:<span class="hljs-number">250</span>,
    width: <span class="hljs-number">235</span>,
    height: <span class="hljs-number">35</span>,
});

loginWindow.add(passwordView);


<span class="hljs-keyword">var</span> passwordTextField = Ti.UI.createTextField({
     hintText: <span class="hljs-string">'Password'</span>,
     borderStyle: Ti.UI.INPUT_BORDERSTYLE_ROUNDED,
     width: <span class="hljs-number">235</span>,
     height: <span class="hljs-number">35</span>
});

passwordView.add(passwordTextField);


<span class="hljs-keyword">var</span> loginButton = Ti.UI.createButton({
    title: <span class="hljs-string">'Submit'</span>,
    backgroundColor: <span class="hljs-string">'#d35400'</span>,
    color: <span class="hljs-string">'#fff'</span>,
    width: <span class="hljs-number">250</span>,
    height: <span class="hljs-number">50</span>,
    bottom: <span class="hljs-number">100</span>
});

loginWindow.add(loginButton);


loginButton.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

    Cloud.Users.login({
    login: usernameTextField.value,
    password: passwordTextField.value
}, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) </span>{
    <span class="hljs-keyword">if</span> (e.success) {
        <span class="hljs-keyword">var</span> user = e.users[<span class="hljs-number">0</span>];
        alert(<span class="hljs-string">'Success:\n'</span> +
            <span class="hljs-string">'id: '</span> + user.id + <span class="hljs-string">'\n'</span> +
            <span class="hljs-string">'sessionId: '</span> + Cloud.sessionId + <span class="hljs-string">'\n'</span> +
            <span class="hljs-string">'first name: '</span> + user.first_name + <span class="hljs-string">'\n'</span> +
            <span class="hljs-string">'last name: '</span> + user.last_name);
            Ti.App.Properties.setString(<span class="hljs-string">'currentUser_id'</span>, user.id);
            Ti.App.Properties.setString(<span class="hljs-string">'session_id'</span>, Cloud.sessionId);
            Ti.App.Properties.setString(<span class="hljs-string">'username'</span>, user.username);

            Ti.API.info(user.id);
            Ti.API.info(user.username);
            Ti.API.info(Cloud.sessionId);

            <span class="hljs-keyword">var</span> theTabGroup = <span class="hljs-keyword">new</span> ApplicationTabGroup();
            theTabGroup.open();
            loginWindow.close();
    } <span class="hljs-keyword">else</span> {
        alert(<span class="hljs-string">'Error:\n'</span> +
            ((e.error &amp;&amp; e.message) || <span class="hljs-built_in">JSON</span>.stringify(e)));
    }
});

});

<span class="hljs-keyword">var</span> createUserButton = Ti.UI.createButton({
    title: <span class="hljs-string">'Create a new account'</span>,
    color: <span class="hljs-string">'#fff'</span>,
    bottom: <span class="hljs-number">60</span>
});

loginWindow.add(createUserButton);

createUserButton.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> createUser = <span class="hljs-keyword">new</span> createUserWin();
    Ti.API.info(<span class="hljs-string">'This Worked'</span>);
    createUser.open({modal:<span class="hljs-literal">false</span>});

});


<span class="hljs-keyword">return</span> loginWindow;

}

<span class="hljs-built_in">module</span>.exports = login;
</code></pre>
		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="September 2nd 2014, 11:01:44 pm">September 2nd 2014</span>
				by <span class='authorname'>Connor Phillips</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>acs</span></li>
					
						<li><span class='tagname'>cloud</span></li>
					
						<li><span class='tagname'>debug</span></li>
					
						<li><span class='tagname'>image</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-282117">
				
						<section>
							<p>I use Cloud.Users.update when I need to update the photo for a user.</p>
<pre><code class="hljs">    Cloud.Users.<span class="hljs-keyword">update</span>({
        id : userid,
        photo : photoObj
    }, function(<span class="hljs-keyword">e</span>) {
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">e</span>.success) {
            onSuccess(<span class="hljs-keyword">e</span>);
        } <span class="hljs-keyword">else</span> {
            onError(<span class="hljs-keyword">e</span>);
        }
    });
</code></pre><p>Where userid is the ACSID of the user and photoObj is the path to the photo object. You can get that from <code>Titanium.Filesystem.getFile(ft.nativePath)</code> where ft is the file object.</p>
<p>Ray</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="September 3rd 2014, 11:35:45 am">September 3rd 2014</span>
								by <span class='authorname'>Ray Belisle</span><br>
								<a class="icon-bg icon-link" href="question/177422/saving-photo-to-logged-in-user-acs-cloud#answer-282117" rel="permalink">permalink</a>
							</div>

							<h5>10 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hey Ray,</p>
<p>Thank you for your answer. This worked, but it took about a minute and a half to finally finish updating. Is there a reason why there would be such a long delay?</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 8th 2014, 11:19:48 pm">September 8th 2014</span>
											by <span class='authorname'>Connor Phillips</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>You should check and see what size your photo to upload is. Wondering if the &#39;delay&#39; is the upload…</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 8th 2014, 11:26:34 pm">September 8th 2014</span>
											by <span class='authorname'>Ray Belisle</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hey Ray,</p>
<p>I checked and it says the file size was, 6121831, but i&#39;m not sure what measurement that would be in.I set up my Cloud.Users.Update to save the file format from the photo album. Is there maybe a way I can select the size to upload to reduce this issue?</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 9th 2014, 10:33:23 pm">September 9th 2014</span>
											by <span class='authorname'>Connor Phillips</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Connor, that is bytes, so you are uploading 6mb photos. That is likely taking most of your time. You can reduce it to a smaller image size, depending on if you are using iOS or android. Let me know which platform you are using and I can give you some code to reduce the image size before you upload.</p>
<p>Ray</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 9th 2014, 10:53:34 pm">September 9th 2014</span>
											by <span class='authorname'>Ray Belisle</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Ray,</p>
<p>I&#39;m using iOS and thanks! Definitely way too big to be uploading.</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 9th 2014, 11:45:51 pm">September 9th 2014</span>
											by <span class='authorname'>Connor Phillips</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Ok, there is a module for Titanium called ImageFactory you can find <a href="https:&#x2F;&#x2F;github.com&#x2F;appcelerator-modules&#x2F;ti.imagefactory&#x2F;tree&#x2F;stable&#x2F;ios">here</a>. You can download the module in the zip file, then expand the module and place in the modules&#x2F;iphone&#x2F; directory in your project. Once you have copied it there, add it to your tiapp.xml file.</p>
<p>Now you are ready to call it. I have a function I use as follows:</p>
<pre><code class="hljs"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resizeImage</span>(<span class="hljs-params">blob, filename</span>) </span>{
    <span class="hljs-comment">//pass the blob for the image as the first parameter and the filename to save to as the second parameter.</span>
        <span class="hljs-keyword">var</span> ImageFactory = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ti.imagefactory'</span>);
        <span class="hljs-keyword">var</span> newBlob = ImageFactory.compress(blob, <span class="hljs-number">0.7</span>); <span class="hljs-comment">//compress to 70%, play with this to see what works for you.</span>
        <span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory, filename);
        f.write(newBlob);
        <span class="hljs-keyword">return</span> f.nativePath;
<span class="hljs-comment">//function returns the path to the file. You can upload this compressed file.</span>
}
</code></pre><p>Let me know if you have any questions.</p>
<p>Ray</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 10th 2014, 12:28:26 am">September 10th 2014</span>
											by <span class='authorname'>Ray Belisle</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hey Ray,</p>
<p>I appreciate the help so far. I&#39;m just having trouble trying to figure out how to compress the image that was selected from the photo album, specifically the <code>events.media</code>. I wrapped the ACS update method in the function you laid out above, but I don&#39;t believe i&#39;m converting the image.</p>
<pre><code class="hljs">changeProfilePicture.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

        Titanium.Media.openPhotoGallery({
            success:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                <span class="hljs-comment">// called when media returned from the camera</span>
                Ti.API.debug(<span class="hljs-string">'Our type was: '</span>+event.mediaType);
                    <span class="hljs-keyword">if</span>(event.mediaType == Ti.Media.MEDIA_TYPE_PHOTO) {

                        user_id = Ti.App.Properties.getString(<span class="hljs-string">'currentUser_id'</span>)    ;

                        userThumbnail.setImage(event.media);

                        <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">resizeImage</span>(<span class="hljs-params">blob, filename</span>) </span>{
                                <span class="hljs-keyword">var</span> ImageFactory = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ti.imagefactory'</span>);
                                <span class="hljs-keyword">var</span> newBlob = ImageFactory.compress(blob, <span class="hljs-number">0.7</span>);

                                <span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory, filename);
                                    f.write(newBlob);
                                    <span class="hljs-keyword">return</span> f.nativePath;


                        Cloud.Users.update({
                            id: user_id,
                            photo: newBlob
                        }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                            <span class="hljs-keyword">if</span> (e.success) {
                                alert(<span class="hljs-string">'This Worked'</span>);
                            } <span class="hljs-keyword">else</span> {
                                alert(<span class="hljs-string">'Error'</span>);
                            }
                        });

                        }

                    }     <span class="hljs-keyword">else</span> {

                        alert(<span class="hljs-string">"got the wrong type back ="</span>+event.mediaType);

                    }
            },

            cancel:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-comment">// called when user cancels taking a picture</span>
            },

            error:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
                <span class="hljs-comment">// called when there's an error</span>
                <span class="hljs-keyword">var</span> a = Titanium.UI.createAlertDialog({title:<span class="hljs-string">'Camera'</span>});
                <span class="hljs-keyword">if</span> (error.code == Titanium.Media.NO_CAMERA) {
                    a.setMessage(<span class="hljs-string">'Please run this test on device'</span>);
                } <span class="hljs-keyword">else</span> {
                    a.setMessage(<span class="hljs-string">'Unexpected error: '</span> + error.code);
                }
                a.show();
            },

            saveToPhotoGallery:<span class="hljs-literal">true</span>,
            allowEditing:<span class="hljs-literal">true</span>,
            mediaTypes:[Ti.Media.MEDIA_TYPE_VIDEO,Ti.Media.MEDIA_TYPE_PHOTO]

        }); <span class="hljs-comment">//END Open photo gallery function</span>

    }); <span class="hljs-comment">//END Change profile picture event listenet</span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="September 11th 2014, 9:27:58 pm">September 11th 2014</span>
											by <span class='authorname'>Connor Phillips</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Connor, since you are not calling the function outside of your button click eventlistener, but using it inline, then you want something like this. I have changed the code and added some comments so you can follow along. Let me know how this works. BTW, make sure you have added the ImageFactory module to your project or you will get an error when you try and run the compress() function!</p>
<pre><code class="hljs">changeProfilePicture.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{

    Titanium.Media.openPhotoGallery({
        success : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
            <span class="hljs-comment">// called when media returned from the camera</span>
            Ti.API.debug(<span class="hljs-string">'Our type was: '</span> + event.mediaType);
            <span class="hljs-keyword">if</span> (event.mediaType == Ti.Media.MEDIA_TYPE_PHOTO) {

                user_id = Ti.App.Properties.getString(<span class="hljs-string">'currentUser_id'</span>);

                userThumbnail.setImage(event.media);

                <span class="hljs-keyword">var</span> ImageFactory = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ti.imagefactory'</span>);
                <span class="hljs-keyword">var</span> newBlob = ImageFactory.compress(event.media, <span class="hljs-number">0.7</span>); <span class="hljs-comment">//so we send an object of type BLOB, which is event.media</span>

                <span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory, <span class="hljs-string">'compressedImage.jpg'</span>);
                f.write(newBlob); <span class="hljs-comment">//this writes the compressed image to a new file on the filesystem</span>


                Cloud.Users.update({
                    id : user_id,
                    photo : f.nativePath <span class="hljs-comment">//we pass the full path to the compressed file</span>
                }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                    <span class="hljs-keyword">if</span> (e.success) {
                        alert(<span class="hljs-string">'This Worked'</span>);
                    } <span class="hljs-keyword">else</span> {
                        alert(<span class="hljs-string">'Error'</span>);
                    }
                });

            } <span class="hljs-keyword">else</span> {

                alert(<span class="hljs-string">"got the wrong type back ="</span> + event.mediaType);

            }
        },

        cancel : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
            <span class="hljs-comment">// called when user cancels taking a picture</span>
        },

        error : <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
            <span class="hljs-comment">// called when there's an error</span>
            <span class="hljs-keyword">var</span> a = Titanium.UI.createAlertDialog({
                title : <span class="hljs-string">'Camera'</span>
            });
            <span class="hljs-keyword">if</span> (error.code == Titanium.Media.NO_CAMERA) {
                a.setMessage(<span class="hljs-string">'Please run this test on device'</span>);
            } <span class="hljs-keyword">else</span> {
                a.setMessage(<span class="hljs-string">'Unexpected error: '</span> + error.code);
            }
            a.show();
        },

        saveToPhotoGallery : <span class="hljs-literal">true</span>,
        allowEditing : <span class="hljs-literal">true</span>,
        mediaTypes : [Ti.Media.MEDIA_TYPE_VIDEO, Ti.Media.MEDIA_TYPE_PHOTO]

    });
    <span class="hljs-comment">//END Open photo gallery function</span>

});
<span class="hljs-comment">//END Change profile picture event listener</span>
</code></pre><p>Ray</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 11th 2014, 11:54:13 pm">September 11th 2014</span>
											by <span class='authorname'>Ray Belisle</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hey Ray,</p>
<p>I&#39;m actually getting an error message after making your changes and it looks like it is coming from the <code>&amp;#39;compressedImage.jpg&amp;#39;</code> file. </p>
<pre><code class="hljs">Sep <span class="hljs-number">19</span> <span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">59</span> xxx-xxx-iPhone camera_app<span class="hljs-string">[282]</span> &lt;Warning&gt;: <span class="hljs-string">[DEBUG]</span> Our type was: public.image
Sep <span class="hljs-number">19</span> <span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">59</span> xxx-xxxx-iPhone camera_app<span class="hljs-string">[282]</span> &lt;Warning&gt;: <span class="hljs-string">[INFO]</span> ACS Request: { url: <span class="hljs-string">"users/update.json"</span>, verb: <span class="hljs-string">"<span class="hljs-keyword">PUT</span>"</span>, data: {<span class="hljs-string">"id"</span>:<span class="hljs-string">"530006232341356b40b4b16c241"</span>,<span class="hljs-string">"photo"</span>:<span class="hljs-string">"file:///var/mobile/Applications/A6557E1E-6EE2-4A41-999A-E192232344A824/Documents/compressedImage.jpg"</span>} })
Sep <span class="hljs-number">19</span> <span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">59</span> xxx-xxx-iPhone camera_app<span class="hljs-string">[282]</span> &lt;Warning&gt;: <span class="hljs-string">[INFO]</span> PUT: https://api.cloud.appcelerator.com/v1/users/update.json?key=ISXt63TM6LrNo1b19vjGtIzuKY0htMlx&amp;_session_id=JAqDyNn9ErW8oCn-zh6ba9kCMUA
Sep <span class="hljs-number">19</span> <span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">59</span> xxx-xxx-iPhone camera_app<span class="hljs-string">[282]</span> &lt;Warning&gt;: <span class="hljs-string">[INFO]</span> header: {}
Sep <span class="hljs-number">19</span> <span class="hljs-number">11</span>:<span class="hljs-number">49</span>:<span class="hljs-number">59</span> xxx-xxx-iPhone camera_app<span class="hljs-string">[282]</span> &lt;Warning&gt;: <span class="hljs-string">[INFO]</span> data: {<span class="hljs-string">"id"</span>:<span class="hljs-string">"530006cd1356b40b4b16c241"</span>,<span class="hljs-string">"suppress_response_codes"</span>:<span class="hljs-string">"true"</span>,<span class="hljs-string">"ti_analytics"</span>:<span class="hljs-string">"{\"</span>mid\<span class="hljs-string">":\"</span>4298ACC2-521E-42ED-B146-BD1DCfdsfsfCBCB\<span class="hljs-string">",\"</span>app_version\<span class="hljs-string">":\"</span><span class="hljs-number">1</span>.<span class="hljs-number">0</span>\<span class="hljs-string">",\"</span>platform\<span class="hljs-string">":\"</span>ios\<span class="hljs-string">",\"</span>sid\<span class="hljs-string">":\"</span>0F2B82A2-A2C2-47EA-B24F-E4C8D7Efsdfsd855\<span class="hljs-string">"}"</span>,<span class="hljs-string">"photo"</span>:<span class="hljs-string">"file:///var/mobile/Applications/A6557E1E-6EE2-4A41-999A-E1929544A824/Documents/compressedImage.jpg"</span>}
Sep <span class="hljs-number">19</span> <span class="hljs-number">11</span>:<span class="hljs-number">50</span>:<span class="hljs-number">00</span> xxx-xxx-iPhone camera_app<span class="hljs-string">[282]</span> &lt;Warning&gt;: <span class="hljs-string">[ERROR]</span> <span class="hljs-number">400</span>: Failed to upload photo: undefined method `destroy' for nil:NilClass
</code></pre><p>My revised code:</p>
<pre><code class="hljs">changeProfilePicture.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)</span>{

        Titanium.Media.openPhotoGallery({
            success:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">event</span>) </span>{
                <span class="hljs-comment">// called when media returned from the camera</span>
                Ti.API.debug(<span class="hljs-string">'Our type was: '</span>+event.mediaType);
                    <span class="hljs-keyword">if</span>(event.mediaType == Ti.Media.MEDIA_TYPE_PHOTO) {

                        user_id = Ti.App.Properties.getString(<span class="hljs-string">'currentUser_id'</span>)    ;

                        userThumbnail.setImage(event.media);

                                <span class="hljs-keyword">var</span> ImageFactory = <span class="hljs-built_in">require</span>(<span class="hljs-string">'ti.imagefactory'</span>);
                                <span class="hljs-keyword">var</span> newBlob = ImageFactory.compress(event.media, <span class="hljs-number">0.7</span>);

                                <span class="hljs-keyword">var</span> f = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory, <span class="hljs-string">'compressedImage.jpg'</span>);
                                    f.write(newBlob);                            

                        Cloud.Users.update({
                            id: user_id,
                            photo: f.nativePath
                        }, <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">e</span>) </span>{
                            <span class="hljs-keyword">if</span> (e.success) {
                                alert(<span class="hljs-string">'This Worked'</span>);
                            } <span class="hljs-keyword">else</span> {
                                alert(<span class="hljs-string">'Error'</span>);
                            }
                        });

                    }     <span class="hljs-keyword">else</span> {

                        alert(<span class="hljs-string">"got the wrong type back ="</span>+event.mediaType);

                    }
            },

            cancel:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
                <span class="hljs-comment">// called when user cancels taking a picture</span>
            },

            error:<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">error</span>) </span>{
                <span class="hljs-comment">// called when there's an error</span>
                <span class="hljs-keyword">var</span> a = Titanium.UI.createAlertDialog({title:<span class="hljs-string">'Camera'</span>});
                <span class="hljs-keyword">if</span> (error.code == Titanium.Media.NO_CAMERA) {
                    a.setMessage(<span class="hljs-string">'Please run this test on device'</span>);
                } <span class="hljs-keyword">else</span> {
                    a.setMessage(<span class="hljs-string">'Unexpected error: '</span> + error.code);
                }
                a.show();
            },

            saveToPhotoGallery:<span class="hljs-literal">true</span>,
            allowEditing:<span class="hljs-literal">true</span>,
            mediaTypes:[Ti.Media.MEDIA_TYPE_VIDEO,Ti.Media.MEDIA_TYPE_PHOTO]

        }); <span class="hljs-comment">//END Open photo gallery function</span>

    }); <span class="hljs-comment">//END Change profile picture event listenet</span>
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="September 19th 2014, 1:55:02 pm">September 19th 2014</span>
											by <span class='authorname'>Connor Phillips</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I think I have seen this before. If I&#39;m right, there is an issue with your user. I <em>believe</em> that the problem is something like this:</p>
<ul>
<li>You created a user, let&#39;s call him user1</li>
<li>You added a photo to user1, this adds a photo to the photo ACS objects and creates a link to your user.</li>
<li>The photo object was deleted, but from the photo ACS interface, not the user ACS interface.</li>
<li>Now you are trying to replace a photo, but ACS cannot delete the existing photo object because it does not exist.</li>
</ul>
<p>As I said, I&#39;m not sure, but I do remember something like what I described. In the end it was something with the state of the user and his photo link, not the code. I don&#39;t think it&#39;s your code. To troubleshoot, do the following. Create a new user and try your code. Should work. If it does, then go into ACS and try and determine the difference in state between the user that works and the one that doesn&#39;t. If using a new user still fails, then I&#39;m wrong…  :)</p>
<p>Ray</p>
</p>
										<div class="author">
											&mdash; commented <span title="September 19th 2014, 2:09:50 pm">September 19th 2014</span>
											by <span class='authorname'>Ray Belisle</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
