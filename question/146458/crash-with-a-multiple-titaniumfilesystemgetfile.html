<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Crash with a multiple Titanium.Filesystem.getFile Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Crash with a multiple Titanium.Filesystem.getFile</h1>
		</header>
		<section>
			<p>I have a problem with save a lot file, the code is:</p>
<pre><code class="hljs">
<span class="hljs-label">for</span> (i = <span class="hljs-number">0</span><span class="hljs-comment">; i &lt; 1000; i++) {</span>

        <span class="hljs-comment">/* do something */</span>

        var <span class="hljs-keyword">blobImage </span>= Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory, <span class="hljs-string">"foo.jpg"</span>)<span class="hljs-comment">;</span>
    }
</code></pre><p>at the 507th interaction the application crashes.<br>This is the log of device:</p>
<pre><code class="hljs">
<span class="hljs-keyword">E</span>/dalvikvm( <span class="hljs-number">4933</span>): JNI ERROR (app bug): local reference table overflow (max=<span class="hljs-number">512</span>)
W/dalvikvm( <span class="hljs-number">4933</span>): JNI local reference table (<span class="hljs-number">0x6309dd68</span>) dump:
W/dalvikvm( <span class="hljs-number">4933</span>):   <span class="hljs-keyword">Last</span> <span class="hljs-number">10</span> entries (of <span class="hljs-number">512</span>):
W/dalvikvm( <span class="hljs-number">4933</span>):       <span class="hljs-number">511</span>: <span class="hljs-number">0x40d4b0a0</span> libcore.io.Posix
W/dalvikvm( <span class="hljs-number">4933</span>):       <span class="hljs-number">510</span>: <span class="hljs-number">0x41c466c8</span> java.lang.Object[] (<span class="hljs-number">2</span> elements)
W/dalvikvm( <span class="hljs-number">4933</span>):       <span class="hljs-number">509</span>: <span class="hljs-number">0x41c466b8</span> org.appcelerator.kroll.KrollInvocation
W/dalvikvm( <span class="hljs-number">4933</span>):       <span class="hljs-number">508</span>: <span class="hljs-number">0x41c46668</span> java.lang.<span class="hljs-keyword">String</span> <span class="hljs-string">"app://db.js"</span>
W/dalvikvm( <span class="hljs-number">4933</span>):       <span class="hljs-number">507</span>: <span class="hljs-number">0x41c442f8</span> java.lang.<span class="hljs-keyword">String</span> <span class="hljs-string">"app://db.js"</span>
W/dalvikvm( <span class="hljs-number">4933</span>):       <span class="hljs-number">506</span>: <span class="hljs-number">0x41c41f20</span> java.lang.<span class="hljs-keyword">String</span> <span class="hljs-string">"app://db.js"</span>
W/dalvikvm( <span class="hljs-number">4933</span>):       <span class="hljs-number">505</span>: <span class="hljs-number">0x41c3f6b0</span> java.lang.<span class="hljs-keyword">String</span> <span class="hljs-string">"app://db.js"</span>
W/dalvikvm( <span class="hljs-number">4933</span>):       <span class="hljs-number">504</span>: <span class="hljs-number">0x41c3d810</span> java.lang.<span class="hljs-keyword">String</span> <span class="hljs-string">"app://db.js"</span>
W/dalvikvm( <span class="hljs-number">4933</span>):       <span class="hljs-number">503</span>: <span class="hljs-number">0x41c3b620</span> java.lang.<span class="hljs-keyword">String</span> <span class="hljs-string">"app://db.js"</span>
W/dalvikvm( <span class="hljs-number">4933</span>):       <span class="hljs-number">502</span>: <span class="hljs-number">0x41c39798</span> java.lang.<span class="hljs-keyword">String</span> <span class="hljs-string">"app://db.js"</span>
W/dalvikvm( <span class="hljs-number">4933</span>):   Summary:
W/dalvikvm( <span class="hljs-number">4933</span>):         <span class="hljs-number">1</span> of java.lang.Object[] (<span class="hljs-number">1</span> elements)
W/dalvikvm( <span class="hljs-number">4933</span>):         <span class="hljs-number">1</span> of java.lang.Object[] (<span class="hljs-number">2</span> elements)
W/dalvikvm( <span class="hljs-number">4933</span>):       <span class="hljs-number">507</span> of java.lang.<span class="hljs-keyword">String</span> (<span class="hljs-number">507</span> unique instances)
W/dalvikvm( <span class="hljs-number">4933</span>):         <span class="hljs-number">1</span> of libcore.io.Posix
W/dalvikvm( <span class="hljs-number">4933</span>):         <span class="hljs-number">1</span> of org.appcelerator.kroll.KrollInvocation
W/dalvikvm( <span class="hljs-number">4933</span>):         <span class="hljs-number">1</span> of org.appcelerator.kroll.runtime.v8.V8Function
<span class="hljs-keyword">E</span>/dalvikvm( <span class="hljs-number">4933</span>): Failed adding to JNI local ref table (has <span class="hljs-number">512</span> entries)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>): <span class="hljs-string">"KrollRuntimeThread"</span> prio=<span class="hljs-number">5</span> tid=<span class="hljs-number">10</span> RUNNABLE
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   | group=<span class="hljs-string">"main"</span> sCount=<span class="hljs-number">0</span> dsCount=<span class="hljs-number">0</span> obj=<span class="hljs-number">0x415119a8</span> self=<span class="hljs-number">0x63baf9f8</span>
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   | sysTid=<span class="hljs-number">4947</span> nice=<span class="hljs-number">0</span> sched=<span class="hljs-number">0</span>/<span class="hljs-number">0</span> cgrp=apps handle=<span class="hljs-number">1677001376</span>
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   | state=R schedstat=( <span class="hljs-number">3494088000</span> <span class="hljs-number">565448000</span> <span class="hljs-number">7002</span> ) utm=<span class="hljs-number">236</span> stm=<span class="hljs-number">113</span> core=<span class="hljs-number">0</span>
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at libcore.io.Posix.access(Native <span class="hljs-keyword">Method</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at libcore.io.ForwardingOs.access(ForwardingOs.java:<span class="hljs-number">39</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at java.io.<span class="hljs-keyword">File</span>.doAccess(<span class="hljs-keyword">File</span>.java:<span class="hljs-number">283</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at java.io.<span class="hljs-keyword">File</span>.exists(<span class="hljs-keyword">File</span>.java:<span class="hljs-number">363</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at android.app.ContextImpl.getDir(ContextImpl.java:<span class="hljs-number">1817</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at android.content.ContextWrapper.getDir(ContextWrapper.java:<span class="hljs-number">218</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at org.appcelerator.titanium.util.TiFileHelper.getDataDirectory(TiFileHelper.java:<span class="hljs-number">606</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at org.appcelerator.titanium.io.TiFileFactory.getDataDirectory(TiFileFactory.java:<span class="hljs-number">142</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at org.appcelerator.titanium.io.TiFileFactory.createTitaniumFile(TiFileFactory.java:<span class="hljs-number">79</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at org.appcelerator.titanium.util.TiUrl.resolve(TiUrl.java:<span class="hljs-number">234</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at org.appcelerator.kroll.KrollProxy.resolveUrl(KrollProxy.java:<span class="hljs-number">977</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at org.appcelerator.titanium.TiFileProxy.&lt;init&gt;(TiFileProxy.java:<span class="hljs-number">77</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at ti.modules.titanium.filesystem.FileProxy.&lt;init&gt;(FileProxy.java:<span class="hljs-number">20</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at ti.modules.titanium.filesystem.FilesystemModule.getFile(FilesystemModule.java:<span class="hljs-number">81</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at org.appcelerator.kroll.runtime.v8.V8Function.nativeInvoke(Native <span class="hljs-keyword">Method</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at org.appcelerator.kroll.runtime.v8.V8Function.callSync(V8Function.java:<span class="hljs-number">58</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at org.appcelerator.kroll.runtime.v8.V8Function.call(V8Function.java:<span class="hljs-number">44</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at org.appcelerator.kroll.runtime.v8.V8Function$<span class="hljs-number">1.</span>run(V8Function.java:<span class="hljs-number">71</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at android.os.Handler.handleCallback(Handler.java:<span class="hljs-number">725</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at android.os.Handler.dispatchMessage(Handler.java:<span class="hljs-number">92</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at android.os.Looper.loop(Looper.java:<span class="hljs-number">137</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>):   at org.appcelerator.kroll.KrollRuntime$KrollRuntimeThread.run(KrollRuntime.java:<span class="hljs-number">109</span>)
<span class="hljs-keyword">I</span>/dalvikvm( <span class="hljs-number">4933</span>): 
<span class="hljs-keyword">E</span>/dalvikvm( <span class="hljs-number">4933</span>): VM aborting
F/libc    ( <span class="hljs-number">4933</span>): Fatal signal <span class="hljs-number">11</span> (SIGSEGV) at <span class="hljs-number">0xdeadd00d</span> (code=<span class="hljs-number">1</span>), thread <span class="hljs-number">4947</span> (KrollRuntimeThr)
</code></pre><p>what could be the problem?</p>
<p>Best Regards</p>
<p>Roberto Sitzia - LibertyLine s.r.l.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="January 4th 2013, 1:27:21 pm">January 4th 2013</span>
				by <span class='authorname'>Roberto Sitzia</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>crash</span></li>
					
						<li><span class='tagname'>filesystem</span></li>
					
						<li><span class='tagname'>getfile</span></li>
					
						<li><span class='tagname'>write file</span></li>
					
				</ul>
			

			<section>
				<h5>1 Comment</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p><code>what could be the problem?</code></p>
<p>Poor application design.</p>
</div>
							<div class="author">
								&mdash; commented <span title="January 4th 2013, 1:34:14 pm">January 4th 2013</span>
								by <span class='authorname'>Stephen Feather</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>-1</span> Votes</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-253850">
				
						<section>
							<p>Is there a reason that you are trying to blob out the exact same image 1000 times? The error message tells you what the issue is. You are overflowing the local reference table. Every time you cross the bridge to get the file, you are creating a local reference on the java side. You are creating more than the allowed number of references.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 4th 2013, 1:37:48 pm">January 4th 2013</span>
								by <span class='authorname'>Anthony Decena</span><br>
								<a class="icon-bg icon-link" href="question/146458/crash-with-a-multiple-titaniumfilesystemgetfile#answer-253850" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-253851">
				
						<section>
							<p>@Anthony Decena, the real code references different images; it&#39;s used to download a set of images from a remote server.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="January 4th 2013, 1:42:39 pm">January 4th 2013</span>
								by <span class='authorname'>Roberto Sitzia</span><br>
								<a class="icon-bg icon-link" href="question/146458/crash-with-a-multiple-titaniumfilesystemgetfile#answer-253851" rel="permalink">permalink</a>
							</div>

							<h5>14 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>please use the comment system when replying to answers, it keeps the thread easier to read.<br>I just ran the code that you provided above and I did not experience a crash. So the crash might be specific to the code you&#39;re actually using.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 4th 2013, 1:52:36 pm">January 4th 2013</span>
											by <span class='authorname'>Anthony Decena</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>This is the real code, this example crashes:</p>
<pre><code class="hljs">exports.importImages = function() {

    <span class="hljs-built_in">var</span> i;    
    <span class="hljs-built_in">var</span> mydb = Ti.Database.open(DATABASE_NAME);

    <span class="hljs-built_in">var</span> actInd = Titanium.UI.createActivityIndicator({
        message: <span class="hljs-string">"Collegamento al server..."</span>,
        location: Titanium.UI.ActivityIndicator.DIALOG,
        <span class="hljs-built_in">type</span>: Titanium.UI.ActivityIndicator.DETERMINANT,
        <span class="hljs-built_in">min</span>: <span class="hljs-number">0</span>,
        <span class="hljs-built_in">value</span> : <span class="hljs-number">0</span>
    });

    actInd.<span class="hljs-built_in">value</span> = <span class="hljs-number">0</span>;
    actInd.<span class="hljs-built_in">max</span> = <span class="hljs-number">1000</span>;        
     actInd.<span class="hljs-built_in">show</span>();

    for (i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">1000</span>; i++) {

        actInd.<span class="hljs-built_in">value</span> = (i/<span class="hljs-number">1000</span>)*<span class="hljs-number">100</span>;
        actInd.message = <span class="hljs-string">"Item "</span> + i + <span class="hljs-string">" of 1000"</span>;

         q = <span class="hljs-string">"INSERT INTO categorie (id_categoria, descrizione) VALUES (1, 'ciao')"</span>             
         mydb.execute(q);


        <span class="hljs-built_in">var</span> blobImage = Titanium.Filesystem.getFile(Titanium.Filesystem.applicationDataDirectory, <span class="hljs-string">"foo.jpg"</span>);
    } 


}
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="January 4th 2013, 2:06:26 pm">January 4th 2013</span>
											by <span class='authorname'>Roberto Sitzia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>It crashes also if I remove the database insert query.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 4th 2013, 2:07:20 pm">January 4th 2013</span>
											by <span class='authorname'>Roberto Sitzia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Ok, you need to post all the information regarding your dev environment. I just ran your code (without the db stuff) and I still did not crash. If you have any questions regarding what info needs to be posted please see the <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;ask">Ask A Question Page</a> for more info.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 4th 2013, 2:32:57 pm">January 4th 2013</span>
											by <span class='authorname'>Anthony Decena</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>This is a small project that reproduces the problem: http:&#x2F;&#x2F;devtests.libertyline.com&#x2F;TestCrash.zip</p>
<p>Please check if it works for you.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 8th 2013, 6:24:51 am">January 8th 2013</span>
											by <span class='authorname'>Roberto Sitzia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Application type: mobile</p>
<p>Titanium SDK:<br>Titanium Studio, build: 3.0.1.201212181159<br>(c) Copyright 2012 by Appcelerator, Inc.  All rights reserved.</p>
<p>Build: jenkins-titanium-rcp-master-350 (origin&#x2F;master)<br>Date: 18 December 2012, 12:04:42</p>
<p>Platform &amp; version: Android 4.2 (nexus 7)<br>Device: NEXUS 7<br>Host Operating System: Windows 7</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 8th 2013, 6:27:30 am">January 8th 2013</span>
											by <span class='authorname'>Roberto Sitzia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>No, it crashes. Please refer to my previous answer.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 8th 2013, 1:26:39 pm">January 8th 2013</span>
											by <span class='authorname'>Anthony Decena</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>What do you mean ? I know that the crash is because I use too many local references.<br>Is there a way to free the file after using it ?</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 8th 2013, 2:15:18 pm">January 8th 2013</span>
											by <span class='authorname'>Roberto Sitzia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>If you&#39;ve got 1000 files you need, then you should probably start thinking about a different way to do this. If they are the same files all the time, then think about zipping them up and unarchiving them on device or something similar. We are bound by the limits of the native system, and when you create too many references on the native platform, it crashes. To be completely honest, once you pass 100 images, you should start thinking of another way to handle the download. </p>
<p>Again, its hard, because you&#39;re code is literally NOT downloading ANY files. All you are doing is creating a filesystem reference. Your code does absolutely nothing. Its like a stress test where you create a bunch of references but don&#39;t actually do anything with it, just leave them in memory. So all you&#39;re really saying is that you&#39;ve found the reference limit on this version of Android, which is 507. Now that you know what JNI will allow you to do .. work with it.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 8th 2013, 2:51:13 pm">January 8th 2013</span>
											by <span class='authorname'>Anthony Decena</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Ok but it&#39;s strange that there is no way to free the reference once it&#39;s used.<br>Is this really impossible?</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 9th 2013, 6:56:15 am">January 9th 2013</span>
											by <span class='authorname'>Roberto Sitzia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I am using an alternative way, download a single zip file and then unzip it.<br>But I can not find any native method to unzip, what can I use?</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 14th 2013, 9:34:15 am">January 14th 2013</span>
											by <span class='authorname'>Roberto Sitzia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>There may be a couple modules in the marketplace that can help out. <a href="https:&#x2F;&#x2F;marketplace.appcelerator.com&#x2F;listing?140214998&amp;q=unzip#!&#x2F;list&#x2F;page&#x2F;1">https:&#x2F;&#x2F;marketplace.appcelerator.com&#x2F;listing?140214998&amp;q=unzip#!&#x2F;list&#x2F;page&#x2F;1</a></p>
</p>
										<div class="author">
											&mdash; commented <span title="January 14th 2013, 3:03:29 pm">January 14th 2013</span>
											by <span class='authorname'>Anthony Decena</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>But 9,99$ per month means that if I do not pay during the following months I will be deactivated the library? or I will not have updates that component?</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 15th 2013, 7:43:16 am">January 15th 2013</span>
											by <span class='authorname'>Roberto Sitzia</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>The payment is just needed during the time you are developing. If you build your app with the module and don&#39;t pay the next month, your app WILL STILL WORK. However, if you need to update your app, you will again have to pay for the module.</p>
</p>
										<div class="author">
											&mdash; commented <span title="January 15th 2013, 2:58:07 pm">January 15th 2013</span>
											by <span class='authorname'>Anthony Decena</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
