<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Can&#39;t get tableview work the same in iOS and Android Â» Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Can&#39;t get tableview work the same in iOS and Android</h1>
		</header>
		<section>
			<p>Hi, in an iPhone project I&#39;ve this code:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> model = [<span class="hljs-string">"A"</span>,<span class="hljs-string">"B"</span>,<span class="hljs-string">"B"</span>,<span class="hljs-string">"B"</span>,<span class="hljs-string">"B"</span>,<span class="hljs-string">"C"</span>,<span class="hljs-string">"C"</span>,<span class="hljs-string">"D"</span>];
<span class="hljs-keyword">var</span> modelLen = model.length;

<span class="hljs-keyword">var</span> tableView = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createTableView({top:<span class="hljs-number">0</span>,<span class="hljs-keyword">left</span>:<span class="hljs-number">0</span>,width:<span class="hljs-number">320</span>});

<span class="hljs-keyword">var</span> temp = <span class="hljs-string">""</span>;

<span class="hljs-keyword">var</span> <span class="hljs-built_in">c</span>=<span class="hljs-number">0</span>;

<span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;modelLen;i++) {

        <span class="hljs-keyword">if</span> (temp != model[i]) {

            <span class="hljs-keyword">var</span> tempView  = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createView({backgroundColor:'#9fb650',height:<span class="hljs-number">30</span>});

            <span class="hljs-keyword">var</span> tempSection = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createTableViewSection({
                headerView: tempView,
                height: <span class="hljs-number">40</span>
            });

            tableView.insertSectionBefore(<span class="hljs-number">0</span>, tempSection);
            temp = model[i];
        }

        <span class="hljs-keyword">var</span> row = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createTableViewRow({
            className : <span class="hljs-string">"item"</span> + <span class="hljs-built_in">c</span>,
            backgroundColor: <span class="hljs-string">"#ffcc00"</span>,
            rowIndex : <span class="hljs-built_in">c</span>,
            height : <span class="hljs-number">30</span>,
            width: 'auto'
        });

        <span class="hljs-keyword">var</span> label = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createLabel({
            text : <span class="hljs-string">"label"</span>+i,
            <span class="hljs-keyword">left</span> : <span class="hljs-number">34</span>,
            top : <span class="hljs-number">1</span>,
            width : <span class="hljs-number">320</span>,
            height : <span class="hljs-number">30</span>
        });
        row.add(label);

        tempSection.add(row);
        <span class="hljs-built_in">c</span>++;
    }

win1.add(tableView);
</code></pre><p>This is quite simple: anytime temp!=model[i] the code creates a new section and then adds rows to the section.</p>
<p>What happens: no problem if I run this code with iPhone. </p>
<p>When I run this code in Android the tableview doesn&#39;t show correctly: the first row under the first section is omitted, while all the others show up correctly.</p>
<p>What&#39;s happening? Why iOS &quot;understands&quot; well what it should do? Is there any logical issue I didn&#39;t notice?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="February 28th 2013, 6:11:12 am">February 28th 2013</span>
				by <span class='authorname'>Kiwi Blas</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>tableview</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box vote-box-answered">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>1</span> Answer</div>
		</aside>
	</div>

	<hr>

	<h3>1 Answer</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article class="accepted-answer" id="answer-257719">
						<header>
							<h2><span class="icon-bg icon-check-1"></span>Accepted Answer</h2>
						</header>
				
						<section>
							<p>Hi</p>
<p>According to this line;</p>
<pre><code class="hljs">tableView.insertSectionBefore(<span class="hljs-number">0</span>, tempSection);
</code></pre><p>You want all new sections to appear above the previous one, is this correct?</p>
<p>If all you are trying to do is add data with sections being created as required when your add element value changes from the last loops value then let me know I can revise your code to work as you want.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 28th 2013, 6:36:30 am">February 28th 2013</span>
								by <span class='authorname'>Malcolm Hollingsworth</span><br>
								<a class="icon-bg icon-link" href="../../question/148931/cant-get-tableview-work-the-same-in-ios-and-android.html#answer-257719" rel="permalink">permalink</a>
							</div>

							<h5>9 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Yes, that line is correct. The sample I posted is a reduced version of something far more complex, involving db query and many other things.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 28th 2013, 6:43:50 am">February 28th 2013</span>
											by <span class='authorname'>Kiwi Blas</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>You have said yes once but there were two questions, so there is no confusion;</p>
<ul>
<li>reversed order of sections?</li>
<li>new section each time the section header changes?</li>
</ul>
</p>
										<div class="author">
											&mdash; commented <span title="February 28th 2013, 6:52:00 am">February 28th 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Reversed order of sections: YES.</p>
<p>New section each time temp!=model[i]: YES.   :-)</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 28th 2013, 6:58:16 am">February 28th 2013</span>
											by <span class='authorname'>Kiwi Blas</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>As a side note, I must say this doesn&#39;t work at all (that is: using insertSectionAfter). I get a totally white screen with no tableview at all (while it behaves perfectly on iOS):</p>
<pre><code class="hljs">var s=<span class="hljs-number">0</span>;

<span class="hljs-keyword">for</span>(var i=<span class="hljs-number">0</span>;i&lt;modelLen;i++) {
        <span class="hljs-comment">//</span>

        <span class="hljs-keyword">if</span> (temp != model[i]) {

            var tempView  = Ti.UI.createView({
               backgroundColor:<span class="hljs-string">'#9fb650'</span>,
               <span class="hljs-variable">height</span>:<span class="hljs-number">30</span>
            });

            var tempSection = Ti.UI.createTableViewSection({
                headerView: tempView,
                <span class="hljs-variable">height</span>: <span class="hljs-number">40</span>
            });

            tableView.insertSectionAfter(s, tempSection);
            s++;
            <span class="hljs-comment">//</span>
            temp = model[i];
        }

        var row = Ti.UI.createTableViewRow({
            className : <span class="hljs-string">"item"</span> + c,
            backgroundColor: <span class="hljs-string">"#ffcc00"</span>,
            rowIndex : c,
            <span class="hljs-variable">height</span> : <span class="hljs-number">30</span>,
            <span class="hljs-variable">width</span>: <span class="hljs-string">'auto'</span>
        });
        <span class="hljs-comment">//</span>

        var label = Ti.UI.createLabel({
            <span class="hljs-built_in">text</span> : <span class="hljs-string">"label"</span>+i,
            left : <span class="hljs-number">34</span>,
            top : <span class="hljs-number">1</span>,
            <span class="hljs-variable">width</span> : <span class="hljs-number">320</span>,
            <span class="hljs-variable">height</span> : <span class="hljs-number">30</span>
        });
        row.<span class="hljs-built_in">add</span>(label);

        tempSection.<span class="hljs-built_in">add</span>(row);
        c++;

    }
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="February 28th 2013, 7:45:06 am">February 28th 2013</span>
											by <span class='authorname'>Kiwi Blas</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Playing with the code now.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 28th 2013, 8:13:25 am">February 28th 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Here is an answer, the problem is likely due to how the <strong>insertSectionAfter</strong> and <strong>insertSectionBefore</strong> work on the Android devices.  But that is not a problem as there is a much more efficient method anyway to achieve your goal and with only very small changes.</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> model = [<span class="hljs-string">"A"</span>,<span class="hljs-string">"B"</span>,<span class="hljs-string">"B"</span>,<span class="hljs-string">"B"</span>,<span class="hljs-string">"B"</span>,<span class="hljs-string">"C"</span>,<span class="hljs-string">"C"</span>,<span class="hljs-string">"D"</span>];
<span class="hljs-keyword">var</span> modelLen = model.length;

<span class="hljs-keyword">var</span> tableView = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createTableView({top:<span class="hljs-number">0</span>,<span class="hljs-keyword">left</span>:<span class="hljs-number">0</span>,width:<span class="hljs-number">320</span>});

<span class="hljs-keyword">var</span> temp = <span class="hljs-string">""</span>;

<span class="hljs-keyword">var</span> <span class="hljs-built_in">c</span>=<span class="hljs-number">0</span>;
<span class="hljs-keyword">var</span> sections = [], section;

<span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>;i&lt;modelLen;i++) {

    <span class="hljs-keyword">if</span> (temp != model[i]) {

        <span class="hljs-keyword">var</span> tempView  = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createView({backgroundColor:'#9fb650',height:<span class="hljs-number">30</span>});

        <span class="hljs-keyword">var</span> section = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createTableViewSection({
            headerView: tempView,
            height: <span class="hljs-number">40</span>,
            width: <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.<span class="hljs-type">FILL</span>
        });

        <span class="hljs-comment">//tableView.insertSectionBefore(0, tempSection);</span>
        sections.push(section);
        temp = model[i];
    }

    <span class="hljs-keyword">var</span> row = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createTableViewRow({
        className : <span class="hljs-string">"item"</span> + <span class="hljs-built_in">c</span>,
        backgroundColor: <span class="hljs-string">"#ffcc00"</span>,
        rowIndex : <span class="hljs-built_in">c</span>,
        height : <span class="hljs-number">30</span>,
        width: 'auto'
    });

    <span class="hljs-keyword">var</span> label = <span class="hljs-type">Ti</span>.<span class="hljs-type">UI</span>.createLabel({
        text : <span class="hljs-string">"label"</span>+i,
        <span class="hljs-keyword">left</span> : <span class="hljs-number">34</span>,
        top : <span class="hljs-number">1</span>,
        width : <span class="hljs-number">320</span>,
        height : <span class="hljs-number">30</span>
    });
    row.add(label);

    section.add(row);
    <span class="hljs-built_in">c</span>++;
}

tableView.setData(sections.<span class="hljs-built_in">reverse</span>());

win1.add(tableView);
</code></pre><p>This works by creating your sections as you do, but adding them to an array and not the table until the end of the loop.  Once the sections and rows have been created the array is simply reversed and <strong>setData</strong> adds all the sections it to the table.</p>
<p>Works in iOS and Android - fully tested.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 28th 2013, 12:46:37 pm">February 28th 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hello Malcolm, only today I could test your solution. Anything seems to work fine now, thanks. Do you think there is a bug in Titanium? Should I report it?</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 5th 2013, 11:11:10 am">March 5th 2013</span>
											by <span class='authorname'>Kiwi Blas</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I would not worry about it, probably just one of those things that happens - mine worked fine every time.</p>
<p>Glad I could help.</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 5th 2013, 12:28:17 pm">March 5th 2013</span>
											by <span class='authorname'>Malcolm Hollingsworth</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Ok, sorry for the late reply   :-)</p>
</p>
										<div class="author">
											&mdash; commented <span title="March 5th 2013, 12:30:54 pm">March 5th 2013</span>
											by <span class='authorname'>Kiwi Blas</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box vote-box-answered">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
