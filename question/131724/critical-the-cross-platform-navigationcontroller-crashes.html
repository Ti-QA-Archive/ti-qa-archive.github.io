<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>[Critical?] The cross-platform NavigationController crashes. » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>[Critical?] The cross-platform NavigationController crashes.</h1>
		</header>
		<section>
			<p>Again self explanatory.</p>
<p>In Android control the windows is a living hell. I don&#39;t know if a bug or just I&#39;m doing something wrong and I&#39;m going to explain how to make it crash:</p>
<p>https:&#x2F;&#x2F;github.com&#x2F;appcelerator-developer-relations&#x2F;Forging-Titanium&#x2F;tree&#x2F;master&#x2F;ep-002&#x2F;Resources</p>
<p>Download the source code an create the new project.</p>
<p>1.- Run it with any android version<br>2.- Open a few windows<br>3.- Go to titanium studio and run it again without closing any window or the app<br>4.- CRASH! There you have your black window. You have to restart the emulator (also happens in real devices) or try to run the application as many times as windows you opened</p>
<p>I seriously don&#39;t know why this happens or how to fix it, but it doesn&#39;t work. When you have an app using this navigation controller minimized for too long (it may take 10 minutes, maybe even an hour) you got another black screen.</p>
<p>If this is a TiMob bug please post it in jira or in lighthouse cause this little issue is the most annoying thing I&#39;ve ran into since I&#39;m using Titanium. I&#39;ve also tried other controllers from the titanium marketplace and still the same.</p>
<p>Tried with:</p>
<p>Mac OSX Leopard</p>
<p>TiMob SDK from 1.6.2 to 1.8.0.1 (Up to version 1.7.0 crashes, in 1.7.1 doesn&#39;t even run, and in 1.6.2 runs fine so that&#39;s what made me think that this is one hell of a bug)</p>
<p>Huawei U8120 (Vodafone 845 Joy) with Android 2.2 (rooted)</p>
<p>Point Of View PlayTab 2 with Android 2.3 (not rooted)</p>
<p>Emulator android versions: 2.1 2.2 2.3 4.0 4.0.3</p>
<p>This log is what you got when you try to start it an click in the black screen:</p>
<p>http:&#x2F;&#x2F;pastebin.com&#x2F;Mr2ZjzMC</p>
<p>Is my fault? android&#39;s or titanium&#39;s? What should I do to make a good navigation controller that doesn&#39;t crashes?</p>
<p>PD: This goes in the app.js line 9:<br>controller.open(new TestWindow(controller, TestWindow));</p>
<p>And this in TestWindow.js line 1:<br>exports.TestWindow = function(navController, TestWindow) {</p>
<p>and line 3:<br>title:&#39;Window &#39;+navController.windowStack.length,</p>
<p>If I find something I will post it but please help, cause I think that this is important.</p>
<p>Code strong.</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="February 6th 2012, 10:18:46 am">February 6th 2012</span>
				by <span class='authorname'>Juan Manuel Pedraza</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>android</span></li>
					
						<li><span class='tagname'>crash</span></li>
					
						<li><span class='tagname'>navigationcontroller</span></li>
					
				</ul>
			

			<section>
				<h5>0 Comments</h5>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>0</span> Votes</div>
			<div class="answers"><span>4</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>4 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-229547">
				
						<section>
							<p>there are comments posted on the github repo which I believe explain how to address the problems you are experiencing, did you read through them?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 6th 2012, 12:19:36 pm">February 6th 2012</span>
								by <span class='authorname'>Aaron Saunders</span><br>
								<a class="icon-bg icon-link" href="../../question/131724/critical-the-cross-platform-navigationcontroller-crashes.html#answer-229547" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>I read them all and also tried the &quot;fixed&quot; version of the NavigationController but still have the same issues</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 6th 2012, 1:36:18 pm">February 6th 2012</span>
											by <span class='authorname'>Juan Manuel Pedraza</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-229548">
				
						<section>
							<p>Hello Juan.</p>
<p>As I can see, in that episode global variable is used. You can search Q&#x2F;A (and JIRA) for topics regarding global variables and CommonJS. To be short, global variables cannot be used in CommonJS standard. The fact globals are present on iOS is an error and it should be fixed in the future. Android got this right (an error on Android is expected behavior).</p>
<p>Unfortunately, that episode, along some other episodes, are still not rewritten and are working just because that bug on iOS is not fixed. As a workaround, you should not use global variable and should use common CommonJS module in which you can store all global data and you can &quot;require&quot; that module everywhere you want to use it.</p>
<p>Cheers, </p>
<p>Ivan.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 6th 2012, 12:25:37 pm">February 6th 2012</span>
								by <span class='authorname'>Ivan Škugor</span><br>
								<a class="icon-bg icon-link" href="../../question/131724/critical-the-cross-platform-navigationcontroller-crashes.html#answer-229548" rel="permalink">permalink</a>
							</div>

							<h5>4 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Hello Ivan.</p>
<p>My problem is not releated with commonJS and the global variables, is a problem that the application crashes unexpectedly with no reason.</p>
<p>My problem is that if I try to manage the opened windows with a stack or other structure (such as the implemented in the github repo) when I restart the application It fails to load and crashes.</p>
<p>I also tried this without commonJS in older SDKs such as 1.6.2</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 6th 2012, 1:40:11 pm">February 6th 2012</span>
											by <span class='authorname'>Juan Manuel Pedraza</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Juan,</p>
<p>the reason your application crushes on Android is really because of usage of global variables.</p>
<p>In &quot;TestWindow.js&quot;:</p>
<pre><code class="hljs">exports.TestWindow = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(navController)</span> </span>{
    <span class="hljs-keyword">var</span> win = Ti.UI.createWindow({
        title:<span class="hljs-string">'Window '</span>+controller.windowStack.length,
        backgroundColor:<span class="hljs-string">'#fff'</span>,
        layout:<span class="hljs-string">'vertical'</span>
    });
</code></pre><p>Do you see variable &quot;controller&quot;? It&#39;s undeclared variable in module scope. It is actually a global variable because it is defined in &quot;app.js&quot;:</p>
<pre><code class="hljs"><span class="hljs-comment">//create NavigationController which will drive our simple application</span>
<span class="hljs-keyword">var</span> controller = <span class="hljs-keyword">new</span> NavigationController();
</code></pre><p>The code from that episode works because there was an error in implementation of CommonJS standard on both platforms before SDK 1.7.3 (I think) that allowed usage of global variables.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 6th 2012, 3:52:38 pm">February 6th 2012</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I got some info from Appcelerator regarding this issue, in this week&#39;s episode they will announce that there are new samples and templates in Studio available that are written in a better way.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 6th 2012, 4:04:36 pm">February 6th 2012</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I fixed the code (forgot to post it, sorry…) and tried it again, same mistake…</p>
<p>Down there in my last response I explain in more detail my error and without commonJS.</p>
<p>About commonJS and those issues I swear that I&#39;ve been specially looking for that because is the closest declaration of &quot;Objects&quot; and classes.</p>
<p>Thanks for the help.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 7th 2012, 5:17:13 pm">February 7th 2012</span>
											by <span class='authorname'>Juan Manuel Pedraza</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-229549">
				
						<section>
							<pre><code class="hljs"><span class="hljs-comment">// globals.js</span>
<span class="hljs-keyword">var</span> globals = {
    u : Ti.Android != <span class="hljs-literal">undefined</span> ? <span class="hljs-string">'dp'</span> : <span class="hljs-number">0</span>,
    isAndroid : Ti.Android != <span class="hljs-literal">undefined</span>
};

exports.globals = globals;

exports.GlobalUpdate = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(inName, inValue)</span> </span>{
    <span class="hljs-keyword">this</span>.globals[inName] = inValue;
};
</code></pre><pre><code class="hljs"><span class="hljs-comment">// use of globals in application</span>
<span class="hljs-comment">// Globals</span>
app = <span class="hljs-built_in">require</span>(<span class="hljs-string">'/common/globals'</span>);

<span class="hljs-comment">// save a global variable</span>
app.GlobalUpdate(<span class="hljs-string">'mainWindow'</span>, mainWindow);

<span class="hljs-comment">// get a global variable</span>
app.globals.isAndroid
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 6th 2012, 12:31:21 pm">February 6th 2012</span>
								by <span class='authorname'>Aaron Saunders</span><br>
								<a class="icon-bg icon-link" href="../../question/131724/critical-the-cross-platform-navigationcontroller-crashes.html#answer-229549" rel="permalink">permalink</a>
							</div>

							<h5>1 Comment</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>the templates for new applications are already available in the dashboard of the Appcelerator IDE, check there</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 6th 2012, 4:07:56 pm">February 6th 2012</span>
											by <span class='authorname'>Aaron Saunders</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-229675">
				
						<section>
							<p>It looks like that anyone got my point D: too bad…</p>
<p>I&#39;m looking closely to that code and it has serious problems, so I will try to explain it WITHOUT CommonJS.</p>
<p>This time the enviorement is different (not at all, still using a *NIX OS):</p>
<ul>
<li><p>Ubuntu GNU&#x2F;Linux 11.10 with Unity</p>
</li>
<li><p>Titanium SDK: 1.7.5, 1.8.0.1 and 1.8.1</p>
</li>
<li><p>Titanium Studio version build: 1.0.8.201201262211</p>
</li>
</ul>
<p>With this code (and as everyone can see, it has no commonJS or mistery) I create 2 Android activities, to explain more clearly what happened I will tell you how to recreate that situation:</p>
<p>1.- Run this code (is the app.js)</p>
<p>2.- Click the first button, this will make another window to be created and openned</p>
<p>3.- Go to Titanium Studio and run it again without exiting the app or closing the emulator</p>
<p>4.- Got there the black screenshot of dead (android version)…</p>
<p>So here is my point:</p>
<p>1.- I am working with multiples windows in Android, is confortable for the user to have the needed information in the needed place :)</p>
<p>2.- When I&#39;m not in the main window&#39;s, if I restart the application OR I just minimize it for too long it crashes</p>
<p>3.- I read all the android activity docs and I can&#39;t find anything that explains this behavior</p>
<p>4.- I can&#39;t find anything releated to this kind of crash and also tried controllers for android made by other people (from the marketplace) and have the same issues</p>
<p>This code:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> v1 = Ti.UI.createWindow({
    backgroundColor: <span class="hljs-string">'#FFFFFF'</span>,
    fullscreen: <span class="hljs-literal">false</span>,
});

<span class="hljs-keyword">var</span> b1 = Ti.UI.createButton({
    title: <span class="hljs-string">'Boton'</span>
});

v1.add(b1);
v1.open();

b1.addEventListener(<span class="hljs-string">'click'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
    <span class="hljs-keyword">var</span> v2 = Ti.UI.createWindow({
        backgroundColor: <span class="hljs-string">'#FF0000'</span>,
        fullscreen: <span class="hljs-literal">false</span>,
    });

    <span class="hljs-keyword">var</span> b2 = Ti.UI.createButton({
        title: <span class="hljs-string">'Botonete'</span>
    });

    v2.add(b2);
    v2.open();
});
</code></pre>
						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 7th 2012, 5:13:54 pm">February 7th 2012</span>
								by <span class='authorname'>Juan Manuel Pedraza</span><br>
								<a class="icon-bg icon-link" href="../../question/131724/critical-the-cross-platform-navigationcontroller-crashes.html#answer-229675" rel="permalink">permalink</a>
							</div>

							<h5>9 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Android emulator is buggy. :)</p>
<p>That code works fine on device. If you can prove otherwise, report a bug: <a href="https:&#x2F;&#x2F;wiki.appcelerator.org&#x2F;display&#x2F;guides&#x2F;How+to+Submit+a+Bug+Report">https:&#x2F;&#x2F;wiki.appcelerator.org&#x2F;display&#x2F;guides&#x2F;How+to+Submit+a+Bug+Report</a></p>
</p>
										<div class="author">
											&mdash; commented <span title="February 8th 2012, 7:08:19 am">February 8th 2012</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>If that code is fine, why if I minimize the application it crashes after a while?</p>
<p>By the way, thanks for all the help Ivan</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 8th 2012, 7:46:51 am">February 8th 2012</span>
											by <span class='authorname'>Juan Manuel Pedraza</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Because Android emulator is buggy. Really - try that same code on device and let me know if it works.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 8th 2012, 7:49:42 am">February 8th 2012</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>As soon as I can try it in a device (my tablet is out of battery, in 30m I&#39;ll try it) I will post it, but with the &quot;fixed&quot; navigation controller of github I&#39;m talking that all that happened in real devices, 2 to be precise.</p>
<p>Also discovered that for this &quot;bug&quot; to show you have to keep opened the window before, so that&#39;s why I thought that it could be my problem.</p>
<p>Also tried kitchensink and runs fine, but if I extract some code from it (the window example) it crashes too.</p>
<p>And for the final problem: If I kill the app with a task manager (internal or one of the market) the application crashes when I try to execute it, and I&#39;m talking about testing it on real device.</p>
<p>Hope this info helps, thanks again!</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 8th 2012, 8:11:58 am">February 8th 2012</span>
											by <span class='authorname'>Juan Manuel Pedraza</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Sorry for keep you waiting… It crashed after 2 hours minimized…</p>
<p>The navigation controler screws up when the app is minimized and also if you kill the process with a task manager…</p>
<p>Tested in real device… It looks like that for the navigation controler for make it runs fine you have to close all the previous windows before the active one.</p>
<p>But against the killed process issue I haven&#39;t figured out how to solve it. This one is important because in iOS and Android there are people that likes manage the phone memory manually as much as they can (and I am one of them)</p>
<p>So, try that code and kill the app in the second window</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 8th 2012, 1:35:24 pm">February 8th 2012</span>
											by <span class='authorname'>Juan Manuel Pedraza</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>If you can reliably reproduce that issue, then you should report a bug.</p>
<p>I must admit that I have never had that kind of problems on device.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 8th 2012, 1:52:08 pm">February 8th 2012</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>It&#39;s easy to reproduce the issue of the task manager (just kill the app) but about the other one (the minimized) it&#39;s a whole different story because it happens maybe in 20 minutes or perfectly (like in this case) 2 hours, so I don&#39;t know what to do…</p>
<p>By the way, thanks for all the help.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 8th 2012, 1:54:32 pm">February 8th 2012</span>
											by <span class='authorname'>Juan Manuel Pedraza</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Well, I&#39;ve posted this in jira a while ago</p>
<p>https:&#x2F;&#x2F;jira.appcelerator.org&#x2F;browse&#x2F;TC-577</p>
<p>And the kill issue is still there, wich navigation controller do you use?</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 9th 2012, 6:41:08 am">February 9th 2012</span>
											by <span class='authorname'>Juan Manuel Pedraza</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>My own. :)</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 9th 2012, 6:57:38 am">February 9th 2012</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
