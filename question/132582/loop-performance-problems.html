<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Loop performance problems » Community Questions &amp; Answers </title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Loop performance problems</h1>
		</header>
		<section>
			<p>[INFO] Titanium SDK version: 1.8.1 (01&#x2F;27&#x2F;12 17:31 a24502a)</p>
<p>I have a loop where I inspect a JSON-array of about 150 items. Basically I inspect the values of most fields and set colors variables&#x2F;create sections as necessary. Nothing really complicated but maybe 10 if&#39;s and switch&#39;s. Finally I create 4 colored labels and one TableViewRow, where the labels are added. The row is added to an array which is later on (not in loop) sent to TableView using setData.</p>
<p>This loop handling 150 items takes about 1.5 seconds, which to me is a very long time since I don&#39;t think the code is very complicated. Since I have to run this loop 5 times for 5 data sets, the total wait-time is over 7 seconds.</p>
<p>The system object that are created for each loop are: 7 sections, 28 labels and about 30 TableViewRow&#39;s.</p>
<p>How can I speed up this loop?</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="February 22nd 2012, 10:30:22 am">February 22nd 2012</span>
				by <span class='authorname'>Peter Andersson</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>api</span></li>
					
						<li><span class='tagname'>appcelerator</span></li>
					
						<li><span class='tagname'>tableview</span></li>
					
						<li><span class='tagname'>tableviewrow</span></li>
					
						<li><span class='tagname'>titanium</span></li>
					
				</ul>
			

			<section>
				<h5>2 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>I&#39;m using iOS, and in this case the Simulator is VERY fast and the problem only exists on the actual device (iPhone4), sorry should have mentioned that.</p>
</div>
							<div class="author">
								&mdash; commented <span title="February 22nd 2012, 10:40:04 am">February 22nd 2012</span>
								by <span class='authorname'>Peter Andersson</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>Sounds very long, any chance you can post some code that reproduces the problem? I know you&#39;ll probably have to edit quite a bit so you can post it, but it would allow us to take a good look and play around with it.</p>
</div>
							<div class="author">
								&mdash; commented <span title="February 22nd 2012, 4:58:24 pm">February 22nd 2012</span>
								by <span class='authorname'>David Doran</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>3</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>3 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-231192">
				
						<section>
							<p>If you&#39;re using Android emulator, the solution is to use device for performance testing because emulator is generally much slower than device.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 22nd 2012, 10:33:36 am">February 22nd 2012</span>
								by <span class='authorname'>Ivan Škugor</span><br>
								<a class="icon-bg icon-link" href="question/132582/loop-performance-problems.html#answer-231192" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-231196">
				
						<section>
							<p>A general technique for speeding up tableView rendering is to utilise a className on the row objects you create. Are you doing that ?</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 22nd 2012, 10:53:11 am">February 22nd 2012</span>
								by <span class='authorname'>Nick Milner</span><br>
								<a class="icon-bg icon-link" href="question/132582/loop-performance-problems.html#answer-231196" rel="permalink">permalink</a>
							</div>

							<h5>5 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Yes I am, however I use the same className for all rows, does that matter?</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 22nd 2012, 10:58:41 am">February 22nd 2012</span>
											by <span class='authorname'>Peter Andersson</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>The className should be repeated for each row that <em>has the same layout</em> It helps the rendering engine to re-use rows instead of expensively generating new ones.</p>
<p>Some general rules for javascript performance can include (not a complete list);</p>
<ol>
<li>Dont declare variables within loops (creating&#x2F;destroying them can be an overhead)</li>
<li>Try not to reference global variables (the interpreter has to walk the scope chain to find it)</li>
<li><p>Cache values in variables (eg check the .length of an array)</p>
</li>
<li><p>Avoid try&#x2F;catch where performance is paramount;</p>
</li>
</ol>
</p>
										<div class="author">
											&mdash; commented <span title="February 22nd 2012, 11:42:58 am">February 22nd 2012</span>
											by <span class='authorname'>Nick Milner</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Nick,</p>
<p>first point does make sense in JavaScript because variables are &quot;hoisted&quot; on top of scope in which they are declared (and &quot;for&quot; loop does not create new scope).</p>
<p><a href="http:&#x2F;&#x2F;dmitrysoshnikov.com&#x2F;notes&#x2F;note-4-two-words-about-hoisting&#x2F;">http:&#x2F;&#x2F;dmitrysoshnikov.com&#x2F;notes&#x2F;note-4-two-words-about-hoisting&#x2F;</a></p>
</p>
										<div class="author">
											&mdash; commented <span title="February 22nd 2012, 11:51:36 am">February 22nd 2012</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Ivan, do you mean &quot;does NOT make sense&quot; ? else I completely misunderstood the article you refer to (which is quite probably the case anyway).</p>
<ul>
<li>I do declare a few variables, would that really cause this slow execution?</li>
<li>No globals (as in &#39;attached to window object&#39;) variables. However a bunch (20) of others declared in the containing function.</li>
<li>I do cache the length of the array I loop thru</li>
<li>No try&#x2F;catch</li>
</ul>
<p>as I said, code is VERY fast on my iOS Emulator, its just on the iPhone4 that it is slow.</p>
<p>Removing the four createLabel() calls, just as an experiment, seems to improve things a bit, so I will try to pre-create 4 labels, and set the &quot;text&quot;<br>attribute on them before adding them to the row, would that work?</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 22nd 2012, 7:39:55 pm">February 22nd 2012</span>
											by <span class='authorname'>Peter Andersson</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Yeah, &quot;not&quot; is missing there. :)</p>
<p>I can&#39;t tell you would that work because I don&#39;t know what&#39;s the source of the problem. Maybe you should try to create small example that demonstrates that issue so people can play with it.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 23rd 2012, 7:00:21 am">February 23rd 2012</span>
											by <span class='authorname'>Ivan Škugor</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-231258">
				
						<section>
							<p>Hello,</p>
<p>remember that a mobile app is more a &quot;viewport&quot;, where you can put web content, graphics, etc. Therefore, if you need to do this kind of process (600 elements?) try to bring that complexity into the server, which is specifically designed to this kind of workload. This will make your app more efficient, in terms of cpu processing power, battery usage and data transfer. </p>
<p>Best,</p>
<p>Mauro</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="February 22nd 2012, 9:38:20 pm">February 22nd 2012</span>
								by <span class='authorname'>Mauro Parra</span><br>
								<a class="icon-bg icon-link" href="question/132582/loop-performance-problems.html#answer-231258" rel="permalink">permalink</a>
							</div>

							<h5>3 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>Yes I could, but there are a few items of consideration:</p>
<ul>
<li>Those 600 elements are all the data, there is no more! It consists of 5 weeks (each week is a View in a ScrollView) with 7 days each in a TableView, and approx 5-6 items on each day. You scroll weeks sideways, and days vertically. Works really nice I must say.</li>
<li>I want the app to work even is network is unavailable so I store it locally, both in a database and in cached variables.</li>
<li>Supposedly, filtering from an existing dataset what data to show should always be faster than re-requesting it from the server. In this case, added network overhead would certainly not help.</li>
</ul>
<p>I can make this app work acceptably fast, but the core question is whether Appcellerator is this slow? I worry about other planned applications if this simple thing causes performance problems.</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 22nd 2012, 10:02:49 pm">February 22nd 2012</span>
											by <span class='authorname'>Peter Andersson</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hello,</p>
<p>If that&#39;s all the data, this 7 seconds are happening once. I think you should consider that you should calculate the actual time: </p>
<p>% time downloading the data</p>
<p>% time processing the data </p>
<p>I would go and fill first the db, then draw, by example. </p>
<p>Best,</p>
<p>Mauro</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 22nd 2012, 10:07:46 pm">February 22nd 2012</span>
											by <span class='authorname'>Mauro Parra</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Hello,<br>You can ignore d&#x2F;l of data since I already have the data on the phone, and only refresh it on request from user. The actual downloading is also very fast since its a really small amount of data.<br>I rebuild the TableViews when the user does various selections. For example I change color&#x2F;font&#x2F;position on items, move labels to another position etc. Therefore it was easier to just rebuild the whole 5 tables instead of changing most rows. So it takes 7 secs every time the user changes the &#39;filters&#39;.<br>The core problem is that it takes so long time to do it on the phone. The logic itself is very simple, and the re-create is almost instantaneous in the simulator, so why is the iPhone so slow?</p>
</p>
										<div class="author">
											&mdash; commented <span title="February 23rd 2012, 5:15:08 am">February 23rd 2012</span>
											by <span class='authorname'>Peter Andersson</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
