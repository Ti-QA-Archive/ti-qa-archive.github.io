<!doctype html>
<html>
<head>
	<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<meta charset="utf-8">
	
		<title>Cant find variable Ti - When webview loads url via hrefs » Community Questions &amp; Answers » Appcelerator Developer Center</title>
	
	<meta name="viewport" content="width=device-width,initial-scale=1">
	<link href="../../related/favicon.png" rel="shortcut icon" type="image/png">
	<link href="//fonts.googleapis.com/css?family=Open+Sans:300,400,500,600,700" rel="stylesheet" type="text/css">
	<link href="//d3ilu1xuwhtfe2.cloudfront.net/e8e0ebd/css/style.css" rel="stylesheet" type="text/css">
	<link href="../../related/qa.css" rel="stylesheet" type="text/css">
	<link href="../../related/hybrid.css" rel="stylesheet" type="text/css">
	
	<link href="../../related/overrides.css" rel="stylesheet" type="text/css">
</head>
<body>

<div class='mast'>    <div class='container'>        <div class='row'>            <div class='col-sm-12'>                <div class='masthead'><h1>Titanium Community Questions & Answer Archive</h1><h2>We felt that 6+ years of knowledge should not die so this is the Titanium Community Questions &amp; Answer Archive</h2></div>            </div>        </div>    </div></div>

<main class="container">
	<div class="row">
		<div class="col-sm-12">
			
		</div>
	</div>
	<div class="row">
		<div class="col-sm-12">
			<article class="question-container">
	<div class="question">
		<header>
			<h1>Cant find variable Ti - When webview loads url via hrefs</h1>
		</header>
		<section>
			<p>Its been a while developing in titanium and i have got quite used to firing from within webviews and listening it from app.js adn vice-versa.But this time,when i specify this particular url directly in properties when creating the Webview,all the Ti.App.fireEvents in the html fire normally.. but not when i reach the page clicking links.</p>
<p>Is this a bug from Titanium? i am using the latest SDK.I would mention,the other pages also have multiple events firing which listen in app.js but they dont fail.</p>
<p>Can anyone help me? This doesnt depend on the code which is written in eventlistener because simple alerts don&#39;t work too.Although i even tried my actual code which is of geolocation.Any leads to the problem?</p>
<p>This is presently the eventlistener:</p>
<p>var f = function(e) {<br>    try {<br>        var top_view = Ti.UI.createView({<br>            top : &quot;0px&quot;,<br>            height : &quot;170px&quot;,<br>            width : &quot;100%&quot;,<br>            backgroundImage : &quot;backgrnd.jpg&quot;<br>        });<br>        var low_view = Ti.UI.createView({<br>            backgroundImage : &quot;lowBack.jpg&quot;,<br>            height : &quot;88px&quot;,<br>            bottom : &quot;0px&quot;<br>        });<br>        var listview = Ti.UI.createImageView({<br>            top : &#39;10dp&#39;,<br>            left : &#39;10dp&#39;,<br>            image : &#39;listview4.png&#39;,<br>            &#x2F;&#x2F;title : &#39;dffsf&#39;<br>        });<br>        var mapview = Ti.UI.createImageView({<br>            top : &#39;10dp&#39;,<br>            left : &#39;100dp&#39;,<br>            image : &#39;MapPage.png&#39;,<br>            &#x2F;&#x2F;title : &#39;asdasd&#39;<br>        });<br>        var choose = Ti.UI.createLabel({<br>            text : &quot;Choose Map View to see all&quot;,<br>            color : &quot;white&quot;,<br>            right : &quot;10dp&quot;,<br>            font : {<br>                fontSize : &#39;10pt&#39;<br>            }<br>        })<br>        var logo = Ti.UI.createImageView({<br>            image : &#39;speedcologo.png&#39;,<br>            left : &#39;0dp&#39;,<br>            width : &#39;100dp&#39;<br>        })<br>        var homeBtn = Ti.UI.createButton({<br>            top : &#39;10dp&#39;,<br>            right : &#39;10dp&#39;,<br>            font : {<br>                fontSize : &#39;15pt&#39;<br>            },<br>            backgroundImage : &#39;button.png&#39;,<br>            title : &#39;HOME&#39;<br>        });<br>        var backBtn = Ti.UI.createButton({<br>            top : &#39;10dp&#39;,<br>            right : &#39;70dp&#39;,<br>            font : {<br>                fontSize : &#39;15pt&#39;<br>            },<br>            backgroundImage : &#39;button.png&#39;,<br>            title : &#39;BACK&#39;<br>        });<br>        alert(&#39;popa reached&#39;);<br>        var mapWin = Ti.UI.createWindow({<br>            navBarHidden : true<br>        });<br>        var map = Ti.Map.createView({<br>            mapType : Titanium.Map.STANDARD_TYPE,<br>            &#x2F;<em>region : {<br>             latitude : 14.6673667,<br>             longitude : 121.0432335,<br>             latitudeDelta : 0.5,<br>             longitudeDelta : 0.5<br>             },
             </em>&#x2F;<br>            regionFit : true,<br>            animate : true,<br>            regionFit : true,<br>            userLocation : true<br>        });<br>        Ti.Geolocation.preferredProvider = Titanium.Geolocation.PROVIDER_GPS;<br>        Ti.Geolocation.purpose = &quot;Speedco&quot;;<br>        Titanium.Geolocation.accuracy = Titanium.Geolocation.ACCURACY_BEST;</p>
<pre><code class="hljs">    //
    //  SET DISTANCE FILTER.  THIS DICTATES HOW OFTEN AN EVENT FIRES BASED ON THE DISTANCE THE DEVICE MOVES
    //  THIS VALUE IS IN METERS
    //
    Titanium.Geolocation.distanceFilter = <span class="hljs-number">10</span>;
    /*Titanium.Geolocation.getCurrentPosition(<span class="hljs-keyword">function</span>(e) {
     <span class="hljs-keyword">if</span> (!e.success || e.error) {
     alert('error ' + JSON.stringify(e.error));
     <span class="hljs-keyword">return</span>;
     }
     <span class="hljs-keyword">var</span> region = {
     latitude : e.coords.latitude,
     longitude : e.coords.longitude,
     latitudeDelta : <span class="hljs-number">0.5</span>,
     longitudeDelta : <span class="hljs-number">0.5</span>
     };
     globalLat = e.coords.latitude;
     globalLong = e.coords.longitude;
     <span class="hljs-typename">map</span>.setLocation(region);
     });*/
    Ti.Geolocation.getCurrentPosition(<span class="hljs-keyword">function</span>(evt) {

        <span class="hljs-keyword">var</span> origin = String(evt.coords.latitude + ',' + evt.coords.longitude), travelMode = 'driving', yourLatitude = <span class="hljs-string">"35.179217"</span>, yourLongitude = <span class="hljs-string">"-113.79347"</span>, destination = String(yourLatitude + ',' + yourLongitude), url = <span class="hljs-string">"http://maps.google.com/maps/api/directions/xml?mode="</span> + travelMode + <span class="hljs-string">"&amp;origin="</span> + origin + <span class="hljs-string">"&amp;destination="</span> + destination + <span class="hljs-string">"&amp;sensor=false"</span>;
        xhr = Titanium.Network.createHTTPClient();
        xhr.open('GET', url);

        Ti.API.info('&gt;&gt;&gt; go get data <span class="hljs-keyword">for</span> Rgeocode! ...URL: ' + url);

        xhr.onload = <span class="hljs-keyword">function</span>(e) {
            /*<span class="hljs-keyword">var</span> xml = this.responseXML, points = [], steps = xml.documentElement.getElementsByTagName(<span class="hljs-string">"step"</span>), totalSteps = steps.length;

             <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; totalSteps; i++) {
             <span class="hljs-keyword">var</span> startLocation = steps.item(i).getElementsByTagName(<span class="hljs-string">"start_location"</span>);
             startLatitude = startLocation.item(<span class="hljs-number">0</span>).getElementsByTagName(<span class="hljs-string">"lat"</span>).item(<span class="hljs-number">0</span>).text, startLongitude = startLocation.item(<span class="hljs-number">0</span>).getElementsByTagName(<span class="hljs-string">"lng"</span>).item(<span class="hljs-number">0</span>).text;

             points.push({
             latitude : startLatitude,
             longitude : startLongitude
             });
             }*/
            <span class="hljs-keyword">var</span> xml = this.responseXML, points = [], steps = xml.documentElement.getElementsByTagName(<span class="hljs-string">"step"</span>), totalSteps = steps.length;

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> i = <span class="hljs-number">0</span>; i &lt; totalSteps; i++) {
                <span class="hljs-keyword">var</span> polylineString = steps.item(i).getElementsByTagName(<span class="hljs-string">"polyline"</span>).item(<span class="hljs-number">0</span>).getElementsByTagName(<span class="hljs-string">"points"</span>).item(<span class="hljs-number">0</span>).text, decodedPolyline = decodeLine(polylineString);

                <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> j = <span class="hljs-number">0</span>; j &lt; decodedPolyline.length; j++) {
                    <span class="hljs-keyword">if</span> (decodedPolyline[j] != <span class="hljs-literal">null</span>) {
                        points.push({
                            latitude : decodedPolyline[j][<span class="hljs-number">0</span>],
                            longitude : decodedPolyline[j][<span class="hljs-number">1</span>]
                        });
                    }
                }
            }

            // Get last point and add it to the <span class="hljs-typename">array</span>, as we are only parsing &lt;start_location&gt;
            <span class="hljs-keyword">var</span> finalLocation = steps.item(totalSteps - <span class="hljs-number">1</span>).getElementsByTagName(<span class="hljs-string">"end_location"</span>), finalLatitude = finalLocation.item(<span class="hljs-number">0</span>).getElementsByTagName(<span class="hljs-string">"lat"</span>).item(<span class="hljs-number">0</span>).text, finalLongitude = finalLocation.item(<span class="hljs-number">0</span>).getElementsByTagName(<span class="hljs-string">"lng"</span>).item(<span class="hljs-number">0</span>).text;

            points.push({
                latitude : finalLatitude,
                longitude : finalLongitude
            });

            // Create route and annotations
            <span class="hljs-keyword">var</span> route = {
                name : <span class="hljs-string">"bonVoyage"</span>,
                points : points,
                color : <span class="hljs-string">"blue"</span>,
                width : <span class="hljs-number">6</span>
            }, startAnnotation = Ti.Map.createAnnotation({
                pincolor : Ti.Map.ANNOTATION_GREEN,
                latitude : points[<span class="hljs-number">0</span>].latitude,
                longitude : points[<span class="hljs-number">0</span>].longitude,
                title : 'Current location'
            }), endAnnotation = Ti.Map.createAnnotation({
                pincolor : Ti.Map.ANNOTATION_RED,
                latitude : points[points.length - <span class="hljs-number">1</span>].latitude,
                longitude : points[points.length - <span class="hljs-number">1</span>].longitude,
                title : 'Destination'
            });

            // Add elements
            <span class="hljs-typename">map</span>.addRoute(route);
            <span class="hljs-typename">map</span>.addAnnotation(startAnnotation);
            <span class="hljs-typename">map</span>.addAnnotation(endAnnotation);
            /*setTimeout(<span class="hljs-keyword">function</span>() {
             <span class="hljs-typename">map</span>.regionFit = <span class="hljs-literal">true</span>;
             }, <span class="hljs-number">700</span>);
             //hack to get route to show*/
        };

        xhr.send();
    });
    /*<span class="hljs-keyword">var</span> marker = [];

     <span class="hljs-keyword">var</span> annot = Titanium.Map.createAnnotation({
     latitude : <span class="hljs-number">35.179217</span>,
     longitude : -<span class="hljs-number">113.79347</span>,
     title : <span class="hljs-string">"Speedco 304"</span>,
     subtitle : <span class="hljs-string">"Address: "</span> + <span class="hljs-string">"875 Ty Rd"</span>,
     pincolor : Titanium.Map.ANNOTATION_RED,
     animate : <span class="hljs-literal">true</span>,
     leftButton : <span class="hljs-string">"m.png"</span>,
     //leftButton : <span class="hljs-string">"images/no_photo.jpg"</span>,
     myid : <span class="hljs-string">"Speedco 304"</span> // CUSTOM ATTRIBUTE THAT IS PASSED INTO EVENT OBJECTS
     });
     <span class="hljs-keyword">var</span> current = Titanium.Map.createAnnotation({
     latitude : <span class="hljs-number">35.208449</span>,
     longitude : -<span class="hljs-number">114.025730</span>,
     title : <span class="hljs-string">"YOU"</span>,
     subtitle : <span class="hljs-string">"You are here"</span>,
     pincolor : Titanium.Map.ANNOTATION_GREEN,
     animate : <span class="hljs-literal">true</span>,
     leftButton : <span class="hljs-string">"m.png"</span>,
     //leftButton : <span class="hljs-string">"images/no_photo.jpg"</span>,
     myid : <span class="hljs-string">"YOU"</span> // CUSTOM ATTRIBUTE THAT IS PASSED INTO EVENT OBJECTS
     });
     marker.push(annot);
     marker.push(current);
     <span class="hljs-typename">map</span>.annotations = marker;
     <span class="hljs-keyword">var</span> pts = [];
     pts.push({
     latitude : <span class="hljs-number">35.208449</span>,
     longitude : -<span class="hljs-number">114.025730</span>
     });

     pts.push({
     latitude : <span class="hljs-number">35.179217</span>,
     longitude : -<span class="hljs-number">113.79347</span>
     });
     <span class="hljs-keyword">var</span> route = {
     name : 'Demo Route',
     points : pts,
     color : <span class="hljs-string">"blue"</span>,
     width : <span class="hljs-number">2</span>
     };

     // add a route
     <span class="hljs-typename">map</span>.addRoute(route);
     //<span class="hljs-typename">map</span>.addRoute(annot);
     */
    mapWin.add(<span class="hljs-typename">map</span>);
    top_view.add(logo);
    top_view.add(backBtn);
    top_view.add(homeBtn);
    low_view.add(listview);
    low_view.add(mapview);
    low_view.add(choose);
    mapWin.add(low_view);
    mapWin.add(top_view);
    mapWin.open();
} <span class="hljs-keyword">catch</span>(e) {
    alert(e);
}
</code></pre><p>}<br>Ti.App.addEventListener(&#39;popa&#39;, f);</p>
<p>and the getdirections.html:</p>
<pre><code class="hljs"><span class="hljs-doctype">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"&gt;</span>
<span class="hljs-comment">&lt;!-- saved from url=(0047) --&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">html</span>&gt;</span>
    <span class="hljs-tag">&lt;<span class="hljs-title">head</span>&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">charset</span>=<span class="hljs-value">"utf-8"</span> /&gt;</span>
      <span class="hljs-comment">&lt;!-- Always force latest IE rendering engine (even in intranet) &amp; Chrome Frame 
       Remove this if you use the .htaccess --&gt;</span>
      <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">http-equiv</span>=<span class="hljs-value">"X-UA-Compatible"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"IE=edge,chrome=1"</span> /&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-title">title</span>&gt;</span>A Princess of Mars<span class="hljs-tag">&lt;/<span class="hljs-title">title</span>&gt;</span>

      <span class="hljs-tag">&lt;<span class="hljs-title">meta</span> <span class="hljs-attribute">name</span>=<span class="hljs-value">"viewport"</span> <span class="hljs-attribute">content</span>=<span class="hljs-value">"width=device-width; initial-scale=1.0"</span> /&gt;</span>
    <span class="hljs-tag">&lt;/<span class="hljs-title">head</span>&gt;</span>
<span class="hljs-tag">&lt;<span class="hljs-title">body</span>&gt;</span>

<span class="hljs-tag">&lt;<span class="hljs-title">input</span> <span class="hljs-attribute">value</span>=<span class="hljs-value">"Click here"</span> <span class="hljs-attribute">type</span>=<span class="hljs-value">"button"</span> <span class="hljs-attribute">onclick</span>=<span class="hljs-value">"try{Ti.App.fireEvent('popa',{});} catch(e){alert(e);}"</span>/&gt;</span>

<span class="hljs-tag">&lt;/<span class="hljs-title">body</span>&gt;</span>
<span class="hljs-tag">&lt;/<span class="hljs-title">html</span>&gt;</span>
</code></pre><p>I HOPE YOU SAW THIS AARON SAUNDERS! lol. Please help</p>

		</section>
		<footer>
			<div class="author">
				&mdash; asked <span title="November 5th 2012, 1:09:59 pm">November 5th 2012</span>
				by <span class='authorname'>Nezam Uddin</span>
			</div>

			
				<ul class="tags">
					
						<li><span class='tagname'>gps</span></li>
					
						<li><span class='tagname'>iphone</span></li>
					
						<li><span class='tagname'>mobile</span></li>
					
				</ul>
			

			<section>
				<h5>3 Comments</h5>
				
					<ul class="comments">
					
						<li class="comment">
							<div><p>Can you post the code one more time, formatted properly. You formatted the html properly, but the code is not in a code block.</p>
</div>
							<div class="author">
								&mdash; commented <span title="November 5th 2012, 2:00:15 pm">November 5th 2012</span>
								by <span class='authorname'>Anthony Decena</span>
							</div>
						</li>
					
						<li class="comment">
							<div><p>relevant code block in app.js:</p>
<pre><code class="hljs"><span class="hljs-comment">// Since the full code could'nt be posted in a single comment,i divided it into two comments</span>
<span class="hljs-comment">// the code is continued in the next comment,Insha Allah </span>
var f = function(e) {
    <span class="hljs-keyword">try</span> {
        var top_view = Ti.UI.createView({
            <span class="hljs-string">top :</span> <span class="hljs-string">"0px"</span>,
            <span class="hljs-string">height :</span> <span class="hljs-string">"170px"</span>,
            <span class="hljs-string">width :</span> <span class="hljs-string">"100%"</span>,
            <span class="hljs-string">backgroundImage :</span> <span class="hljs-string">"backgrnd.jpg"</span>
        });
        var low_view = Ti.UI.createView({
            <span class="hljs-string">backgroundImage :</span> <span class="hljs-string">"lowBack.jpg"</span>,
            <span class="hljs-string">height :</span> <span class="hljs-string">"88px"</span>,
            <span class="hljs-string">bottom :</span> <span class="hljs-string">"0px"</span>
        });
        var listview = Ti.UI.createImageView({
            <span class="hljs-string">top :</span> <span class="hljs-string">'10dp'</span>,
            <span class="hljs-string">left :</span> <span class="hljs-string">'10dp'</span>,
            <span class="hljs-string">image :</span> <span class="hljs-string">'listview4.png'</span>,
            <span class="hljs-comment">//title : 'dffsf'</span>
        });
        var mapview = Ti.UI.createImageView({
            <span class="hljs-string">top :</span> <span class="hljs-string">'10dp'</span>,
            <span class="hljs-string">left :</span> <span class="hljs-string">'100dp'</span>,
            <span class="hljs-string">image :</span> <span class="hljs-string">'MapPage.png'</span>,
            <span class="hljs-comment">//title : 'asdasd'</span>
        });
        var choose = Ti.UI.createLabel({
            <span class="hljs-string">text :</span> <span class="hljs-string">"Choose Map View to see all"</span>,
            <span class="hljs-string">color :</span> <span class="hljs-string">"white"</span>,
            <span class="hljs-string">right :</span> <span class="hljs-string">"10dp"</span>,
            <span class="hljs-string">font :</span> {
                <span class="hljs-string">fontSize :</span> <span class="hljs-string">'10pt'</span>
            }
        })
        var logo = Ti.UI.createImageView({
            <span class="hljs-string">image :</span> <span class="hljs-string">'speedcologo.png'</span>,
            <span class="hljs-string">left :</span> <span class="hljs-string">'0dp'</span>,
            <span class="hljs-string">width :</span> <span class="hljs-string">'100dp'</span>
        })
        var homeBtn = Ti.UI.createButton({
            <span class="hljs-string">top :</span> <span class="hljs-string">'10dp'</span>,
            <span class="hljs-string">right :</span> <span class="hljs-string">'10dp'</span>,
            <span class="hljs-string">font :</span> {
                <span class="hljs-string">fontSize :</span> <span class="hljs-string">'15pt'</span>
            },
            <span class="hljs-string">backgroundImage :</span> <span class="hljs-string">'button.png'</span>,
            <span class="hljs-string">title :</span> <span class="hljs-string">'HOME'</span>
        });
        var backBtn = Ti.UI.createButton({
            <span class="hljs-string">top :</span> <span class="hljs-string">'10dp'</span>,
            <span class="hljs-string">right :</span> <span class="hljs-string">'70dp'</span>,
            <span class="hljs-string">font :</span> {
                <span class="hljs-string">fontSize :</span> <span class="hljs-string">'15pt'</span>
            },
            <span class="hljs-string">backgroundImage :</span> <span class="hljs-string">'button.png'</span>,
            <span class="hljs-string">title :</span> <span class="hljs-string">'BACK'</span>
        });
        alert(<span class="hljs-string">'popa reached'</span>);
        var mapWin = Ti.UI.createWindow({
            <span class="hljs-string">navBarHidden :</span> <span class="hljs-literal">true</span>
        });
        var map = Ti.Map.createView({
            <span class="hljs-string">mapType :</span> Titanium.Map.STANDARD_TYPE,

            <span class="hljs-string">regionFit :</span> <span class="hljs-literal">true</span>,
            <span class="hljs-string">animate :</span> <span class="hljs-literal">true</span>,
            <span class="hljs-string">regionFit :</span> <span class="hljs-literal">true</span>,
            <span class="hljs-string">userLocation :</span> <span class="hljs-literal">true</span>
        });
</code></pre></div>
							<div class="author">
								&mdash; commented <span title="November 6th 2012, 2:43:55 am">November 6th 2012</span>
								by <span class='authorname'>Nezam Uddin</span>
							</div>
						</li>
					
						<li class="comment">
							<div><pre><code class="hljs">
<span class="hljs-comment">//this whole code is within function f</span>

    Ti.Geolocation.preferredProvider = Titanium.Geolocation.PROVIDER_GPS;
        Ti.Geolocation.purpose = <span class="hljs-string">"Speedco"</span>;
        Titanium.Geolocation.accuracy = Titanium.Geolocation.ACCURACY_BEST;

        Titanium.Geolocation.distanceFilter = <span class="hljs-number">10</span>;

        Ti.Geolocation.getCurrentPosition(function(evt) {

            var origin = <span class="hljs-keyword">String</span>(evt.coords.latitude + <span class="hljs-string">','</span> + evt.coords.longitude), travelMode = <span class="hljs-string">'driving'</span>, yourLatitude = <span class="hljs-string">"35.179217"</span>, yourLongitude = <span class="hljs-string">"-113.79347"</span>, destination = <span class="hljs-keyword">String</span>(yourLatitude + <span class="hljs-string">','</span> + yourLongitude), url = <span class="hljs-string">"http://maps.google.com/maps/api/directions/xml?mode="</span> + travelMode + <span class="hljs-string">"&amp;origin="</span> + origin + <span class="hljs-string">"&amp;destination="</span> + destination + <span class="hljs-string">"&amp;sensor=false"</span>;
            xhr = Titanium.Network.createHTTPClient();
            xhr.<span class="hljs-built_in">open</span>(<span class="hljs-string">'GET'</span>, url);

            Ti.API.info(<span class="hljs-string">'&gt;&gt;&gt; go get data for Rgeocode! ...URL: '</span> + url);

            xhr.onload = function(e) {

                var xml = <span class="hljs-keyword">this</span>.responseXML, points = [], steps = xml.documentElement.getElementsByTagName(<span class="hljs-string">"step"</span>), totalSteps = steps.length;

                <span class="hljs-keyword">for</span> (var i = <span class="hljs-number">0</span>; i &lt; totalSteps; i++) {
                    var polylineString = steps.item(i).getElementsByTagName(<span class="hljs-string">"polyline"</span>).item(<span class="hljs-number">0</span>).getElementsByTagName(<span class="hljs-string">"points"</span>).item(<span class="hljs-number">0</span>).<span class="hljs-built_in">text</span>, decodedPolyline = decodeLine(polylineString);

                    <span class="hljs-keyword">for</span> (var j = <span class="hljs-number">0</span>; j &lt; decodedPolyline.length; j++) {
                        <span class="hljs-keyword">if</span> (decodedPolyline[j] != <span class="hljs-keyword">null</span>) {
                            points.push({
                                latitude : decodedPolyline[j][<span class="hljs-number">0</span>],
                                longitude : decodedPolyline[j][<span class="hljs-number">1</span>]
                            });
                        }
                    }
                }

                <span class="hljs-comment">// Get last point and add it to the array, as we are only parsing &lt;start_location&gt;</span>
                var finalLocation = steps.item(totalSteps - <span class="hljs-number">1</span>).getElementsByTagName(<span class="hljs-string">"end_location"</span>), finalLatitude = finalLocation.item(<span class="hljs-number">0</span>).getElementsByTagName(<span class="hljs-string">"lat"</span>).item(<span class="hljs-number">0</span>).<span class="hljs-built_in">text</span>, finalLongitude = finalLocation.item(<span class="hljs-number">0</span>).getElementsByTagName(<span class="hljs-string">"lng"</span>).item(<span class="hljs-number">0</span>).<span class="hljs-built_in">text</span>;

                points.push({
                    latitude : finalLatitude,
                    longitude : finalLongitude
                });

                <span class="hljs-comment">// Create route and annotations</span>
                var route = {
                    name : <span class="hljs-string">"bonVoyage"</span>,
                    points : points,
                    <span class="hljs-built_in">color</span> : <span class="hljs-string">"blue"</span>,
                    <span class="hljs-variable">width</span> : <span class="hljs-number">6</span>
                }, startAnnotation = Ti.Map.createAnnotation({
                    pincolor : Ti.Map.ANNOTATION_GREEN,
                    latitude : points[<span class="hljs-number">0</span>].latitude,
                    longitude : points[<span class="hljs-number">0</span>].longitude,
                    title : <span class="hljs-string">'Current location'</span>
                }), endAnnotation = Ti.Map.createAnnotation({
                    pincolor : Ti.Map.ANNOTATION_RED,
                    latitude : points[points.length - <span class="hljs-number">1</span>].latitude,
                    longitude : points[points.length - <span class="hljs-number">1</span>].longitude,
                    title : <span class="hljs-string">'Destination'</span>
                });

                <span class="hljs-comment">// Add elements</span>
                <span class="hljs-built_in">map</span>.addRoute(route);
                <span class="hljs-built_in">map</span>.addAnnotation(startAnnotation);
                <span class="hljs-built_in">map</span>.addAnnotation(endAnnotation);
                <span class="hljs-comment">/*setTimeout(function() {
                 map.regionFit = true;
                 }, 700);
                 //hack to get route to show*/</span>
            };

            xhr.send();
        });

        mapWin.<span class="hljs-built_in">add</span>(<span class="hljs-built_in">map</span>);
        top_view.<span class="hljs-built_in">add</span>(logo);
        top_view.<span class="hljs-built_in">add</span>(backBtn);
        top_view.<span class="hljs-built_in">add</span>(homeBtn);
        low_view.<span class="hljs-built_in">add</span>(listview);
        low_view.<span class="hljs-built_in">add</span>(mapview);
        low_view.<span class="hljs-built_in">add</span>(choose);
        mapWin.<span class="hljs-built_in">add</span>(low_view);
        mapWin.<span class="hljs-built_in">add</span>(top_view);
        mapWin.<span class="hljs-built_in">open</span>();
    } <span class="hljs-keyword">catch</span>(e) {
        alert(e);
    }
}

<span class="hljs-comment">//scope of function f ended and now i attached an event with it,which is fired from the html inside we//bview (code posted in question)</span>
Ti.App.addEventListener(<span class="hljs-string">'popa'</span>, f);

<span class="hljs-comment">// I REPEAT THAT THIS EVENT DOESNT GET FIRED EVEN IF I REMOVE THE CODE AND PLACE //A SIMPLE ALERT IN IT.REFER TO THE PROBLEM IN THE QUESTION.</span>
</code></pre></div>
							<div class="author">
								&mdash; commented <span title="November 6th 2012, 2:47:52 am">November 6th 2012</span>
								by <span class='authorname'>Nezam Uddin</span>
							</div>
						</li>
					
					</ul>
				
			</section>
		</footer>
		<aside class="vote-box">
			<div class="score"><span>1</span> Vote</div>
			<div class="answers"><span>2</span> Answers</div>
		</aside>
	</div>

	<hr>

	<h3>2 Answers</h3>

	
		<ul class="answers">
			
				<li class="answer">
				
					<article id="answer-250616">
				
						<section>
							<p>The Ti object is only injected into the WebView pages when loading local pages (via url) or loading pages using the <code>web.html</code> property.</p>
<p>See this <a href="http:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;144346&#x2F;titanium-object-missing-in-webview-when-refreshing-the-page#answer-250615">Q&amp;A</a> for a simple trick to inject the limited webview Ti object into any webpage. You can get more creative from there…</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="November 6th 2012, 12:27:28 am">November 6th 2012</span>
								by <span class='authorname'>David Bankier</span><br>
								<a class="icon-bg icon-link" href="question/144372/cant-find-variable-ti---when-webview-loads-url-via-hrefs#answer-250616" rel="permalink">permalink</a>
							</div>

							<h5>9 Comments</h5>
							
								<ul class="comments">
								
									<li class="comment">
										<p><p>my html is local only.It&#39;s within the HTML folder.So is this a titanium bug that Ti feels uneasy and predicts this as something &#39;online&#39; ? gonna look into your link now.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 6th 2012, 2:50:11 am">November 6th 2012</span>
											by <span class='authorname'>Nezam Uddin</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>Tried that david,gives me a blank page instead of my index.html.Does&#39;nt work.Anything else?</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 6th 2012, 3:32:17 am">November 6th 2012</span>
											by <span class='authorname'>Nezam Uddin</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>I just tried the code below fine. It is modified from the code above. </p>
<p>In a nutshell you needed to inject the Ti object in every page you surf to after the first local html file - this is not done for you by the SDK. That is why I&#39;m listening to the &#39;load&#39; event - for every page load. It <em>might</em> not work with your specific html, but you should be able to adapt it to work.</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> win = Ti.UI.createWindow();
<span class="hljs-keyword">var</span> web = Ti.UI.createWebView({
    url: <span class="hljs-string">"http://www.theaustralian.com.au"</span>
});

<span class="hljs-keyword">var</span> injected = <span class="hljs-literal">false</span>;
web.addEventListener(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
    Ti.API.info(<span class="hljs-string">"LOADING"</span>);
    <span class="hljs-keyword">if</span> (!injected) {
        Ti.API.info(<span class="hljs-string">"INJECTING"</span>);
        web.html=web.html;
        injected = <span class="hljs-literal">true</span>;
    } <span class="hljs-keyword">else</span> {
        injected = <span class="hljs-literal">false</span>;
    }
    web.evalJS(<span class="hljs-string">"Ti.App.fireEvent('injected');"</span>);
});

Ti.App.addEventListener(<span class="hljs-string">"injected"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span>{
   Ti.API.info(<span class="hljs-string">"I'M HIT"</span>);
});

win.add(web);
win.open();
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="November 6th 2012, 4:02:48 am">November 6th 2012</span>
											by <span class='authorname'>David Bankier</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>This is my code.. IM HIT is not coming up.. although &quot;came in&quot; shows up:</p>
<p>please help:</p>
<pre><code class="hljs"><span class="hljs-comment">// Create a WebView, this will host the HTML</span>
    <span class="hljs-keyword">var</span> webView = Ti.UI.createWebView({

        showScrollbars : <span class="hljs-keyword">false</span>,

        left : gutter,
        top : gutter,
        right : gutter,
        bottom : gutter,


        opacity : animationsOn ? <span class="hljs-number">0</span> : <span class="hljs-number">1</span>,
        enableZoomControls : <span class="hljs-keyword">false</span>, <span class="hljs-comment">// Android only</span>
        <span class="hljs-comment">// Default assumes that all HTML is in the HTML folder and the first file is index.html, you can change the next line to suit your HTML.</span>
        url : <span class="hljs-string">'/HTML/home.html'</span>
    });
    <span class="hljs-keyword">var</span> injected = <span class="hljs-keyword">false</span>;
    webView.addEventListener(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        Ti.API.info(<span class="hljs-string">"LOADING"</span>);
        <span class="hljs-keyword">var</span> arr = webView.getUrl().split(<span class="hljs-string">'/'</span>);
        <span class="hljs-comment">//alert("webview loaded:"+arr[arr.length-1]);</span>
        <span class="hljs-keyword">if</span> (arr[arr.length - <span class="hljs-number">1</span>] == <span class="hljs-string">"getdirections.html"</span>) {
            Ti.API.info(<span class="hljs-string">"LOADING"</span>);
            <span class="hljs-keyword">if</span> (!injected) {
                Ti.API.info(<span class="hljs-string">"INJECTING"</span>);
                webView.html = webView.html;
                injected = <span class="hljs-keyword">true</span>;
            } <span class="hljs-keyword">else</span> {
                injected = <span class="hljs-keyword">false</span>;
            }
            alert(<span class="hljs-string">"came in"</span>);
            web.evalJS(<span class="hljs-string">"Ti.App.fireEvent('injected');"</span>);
        }
        <span class="hljs-comment">//webView.evalJS("Ti.App.fireEvent('popa',{});");</span>
    });
    <span class="hljs-comment">//webView.html = webView.html;</span>
    <span class="hljs-comment">//webView.setWidth(50);</span>
    Ti.App.addEventListener(<span class="hljs-string">"injected"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span> </span>{
        alert(<span class="hljs-string">"I'M HIT"</span>);
    });

    <span class="hljs-keyword">self</span>.add(webView);
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="November 14th 2012, 4:48:11 am">November 14th 2012</span>
											by <span class='authorname'>Nezam Uddin</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>In the above code your page is effectively being loaded twice. The first time without Ti, and the second time (because of the trick) with Ti. I don&#39;t think that the second time the webView.getUrl() will be what you are expecting as the trick sets the html content manually and not via an url.</p>
<p>Move the web.eval statement outside your <code>if (arr...</code> statement and try again.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 14th 2012, 10:04:28 am">November 14th 2012</span>
											by <span class='authorname'>David Bankier</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>can you explain me what is actually happening? because although i made it through with some tweaks,but when i try to fire from other html pages i still get ReferenceError.. that means the Ti is not injected.</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 14th 2012, 12:14:38 pm">November 14th 2012</span>
											by <span class='authorname'>Nezam Uddin</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>please explain to me why and i mean <strong>WHY</strong> the <code>Ti.App.fireEvent(&amp;#39;name&amp;#39;,{});</code> works when called in some html pages and gives referenceError in others?</p>
<p>heres some code which isn&#39;t working:(notice the changes)</p>
<p>Code:</p>
<pre><code class="hljs">    webView.addEventListener(<span class="hljs-string">'load'</span>, <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">()</span></span> {
        Ti.API.info(<span class="hljs-string">"LOADING"</span>);
        //var arr = webView.getUrl().split(<span class="hljs-string">'/'</span>);
        //alert(<span class="hljs-string">"webview loaded:"</span>+arr[arr.length-<span class="hljs-number">1</span>]);
        //<span class="hljs-keyword">if</span> (arr[arr.length - <span class="hljs-number">1</span>] == <span class="hljs-string">"home.html"</span>) 
        {
            Ti.API.info(<span class="hljs-string">"LOADING"</span>);
            <span class="hljs-keyword">if</span> (!injected) {
                Ti.API.info(<span class="hljs-string">"INJECTING"</span>);
                webView.html = webView.html;
                injected = <span class="hljs-keyword">true</span>;
            } <span class="hljs-keyword">else</span> {
                injected = <span class="hljs-keyword">false</span>;
            }
            //alert(<span class="hljs-string">"came in"</span>);
            web.evalJS(<span class="hljs-string">"Ti.App.fireEvent('injected');"</span>);
        }
        //webView.evalJS(<span class="hljs-string">"Ti.App.fireEvent('popa',{});"</span>);
    });
</code></pre><p>and HTML has a script tag.Within it a function which fires Ti</p>
<pre><code class="hljs"><span class="hljs-keyword">for</span> ( <span class="hljs-keyword">g</span> = 0; <span class="hljs-keyword">g</span> &lt; decDist.length; <span class="hljs-keyword">g</span>++) {
                                        qs = decDist[<span class="hljs-keyword">g</span>][0].substring(7);
                    try{Ti.<span class="hljs-keyword">App</span>.fireEvent('getFeed',{<span class="hljs-keyword">st</span>:qs});}catch(<span class="hljs-keyword">e</span>){alert(<span class="hljs-keyword">e</span>);}
                    }
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="November 14th 2012, 12:18:48 pm">November 14th 2012</span>
											by <span class='authorname'>Nezam Uddin</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>app.js:</p>
<pre><code class="hljs"><span class="hljs-keyword">var</span> createLis = <span class="hljs-function"><span class="hljs-keyword">function</span><span class="hljs-params">(e)</span> </span>{
    <span class="hljs-keyword">var</span> feedHTML = <span class="hljs-string">""</span>;
    <span class="hljs-keyword">var</span> db = Ti.Database.install(<span class="hljs-string">'sxyz.db'</span>, <span class="hljs-string">'storeDB'</span>);
    <span class="hljs-keyword">var</span> rows = db.execute(<span class="hljs-string">'SELECT * FROM stores where Store='</span>+e.st);
    alert(<span class="hljs-string">"create"</span>);
    alert(feedHTML);
}
Ti.App.addEventListener(<span class="hljs-string">'getFeed'</span>, createLis);
</code></pre></p>
										<div class="author">
											&mdash; commented <span title="November 14th 2012, 12:20:42 pm">November 14th 2012</span>
											by <span class='authorname'>Nezam Uddin</span>
										</div>
									</li>
								
									<li class="comment">
										<p><p>all this is local NOT ONLINE HTMLS.</p>
<p>Aaron where are you?</p>
</p>
										<div class="author">
											&mdash; commented <span title="November 14th 2012, 12:21:36 pm">November 14th 2012</span>
											by <span class='authorname'>Nezam Uddin</span>
										</div>
									</li>
								
								</ul>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
				<li class="answer">
				
					<article id="answer-253152">
				
						<section>
							<p>Got it solved via <a href="https:&#x2F;&#x2F;developer.appcelerator.com&#x2F;question&#x2F;133609&#x2F;linking-to-another-page-within-webview-loses-access-to-the-titanium-javascript-object">this</a></p>
<p>All Praises to Allah Alone.</p>

						</section>
						<footer>
							<div class="author">
								&mdash; answered <span title="December 20th 2012, 9:14:54 am">December 20th 2012</span>
								by <span class='authorname'>Nezam Uddin</span><br>
								<a class="icon-bg icon-link" href="question/144372/cant-find-variable-ti---when-webview-loads-url-via-hrefs#answer-253152" rel="permalink">permalink</a>
							</div>

							<h5>0 Comments</h5>
							
						</footer>
						<aside class="vote-box">
							<div class="score"><span>0</span> Votes</div>
						</aside>
					</article>
				</li>
			
		</ul>
	
</article>

		</div>
		<div class="col-sm-3"></div>
	</div>
	<div class="row"><div class="signoff">The ownership of individual contributions to this community generated content is retained by the authors of their contributions.<br>All trademarks remain the property of the respective owner.</div></div>
</main>


</body>
</html>
